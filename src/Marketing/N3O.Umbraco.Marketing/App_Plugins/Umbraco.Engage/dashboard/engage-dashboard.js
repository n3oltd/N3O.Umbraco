!function(){function uMarketingSuiteController(eventEmitter,$timeout,$rootScope,packageState,$q,userGroupPermissionsService,userService,umsConfigurationService){var $ctrl=this;function updateTitle(){$timeout(function(){$rootScope.locationTitle.indexOf("Engage")>-1&&($rootScope.locationTitle=$rootScope.locationTitle.replace("engage","engage"))})}this.disableAnalytics=!1,this.disableAbTesting=!1,this.disablePersonalization=!1,this.disableProfiles=!1,this.disableReporting=!1,this.showAnalytics=!0,this.showAbTesting=!0,this.showPersonalization=!0,this.showProfiles=!0,this.showSettings=!0,this.showReporting=!0,function init(){$("#umb-notifications-wrapper").addClass("ums-active"),updateTitle(),eventEmitter.on("umsPathChange",updateTitle),function checkPermissions(){$q.all([packageState.loadState,userGroupPermissionsService.getAll(),userService.getCurrentUser(),umsConfigurationService.getConfiguration()]).then(function(data){var state=data[0],permissions=data[1],user=data[2],configuration=data[3],userGroups=null==user||null==user.userGroups?[]:user.userGroups;function canAccess(section){return userGroups.some(function(userGroup){return permissions.some(function(permission){return permission.userGroupAlias===userGroup&&permission["accessTo"+section]})})}var canAccessAnalytics=canAccess("Analytics"),canAccessAbTesting=canAccess("AbTesting"),canAccessPersonalization=canAccess("Personalization"),canAccessSettings=canAccess("Settings"),canAccessProfiles=canAccess("Profiles"),canAccessReporting=canAccess("Reporting");$ctrl.disableAnalytics=!state.featureAnalyticsEnabled,$ctrl.showAnalytics=canAccessAnalytics,$ctrl.disableAbTesting=!state.featureAbTestingEnabled,$ctrl.showAbTesting=canAccessAbTesting,$ctrl.disablePersonalization=!state.featurePersonalizationEnabled||!canAccessPersonalization,$ctrl.showPersonalization=canAccessPersonalization,$ctrl.disableProfiles=!canAccessProfiles||!state.featureAnalyticsEnabled,$ctrl.showProfiles=canAccessProfiles,$ctrl.showSettings=canAccessSettings,$ctrl.disableReporting=!state.featurePersonalizationEnabled||!canAccessReporting,$ctrl.showReporting=canAccessReporting&&configuration&&configuration.reporting&&!0===configuration.reporting.dataGenerationEnabled})}()}()}function umsAccordionItemCtrl($transclude){var ctrl=this;this.state={open:!1,personalisationEnabled:!1,showStatus:$transclude.isSlotFilled("status")},this.toggleItem=function(){this.state.open=!this.state.open},this.$onInit=function(){ctrl.isPersonalisation&&(this.state.personalisationEnabled=!0),ctrl.isOpenDefault&&(this.state.open=ctrl.isOpenDefault)}}function umsAnnotationEditorController(service,utils,notificationsService){var ctrl=this;this.visibilityOptions=[],this.$onInit=function(){this.state.annotation=angular.copy(this.annotation),this.visibilityOptions.push({name:"Everywhere",value:0}),null!=this.contentId&&this.visibilityOptions.push({name:"This node",value:1},{name:"This node + descendants",value:2})},this.state={annotation:null,timepicker:{options:{altInput:!0,enableTime:!0,dateFormat:"YYYY-MM-DDTHH:mm:ss[Z]",altformat:"M d, Y h:mm a",time_24hr:!0,allowInput:!0},timestamp:null}},this.fn={visibilityOnChange:function(){switch(ctrl.state.annotation.visibility){case 0:ctrl.state.annotation.pageVariants.length=0;break;case 1:case 2:null!=ctrl.contentId&&null!=ctrl.culture&&ctrl.state.annotation.pageVariants.push({contentId:ctrl.contentId,culture:ctrl.culture})}},save:function(){if(null!=ctrl.state.annotation&&null!==ctrl.state.annotation.timestamp){var isNew=0===ctrl.state.annotation.id;service.save(ctrl.state.annotation).then(function(response){var savedAnnotation=response.data;utils.merge(ctrl.annotation,savedAnnotation);var onChange=isNew?ctrl.onCreate:ctrl.onEdit;"function"==typeof onChange&&onChange({annotation:savedAnnotation}),"function"==typeof ctrl.onSave&&ctrl.onSave({annotation:savedAnnotation}),notificationsService.success('Annotation "'+ctrl.state.annotation.description+'" created'),ctrl.close()})}},convertDate:function(date){return new Date(date)},onSetupPicker:function(picker,initDate){picker.element.placeholder="Select date...",ctrl.state.timepicker.timestamp=picker,initDate&&ctrl.state.timepicker.timestamp.setDate(ctrl.fn.convertDate(initDate),!1)},onTimePickerChange:function(picker){picker.selectedDates.length>0?ctrl.state.annotation.timestamp=picker.selectedDates[0]:ctrl.state.annotation.timestamp=null}}}function umsAnnotationsPluginFactory(){function umsAnnotationsPlugin(chart,annotations,enabled){this.chart=chart,this.id="ums-annotations",this.annotations=annotations,this.annotationImages={},this.enabled=!!enabled}return umsAnnotationsPlugin.prototype.enable=function(){this.enabled||(this.enabled=!0,this.reload())},umsAnnotationsPlugin.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.reload())},umsAnnotationsPlugin.prototype.reload=function(){this.chart.render()},umsAnnotationsPlugin.prototype.getXAxisValuePosisition=function(chartInstance,pointIndex){return chartInstance.getDatasetMeta(0).data[pointIndex]._model.x},umsAnnotationsPlugin.prototype.renderAnnotationMarker=function(chartInstance,annotation){if(this.enabled&&null!=annotation&&null!=annotation.icon){var labelIndex=this.getAnnotationIndex(chartInstance,annotation);if(-1!==labelIndex){var imageSize=14,lineLeftOffset=this.getXAxisValuePosisition(chartInstance,labelIndex)-imageSize/2,scaleY=chartInstance.scales["y-axis-0"],context=chartInstance.chart.ctx;context.beginPath();var image=this.annotationImages[annotation.icon];if(null==image){var img=new Image;img.onload=function(){drawImageOnCanvas(img)},img.src=annotation.icon,this.annotationImages[annotation.icon]=img}else drawImageOnCanvas(image)}}function drawImageOnCanvas(annotationIcon){try{context.drawImage(annotationIcon,lineLeftOffset,scaleY.bottom-imageSize/2,imageSize,imageSize)}catch(_){}}},umsAnnotationsPlugin.prototype.getAnnotationIndex=function(chartInstance,annotation){return _.findIndex(chartInstance.config.data.labels.dates,function(dateArray){return dateArray.indexOf(annotation.date)>-1})},umsAnnotationsPlugin.prototype.afterDraw=function(chart,easing){this.enabled&&null!=this.annotations&&0!==this.annotations.length&&(chart.canvas.style.cursor="",this.annotations.forEach(this.renderAnnotationMarker.bind(this,chart)))},umsAnnotationsPlugin.prototype.resize=function(){"function"==typeof this.onResize&&this.onResize(this)},umsAnnotationsPlugin}function umsAnnotationsController(service,daterangePickerService,umsUtilService,notificationsService){var self=this,destroyFns=[];this.state={isLoading:!0,annotations:[],edit:{annotation:null},confirm:null},this.$onInit=function(){null!=this.onInit&&this.onInit({component:this}),this.initDaterange(),this.initContentIdCulture(),this.refresh()},this.initDaterange=function(){if(!this.from&&!this.to){var config=daterangePickerService.getConfig(),range=daterangePickerService.getRange();this.setFromAndTo(config,range),destroyFns.push(daterangePickerService.onChange(function(config,range){this.setFromAndTo(config,range),this.refresh()}.bind(this)))}},this.initContentIdCulture=function(){if(!this.contentId&&!this.culture){var contentId=umsUtilService.getCurrentContentId();if(null==contentId)return;this.contentId=contentId,this.culture=umsUtilService.getCurrentCulture()}},this.setFromAndTo=function(config,range){config.compare?(this.from=range.primary.from<range.secondary.from?range.primary.from:range.secondary.from,this.to=range.primary.to>range.secondary.to?range.primary.to:range.secondary.to):(this.from=range.primary.from,this.to=range.primary.to)},this.$onChanges=function(changes,b,c){(changes.from||changes.to||changes.contentId||changes.culture)&&(this.updateDaterange(),this.refresh())},this.$onDestroy=function(){null!=this.onDestroy&&this.onDestroy({component:this}),destroyFns.forEach(function(fn){fn()})},this.add=function add(){service.getEmpty().then(function(response){this.state.edit.annotation=response.data}.bind(this))},this.edit=function edit(annotation){this.state.edit.annotation=annotation},this.remove=function remove(annotation){this.state.confirm={header:"Remove annotation",fn:function confirmFn(){service.remove(annotation.id).then(function(){self.refresh(),self.triggerChange(annotation,"delete"),notificationsService.success('Annotation "'+annotation.description+'" deleted')})}}},this.refresh=function refresh(){this.isLoading=!0,service.getAll(this.contentId,this.culture,this.from,this.to).then(function(annotations){this.annotations=annotations||[]}.bind(this)).finally(function(){this.isLoading=!1}.bind(this))},this.annotationFilter=function annotationFilter(annotation){return null==this.state.filter.from||null==this.state.filter.to||annotation.timestamp>=this.state.filter.from&&annotation.timestamp<=this.state.filter.to},this.triggerChange=function triggerChange(annotation,type){if("function"==typeof this.onChange){var evt={sender:this,annotation:annotation,type:type};this.onChange({evt:evt})}},this.onCreate=function onCreate(annotation){this.triggerChange(annotation,"create")},this.onEdit=function onEdit(annotation){this.triggerChange(annotation,"edit")},this.showTable=function showTable(){null!=this.onShow&&this.onShow(),this.state.showTable=!0},this.hideTable=function hideTable(){null!=this.onHide&&this.onHide(),this.state.showTable=!1},this.getIconByIconUrl=function getIconByIconUrl(url){return url.includes("ab-test-start")?"A/B Test Start":url.includes("ab-test-end")?"A/B Test End":url.includes("created-in-umbraco")?"Created in Umbraco":url.includes("custom-specific-annotation")?"Custom Specific Annotation":url.includes("custom-specific-subnode")?"Custom Specific Subnode":url.includes("published-in-umbraco")?"Published":"Custom Global Annotation"}}function umsAnnotationsService(UmsDownloader){var api=new UmsDownloader("/umbraco/backoffice/engage/annotations/");function getAllGlobal(from,to){return api.get("getallglobal?from="+encodeURIComponent(from)+"&to="+encodeURIComponent(to)).then(function(response){return response.data})}function getAllForPage(contentId,culture,from,to){return api.get("getallforpage?contentid="+contentId+"&culture="+culture+"&from="+encodeURIComponent(from)+"&to="+encodeURIComponent(to)).then(function(response){return response.data})}this.getAll=function getAll(contentId,culture,from,to){return null==contentId?getAllGlobal(from,to):getAllForPage(contentId,culture,from,to)},this.getAllForPage=getAllForPage,this.getAllGlobal=getAllGlobal,this.save=function save(annotation){return api.post("save",annotation)},this.remove=function remove(annotationId){return api.post("delete?id="+annotationId)},this.getEmpty=function getEmpty(){return api.get("getEmpty")}}function initializeUmsChartPrefabsConstant(configurationService,UMS_CHART_PREFABS,callback){var PREFABS={pageviews:{metrics:[ums.constants.metrics.pageviews],unit:"pageviews",unitSingular:"pageview"},pageviews_withsubpages:{metrics:[ums.constants.metrics.pageviewsWithSubpages],unit:"pageviews",unitSingular:"pageview"},referrals:{metrics:[ums.constants.metrics.pageviews],unit:"pageviews",unitSingular:"pageview"},devicetypes:{metrics:[ums.constants.metrics.pageviews],dimension:ums.constants.dimensions.deviceCategory,type:"bar",stack:!0,unit:"pageviews",unitSingular:"pageview"},devicetypes_page:{metrics:[ums.constants.metrics.pageviews],dimension:ums.constants.dimensions.deviceCategory,type:"bar",stack:!0,unit:"pageviews",unitSingular:"pageview"},devicetypes_page_withsubpages:{metrics:[ums.constants.metrics.pageviewsWithSubpages],dimension:ums.constants.dimensions.deviceCategory,type:"bar",stack:!0,unit:"pageviews",unitSingular:"pageview"},bots:{metrics:[ums.constants.metrics.pageviewsBot],unit:"pageviews",unitSingular:"pageview"},goals:{metrics:[ums.constants.metrics.goalCompletionsAll],unit:"goal completions",unitSingular:"goal completion"},visitors:{metrics:[ums.constants.metrics.visitors],dimension:ums.constants.dimensions.usertype,type:"bar",stack:!0,unit:"visitors",unitSingular:"visitor"},pagevisitors:{metrics:[ums.constants.metrics.pageVisitors],dimension:ums.constants.dimensions.usertype,type:"bar",stack:!0,unit:"visitors",unitSingular:"visitor"},pagevisitors_withsubpages:{metrics:[ums.constants.metrics.pageVisitorsWithSubpages],dimension:ums.constants.dimensions.usertype,type:"bar",stack:!0,unit:"visitors",unitSingular:"visitor"},sessions:{metrics:[ums.constants.metrics.sessions],unit:"sessions",unitSingular:"session"},pagesessions:{metrics:[ums.constants.metrics.pageSessions],unit:"sessions",unitSingular:"session"},pagesessions_withsubpages:{metrics:[ums.constants.metrics.pageSessionsWithSubpages],unit:"sessions",unitSingular:"session"},events:{metrics:[ums.constants.metrics.totalEvents],unit:"events",unitSingular:"event"},segmentinsights:{realtime:!0,metrics:[ums.constants.metrics.pageviews],dimension:ums.constants.dimensions.pageviewSegmentName,unit:"pageviews",unitSingular:"pageview"},appliedsegmentinsights:{realtime:!0,metrics:[ums.constants.metrics.pageviews],dimension:ums.constants.dimensions.pageviewAppliedSegmentName,filter:"pageviewAppliedSegmentName!~'(deleted segment:'",unit:"displays",unitSingular:"display"},campaigns:{metrics:[ums.constants.metrics.pageviews],unit:"entries",unitSingular:"entry"},campaigns_page:{metrics:[ums.constants.metrics.pageviews],unit:"entries",unitSingular:"entry"},videos:{metrics:[ums.constants.metrics.videoPlays],unit:"views",unitSingular:"view"},umbracoformssubmissions:{metrics:[ums.constants.metrics.umbracoFormsSubmissions],unit:"submissions",unitSingular:"submission"},locations:{metrics:[ums.constants.metrics.sessions],unit:"sessions",unitSingular:"session"},locations_withsubpages:{metrics:[ums.constants.metrics.pageSessionsWithSubpages],unit:"sessions",unitSingular:"session"},locations_page:{metrics:[ums.constants.metrics.pageSessions],unit:"sessions",unitSingular:"session"},timeonpage:{metrics:[ums.constants.metrics.avgTimeOnPage,ums.constants.metrics.avgEngagedTimeOnPage],unit:"seconds",unitSingular:"second"},segmentpageviewcoverage:{type:"bar",stack:!0,unit:"pageviews",unitSingular:"pageview",metrics:[ums.constants.metrics.activeSegmentPageviews,ums.constants.metrics.inactiveSegmentPageviews]},segmentsessioncoverage:{type:"bar",stack:!0,unit:"sessions",unitSingular:"session",metrics:[ums.constants.metrics.activeSegmentSessions,ums.constants.metrics.inactiveSegmentSessions]},segmentprofilecoverage:{type:"bar",stack:!0,unit:"profiles",unitSingular:"profile",metrics:[ums.constants.metrics.activeSegmentProfiles,ums.constants.metrics.inactiveSegmentProfiles]},segmentpersonalizationpageviewcoverage:{type:"bar",stack:!0,unit:"pageviews",unitSingular:"pageview",metrics:[ums.constants.metrics.activePersonalizedSegmentPageviews,ums.constants.metrics.inactivePersonalizedSegmentPageviews]},segmentpersonalizationsessioncoverage:{type:"bar",stack:!0,unit:"sessions",unitSingular:"session",metrics:[ums.constants.metrics.activePersonalizedSegmentSessions,ums.constants.metrics.inactivePersonalizedSegmentSessions]},segmentpersonalizationprofilecoverage:{type:"bar",stack:!0,unit:"profiles",unitSingular:"profile",metrics:[ums.constants.metrics.activePersonalizedSegmentProfiles,ums.constants.metrics.inactivePersonalizedSegmentProfiles]},searches:{type:"bar",stack:!0,unit:"search volume",unitSingular:"search volume",metrics:[ums.constants.metrics.searchVolume]},searches_withsubpages:{type:"bar",stack:!0,unit:"search volume",unitSingular:"search volume",metrics:[ums.constants.metrics.searchVolumeWithSubpages]}};configurationService.getConfiguration().then(function(config){!0!==config.reporting.dataGenerationEnabled&&(PREFABS.referrals.filter="hostname!=referralHostname",PREFABS.campaigns.filter="campaign!=''",PREFABS.bots.metrics=[ums.constants.metrics.pageviews],function enableRealTimeReporting(){for(var table in PREFABS)PREFABS[table].realtime=!0,"string"==typeof PREFABS[table].filter&&PREFABS[table].filter.length>0?PREFABS[table].filter="visitorType=='person';"+PREFABS[table].filter:PREFABS[table].filter="visitorType=='person'"}(),delete PREFABS.goals.filter,PREFABS.bots.filter="visitorType=='bot';bot!=''"),angular.extend(UMS_CHART_PREFABS,PREFABS)}).catch(function(){}).then(()=>{"function"==typeof callback&&callback()})}function umsPrefabChartController(umsConfigurationService,UMS_CHART_PREFABS){var self=this;self.theme="default",self.size="large",self.currentFilter=null,self.showAnnotations=!0,self.isFullHeight=!1,self.showPercentages=!1,self.metrics=null,self.isLoading=!0;var EMPTY_ARRAY=[];function definePrefabProperty(name,defaultValue){void 0===defaultValue&&(defaultValue=null),Object.defineProperty(self,name,{get:function(){if("string"!=typeof self.alias)throw"Prefab chart has no alias!";var prefab=UMS_CHART_PREFABS[self.alias.toLowerCase()];if(null==prefab)return defaultValue;var value=prefab[name];return void 0===value?defaultValue:value}})}function determineFilter(){var drilldown=null;if(null===self.drilldown||void 0===self.drilldown||"boolean"==typeof self.drilldown)drilldown=[];else if("string"==typeof self.drilldown)drilldown=[self.drilldown];else{if(!Array.isArray(self.drilldown))throw'Expected drilldown to be null, undefined, a string or an array, but instead found "'+typeof self.drilldown+'" instead!';drilldown=self.drilldown}if("string"!=typeof self.alias)throw"Prefab chart has no alias!";var prefab=UMS_CHART_PREFABS[self.alias.toLowerCase()],baseFilter=prefab&&prefab.filter||"";return 0===drilldown.length?[baseFilter]:baseFilter?drilldown.map(function(dd){return baseFilter+";"+dd}):drilldown}Object.defineProperty(self,"filter",{get:function(){return self.currentFilter||(self.currentFilter=determineFilter()),self.currentFilter}}),definePrefabProperty("type","line"),definePrefabProperty("dimension"),definePrefabProperty("stack",!1),definePrefabProperty("unit"),definePrefabProperty("unitSingular"),definePrefabProperty("realtime",!1),definePrefabProperty("trendIndex",null),self.$onChanges=function(changes){initializeUmsChartPrefabsConstant(umsConfigurationService,UMS_CHART_PREFABS,()=>(function updateMetrics(changes){if(changes&&changes.alias&&changes.alias.currentValue&&!UMS_CHART_PREFABS[changes.alias.currentValue.toLowerCase()])throw"There is no prefab chart with alias '"+changes.alias.currentValue+"'.";(changes.drilldown||changes.alias)&&(self.currentFilter=determineFilter());changes.metrics&&self.metrics&&!Array.isArray(self.metrics)&&(self.metrics=[self.metrics]);self.isLoading=!1})(changes))},Object.defineProperty(self,"allMetrics",{get:function(){if(self.metrics)return self.metrics;if("string"!=typeof self.alias)throw"Prefab chart has no alias!";var prefab=UMS_CHART_PREFABS[self.alias.toLowerCase()];return null==prefab?EMPTY_ARRAY:void 0===prefab.metrics?EMPTY_ARRAY:prefab.metrics}})}function umsConfigurationReportingController($scope,$http,$interval){var ctrl=this,state=this.state={configuration:null,isGenerating:!1,confirm:null};const endpoint="/umbraco/backoffice/engage/reporting/";$scope.getState=function(){$http.get(endpoint+"GetGenerationStatus").then(function(response){response.data.isGenerating?(state.isGenerating=!0,ctrl.$onChanges()):(state.isGenerating=!1,ctrl.$onChanges())}).catch(function(error){console.error("Error checking process status:",error)})},this.$onInit=function(){$scope.getState()},this.$onChanges=function(){state.isGenerating?(ctrl.regenerateButtonText="Generating...",ctrl.regenerateButtonDisabled=!0):(ctrl.regenerateButtonText="Regenerate",ctrl.regenerateButtonDisabled=!1)};var intervalPromise=$interval($scope.getState,5e3);function regenerateData(){state.isGenerating=!0,$http.post(endpoint+"StartDataGeneration").then(function(response){$scope.getState()}).catch(function(error){console.error("Error starting data generation:",error)}),ctrl.$onChanges()}$scope.$on("$destroy",function(){$interval.cancel(intervalPromise)}),ctrl.closeConfirm=function(){state.confirm=null},ctrl.confirmRegenerate=function(){state.confirm={header:"Are you sure?",text:"Warning! Regenerating reporting data might have an impact on the performance of the site.",fn:regenerateData}}}function umsConfigurationController(service,notificationsService){var ctrl=this,state=this.state={configuration:null,isLoading:!0,confirm:null,enabled:!0};this.$onInit=function(){ctrl.refresh()},this.refresh=function refresh(){ctrl.getAll().then(function(){service.mainSwitchStatus().then(function(on){state.enabled=on&&state.configuration.settings.enabled})})},this.getAll=function(){return service.getConfiguration().then(function(configuration){state.configuration=configuration,state.isLoading=!1})},this.closeConfirm=function(){state.confirm=null,ctrl.refresh()},this.umsActivityChanges=function($event,value){if(!0===value&&!1===ctrl.state.enabled)service.mainSwitchOn().then(function(){ctrl.refresh(),notificationsService.success("Umbraco Engage is enabled. From this moment on, Umbraco Engage is collecting data.")});else if(!1===value&&!0===ctrl.state.enabled){$event.preventDefault(),$event.stopPropagation(),state.confirm={header:"Are you sure?",text:"If Umbraco Engage is disabled, no data will be collected and no personalization or A/B testing is applied.",fn:function confirmFn(){service.mainSwitchOff().then(function(){ctrl.refresh(),ctrl.state.enabled=!1,notificationsService.success("Umbraco Engage is disabled. This means that Umbraco Engage is not collecting data anymore.")})}}}}}function umsConfigurationService($http,$q,userService){var root="/umbraco/backoffice/engage/",self=this;function getConfiguration(forceRefresh){return self.ConfigurationPromise?self.ConfigurationPromise:!forceRefresh&&self.Configuration?$q.resolve(self.Configuration):userService.isAuthenticated().then(function(isAuthenticated){if(!isAuthenticated)throw new Error("Not authenticated");return self.ConfigurationPromise=$http.get(root+"configuration/getconfiguration").then(function(response){return self.ConfigurationPromise=null,self.Configuration=response.data})})}self.Configuration=null,self.ConfigurationPromise=null,this.getConfiguration=getConfiguration,this.mainSwitchOn=function mainSwitchOn(){return $http.post(root+"mainswitch/turnon")},this.mainSwitchOff=function mainSwitchOff(){return $http.post(root+"mainswitch/turnoff")},this.mainSwitchStatus=function mainSwitchStatus(){return $http.get(root+"mainswitch/status").then(function(response){return null!=response.data&&response.data.on||!1})},getConfiguration().catch(function(){})}function umsContentTypeService($http){var root="/umbraco/backoffice/engage/contenttype/";this.getAll=function(){return $http.get(root+"GetAllContentTypes").then(function(response){return response.data||[]})},this.hasSegmentedProperty=function(contentTypeId){return $http.get(root+"HasSegmentedProperty?contentTypeId="+contentTypeId).then(function(response){return response.data||!1})}}function umsCssJsEditorCtrl(){this.hasCss=!1,this.hasJs=!1,this.$onInit=function(){this.hasCss=this.hasContent(this.css),this.hasJs=this.hasContent(this.js)},this.hasContent=function(value){return null!=value&&value.length>0}}function groupByControlsController(eventEmitter,localStorageService){var destroyFns=[];this.state={groupBy:"day"},this.update=function(newValue,skipEvents){var oldValue=this.state.groupBy;if(oldValue!==newValue&&(this.state.groupBy=newValue,this.persist(newValue),!skipEvents)){var params={sender:this,oldValue:oldValue,newValue:newValue};eventEmitter.emit("groupByControls.onChange",params),"function"==typeof this.onChange&&this.onChange(params)}},this.persist=function(value){localStorageService.save("ums-group-by-controls",{value:value})},this.onSync=function(evt){evt.sender!==this&&this.update(evt.newValue,!0)},this.$onInit=function(){var stored=localStorageService.get("ums-group-by-controls");null!=stored&&null!=stored.value&&stored.value!==this.state.groupBy&&this.update(stored.value),destroyFns.push(eventEmitter.on("groupByControls.onChange",this.onSync.bind(this)))},this.$onDestroy=function(){for(var i=0;i<destroyFns.length;i++)destroyFns[i]()}}function umsIpFilterEditorController(service,utils){var ctrl=this;this.$onInit=function(){this.state.ipFilter=angular.copy(this.ipFilter)},this.state={ipFilter:null},this.fn={addIpAddress:function(){null==ctrl.state.ipFilter.ipAddresses&&(ctrl.state.ipFilter.ipAddresses=[]),ctrl.state.ipFilter.ipAddresses.push("")},removeIpAddress:function(index){ctrl.state.ipFilter.ipAddresses.splice(index,1)},save:function(){null!=ctrl.state.ipFilter&&service.save(ctrl.state.ipFilter).then(function(response){var savedIpFilter=response.data;utils.merge(ctrl.ipFilter,savedIpFilter),ctrl.close(),"function"==typeof ctrl.onSave&&ctrl.onSave({ipFilter:savedIpFilter})})}}}function umsIpFiltersController(service,notificationsService){var ctrl=this;this.$onInit=function(){this.fn.getAll()},this.state={loading:!1,ipFilters:[],edit:{ipFilter:null},confirm:null},this.fn={getAll:function(){ctrl.state.loading=!0,service.getAll().then(function(response){ctrl.state.ipFilters=response.data}).finally(function(){ctrl.state.loading=!1})},add:function(){service.getEmpty().then(function(response){ctrl.state.edit.ipFilter=response.data})},refresh:function(){this.getAll()},edit:function(ipFilter){ctrl.state.edit.ipFilter=ipFilter},remove:function(ipFilter){ctrl.state.confirm={header:'Remove IP filter "'+ipFilter.name+'"',fn:function confirmFn(){service.deleteFilter(ipFilter.id).then(function(){ctrl.fn.refresh(),notificationsService.success('IP filter "'+ipFilter.name+'" was removed')})}}}}}function umsIpFiltersService(UmsDownloader){var api=new UmsDownloader("/umbraco/backoffice/engage/ipfilters/");this.getAll=function getAll(){return api.get("getall")},this.save=function save(ipFilter){return api.post("save",ipFilter)},this.deleteFilter=function deleteFilter(ipFilterId){return api.post("delete?id="+ipFilterId)},this.getEmpty=function getEmpty(){return api.get("getEmpty")}}var root,factory;function umsPackageService($http){var root="/umbraco/backoffice/engage/package/";this.getStatus=function getStatus(){return $http.get(root+"Status").then(function(response){if(response.data&&response.data.expirationDate){var date=new Date(response.data.expirationDate);date&&!isNaN(date.getTime())?response.data.expirationDate=date:response.data.expirationDate=null}return response.data})}}function umsPackageState(packageService){var state={initialized:!1,expirationDate:null,isPackageEnabled:!1,packageStatus:null,expiresSoon:!1,isNearLimit:!1,domains:[],tierName:null,monthlyPageviewLimit:null,currentPageviewsThisMonth:null,featureAnalyticsEnabled:!1,featureAbTestingEnabled:!1,featurePersonalizationEnabled:!1};return state.loadState=packageService.getStatus().then(function(status){return Object.assign(state,status,{initialized:!0}),state}),state}function umsReportingChartWrapperController(){}function umsRoutingHelper($routeParams,$location){var PATH_ROOT="/engage",PATH_ROOT_RE=new RegExp("^"+PATH_ROOT,"i");this.isUmsRoute=function isUmsRoute(route){return null!=route&&null!=route.pathParams&&"engage"===route.pathParams.section},this.isUmsSection=function isUmsSection(){return"engage"===$routeParams.section},this.getCurrentPath=function getCurrentPath(){return $location.path().replace(PATH_ROOT_RE,"")},this.getAbsolutePath=function getAbsolutePath(relativePath){return PATH_ROOT+relativePath}}function umsRouting($rootScope,$routeParams,$route,routingHelper,eventEmitter){var lastRoute=$route.current,cancelRoute=!1;$rootScope.$on("$routeChangeStart",function(evt,next,current){routingHelper.isUmsRoute(next)&&routingHelper.isUmsRoute(current)&&(cancelRoute=!0,$routeParams.tree="engage")}),$rootScope.$on("$routeChangeSuccess",function(){routingHelper.isUmsRoute($route.current)&&(delete $routeParams.method,delete $routeParams.id,$routeParams.tree="engage",lastRoute=$route.current)}),$rootScope.$on("$locationChangeSuccess",function(){if(routingHelper.isUmsRoute($route.current)){cancelRoute&&($route.current=lastRoute,cancelRoute=!1);var path=routingHelper.getCurrentPath();eventEmitter.emit("umsPathChange",path)}})}function umsScreenManagerController(routingHelper,$location){this.isCurrent=function isCurrent(path){return routingHelper.getCurrentPath()===path},this.isActive=function isActive(path){var currentPath=routingHelper.getCurrentPath();return null!=currentPath&&0===currentPath.indexOf(path+"/")},this.open=function open(path,params){var absolutePath=routingHelper.getAbsolutePath(path);$location.path(absolutePath).search(params||{})}}function umsScreenNavigationController(routingHelper){this.$onInit=function(){this.inUms=routingHelper.isUmsSection()}}function umsScreenUtils(){this.generateAlias=function generateAlias(name){return name.replace(/ +/g,"-").replace(/[^\w-]+/g,"").toLowerCase()}}function umsScreenController(eventEmitter,routingHelper,screenUtils,$timeout){this.destroyFns=[],this.$onInit=function(){if(null==this.name)throw new Error("<ums-screen>: name attribute is required and must not be empty");this.alias=this.alias||screenUtils.generateAlias(this.name),this.hide=!!this.hide,this.path=this.getPath(),this.destroyFns.push(eventEmitter.on("umsPathChange",this.handlePathChange.bind(this))),this.destroyFns.push(this.screensCtrl.remove.bind(this.screensCtrl,this));var path=routingHelper.getCurrentPath();this.handlePathChange(path),this.screensCtrl.add(this)},this.$onDestroy=function(){if(this.destroyFns.length>0)for(var i=0;i<this.destroyFns.length;i++)this.destroyFns[i]()},this.getPath=function(){var path="/"+this.alias;return null==this.parentScreen?path:this.parentScreen.path+path},this.handlePathChange=function(path){this.disabled||this.path!==path&&0!==path.indexOf(this.path+"/")||(this.active&&this.path===path?this.reset():this.activate())},this.reset=function(){if(!this.disabled&&!eventEmitter.emitCancelable("screenReset",{screen:this})){var screen=this;screen.active=!1,$timeout(function(){screen.active=!0})}},this.activate=function(){this.active||this.disabled||this.screensCtrl.activate(this)}}function umsScreensController(){this.screens=[],this.add=function(screen){this.screens.push(screen),screen.hide||screen.disabled||this.hasActiveScreen()||(screen.active=!0)},this.remove=function(screen){var idx=this.screens.indexOf(screen);idx>-1&&this.screens.splice(idx,1)},this.findScreen=function(predicate){for(var i=0;i<this.screens.length;i++){var screen=this.screens[i];if(predicate(screen))return screen}},this.activate=function(screen){if(!screen.disabled){for(var i=0;i<this.screens.length;i++)this.screens[i].active=!1;screen.active=!0}},this.hasActiveScreen=function(){return this.screens.some(function(screen){return screen.active})}}function umsSettingsController(packageState){this.packageState=packageState}function umsSplitviewBottombarAbTestingController(eventEmitter){var $ctrl=this;this.showControls=!1,this.abVariant=null,this.$onChanges=function(changes){changes.variants&&this.handleVariantsChange()},this.handleVariantsChange=function(){this.showControls=!1,this.abVariant=null;for(var i=0;i<$ctrl.variants.length;i++){var variant=$ctrl.variants[i];if("ab-testing"===variant.type){this.showControls=!0,this.abVariant=variant.entity;break}}},this.backToAbTest=function(){$ctrl.variantsCtrl.editors.length>1&&$ctrl.variantsCtrl.closeSplitView(1),$ctrl.variantsCtrl.selectApp({alias:"umsAbTesting"}),null!=$ctrl.abVariant&&eventEmitter.emit("ab-testing.content-app.show-test",{id:$ctrl.abVariant.abTestId})}}function umsSplitviewBottombarPersonalizationController(){var $ctrl=this;this.showControls=!1,this.$onChanges=function(changes){changes.variants&&this.handleVariantsChange()},this.handleVariantsChange=function(){this.showControls=$ctrl.variants.some(function(variant){return"personalization"===variant.type})},this.gotoAllVariants=function(){$ctrl.variantsCtrl.editors.length>1&&$ctrl.variantsCtrl.closeSplitView(1),$ctrl.variantsCtrl.selectApp({alias:"umsPersonalization"})}}function umsSplitviewControlsController($q,$scope,$timeout,eventEmitter,abTestingService,personalizationService,testCreateState){var $ctrl=this,destroyFns=[];function getEntity(segmentType,segment){switch(segmentType){case"ab-testing":return function getAbTestVariantWithIndex(segment){if(null!=testCreateState.test){for(var index=null,variant=null,i=0;i<testCreateState.test.variants;i++){var v=testCreateState.test.variants[i];if(v.segment===segment){index=i,variant=v;break}}if(null!=variant)return angular.merge(variant,{index:index})}return abTestingService.getVariantBySegment(segment).then(function addIndexToVariant(variantDto){return abTestingService.getTestDetails(variantDto.abTestId).then(function(response){var test=response.data;if(null!=test){var index=_.findIndex(test.variants,function(v){return v.id===variantDto.id});return angular.merge(variantDto,{index:-1===index?1:index})}return variantDto})})}(segment);case"personalization":return personalizationService.getBySegment(segment);case"default":return $q.when(null);default:throw new Error("Unknown segment type: '"+segmentType+"'")}}function createVariant(editor,index){var culture="invariant"===editor.culture?null:editor.culture,type=function getVariantType(segment){if(null==segment||0===segment.length)return"default";for(var typeMappings=[["engage_personalization","personalization"],["umarketingsuite_personalization","personalization"],["engage_ab-testing","ab-testing"],["umarketingsuite_ab-testing","ab-testing"]],i=0;i<typeMappings.length;i++){var map=typeMappings[i],prefix=map[0],type=map[1];if(0===segment.indexOf(prefix))return type}return null}(editor.segment);return null==type?null:getEntity(type,editor.segment).then(function(entity){return{segment:editor.segment,culture:culture,entity:entity,type:type,index:index}})}this.variants=[],this.hasAbTest=!1,this.hasPersonalization=!1,this.enableControls=!1,this.$onInit=function(){this.handleSplitviewChange(),this.handleSelectVariant(),this.handleContentAppActivationChange(),this.handleSplitviewRequests(),this.updateVariants($ctrl.variantsCtrl.editors)},this.$onDestroy=function(){destroyFns.forEach(function(fn){fn()})},this.handleSplitviewChange=function(){destroyFns.push($scope.$on("editors.content.splitViewChanged",function(_,args){$timeout(function(){$ctrl.updateVariants(args.editors)})}))},this.handleSelectVariant=function(){var selectVariantFn=this.variantsCtrl.selectVariant;function umsSelectVariant(){selectVariantFn.apply($ctrl.variantsCtrl,arguments),$timeout(function(){$ctrl.updateVariants($ctrl.variantsCtrl.editors)})}this.variantsCtrl.selectVariant=umsSelectVariant,destroyFns.push(function(){$ctrl.variantsCtrl.selectVariant===umsSelectVariant&&($ctrl.variantsCtrl.selectVariant=selectVariantFn)})},this.handleContentAppActivationChange=function(){$scope.contentContentApp=_.find($ctrl.variantsCtrl.content.apps,function(app){return"umbContent"===app.alias}),null!=$scope.contentContentApp&&destroyFns.push($scope.$watch(function(scope){return scope.contentContentApp.active},function(){$ctrl.updateEnableControls()}))},this.handleSplitviewRequests=function(){destroyFns.push(eventEmitter.on("open-splitview",function(args){$ctrl.openSplitview(args.culture,args.segment)}))},this.updateVariants=function(editors){null!=editors&&Array.isArray(editors)&&0!==editors.length||($ctrl.variants=[]),$q.all(editors.map(createVariant)).then(function(variants){$ctrl.variants=variants.filter(function(variant){return null!=variant}),$ctrl.updateEnableControls()})},this.updateEnableControls=function(){$ctrl.enableControls=null!=$scope.contentContentApp&&$scope.contentContentApp.active&&$ctrl.variants.some(function(variant){return"default"!==variant.type})},this.openSplitview=function openSplitview(culture,segment){var variants=$ctrl.variantsCtrl.content.variants,contentVariant=_.find(variants,function(v){return(null==v.language||v.language.culture===culture)&&v.segment===segment});null!=contentVariant&&($ctrl.variantsCtrl.editors.some(function(editor){return("invariant"===editor.culture?null:editor.culture)===culture&&editor.segment===segment})?$scope.contentContentApp.active||$ctrl.variantsCtrl.selectApp({alias:$scope.contentContentApp.alias}):$ctrl.variantsCtrl.openSplitView(contentVariant))}}function umsSplitviewTopbarAbTestingController(service,umbracoSegmentService,utils,testCreateState,editorState,$q,notificationsService){var $ctrl=this;this.testVariant=null,this.showEditor=!1,this.$onInit=function(){this.testVariant=this.variant.entity},this.save=function(){return service.saveVariant($ctrl.testVariant).then(function(savedVariant){return angular.merge($ctrl.testVariant,savedVariant),$ctrl.testVariant})},this.saveAndPreview=function(){return this.save($ctrl.testVariant).then(this.preview,angular.noop)},this.preview=function(){return utils.publishContent(function(args){return args.culture===$ctrl.variant.culture&&args.segment===$ctrl.variant.segment}).then(function showPreview(){function openPreview(){null!=$ctrl.testVariant.previewUrl&&$ctrl.testVariant.previewUrl.length>0&&window.open($ctrl.testVariant.previewUrl,"_blank")}return null==$ctrl.testVariant.previewUrl||0===$ctrl.testVariant.previewUrl.length?service.getPreviewUrl($ctrl.testVariant.abTestId,$ctrl.testVariant.id).then(function(response){$ctrl.testVariant.previewUrl=response.data.previewUrl,openPreview()}):(openPreview(),$q.when())},function(err){400===err.status?notificationsService.error("Validation failed for variant"):notificationsService.error("Could not save variant")})},this.delete=function(){if(null!=$ctrl.testVariant){var contentId=editorState.current.id,variantIdx=null==testCreateState.test?-1:testCreateState.test.variants.indexOf($ctrl.testVariant);return service.deleteVariant($ctrl.testVariant.id).then(function(){return umbracoSegmentService.delete($ctrl.testVariant.segment,contentId)}).then(function(){variantIdx>-1&&null!=testCreateState.test&&testCreateState.test.variants.splice(variantIdx,1)}).finally(function(){$ctrl.closeEditor(),$ctrl.closeSplitview(),utils.reloadNode()})}},this.closeSplitview=function closeSplitview(){$ctrl.variantsCtrl.editors.length>1&&$ctrl.variantsCtrl.closeSplitView($ctrl.variant.index)},this.closeEditor=function(){this.showEditor=!1}}function umsSplitviewTopbarDefaultCtrl(){this.previewButton=null,this.$onInit=function(){this.previewButton=document.querySelector("umb-button[alias='preview'] button")},this.preview=function(){null!=this.previewButton&&this.previewButton.click()}}function umsSplitviewTopbarPersonalizationController(service,umbracoSegmentService,utils,editorState,$q,notificationsService){var $ctrl=this;this.personalization=null,this.showEditor=!1,this.$onInit=function(){this.personalization=this.variant.entity},this.save=function(personalization){return service.save(personalization).then(function(response){return $ctrl.personalization=response.data,$ctrl.personalization},$q.reject)},this.saveAndPreview=function(personalization){return this.save(personalization).then(this.preview,angular.noop)},this.preview=function(){return utils.publishContent(function(args){return args.culture===$ctrl.variant.culture&&args.segment===$ctrl.variant.segment}).then(function(){null!=$ctrl.personalization.previewUrl&&$ctrl.personalization.previewUrl.length>0&&window.open($ctrl.personalization.previewUrl,"_blank")},function(err){400===err.status?notificationsService.error("Validation failed for variant"):notificationsService.error("Could not save variant")})},this.delete=function(personalization){return service.delete(personalization.id).then(function(){var contentId=editorState.current.id;return umbracoSegmentService.delete(personalization.umbracoSegmentAlias,contentId)}).finally(function(){$ctrl.closeEditor(),$ctrl.closeSplitview(),utils.reloadNode()})},this.closeSplitview=function closeSplitview(){$ctrl.variantsCtrl.editors.length>1&&$ctrl.variantsCtrl.closeSplitView($ctrl.variant.index)},this.closeEditor=function(){this.showEditor=!1}}function umsStartpageController(analyticsApi,umsConfigurationService){var ctrl=this;this.state={package:null,pageviews:0,goalCompletions:{count:0,totalValue:0}},this.$onInit=function(){ctrl.fn.getReportingState().then(function(reportingEnabled){ctrl.fn.getTotalPageViews(reportingEnabled).then(function(views){ctrl.state.pageviews=views}),ctrl.fn.getTotalGoalValue(reportingEnabled).then(function(allGoals){ctrl.state.goalCompletions.count=allGoals.count,ctrl.state.goalCompletions.totalValue=allGoals.value})})},ctrl.fn={getReportingState:function(){return umsConfigurationService.getConfiguration().then(function(config){return null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})},getTotalPageViews:function(reportingEnabled){var from=moment().add(-30,"days").startOf("day"),to=new Date,query={realtime:!1,metrics:["pageviews"],startDate:from.toISOString(),endDate:to.toISOString()};return analyticsApi.query(query).then(function(response){return response.rows[0][0]})},getTotalGoalValue:function(reportingEnabled){var from=moment().add(-30,"days").startOf("day"),to=new Date,query={metrics:["goalCompletionsAll","goalValueAll"],dimensions:["goalId","goal","isMainGoal"],sort:"goalCompletionsAll",startDate:from.toISOString(),endDate:to.toISOString()};return reportingEnabled||(query.filter="visitorType=='person'"),analyticsApi.query(query).then(function(response){var totals={count:0,value:0};return response.rows&&response.rows.forEach(function(row){totals.count+=row[3],totals.value+=row[4]}),totals})}}}function umsState(abTestingState,packageState,versionHelper){return{abTesting:abTestingState,package:packageState,segmentSupport:-1!==versionHelper.versionCompare(Umbraco.Sys.ServerVariables.application.version,"8.7.0")}}function umsStatisticsController(service){var state=this.state={statistics:null,isLoading:!0};this.$onInit=function(){service.getStatistics().then(function(statistics){state.statistics=statistics}).finally(function(){state.isLoading=!1})}}function umsStatisticsService($http){var root="/umbraco/backoffice/engage/statistics/";this.getStatistics=function getStatistics(){return $http.get(root+"GetStatistics").then(function(response){return response.data})}}function initializeUmsTablePrefabsConstant(configurationService,UMS_TABLE_PREFABS,callback){var PREFABS={pageviews:{name:"Pageviews",dimensions:[ums.constants.dimensions.pageUrl],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.pageSessions]},pageviews_withsubpages:{name:"Pageviews",dimensions:[ums.constants.dimensions.pageUrl],metrics:[ums.constants.metrics.pageviewsWithSubpages,ums.constants.metrics.pageSessionsWithSubpages]},devicetypes:{name:"Devices",dimensions:[ums.constants.dimensions.deviceCategory],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.uniquePageviews,ums.constants.metrics.goalCompletionsAll]},devicetypes_page:{name:"Devices",dimensions:[ums.constants.dimensions.deviceCategory],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.pageSessions,ums.constants.metrics.goalCompletionsAll]},devicetypes_page_withsubpages:{name:"Devices",dimensions:[ums.constants.dimensions.deviceCategory],metrics:[ums.constants.metrics.pageviewsWithSubpages,ums.constants.metrics.pageSessionsWithSubpages,ums.constants.metrics.goalCompletionsAll]},goals:{name:"Goals",dimensions:[ums.constants.dimensions.goalId,ums.constants.dimensions.goal,ums.constants.dimensions.goalType],metrics:[ums.constants.metrics.goalCompletionsAll,ums.constants.metrics.goalValueAll]},bots:{name:"Bots",dimensions:[ums.constants.dimensions.botId,ums.constants.dimensions.bot],metrics:[ums.constants.metrics.pageviewsBot]},botversion:{name:"Bot",dimensions:[ums.constants.dimensions.botVersionId,ums.constants.dimensions.botVersion],metrics:[ums.constants.metrics.pageviewsBot]},bot:{name:"Bot",dimensions:[ums.constants.dimensions.pageId,ums.constants.dimensions.page],metrics:[ums.constants.metrics.pageviewsBot]},referraldomains:{name:"Referrals (domain)",dimensions:[ums.constants.dimensions.referralHostname],metrics:[ums.constants.metrics.pageviews]},referralpaths:{name:"Referrals (path)",dimensions:[ums.constants.dimensions.referralPath],metrics:[ums.constants.metrics.pageviews]},referralpathsandqueries:{name:"Referrals (path + query)",dimensions:[ums.constants.dimensions.referralPathAndQuery],metrics:[ums.constants.metrics.pageviews]},referrals:{name:"Referrals",dimensions:[ums.constants.dimensions.fullReferrer],metrics:[ums.constants.metrics.pageviews]},browsers:{name:"Browsers",dimensions:[ums.constants.dimensions.browserId,ums.constants.dimensions.browser],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.uniquePageviews,ums.constants.metrics.goalCompletionsAll]},browsers_page:{name:"Browsers",dimensions:[ums.constants.dimensions.browserId,ums.constants.dimensions.browser],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.pageSessions,ums.constants.metrics.goalCompletionsAll]},browsers_page_withsubpages:{name:"Browsers",dimensions:[ums.constants.dimensions.browserId,ums.constants.dimensions.browser],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.pageSessionsWithSubpages,ums.constants.metrics.goalCompletionsAll]},sessions:{name:"Sessions",dimensions:[],metrics:[ums.constants.metrics.sessions]},pagesessions:{name:"Sessions",dimensions:[],metrics:[ums.constants.metrics.pageSessions]},pagesessions_withsubpages:{name:"Sessions",dimensions:[],metrics:[ums.constants.metrics.pageSessionsWithSubpages]},visitors:{name:"New and returning visitors",dimensions:[ums.constants.dimensions.usertype],metrics:[ums.constants.metrics.visitors,ums.constants.metrics.sessions]},pagevisitors:{name:"New and returning visitors",dimensions:[ums.constants.dimensions.usertype],metrics:[ums.constants.metrics.pageVisitors,ums.constants.metrics.pageSessions]},pagevisitors_withsubpages:{name:"New and returning visitors",dimensions:[ums.constants.dimensions.usertype],metrics:[ums.constants.metrics.pageVisitorsWithSubpages,ums.constants.metrics.pageSessionsWithSubpages]},segmentinsights:{realtime:!0,name:"Possible segments to render",dimensions:[ums.constants.dimensions.pageviewSegmentId,ums.constants.dimensions.pageviewSegmentName],metrics:[ums.constants.metrics.pageviews]},appliedsegmentinsights:{realtime:!0,name:"Rendered segments",dimensions:[ums.constants.dimensions.pageviewAppliedSegmentId,ums.constants.dimensions.pageviewAppliedSegmentName],filter:"pageviewAppliedSegmentName!~'(deleted segment:'",metrics:[ums.constants.metrics.pageviews]},campaigns:{name:"Campaigns",dimensions:[ums.constants.dimensions.campaign],metrics:[ums.constants.metrics.campaignEntries,ums.constants.metrics.campaignVisitors,ums.constants.metrics.campaignGoals,ums.constants.metrics.campaignGoalValue,ums.constants.metrics.campaignFormSubmissions,ums.constants.metrics.campaignCommerceOrders]},campaign_details:{name:"Campaigns",dimensions:[ums.constants.dimensions.sourceMedium],metrics:[ums.constants.metrics.campaignEntries,ums.constants.metrics.campaignVisitors,ums.constants.metrics.campaignGoals,ums.constants.metrics.campaignGoalValue,ums.constants.metrics.campaignFormSubmissions,ums.constants.metrics.campaignCommerceOrders]},campaigns_page:{name:"Campaigns",dimensions:[ums.constants.dimensions.campaign],metrics:[ums.constants.metrics.campaignEntries,ums.constants.metrics.campaignVisitors,ums.constants.metrics.campaignGoals,ums.constants.metrics.campaignGoalValue,ums.constants.metrics.campaignFormSubmissions,ums.constants.metrics.campaignCommerceOrders]},campaign_page_details:{name:"Campaigns",dimensions:[ums.constants.dimensions.sourceMedium],metrics:[ums.constants.metrics.campaignEntries,ums.constants.metrics.campaignVisitors,ums.constants.metrics.campaignGoals,ums.constants.metrics.campaignGoalValue,ums.constants.metrics.campaignFormSubmissions,ums.constants.metrics.campaignCommerceOrders]},videos:{name:"Videos",dimensions:[ums.constants.dimensions.videoName,ums.constants.dimensions.videoUrl],metrics:[ums.constants.metrics.videoPlays,ums.constants.metrics.videoPlaytime,ums.constants.metrics.avgVideoPlaytime,ums.constants.metrics.avgRelativeVideoPlaytime]},videoevents:{name:"Video events",dimensions:[ums.constants.dimensions.videoEventType,ums.constants.dimensions.videoEventTypeName],metrics:[ums.constants.metrics.videoEvents],sort:ums.constants.dimensions.videoEventType,ascending:!0},umbracoforms:{name:"Umbraco Forms",dimensions:[ums.constants.dimensions.umbracoFormsId,ums.constants.dimensions.umbracoFormsName],metrics:[ums.constants.metrics.umbracoFormsViews,ums.constants.metrics.umbracoFormsStarts,ums.constants.metrics.umbracoFormsSubmissions,ums.constants.metrics.umbracoFormsAbandons,ums.constants.metrics.umbracoFormsErrors]},umbracoformsform:{name:"Form Details",dimensions:[ums.constants.dimensions.umbracoFormsFieldId,ums.constants.dimensions.umbracoFormsFieldName],metrics:[ums.constants.metrics.umbracoFormsFieldFocusses,ums.constants.metrics.umbracoFormsFieldAbandons,ums.constants.metrics.umbracoFormsFieldErrors]},umbracoformsformfield:{name:"Form Field Details",dimensions:[ums.constants.dimensions.umbracoFormsFieldError],metrics:[ums.constants.metrics.umbracoFormsFieldErrors]},locations:{name:"Countries",dimensions:[ums.constants.dimensions.country],metrics:[ums.constants.metrics.sessions,ums.constants.metrics.pageviews,ums.constants.metrics.goalCompletionsAll,ums.constants.metrics.goalValueAll]},locations_withsubpages:{name:"Countries",dimensions:[ums.constants.dimensions.country],metrics:[ums.constants.metrics.pageSessionsWithSubpages,ums.constants.metrics.pageviews,ums.constants.metrics.goalCompletionsAll,ums.constants.metrics.goalValueAll]},locations_page:{name:"Countries",dimensions:[ums.constants.dimensions.country],metrics:[ums.constants.metrics.pageSessions,ums.constants.metrics.pageviews,ums.constants.metrics.goalCompletionsAll,ums.constants.metrics.goalValueAll]},locations_country:{name:"Cities",dimensions:[ums.constants.dimensions.city],metrics:[ums.constants.metrics.sessions,ums.constants.metrics.pageviews,ums.constants.metrics.goalCompletionsAll,ums.constants.metrics.goalValueAll]},locations_country_withsubpages:{name:"Cities",dimensions:[ums.constants.dimensions.city],metrics:[ums.constants.metrics.pageSessionsWithSubpages,ums.constants.metrics.pageviews,ums.constants.metrics.goalCompletionsAll,ums.constants.metrics.goalValueAll]},locations_country_page:{name:"Cities",dimensions:[ums.constants.dimensions.city],metrics:[ums.constants.metrics.pageSessions,ums.constants.metrics.pageviews,ums.constants.metrics.goalCompletionsAll,ums.constants.metrics.goalValueAll]},timeonpage:{name:"Time on page",dimensions:[ums.constants.dimensions.pageId,ums.constants.dimensions.pageUrl],metrics:[ums.constants.metrics.avgTimeOnPage,ums.constants.metrics.avgEngagedTimeOnPage]},browser_details:{name:"Browser",dimensions:[ums.constants.dimensions.browserVersion],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.uniquePageviews,ums.constants.metrics.goalCompletionsAll]},browser_details_page:{name:"Browser",dimensions:[ums.constants.dimensions.browserVersion],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.pageSessions,ums.constants.metrics.goalCompletionsAll]},browser_details_page_withsubpages:{name:"Browser",dimensions:[ums.constants.dimensions.browserVersion],metrics:[ums.constants.metrics.pageviews,ums.constants.metrics.pageSessionsWithSubpages,ums.constants.metrics.goalCompletionsAll]},events:{name:"Events",dimensions:[ums.constants.dimensions.eventCategory],metrics:[ums.constants.metrics.totalEvents,ums.constants.metrics.eventValue,ums.constants.metrics.avgEventValue]},eventcategory:{name:"Event Category",dimensions:[ums.constants.dimensions.eventAction],metrics:[ums.constants.metrics.totalEvents,ums.constants.metrics.eventValue,ums.constants.metrics.avgEventValue]},eventaction:{name:"Event Action",dimensions:[ums.constants.dimensions.eventLabel],metrics:[ums.constants.metrics.totalEvents,ums.constants.metrics.eventValue,ums.constants.metrics.avgEventValue]},searches:{name:"Search terms",dimensions:[ums.constants.dimensions.searchTerm],metrics:[ums.constants.metrics.searchVolume]},searches_withsubpages:{name:"Search terms",dimensions:[ums.constants.dimensions.searchTerm],metrics:[ums.constants.metrics.searchVolumeWithSubpages]}};configurationService.getConfiguration().then(function(config){!0!==config.reporting.dataGenerationEnabled&&(PREFABS.referraldomains.filter="hostname!=referralHostname",PREFABS.referralpaths.filter="hostname!=referralHostname",PREFABS.referralpathsandqueries.filter="hostname!=referralHostname",PREFABS.referrals.filter="hostname!=referralHostname",PREFABS.campaigns.filter="campaign!=''",PREFABS.bot.metrics=[ums.constants.metrics.pageviews],PREFABS.botversion.metrics=[ums.constants.metrics.pageviews],PREFABS.bots.metrics=[ums.constants.metrics.pageviews],function enableRealTimeReporting(){for(var table in PREFABS)PREFABS[table].realtime=!0,"string"==typeof PREFABS[table].filter&&PREFABS[table].filter.length>0?PREFABS[table].filter="visitorType=='person';"+PREFABS[table].filter:PREFABS[table].filter="visitorType=='person'"}(),delete PREFABS.goals.filter,delete PREFABS.bot.filter,delete PREFABS.botversion.filter,PREFABS.bots.filter="visitorType=='bot';bot!=''"),angular.extend(UMS_TABLE_PREFABS,PREFABS)}).catch(function(){}).then(()=>{"function"==typeof callback&&callback()})}function umsPrefabTableController(umsConfigurationService,UMS_TABLE_PREFABS){var self=this;self.filter=null,self.title=null,self.metrics=null,self.isLoading=!0;var EMPTY_ARRAY=[];Object.defineProperty(self,"name",{get:function(){if(self.title)return self.title;if("string"!=typeof self.alias)throw"Prefab table has no alias!";var prefab=UMS_TABLE_PREFABS[self.alias.toLowerCase()];return null==prefab?null:prefab.name}}),Object.defineProperty(self,"dimensions",{get:function(){if("string"!=typeof self.alias)throw"Prefab table has no alias!";var prefab=UMS_TABLE_PREFABS[self.alias.toLowerCase()];return null==prefab?EMPTY_ARRAY:prefab.dimensions}}),Object.defineProperty(self,"allMetrics",{get:function(){if(self.metrics)return self.metrics;if("string"!=typeof self.alias)throw"Prefab table has no alias!";var prefab=UMS_TABLE_PREFABS[self.alias.toLowerCase()];return null==prefab?EMPTY_ARRAY:void 0===prefab.metrics?EMPTY_ARRAY:prefab.metrics}}),Object.defineProperty(self,"sort",{get:function(){if("string"!=typeof self.alias)throw"Prefab table has no alias!";var prefab=UMS_TABLE_PREFABS[self.alias.toLowerCase()];return null==prefab?EMPTY_ARRAY:prefab.sort}}),Object.defineProperty(self,"ascending",{get:function(){if("string"!=typeof self.alias)throw"Prefab table has no alias!";var prefab=UMS_TABLE_PREFABS[self.alias.toLowerCase()];return null==prefab?EMPTY_ARRAY:prefab.ascending}}),Object.defineProperty(self,"realtime",{get:function(){if("string"!=typeof self.alias)throw"Prefab table has no alias!";var prefab=UMS_TABLE_PREFABS[self.alias.toLowerCase()];return null==prefab?EMPTY_ARRAY:prefab.realtime}}),self.$onChanges=function(changes){initializeUmsTablePrefabsConstant(umsConfigurationService,UMS_TABLE_PREFABS,()=>(function updateMetrics(changes){if(changes&&changes.alias&&changes.alias.currentValue&&!UMS_TABLE_PREFABS[changes.alias.currentValue.toLowerCase()])throw"There is no prefab table with alias '"+changes.alias.currentValue+"'.";(changes.drilldown||changes.alias)&&(self.filter=function determineFilter(){var drilldown=null;if(null===self.drilldown||void 0===self.drilldown||"boolean"==typeof self.drilldown)drilldown=[];else if("string"==typeof self.drilldown)drilldown=[self.drilldown];else{if(!Array.isArray(self.drilldown))throw'Expected drilldown to be null, undefined, a string or an array, but instead found "'+typeof self.drilldown+'" instead!';drilldown=self.drilldown}if("string"!=typeof self.alias)throw"Prefab table has no alias!";var prefab=UMS_TABLE_PREFABS[self.alias.toLowerCase()],baseFilter=prefab&&prefab.filter||"";return 0===drilldown.length?[baseFilter]:baseFilter?drilldown.map(function(dd){return baseFilter+";"+dd}):drilldown}());changes.metrics&&self.metrics&&!Array.isArray(self.metrics)&&(self.metrics=[self.metrics]);self.isLoading=!1})(changes))}}function umsUmbracoSegmentService($http){var endpoint="/umbraco/backoffice/engage/umbracosegment/";this.delete=function deleteSegment(segment,contentId){return $http.post(endpoint+"deleteSegment?segment="+encodeURIComponent(segment)+"&contentId="+(contentId||"")).then(function(response){return response.data})}}function umsUserService($http){this.getAll=function(){return $http.get("/umbraco/backoffice/engage/user/GetAllUsers").then(function(response){return response.data||[]})}}function umsAbTestingTopbarController(projectDetailState,screenManager,eventEmitter){this.state={shared:{projectDetail:projectDetailState}};var overlay=this.overlay={createProject:!1};this.fn={onProjectCreated:function(project){overlay.createProject=!1,project&&project.id>0&&screenManager.open("/ab-testing/project-detail",{id:project.id})}},this.$onInit=function(){var ctrl=this;this.$onDestroy=eventEmitter.on("abTestingTopbarChangeButtonVisibility",function(buttonConfig){null!=buttonConfig.createTest&&(ctrl.hideCreateAbTestButton=!buttonConfig.createTest),null!=buttonConfig.createProject&&(ctrl.hideCreateAbTestProjectButton=!buttonConfig.createProject)})}}function umsAbTestingCreateTestController(service,helper,goalsService,createState,createService,languageResource,$location,screenManager,contentResource,analyticsApi,notificationsService,$q,umsUtilService,umsRoutingHelper,eventEmitter,projectApi,documentTypePermissionService){var ctrl=this,state=this.state={shared:createState,confirm:!1,test:null,validationResults:null,projects:[],goals:[],status:null,overlay:{codeOverlay:{isOpen:!1,variant:null,index:null},validationResults:{isOpen:!1},createProject:{isOpen:!1},createGoal:{isOpen:!1}},form:null,testTypes:[{id:1,name:"Multiple Pages"},{id:2,name:"Document Type"}],pagePicker:{config:{multiPicker:!0},pages:null,culture:null},splitUrlPagePicker:{config:{multiPicker:!0},pages:null,culture:null},languages:[],sliderOptions:{floor:0,ceil:1,step:.01,precision:2,showSelectionBar:!0,translate:function(value){return isNaN(value)&&(value=0),Math.round(100*value)+"%"}},contentTypePicker:{contentTypes:[],culture:null},contentTypeNames:{},pageNames:{},indication:null,variantInfo:null,scheduleTime:null,formWasSubmitted:!1,schedule:!1,warning:{segmentationRequired:!1},firstSave:!0,contentTypeId:null,timepicker:{options:{altInput:!0,enableTime:!0,dateFormat:"YYYY-MM-DDTHH:mm:ss[Z]",altformat:"M d, Y h:mm a",time_24hr:!0},timestamp:null}},fn=this.fn={submit:function(){return state.confirm?fn.saveTestScheduleTime(new Date):service.saveTest(state.shared.test).then(function(response){response.data&&(null!=response.data.test&&(state.shared.test=response.data.test,ctrl.state.form.$setPristine()),state.validationResults=response.data.validationResults,null!=response.data.id&&(response.data.id>0&&fn.addTestIdToQueryString(response.data.id),state.shared.test.id=response.data.id),state.validationResults.isValid?(service.getRuntimeIndication(state.shared.test).then(function(response){state.indication=response.data}),service.getVariantDetails(state.shared.test).then(function(response){state.variantDetails=response.data,state.confirm=!0}).finally(function(){state.firstSave=!1})):state.overlay.validationResults.isOpen=!0)})},saveTestScheduleTime:function(scheduleTime){state.shared.test.startTime=scheduleTime&&new Date(scheduleTime)||new Date,service.saveTest(state.shared.test).then(function(response){if(response.data&&(state.validationResults=response.data.validationResults,null!=response.data.id&&(state.shared.test.id=response.data.id),response.data.validationResults.isValid)){function finalize(){var testId=state.shared.test.id;delete state.shared.test,ctrl.onCreated?ctrl.onCreated({id:testId,test:response.data.test}):screenManager.open("/ab-testing/test-detail",{id:testId})}0===state.shared.test.testType?fn.publishVariants().finally(finalize):finalize()}})},saveVariants:createService.fn.saveVariants,publishVariants:createService.fn.publishVariants,pagePicker:{setPages:function(){var inputPages=state.pagePicker.pages;if(state.shared.test.umbracoPageVariants=state.shared.test.umbracoPageVariants||[],null!=inputPages&&null!=state.shared.test){for(var arrNodeId=inputPages.split(",").map(function(nodeId){return parseInt(nodeId)}).filter(function(nodeId){return null!=nodeId&&!isNaN(nodeId)}),i=state.shared.test.umbracoPageVariants.length-1;i>=0;i--){var upv=state.shared.test.umbracoPageVariants[i];-1===arrNodeId.indexOf(upv.nodeId)&&state.shared.test.umbracoPageVariants.splice(i,1)}arrNodeId.forEach(function(nodeId){var pageIndex=state.shared.test.umbracoPageVariants.findIndex(function(upv){return upv.nodeId===nodeId});pageIndex>-1?state.shared.test.umbracoPageVariants[pageIndex].culture=state.pagePicker.culture:state.shared.test.umbracoPageVariants.push({nodeId:nodeId,culture:state.pagePicker.culture,abTestId:state.shared.test.id})}),fn.updateEstimatedVisitors();for(i=0;i<state.shared.test.umbracoPageVariants.length;i++){var page=state.shared.test.umbracoPageVariants[i];null==state.pageNames[page.nodeId]&&(state.pageNames[page.nodeId]={}),null==state.pageNames[page.nodeId][page.culture]&&getPageName(page)}}function getPageName(page){contentResource.getById(page.nodeId).then(function(content){if(null!=content){var variant=1===content.variants.length?content.variants[0]:_.find(content.variants,function(v){return page.culture?null!=v.language&&v.language.culture===page.culture:v.isDefault});null!=variant&&(state.pageNames[page.nodeId][page.culture]=variant.name)}})}}},splitUrlPagePicker:{setPages:function(){var inputPages=state.splitUrlPagePicker.pages;null!=inputPages&&null!=state.shared.test&&(state.shared.test.splitUrlCulture=state.splitUrlPagePicker.culture,state.shared.test.splitUrlPages=inputPages.split(",").map(function(nodeId){return parseInt(nodeId)}).filter(function(nodeId){return null!=nodeId&&!isNaN(nodeId)}),state.shared.test.umbracoPageVariants=[],state.shared.test.variants=[],state.shared.test.splitUrlPages.forEach(function(nodeId){state.shared.test.umbracoPageVariants.push({nodeId:nodeId,culture:state.splitUrlPagePicker.culture,abTestId:state.shared.test.id})}),state.shared.test.splitUrlPages.forEach(function(nodeId){state.shared.test.id?state.shared.test.variants.push({name:"Split "+nodeId,description:"Node id: "+nodeId,abTestId:state.shared.test.id}):state.shared.test.variants.push({name:"Split "+nodeId,description:"Node id: "+nodeId})}),fn.updateEstimatedVisitors())}},contentTypePicker:{toggle:function(contentTypeId){var idx=_.findIndex(state.shared.test.contentTypes,function(contentType){return contentType.contentTypeId===contentTypeId});idx>-1?state.shared.test.contentTypes.splice(idx,1):state.shared.test.contentTypes.push({contentTypeId:contentTypeId,culture:state.contentTypePicker.culture}),fn.updateEstimatedVisitors()},updateCulture:function(){var contentTypes=state.shared.test.contentTypes;null!=contentTypes&&contentTypes.length>0&&contentTypes.forEach(function(contentType){contentType.culture=state.contentTypePicker.culture}),fn.updateEstimatedVisitors()},isChecked:function(contentTypeId){return-1<_.findIndex(state.shared.test.contentTypes,function(contentType){return contentType.contentTypeId===contentTypeId})}},variants:{add:function(){state.shared.test.variants||(state.shared.test.variants=[]),state.shared.test.variants.push({})},edit:function(variant){function defaultFn(){fn.overlay.openCode(variant)}"function"==typeof ctrl.editVariant?ctrl.editVariant({test:state.shared.test,variant:variant,defaultFn:defaultFn}):defaultFn()},preview:createService.fn.previewVariant,remove:function(index){state.shared.test.variants.splice(index,1)},getLabel:function(index){return helper.getVariantLabel(index)}},overlay:{openCode:function(variant){state.overlay.codeOverlay.variant=variant,state.overlay.codeOverlay.index=_.findIndex(state.shared.test.variants,variant),state.overlay.codeOverlay.isOpen=!0},closeCode:function(){state.overlay.codeOverlay.variant=null,state.overlay.codeOverlay.index=null,state.overlay.codeOverlay.isOpen=!1}},getEstimatedDailyVisitors:function(){var from=moment().add(-1,"month").startOf("day"),to=moment().startOf("day"),filter=null;switch(state.shared.test.testType){case 0:break;case 1:filter=state.shared.test.umbracoPageVariants.map(function(p){return"VisitorType=='person';NodeId=='"+p.nodeId+(null!=p.culture?"';NodeCulture=='"+p.culture+"'":"'")}).join(",")||"VisitorType=='person'";break;case 2:filter=state.shared.test.contentTypes.map(function(ct){return"VisitorType=='person';NodeContentType=='"+ct.contentTypeId+(null!=ct.culture?"';NodeCulture=='"+ct.culture+"'":"'")}).join(",")||"VisitorType=='person'"}var query={metrics:["users"],realtime:!0,filter:filter,startDate:from.toISOString(),endDate:to.toISOString()};return analyticsApi.query(query).then(function(response){var totalVisitors=response.rows[0][0],totalDays=to.diff(from,"days",!0);return Math.round(totalVisitors/totalDays)})},updateEstimatedVisitors:function(){fn.getEstimatedDailyVisitors().then(function(visitors){state.shared.test.estimatedDailyVisitors=visitors})},getBaselineConversionRate:function(){if(null==state.shared.test.goal||null==state.shared.test.goal.id)return null;var from=moment().add(-7,"days").startOf("day"),to=moment().add(-1,"days").endOf("day"),goalCompletionsQuery={metrics:["goalCompletionsAll"],realtime:!0,filter:"goalId=='"+state.shared.test.goal.id+"';visitorType=='person'",startDate:from.toISOString(),endDate:to.toISOString()},usersQuery={metrics:["users"],realtime:!0,filter:"visitorType=='person'",startDate:from.toISOString(),endDate:to.toISOString()};return $q.all([analyticsApi.query(goalCompletionsQuery),analyticsApi.query(usersQuery)]).then(function(responses){var goalCompletions=responses[0].rows[0][0],users=responses[1].rows[0][0];return 0===users?0:goalCompletions/users})},updateBaselineConversionRate:function(){fn.getBaselineConversionRate().then(function(conversionRate){null!=conversionRate&&conversionRate>0&&(state.shared.test.baselineConversionRate=Math.min(1,conversionRate))})},saveDraft:function(){3===state.shared.test.testType&&state.languages.length>1&&!state.splitUrlPagePicker.culture?notificationsService.add({type:"error",headline:"You must select a culture for the Split URL test to save correctly"}):service.saveTest(state.shared.test,!1).then(function(response){response.data&&(state.validationResults=response.data.validationResults,null!=response.data.test&&(state.shared.test=response.data.test,ctrl.state.form.$setPristine()),state.validationResults=response.data.validationResults,null!=response.data.id&&(response.data.id>0&&fn.addTestIdToQueryString(response.data.id),state.shared.test.id=response.data.id),fn.saveVariants().finally(function(){null!=response.data.id&&(response.data.id>0&&fn.addTestIdToQueryString(response.data.id),state.shared.test.id=response.data.id),response.data.validationResults.isValid?notificationsService.add({type:"success",headline:"Your draft has been saved!"}):notificationsService.add({type:"error",headline:"Your A/B test could not be saved. Resolve the errors and try again."})}))})},addTestIdToQueryString:function(testId){if(umsRoutingHelper.isUmsSection()){var search=$location.search()||{};search.id!=testId&&(search=angular.merge(search,{id:testId}),eventEmitter.once("screenReset",function(evt){evt.cancel()}),$location.search(search).replace())}},onProjectCreated:function(project){state.overlay.createProject.isOpen=!1,project&&(state.projects.push(project),state.shared.test.projectId=project.id)},onCreateNewGoal:function(){state.overlay.createGoal.isOpen=!0,state.newGoal={isActive:!0,isInverted:!1,isMain:!1,isInvalid:!1,value:0}},onCloseGoalPopup:function(){state.overlay.createGoal.isOpen=!1,state.newGoal=null},onGoalCreated:function(){state.newGoal&&(state.shared.test.goal=state.newGoal,state.goals.push(state.newGoal)),fn.onCloseGoalPopup()},changeTestType:function(){0!==state.shared.test.testType&&3!==state.shared.test.testType?state.shared.test.assignVisitorsOnAnyPage=!1:3===state.shared.test.testType?state.shared.test.assignVisitorsOnAnyPage=!0:fn.setSinglePageVariant()},setSinglePageVariant:function(){var culture=umsUtilService.getCurrentCulture(),nodeId=umsUtilService.getCurrentContentId();state.shared.test.umbracoPageVariants=[{nodeId:nodeId,culture:culture,abTestId:state.shared.test.id}],state.contentTypeId=umsUtilService.getCurrentContentTypeId(),umsUtilService.hasSegmentedProperty(state.contentTypeId).then(function(hasSegmentedProperty){state.warning.segmentationRequired=!hasSegmentedProperty})},onDeleteTest:function(test){state.overlay.deleteTest=!1;var notification={type:"success"};test?(notification.headline="The AbTest '"+test.name+"' was successfully deleted!","function"==typeof ctrl.back?ctrl.back():$location.path("/engage/ab-testing/project-detail").search({id:test.projectId})):(notification.headline="The AbTest was successfully deleted!","function"==typeof ctrl.back?ctrl.back():$location.path("/engage/ab-testing/project-overview")),notificationsService.add(notification)},convertDate:function(date){return new Date(date)},onSetupPicker:function(picker,initDate){picker.element.placeholder="Select date...",ctrl.state.timepicker.timestamp=picker,initDate&&ctrl.state.timepicker.timestamp.setDate(ctrl.fn.convertDate(initDate),!1)},onTimePickerChange:function(picker){picker.selectedDates.length>0?ctrl.state.scheduleTime=picker.selectedDates[0]:(ctrl.state.scheduleTime=null,ctrl.state.schedule=null)}};this.$onInit=function(){var projectId=$location.search().projectId;null!=projectId&&(state.shared.projectId=parseInt(projectId,10)),projectApi.getAll().then(function(response){if(null!=state.shared.projectId){var isValid=!1;if(Array.isArray(response.data)&&(isValid=response.data.find(function(project){return null!=project&&project.id===state.shared.projectId&&!0!==project.invalid&&!0!==project.archived})),!isValid)return void $location.path("/engage/ab-testing/project-overview").search({})}state.projects=response.data||[],state.projects=state.projects.filter(function(project){return null!=project&&!0!==project.invalid&&!0!==project.archived}),state.projects=_.sortBy(state.projects,["name"])}),goalsService.getAll().then(function(response){state.goals=response.data}),languageResource.getAll().then(function(languages){if(null!=languages&&(state.languages=languages.map(function(lang){return{culture:lang.culture,name:lang.name}}).sort(function(langA,langB){return langA.name>langB.name?1:langA.name<langB.name?-1:0}),1===state.languages.length)){var language=state.languages[0];state.pagePicker.culture=language.culture,state.contentTypePicker.culture=language.culture}});var abTestId=this.id||parseInt($location.search().id,10);function initTest(){state.shared.test&&5===state.shared.test.status?(Array.isArray(state.shared.test.umbracoPageVariants)&&state.shared.test.umbracoPageVariants.length>0&&(state.pagePicker.pages=state.shared.test.umbracoPageVariants.map(function(x){return x.nodeId}).join(","),state.pagePicker.culture=state.shared.test.umbracoPageVariants[0].culture,state.splitUrlPagePicker.pages=state.shared.test.umbracoPageVariants.map(function(x){return x.nodeId}).join(","),state.splitUrlPagePicker.culture=state.shared.test.umbracoPageVariants[0].culture),Array.isArray(state.shared.test.contentTypes)&&state.shared.test.contentTypes.length>0&&(state.contentTypePicker.culture=state.shared.test.contentTypes[0].culture)):!state.shared.test||1!==state.shared.test.status&&2!==state.shared.test.status&&3!==state.shared.test.status&&4!==state.shared.test.status?null!=ctrl.back?ctrl.back():state.shared.projectId>0?$location.path("/engage/ab-testing/project-detail").search({id:state.shared.projectId}):$location.path("/engage/ab-testing/project-overview"):$location.path("/engage/ab-testing/test-detail").search({id:state.shared.test.id}),state.shared.test.id>0&&(state.firstSave=!1)}abTestId>0?service.getTestDetails(abTestId).then(function(response){state.shared.test=response.data,initTest()}):null!=state.shared.test?initTest():service.createEmpty().then(function(response){state.shared.test=response.data,state.shared.test.projectId=state.shared.projectId,null!=ctrl.testType&&(state.shared.test.testType=ctrl.testType,0===ctrl.testType&&fn.setSinglePageVariant())}),documentTypePermissionService.getAll().then(function(contentTypePermissions){if(null!=contentTypePermissions){state.contentTypePicker.contentTypes=contentTypePermissions.filter(function(permission){return permission.allowAbTesting}).map(function(permission){return{contentTypeId:permission.contentTypeId,name:permission.contentTypeName}}),state.contentTypeNames={};for(var i=0;i<state.contentTypePicker.contentTypes.length;i++){var contentType=state.contentTypePicker.contentTypes[i];state.contentTypeNames[contentType.contentTypeId]=contentType.name}}}),this.enableSinglePage&&state.testTypes.unshift({id:0,name:"Single Page"}),this.enableSplitUrl&&state.testTypes.push({id:3,name:"Split Url"})}}function umsAbTestingTestDetailController(detailState,service,helper,$location,$route,notificationsService){var ctrl=this;this.$onInit=function(){var testId=this.testId||$location.search().id;null!=testId?(state.shared.id=testId,fn.loadViewModel()):state.errorMessage="Test id required but missing"};var state=this.state={shared:detailState,isLoading:!1,errorMessage:null,viewModel:null,confirmUnschedule:null},fn=this.fn={loadViewModel:function(){return state.isLoading=!0,service.getAbTestViewModel(state.shared.id).then(function(response){return response.data}).then(function(viewModel){if(viewModel){if(!0!==viewModel.isDraft)return state.viewModel=viewModel,viewModel;$location.path("/engage/ab-testing/create-test").search({id:state.shared.id})}return null}).finally(function(){state.isLoading=!1})},getVariantLabel:function(idx){return helper.getVariantLabel(idx)},onDeleteTest:function(test){ctrl.overlay.deleteTest=!1;var notification={type:"success"};test?(notification.headline="The AbTest '"+test.name+"' was successfully deleted!",$location.path("/engage/ab-testing/project-detail").search({id:test.projectId})):(notification.headline="The AbTest was successfully deleted!",$location.path("/engage/ab-testing/project-overview")),notificationsService.add(notification)},onFinishTest:function(selectWinnerAfterwards){ctrl.overlay.finishTest=!1,!0===selectWinnerAfterwards&&(ctrl.overlay.selectWinner=!0),fn.loadViewModel()},onConfirmWinner:function(){ctrl.overlay.selectWinner=!1,fn.loadViewModel()},onVariantChanged:function(){fn.loadViewModel()},isScheduled:function(startTime){return new Date(startTime)>new Date},unschedule:function(test){ctrl.state.confirmUnschedule={header:"Unschedule test '"+test.name+"'?",text:"Are you sure you want to unschedule this A/B test?",yesText:"Yes, unschedule",fn:function confirmFn(){test.startTime=null,service.saveTest(test).then(function(response){notificationsService.add({type:"success",headline:"The AbTest '"+response.data.test.name+"' was successfully unscheduled!"}),$route.reload()})}}}}}function umsAbTestingVariantEditorController(helper,$q){var ctrl=this;this.state={css:null,js:null},this.fn={getVariantLabel:helper.getVariantLabel,save:function(){ctrl.variant.css=ctrl.state.css,ctrl.variant.javascript=ctrl.state.js;var promises=[];return"function"==typeof ctrl.save&&promises.push(ctrl.save({variant:ctrl.variant})),$q.all(promises)},saveAndPreview:function(variant){ctrl.fn.save().then(function(){null!=ctrl.previewVariant&&ctrl.previewVariant({variant:variant})},angular.noop)},saveAndClose:function(){ctrl.fn.save(),null!=ctrl.close&&ctrl.close()}},this.$onInit=function(){this.state.css=this.variant.css,this.state.js=this.variant.javascript}}function umsAnalyticsBotsController(){function getDimensionValue(row,dimensionIdx){if(null!=row&&Array.isArray(row.dimensions)&&!(row.dimensions.length<dimensionIdx+1))return row.dimensions[dimensionIdx]}this.botId=null,this.botName=null,this.botVersionId=null,this.botVersionName=null,this.chartFilter=null,this.onClickBot=function(row){this.botId=getDimensionValue(row,0),this.botName=getDimensionValue(row,1),this.updateChartFilter()},this.clearBotId=function(){this.botId=null,this.updateChartFilter()},this.onClickBotVersion=function(row){this.botVersionId=getDimensionValue(row,0),this.botVersionName=getDimensionValue(row,1),this.updateChartFilter()},this.clearBotVersionId=function(){this.botVersionId=null,this.updateChartFilter()},this.updateChartFilter=function(){null!=this.botVersionId?this.chartFilter="botVersionId=='"+this.botVersionId+"'":null!=this.botId?this.chartFilter="botId=='"+this.botId+"'":this.chartFilter=null}}function umsAnalyticsBrowsersController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService){var $ctrl=this;$ctrl.browserId=null,$ctrl.browserName=null,$ctrl.chartAlias=function(){return $ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()&&umsAnalyticsSettingsService.includeNodeDescendants?"pageviews_withsubpages":"pageviews"},$ctrl.tableAlias=function(){return $ctrl.browserId>0?$ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"browser_details_page_withsubpages":"browser_details_page":"browser_details":$ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"browsers_page_withsubpages":"browsers_page":"browsers"},$ctrl.isReportingEnabled=null,umsConfigurationService.getConfiguration().then(function(config){$ctrl.isReportingEnabled=null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})}function umsAnalyticsCampaignController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService){var $ctrl=this;$ctrl.selectedCampaign=null,$ctrl.chartAlias=function(){return umsUtilService.getCurrentContentId()?"campaigns_page":"campaigns"},$ctrl.tableAlias=function(){return umsUtilService.getCurrentContentId()?$ctrl.selectedCampaign?"campaign_page_details":"campaigns_page":$ctrl.selectedCampaign?"campaign_details":"campaigns"}}function umsAnalyticsDeviceTypesController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService){var $ctrl=this;$ctrl.prefabAlias=function(){return $ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"devicetypes_page_withsubpages":"devicetypes_page":"devicetypes"},$ctrl.isReportingEnabled=null,umsConfigurationService.getConfiguration().then(function(config){$ctrl.isReportingEnabled=null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})}function umsAnalyticsEventsController(){var $ctrl=this;this.category=null,this.action=null,Object.defineProperty(this,"drilldown",{get:function(){if(null==$ctrl.category&&null==$ctrl.action)return null;var drilldowns=[];return null!=$ctrl.category&&drilldowns.push("eventCategory=='"+$ctrl.category+"'"),null!=$ctrl.action&&drilldowns.push("eventAction=='"+$ctrl.action+"'"),drilldowns.join(";")}})}function umsAnalyticsLocationsController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService){var $ctrl=this;$ctrl.countryDrilldown=null,$ctrl.hasData=!0,$ctrl.onClickRow=function(row){var filter="country=='"+row.dimensions[0]+"'";$ctrl.countryDrilldown=[filter]},$ctrl.chartAlias=function(){return $ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"locations_withsubpages":"locations_page":"locations"},$ctrl.tableAlias=function(){return $ctrl.countryDrilldown?$ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"locations_country_withsubpages":"locations_country_page":"locations_country":$ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"locations_withsubpages":"locations_page":"locations"},$ctrl.isReportingEnabled=null,umsConfigurationService.getConfiguration().then(function(config){$ctrl.isReportingEnabled=null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})}function umsAnalyticsPageviewsController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService,$scope){var $ctrl=this;$ctrl.pageviewDrilldown=null,$ctrl.pageviewOnClick=function(row){null!=row&&null!=row.dimensions&&null!=row.dimensions[0]&&window.open(row.dimensions[0],"_blank")},$ctrl.resetPageviewDrilldown=function(row){$ctrl.pageviewDrilldown=null},$ctrl.chartAlias=function(){return umsUtilService.getCurrentContentId()&&umsAnalyticsSettingsService.includeNodeDescendants&&$ctrl.isReportingEnabled?"pageviews_withsubpages":"pageviews"},$ctrl.tableAlias=function(){return umsUtilService.getCurrentContentId()&&umsAnalyticsSettingsService.includeNodeDescendants&&$ctrl.isReportingEnabled?"pageviews_withsubpages":"pageviews"},$ctrl.isReportingEnabled=null,umsConfigurationService.getConfiguration().then(function(config){$ctrl.isReportingEnabled=null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})}function umsAnalyticsReferralsController(){this.domain=null}function umsAnalyticsSearchTermsController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService){const $ctrl=this;$ctrl.chartAlias=function(){return umsUtilService.getCurrentContentId()&&umsAnalyticsSettingsService.includeNodeDescendants&&$ctrl.isReportingEnabled?"searches_withsubpages":"searches"},$ctrl.tableAlias=function(){return umsUtilService.getCurrentContentId()&&umsAnalyticsSettingsService.includeNodeDescendants&&$ctrl.isReportingEnabled?"searches_withsubpages":"searches"},$ctrl.isReportingEnabled=null,umsConfigurationService.getConfiguration().then(function(config){$ctrl.isReportingEnabled=null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})}function umsAnalyticsSessionsController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService){var $ctrl=this;$ctrl.prefabAlias=function(){return $ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"pagesessions_withsubpages":"pagesessions":"sessions"},$ctrl.isReportingEnabled=null,umsConfigurationService.getConfiguration().then(function(config){$ctrl.isReportingEnabled=null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})}function umsAnalyticsSettingsService(localStorageService,umsUtilService){var storageKey="ums-analyticsSettingsService",state={eventEmitter:umsUtilService.createEventEmitter()},defaultSettings={includeNodeDescendants:!1},propertyMap={includeNodeDescendants:{get:function(){var settings=localStorageService.get(storageKey)||defaultSettings;return"boolean"==typeof settings.includeNodeDescendants&&settings.includeNodeDescendants},set:function(value){if("boolean"==typeof value){var settings=localStorageService.get(storageKey)||defaultSettings,hasChanged=settings.includeNodeDescendants!==value;settings.includeNodeDescendants=value,localStorageService.save(storageKey,settings),hasChanged&&state.eventEmitter.emit("change",settings)}}}};Object.defineProperties(this,propertyMap),this.registerSettingsChangeCallback=function(callback){return state.eventEmitter.on("change",callback)};localStorageService.onChange(function onStateChanged(statusChange){umsUtilService.getCurrentContentId()&&statusChange&&statusChange.oldValue!==statusChange.newValue&&state.eventEmitter.emit("change",statusChange.newValue)},storageKey)}function umsAnalyticsUmbracoFormsController(){var self=this;self.state={form:null,field:null},this.onClickUp=function(){self.state.field?(self.state.field=null,self.umbracoFormsDrilldown="umbracoFormsId=='"+self.state.form+"'"):(self.state.form=null,self.umbracoFormsDrilldown=null)},this.onClickUmbracoFormsForm=function(row){row&&Array.isArray(row.dimensions)&&!(row.dimensions.length<2)&&row.dimensions[1]&&(self.state.form=row.dimensions[0],self.umbracoFormsDrilldown="umbracoFormsId=='"+self.state.form+"'")},this.onClickUmbracoFormsFormField=function(row){row&&Array.isArray(row.dimensions)&&!(row.dimensions.length<2)&&row.dimensions[1]&&(self.state.field=row.dimensions[0],self.umbracoFormsDrilldown="umbracoFormsId=='"+self.state.form+"';umbracoFormsFieldId=='"+self.state.field+"'")}}function umsAnalyticsVideoController(){var $ctrl=this;this.onClickVideo=function(row){null!=row&&null!=row.dimensions&&null!=row.dimensions[0]&&($ctrl.name="Video events - "+row.dimensions[0],this.videoDrilldown="videoUrl=='"+row.dimensions[1]+"'")}}function umsAnalyticsVisitorsController(umsUtilService,umsAnalyticsSettingsService,umsConfigurationService){var $ctrl=this;$ctrl.prefabAlias=function(){return $ctrl.isReportingEnabled&&umsUtilService.getCurrentContentId()?umsAnalyticsSettingsService.includeNodeDescendants?"pagevisitors_withsubpages":"pagevisitors":"visitors"},$ctrl.isReportingEnabled=null,umsConfigurationService.getConfiguration().then(function(config){$ctrl.isReportingEnabled=null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled})}function umsDividerController(){this.$onInit=function(){null==this.iconSize&&(this.iconSize="lg")}}function umsPortalController($element){this.$onInit=function(){var target=document.querySelector(this.to);if(null==target)throw new Error("ums-portal: No DOM element found for selector '"+this.to+"'");this.prepend?$element.prependTo(target):$element.appendTo(target)},this.$onDestroy=function(){$element.remove()}}function umsAnalyticsCustomerJourneyEditorController(service,utils,mediaResource){var ctrl=this;this.$onInit=function(){this.state.journey=angular.copy(this.journey),void 0===this.state.journey.iconUrl||void 0===this.state.journey.icon?this.state.isNew=!0:mediaResource.getById(this.state.journey.icon).then(function(media){ctrl.state.journey.iconPicker=[{mediaKey:media.key}]})},this.state={journey:null,currentJourneyColor:null,isNew:!1},this.fn={save:function(){if(null!==ctrl.state.journey)if(utils.merge(ctrl.journey,ctrl.state.journey),ctrl.journey.color&&null!==ctrl.journey.color.value&&(ctrl.journey.color=ctrl.journey.color.value),ctrl.journey.iconUrl=null,null!=ctrl.journey.iconPicker&&null!=ctrl.journey.iconPicker[0]&&""!==ctrl.journey.iconPicker[0].mediaKey){var mediaKeyId=ctrl.journey.iconPicker[0].mediaKey;mediaResource.getById(mediaKeyId).then(function(media){media&&"string"==typeof media.mediaLink&&media.mediaLink.length>0&&(ctrl.journey.iconUrl=media.mediaLink,ctrl.journey.icon=media.id),"function"==typeof ctrl.onSave&&ctrl.onSave()})}else ctrl.journey.iconUrl=null,ctrl.journey.icon=null,"function"==typeof ctrl.onSave&&ctrl.onSave()}}}function umsAnalyticsCustomerJourneyGroupEditorController(service,utils){var ctrl=this;this.$onInit=function(){this.state.journeyGroup=angular.copy(this.journeyGroup),void 0===this.state.journeyGroup.createdByUmbracoUsername&&(this.state.isNew=!0)},this.state={journeyGroup:null,isNew:!1},this.fn={save:function(){null!==ctrl.state.journeyGroup&&(utils.merge(ctrl.journeyGroup,ctrl.state.journeyGroup),"function"==typeof ctrl.onSave&&ctrl.onSave())}}}function umsAnalyticsCustomerJourneyController($timeout,api,notificationsService){var self=this;self.state={isLoading:!1,isDragging:!1,selectedJourneyGroup:null,draggableModel:null,journeys:[],isNew:{journeyGroup:!1,journey:{group:null,index:null}},edit:{journeyGroup:null,journey:{item:null,belongsToGroup:null,indexInArray:null}},confirm:null},self.fn={addJourneyItem:function(journeyItemsList,index){self.state.edit.journey.step={title:"",description:"",icon:null},self.state.isNew.journey.group=journeyItemsList,self.state.isNew.journey.index=index},addJourneyGroup:function(){self.state.edit.journeyGroup={title:"",description:"",steps:[],minimumParticipationScoreThreshold:25,minimumDeviationType:0,minimumDeviation:0,expirationType:null,expiration:0,upperScoreLimit:10},self.state.isNew.journeyGroup=!0},getAll:function(openGroupId){self.state.isLoading=!0,api.getAll().then(function(response){self.state.journeys=response}).finally(function(){openGroupId&&"number"==typeof openGroupId?self.fn.openSpecificItem(openGroupId):self.fn.showFirstGroup(),self.state.isLoading=!1})},applyModifiedState:function(){if(self.state.isNew.journey.group){var index=self.state.isNew.journey.index+1;self.state.isNew.journey.group.splice(index,0,self.state.edit.journey.step),self.state.isNew.journey.group=null,self.state.isNew.journey.index=null}self.state.edit.journey.step=null,self.state.edit.journey.belongsToGroup=null,self.state.edit.journey.indexInArray=null,self.fn.save(self.state.selectedJourneyGroup)},applySaveJourneyGroup:function(){self.state.isNew.journeyGroup&&(self.state.journeys.push(self.state.edit.journeyGroup),self.state.isNew.journeyGroup=!1,self.state.selectedJourneyGroup=self.state.edit.journeyGroup),self.fn.save(self.state.edit.journeyGroup,!0),self.state.edit.journeyGroup=null},edit:function(journeyItem,journeyGroup,index){self.state.edit.journey.step=journeyItem,self.state.edit.journey.belongsToGroup=journeyGroup,self.state.edit.journey.indexInArray=index},editJourneyGroup:function(journeyGroup){self.state.edit.journeyGroup=journeyGroup},closeAddJourneyGroup:function(){self.state.isNew.journeyGroup=!1,self.state.edit.journeyGroup=null},closeAddJourney:function(){self.state.isNew.journey.group=null,self.state.isNew.journey.index=null,self.state.edit.journey.step=null},removeItem:function(){self.state.confirm={header:'Remove journey step "'+self.state.edit.journey.step.title+'"',fn:function confirmFn(){self.state.edit.journey.belongsToGroup.splice(self.state.edit.journey.indexInArray,1),self.fn.save(self.state.selectedJourneyGroup,!1,!1).then(function(){notificationsService.success('Journey step "'+self.state.edit.journey.step.title+'" was removed'),self.state.edit.journey.step=null,self.state.edit.journey.belongsToGroup=null,self.state.edit.journey.indexInArray=null})}}},removeGroup:function(journeyGroup){var oneOrMultipleSteps=1!==journeyGroup.steps.length?"steps":"step";self.state.confirm={header:'Remove Journey group "'+journeyGroup.title+'"',text:"Are you sure? Deleting this group will also delete "+journeyGroup.steps.length+" connected "+oneOrMultipleSteps+".",fn:function confirmFn(){api.delete(journeyGroup.id).then(function(){self.state.edit.journeyGroup=null,self.state.selectedJourneyGroup=null,self.fn.getAll(),notificationsService.success('Journey "'+journeyGroup.title+'" was removed')})}}},save:function(journeyGroup,doGetAll,notify){return api.save(journeyGroup).then(function(response){doGetAll&&1==doGetAll&&(self.state.selectedJourneyGroup=null,self.fn.getAll(response.data.id)),0!=notify&&notificationsService.success("Saved successfully")})},showFirstGroup:function(){null===self.state.selectedJourneyGroup&&(self.state.selectedJourneyGroup=self.state.journeys[0])},openSpecificItem:function(openGroupId){self.state.selectedJourneyGroup=self.state.journeys.filter(function filter(value){return value.id==openGroupId})[0]}},self.dragControlListeners={orderChanged:function(){self.fn.save(self.state.selectedJourneyGroup)},dragStart:function(){self.state.isDragging=!0},dragEnd:function(){self.state.isDragging=!1}},this.$onInit=function(){self.fn.getAll()}}angular.module("engage").controller("uMarketingSuiteDashboardController",["umsEventEmitter","$timeout","$rootScope","umsPackageState","$q","umsUserGroupPermissionsService","userService","umsConfigurationService",uMarketingSuiteController]),angular.module("engage").component("umsAccordionItem",{template:'<div class="ums-accordion__header" ng-class="{\'ums-accordion__header--personalisation\': $ctrl.state.personalisationEnabled, \'ums-accordion__header--fluid\': $ctrl.isFluid}" ng-attr-data-panel-open="{{!!$ctrl.state.open}}" ng-click="$ctrl.toggleItem()" aria-label="Toggle next panel"><div class="ums-accordion__name" ng-bind="$ctrl.name" ng-class="{\'h3 umsHeading\': $ctrl.state.personalisationEnabled}"></div><span class="ums-accordion__flex-holder"><div ng-if="$ctrl.state.showStatus" ng-transclude="status"></div><div class="ums-accordion__caret" ng-if="!$ctrl.state.personalisationEnabled"><ums-icon id="icon-toggle" modifier="sm"></ums-icon></div><div class="ums-button ums-button--light ums-button--sm ums-button--square-icon" ng-if="$ctrl.state.personalisationEnabled"><ums-icon id="icon-toggle" css-class="ums-accordion-blank__caret" modifier="xs"></ums-icon></div></span></div><div class="ums-accordion__content" ng-if="$ctrl.state.open" ng-class="{\'ums-accordion__content--personalisation\': $ctrl.state.personalisationEnabled}"><ng-transclude></ng-transclude></div>',transclude:{status:"?umsAccordionItemStatus"},bindings:{name:"@",isPersonalisation:"<?",isFluid:"<?",isOpenDefault:"<?"},controller:["$transclude",umsAccordionItemCtrl]}),angular.module("umbraco").service("umsAnalyticsApi",function($http){var BASE_URL="/umbraco/backoffice/engage/analytics/";this.query=function(queryRequest){return void 0===queryRequest.realtime&&(queryRequest.realtime=!1),$http({method:"POST",url:BASE_URL+"query",data:queryRequest}).then(function(response){return response.data})},this.distinct=function(dimension){return $http.get(BASE_URL+"distinct?dimension="+dimension).then(function(response){return response.data})}}),angular.module("engage").service("umsAnalyticsService",function(umsUtilService,umsDaterangepickerService,umsAnalyticsSettingsService){var changeDateCallbacks=[],changeSettingsCallbacks=[];function buildQueryRequestForDaterange(dimensions,metrics,pagingSettings,dateRange){if(!Array.isArray(metrics)||0===metrics.length)throw"Argument[1] metrics: should be an array containing at least one metric (number).";var result,searchCriteria={startDate:dateRange.from,endDate:dateRange.to,metrics:metrics,dimensions:dimensions||[]};result="object"==typeof pagingSettings?angular.merge(searchCriteria,pagingSettings):searchCriteria;var currentNodeId=umsUtilService.getCurrentContentId();if(currentNodeId){let nodeFilter;result.includeSubpages=!!umsAnalyticsSettingsService.includeNodeDescendants,nodeFilter=umsAnalyticsSettingsService.includeNodeDescendants&&pagingSettings&&pagingSettings.realtime?"NodeId=='"+currentNodeId+"+'":"NodeId=='"+currentNodeId+"'";var currentNodeCulture=umsUtilService.getCurrentCulture();currentNodeCulture&&(nodeFilter+=";NodeCulture=='"+currentNodeCulture+"'"),result.filter=result.filter||"",result.filter=result.filter.trim().split(",").map(function(x){return x.trim().length>0?x+";"+nodeFilter:nodeFilter}).join(",")}return result}umsAnalyticsSettingsService.registerSettingsChangeCallback(function onSettingsChanged(settings){if(settings)for(var i=0;i<changeSettingsCallbacks.length;i++)changeSettingsCallbacks[i](settings)}),umsDaterangepickerService.onChange(function onDateChanged(config,dateRange){if(dateRange&&dateRange.primary)for(var i=0;i<changeDateCallbacks.length;i++)changeDateCallbacks[i](dateRange.primary.from,dateRange.primary.to)});this.buildQueryRequest=function buildQueryRequest(dimensions,metrics,pagingSettings){return buildQueryRequestForDaterange(dimensions,metrics,pagingSettings,umsDaterangepickerService.getRange().primary)},this.buildQueryRequests=function buildQueryRequests(dimensions,metrics,pagingSettings){var requests=[],ranges=umsDaterangepickerService.getRanges();return!umsDaterangepickerService.getConfig().compare&&(ranges=[ranges[0]]),ranges.forEach(function(dateRange){if(null!=dateRange&&null!=dateRange.from&&null!=dateRange.to)if(Array.isArray(pagingSettings.filter))0===pagingSettings.filter.length?createRequestForFilter(""):pagingSettings.filter.forEach(createRequestForFilter);else{var request=buildQueryRequestForDaterange(dimensions,metrics,pagingSettings,dateRange);requests.push(request)}function createRequestForFilter(filter){var ps=angular.merge({},pagingSettings);ps.filter=filter;var request=buildQueryRequestForDaterange(dimensions,metrics,ps,dateRange);requests.push(request)}}),requests},this.registerOnChangeDateCallback=function registerOnChangeDateCallback(callback){if("function"!=typeof callback)throw" Argument 'Callback' must be a function!";return changeDateCallbacks.push(callback),function(){var idx=changeDateCallbacks.indexOf(callback);-1!==idx&&changeDateCallbacks.splice(idx,1)}},this.registerSettingsChangeCallback=function registerOnChangeSettingsCallback(callback){if("function"!=typeof callback)throw" Argument 'Callback' must be a function!";return changeSettingsCallbacks.push(callback),function(){var idx=changeSettingsCallbacks.indexOf(callback);-1!==idx&&changeSettingsCallbacks.splice(idx,1)}}}),angular.module("engage").component("umsAnalytics",{template:'<ums-section-topbar title="Analytics" icon="icon-analytics"></ums-section-topbar><ums-screens name="Analytics" icon-name="analytics"><ums-screen name="Pageviews"><ums-analytics-pageviews></ums-analytics-pageviews></ums-screen><ums-screen name="Sessions"><ums-analytics-sessions></ums-analytics-sessions></ums-screen><ums-screen name="Visitors"><ums-analytics-visitors></ums-analytics-visitors></ums-screen><ums-screen name="Time on page"><ums-analytics-time-on-page></ums-analytics-time-on-page></ums-screen><ums-screen name="Browsers"><ums-analytics-browsers></ums-analytics-browsers></ums-screen><ums-screen name="Locations"><ums-analytics-locations></ums-analytics-locations></ums-screen><ums-screen name="Goals"><ums-analytics-goals></ums-analytics-goals></ums-screen><ums-screen name="Referrals"><ums-analytics-referrals></ums-analytics-referrals></ums-screen><ums-screen name="Campaigns"><ums-analytics-campaigns></ums-analytics-campaigns></ums-screen><ums-screen name="Devices"><ums-analytics-device-types></ums-analytics-device-types></ums-screen><ums-screen name="Events"><ums-analytics-events></ums-analytics-events></ums-screen><ums-screen name="Videos"><ums-analytics-video></ums-analytics-video></ums-screen><ums-screen name="Forms"><ums-analytics-umbraco-forms></ums-analytics-umbraco-forms></ums-screen><ums-screen name="Search terms"><ums-analytics-search-terms></ums-analytics-search-terms></ums-screen><ums-screen name="Heatmap" ng-if="$ctrl.state.inContentTree"><ums-heatmap></ums-heatmap></ums-screen></ums-screens>',bindings:{contentId:"<?",culture:"<?"},controller:["$routeParams",function umsAnalyticsController($routeParams){var state={inContentTree:!1};this.state=state,this.$onInit=function(){state.inContentTree="content"===$routeParams.section&&"content"===$routeParams.tree}}]}),angular.module("engage").component("umsAnnotationEditor",{template:'<ums-overlay close="$ctrl.close()" small="true"><ums-overlay-header><h3 ng-if="$ctrl.state.annotation.id === 0">Add Annotation</h3><h3 ng-if="$ctrl.state.annotation.id !== 0">Edit Annotation</h3></ums-overlay-header><ums-overlay-body><form id="annotation-editor-form" name="$ctrl.form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()"><div class="ums-form__row"><label class="ums-form__label">Timestamp</label><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker datepicker-umbraco datepicker-umbraco-flatpickr" style="max-height: 40px;"><umb-flatpickr options="$ctrl.state.timepicker.options" on-setup="$ctrl.fn.onSetupPicker(fpItem, $ctrl.state.annotation.timestamp)" on-change="$ctrl.fn.onTimePickerChange($ctrl.state.timepicker.timestamp)" class="ums-segmentparameter__datepicker-input"></umb-flatpickr><span class="ums-form__input-icon"><ums-icon id="icon-date-select" modifier="sm"></ums-icon></span> <button class="ums-segmentparameter__datepicker-btn" ng-if="$ctrl.state.annotation.timestamp" ng-click="$ctrl.state.timepicker.timestamp.clear()" type="button"><i class="icon-delete"></i></button></div><div class="ums-errorText" ng-show="($ctrl.form.$submitted || $ctrl.form.ums_time_picker.$dirty ) && !$ctrl.state.annotation.timestamp">This field is required</div></div><div class="ums-form__row"><label for="annotation-description" class="ums-form__label">Description</label> <textarea id="annotation-description" class="ums-form__input" required no-dirty-check ng-model="$ctrl.state.annotation.description"></textarea></div><div class="ums-form__row"><label for="annotation-visibility" class="ums-form__label">Visibility</label><select class="ums-form__select" id="annotation-visibility" required ng-model="$ctrl.state.annotation.visibility" ng-change="$ctrl.fn.visibilityOnChange()" ng-options="visibility.value as visibility.name for visibility in $ctrl.visibilityOptions" no-dirty-check><option value>Select ...</option></select></div></form></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button type="button" class="ums-button ums-button--light" ng-click="$ctrl.close()">Close</button> <button type="submit" form="annotation-editor-form" class="ums-button ums-button--success ums-button--icon"><span>Save</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></ums-overlay-footer></ums-overlay>',bindings:{annotation:"=",contentId:"<?",culture:"<?",onSave:"&?",onCreate:"&?",onEdit:"&?",close:"&"},controller:["umsAnnotationsService","umsUtilService","notificationsService",umsAnnotationEditorController]}),angular.module("engage").factory("umsAnnotationsPluginFactory",[umsAnnotationsPluginFactory]),angular.module("engage").component("umsAnnotations",{template:'<div><div class="ums-button__wrapper ums-button__wrapper--right ums-button__wrapper--no-margin"><button type="button" class="btn ums-button ums-button--light" ng-click="$ctrl.state.showTable ? $ctrl.hideTable() : $ctrl.showTable()"><span ng-if="$ctrl.state.showTable">Hide annotations</span> <span ng-if="!$ctrl.state.showTable">Show annotations</span><ums-icon ng-if="$ctrl.state.showTable" id="icon-toggle" modifier="sm" style="transform:scaleY(-1)"></ums-icon><ums-icon ng-if="!$ctrl.state.showTable" id="icon-toggle" modifier="sm"></ums-icon></button> <button type="button" class="btn ums-button ums-button--main ums-button--square-icon ums-popup__enter" ng-click="$ctrl.add(); $ctrl.showTable();"><ums-icon id="icon-plus" modifier="xxs"></ums-icon><div class="ums-popup__holder ums-popup__holder--auto-whitespace">Add new annotation</div></button></div><table class="ums-table__table" ng-show="$ctrl.state.showTable" ng-class="{\'is-animated\':$ctrl.state.showTable}" style="margin-top: 20px;"><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel"></div></th><th class="ums-table__th"><div class="umsLabel">Date</div></th><th class="ums-table__th" colspan="3"><div class="umsLabel">Description</div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="8">Loading ...</td></tr><tr class="ums-table__tr" ng-if="!$ctrl.state.loading && ($ctrl.annotations == null || $ctrl.annotations.length === 0)"><td class="ums-table__td" colspan="8">No annotations created yet</td></tr><tr class="ums-table__tr ums-table__tr--sm" ng-if="!$ctrl.state.loading && $ctrl.annotations.length > 0" ng-repeat="annotation in $ctrl.annotations | orderBy: \'timestamp\' track by $index"><td class="ums-table__td ums-table__td--nowrap" style="min-width: 60px;"><span class="ums-popup__enter"><img ng-if="annotation.iconPath" ng-src="{{annotation.iconPath}}" class="ums-table__annotation-icon"><div class="ums-popup__holder ums-popup__holder--large ums-popup__holder--auto-whitespace ums-popup__holder--left" style="min-width: 10px" ng-bind="$ctrl.getIconByIconUrl(annotation.iconPath)"></div></span></td><td class="ums-table__td ums-table__td--nowrap"><strong ng-bind="annotation.timestamp | umsDate:true"></strong></td><td class="ums-table__td ums-table__td--nowrap ums-table__td--hide-overflow" ng-bind="annotation.description" width="100%"></td><td class="ums-table__td ums-table__td--right" ng-if="annotation.createdByUsername"><span class="ums-popup__enter"><ums-icon id="icon-info" class="ums-popup__infoicon" modifier="sm"></ums-icon><span class="ums-popup__holder ums-popup__holder--auto-whitespace ums-popup__holder"><span>Created by {{annotation.createdByUsername}} at {{(annotation.created || annotation.timestamp) | umsDate}}</span> <span ng-if="annotation.updated"><br><br>Updated by {{annotation.updatedByUsername}} at {{annotation.updated | umsDate}}</span></span></span></td><td class="ums-table__td ums-table__td--right"><div class="ums-button__wrapper ums-button__wrapper--right ums-button__wrapper--no-margin ums-button__wrapper--no-wrap" ng-show="annotation.id != null"><ums-ui-table-action-buttons on-edit-click="$ctrl.edit(annotation)" on-delete-click="$ctrl.remove(annotation)"></ums-ui-table-action-buttons></div></td></tr></tbody></table></div><ums-annotation-editor ng-if="$ctrl.state.edit.annotation" annotation="$ctrl.state.edit.annotation" close="$ctrl.state.edit.annotation = null" content-id="$ctrl.contentId" culture="$ctrl.culture" on-save="$ctrl.refresh()" on-create="$ctrl.onCreate.bind($ctrl)(annotation)" on-edit="$ctrl.onEdit.bind($ctrl)(annotation)"></ums-annotation-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay>',bindings:{contentId:"<?",culture:"<?",from:"<?",to:"<?",onChange:"&?",onShow:"&?",onHide:"&?",onInit:"&?",onDestroy:"&?"},controller:["umsAnnotationsService","umsDaterangepickerService","umsUtilService","notificationsService",umsAnnotationsController]}),angular.module("engage").service("umsAnnotationsService",["umsDownloader",umsAnnotationsService]),angular.module("engage").component("umsCampaigns",{template:'<div class="ums-topbar__container"><div class="ums-content ums-topbar__content"><div class="ums-topbar__icon"><ums-icon id="icon-campaigns" modifier="lg"></ums-icon></div><div class="ums-topbar__title">Campaigns</div><ums-package-status></ums-package-status><div class="ums-topbar__options"><button type="button" class="btn ums-button ums-button--base ums-topbar__button"><span>Settings</span><ums-icon modifier="btn" id="icon-gear"></ums-icon></button> <button type="button" class="btn ums-button ums-button--base ums-topbar__button"><span>Export</span><ums-icon modifier="btn" id="icon-export"></ums-icon></button></div></div></div>',controller:function(){this.$onInit=function(){}}}),angular.module("engage").service("umsChartsSettings",[function(){var globalOptions={aspectRatio:4,elements:{line:{fill:!1,borderWidth:4,tension:.05},point:{radius:4,borderWidth:0}},scales:{xAxes:[{gridLines:{display:!1}}],yAxes:[{ticks:{suggestedMin:0,beginAtZero:!0,userCallback:function(label,index,labels){if(Math.floor(label)===label)return label}}}]},tooltips:{mode:"index",intersect:!1,xPadding:15,yPadding:10,backgroundColor:"#3444B2",titleFontFamily:"Lato, courier",titleFontStyle:"Bold",bodyFontFamily:"Lato, courier",bodySpacing:5,footerFontFamily:"Lato, courier",cornerRadius:5,displayColors:!1},legend:{display:!0}},chartOptionsPerType={line:{small:{},medium:{},large:{}},pie:{small:{},medium:{},large:{}},doughnut:{small:{},medium:{},large:{}},radar:{small:{},medium:{},large:{}},polarArea:{small:{},medium:{},large:{}},bar:{small:{},medium:{},large:{}}},themes={default:["#3444B2","#FFBA00","#FF7F50","#2AC37C","#F43D1F","#1F2953","#4C69E5"].map(function(color){return{borderColor:color,backgroundColor:color,pointBackgroundColor:color,pointHoverBackgroundColor:color}}),reporting:["#FFBA00","#3444B2","#CBCFEB","#2AC37C","#F43D1F","#1F2953","#4C69E5"].map(function(color){return{borderColor:color,backgroundColor:color,pointBackgroundColor:color,pointHoverBackgroundColor:color,type:"line"}}),successerror:[{backgroundColor:["green"],borderColor:["green"],borderWidth:1},{backgroundColor:["red"],borderColor:["red"],borderWidth:1}]},themeOther={backgroundColor:"#4C69E5",borderColor:"#4C69E5",borderWidth:3},chartSettings={reporting:{bar:{datasetOverride:[{borderWidth:0,backgroundColor:"#3444B2"},{borderWidth:0,backgroundColor:"#D9D9D9",borderColor:"#D9D9D9",backgroundColor:"#D9D9D9",pointBackgroundColor:"#D9D9D9"}],options:{tooltips:{callbacks:{}},legend:{display:!0,position:"bottom",labels:{fontColor:"#000000",usePointStyle:!0,boxWidth:6,boxHeight:6,pointRadius:0}},scales:{xAxes:[{stacked:!0,gridLines:{drawOnChartArea:!1},ticks:{fontColor:"rgba(104, 103, 107, 0.5)"}}],yAxes:[{stacked:!0,gridLines:{drawOnChartArea:!1},ticks:{fontColor:"rgba(104, 103, 107, 0.5)",stepSize:null}}]}}},line:{},pie:{}}};return{getChartOptions:function getChartOptions(type,size,stack){var chartConfig=null;switch(type){case"line":switch(size){case"small":chartConfig=chartOptionsPerType.line.small;break;case"medium":chartConfig=chartOptionsPerType.line.medium;break;case"large":chartConfig=chartOptionsPerType.line.large}break;case"bar":switch(size){case"small":chartConfig=chartOptionsPerType.bar.small;break;case"medium":chartConfig=chartOptionsPerType.bar.medium;break;case"large":chartConfig=chartOptionsPerType.bar.large}break;case"pie":switch(size){case"small":chartConfig=chartOptionsPerType.pie.small;break;case"medium":chartConfig=chartOptionsPerType.pie.medium;break;case"large":chartConfig=chartOptionsPerType.pie.large}break;case"doughnut":switch(size){case"small":chartConfig=chartOptionsPerType.doughnut.small;break;case"medium":chartConfig=chartOptionsPerType.doughnut.medium;break;case"large":chartConfig=chartOptionsPerType.doughnut.large}break;case"radar":switch(size){case"small":chartConfig=chartOptionsPerType.radar.small;break;case"medium":chartConfig=chartOptionsPerType.radar.medium;break;case"large":chartConfig=chartOptionsPerType.radar.large}break;case"polarArea":switch(size){case"small":chartConfig=chartConfig.polarArea.small;break;case"medium":chartConfig=chartConfig.polarArea.medium;break;case"large":chartConfig=chartConfig.polarArea.large}}return stack&&(globalOptions.scales.xAxes[0].stacked=!0,globalOptions.scales.yAxes[0].stacked=!0),angular.merge(globalOptions,chartConfig)},getTheme:function getTheme(themeName,seriesCount){var result=[];if(themeName&&themeName.length>0&&seriesCount>0){var themeParts=themeName.split("-"),theme=themes[themeParts[0]],useOther=themeParts.indexOf("other")>-1;if(theme)for(var i=0;i<seriesCount;i++)if(useOther&&i===seriesCount-1)result.push(themeOther);else{var themeCopy=angular.copy(theme[i%theme.length]);result.push(themeCopy)}}return result},getChartSettings:function getChartSettings(chartName){if("string"!=typeof chartName)throw new TypeError("Expected a string");var nameParts=chartName.split("-");if(2!=nameParts.length)throw new Error(`Expected chartName of the format [screen-chart] (e.g. "reporting-bar") but got "${chartName}" instead `);if(!function chartNameExists(chartName,chartSettings){var settings=Object.keys(chartSettings),chartNames=[];return Object.values(chartSettings).forEach((screen,index)=>{Object.keys(screen).forEach(chart=>{chartNames.push(settings[index]+"-"+chart)})}),chartNames.includes(chartName)}(chartName,chartSettings))throw new Error(`Could not find any settings for the ${chartName} chart`);return chartSettings[nameParts[0]][nameParts[1]]}}}]),angular.module("engage").component("umsChartSkeleton",{template:'<div class="ums-fakegraph__container"><span class="ums-fakegraph__line"></span> <span class="ums-fakegraph__line"></span> <span class="ums-fakegraph__line"></span><div class="ums-fakegraph__number-holder"><span class="ums-fakegraph__number-item">1</span> <span class="ums-fakegraph__number-item">2</span> <span class="ums-fakegraph__number-item">3</span> <span class="ums-fakegraph__number-item">4</span> <span class="ums-fakegraph__number-item">5</span> <span class="ums-fakegraph__number-item">6</span> <span class="ums-fakegraph__number-item">7</span></div><div class="ums-fakegraph__loader ums-loader__small__container ums-loader__animation" ng-if="$ctrl.hasLoader"><div class="loader-inner"><div class="loader-line-wrap gray"><div class="loader-line"></div></div><div class="loader-line-wrap gray"><div class="loader-line"></div></div><div class="loader-line-wrap gray"><div class="loader-line"></div></div><div class="loader-line-wrap gray"><div class="loader-line"></div></div><div class="loader-line-wrap gray"><div class="loader-line"></div></div></div></div><div class="ums-fakegraph__loader ums-loader__small__container ums-loader__animation" ng-if="$ctrl.showNoDataAvailable"><div>No analytics reports have been generated yet. Data will become available within 24 hours</div></div></div>',bindings:{hasLoader:"<?",showNoDataAvailable:"<?"}}),angular.module("engage").component("umsChart",{template:'<div class="ums-chart"><ums-chart-skeleton ng-show="$ctrl.isLoading || !$ctrl.isLoading && !$ctrl.chart.data.length" has-loader="$ctrl.isLoading" show-no-data-available="!$ctrl.isLoading && $ctrl.chart && $ctrl.chart.data.length === 0"></ums-chart-skeleton><div class="ums-chart__wrapper" ng-show="!$ctrl.isLoading && $ctrl.chart && $ctrl.chart.data.length > 0" style="position:relative;"><canvas class="ums-chart__canvas" chart-base chart-type="$ctrl.chart.type" chart-data="$ctrl.chart.data" chart-labels="$ctrl.chart.labels" chart-series="$ctrl.chart.series" chart-dataset-override="$ctrl.chart.datasetOverride" chart-options="$ctrl.chart.options"></canvas><ums-annotations ng-if="$ctrl.showAnnotations" on-change="$ctrl.reload()" on-show="$ctrl.onShowAnnotations()" on-hide="$ctrl.onHideAnnotations()"></ums-annotations></div></div>',bindings:{metrics:"<",dimension:"<?",filter:"<",realtime:"<",theme:"<",type:"<",size:"<",stack:"<?",unit:"<?",unitSingular:"<?",showAnnotations:"<?",showPercentages:"<?",trendIndex:"<?",isFullHeight:"<?"},controller:["umsAnalyticsService","umsAnalyticsApi","umsChartsSettings","umsEventEmitter","umsUtilService","umsAnnotationsService","$scope","umsAnnotationsPluginFactory","$q","$filter","$timeout",function umsChartController(umsAnalyticsService,umsAnalyticsApi,umsChartsSettings,eventEmitter,umsUtilService,umsAnnotationsService,$scope,umsAnnotationsPluginFactory,$q,$filter,$timeout){var self=this,destroyFns=[];function reload(){if(!self.isLoading){self.isLoading=!0;var queryRequests=umsAnalyticsService.buildQueryRequests(self.dimensions,self.metrics,self.querySettings),queryPromises=queryRequests.map(function(queryRequest){return umsAnalyticsApi.query(queryRequest)}),dateRanges=queryRequests.map(function(request){return{from:request.startDate,to:request.endDate}});$q.all(queryPromises).then(function onQueryResponse(dateRanges,queryResponses){if(!Array.isArray(dateRanges)||null==queryResponses)return;self.rawData=[],queryResponses.forEach(function(queryResponse,idx){for(var dateRange=dateRanges[idx],metricCount=queryResponse.columns.length-self.dimensions.length,metricIdx=0;metricIdx<metricCount;metricIdx++){var rows=queryResponse.rows.map(function(row){var metricRow=row[self.dimensions.length+metricIdx];return row.slice(0,self.dimensions.length).concat(metricRow)}),metricColumn=queryResponse.columns[self.dimensions.length+metricIdx],columns=queryResponse.columns.slice(0,self.dimensions.length).concat(metricColumn);if(null==self.dimension||0===rows.length)self.rawData.push({dateRange:dateRange,rows:rows,columns:columns});else{var uniqueValuesObj={};rows.forEach(function(row){var value=row[1];uniqueValuesObj[value]=value});var uniqueValues=Object.keys(uniqueValuesObj),series=uniqueValues.map(function(){return{dateRange:dateRange,columns:columns,rows:[]}});rows.forEach(function(row){var value=row[1],idx=uniqueValues.indexOf(value);-1===idx&&null===value&&(idx=uniqueValues.indexOf("null")),idx>-1&&idx<series.length&&series[idx].rows.push(row)}),self.rawData=self.rawData.concat(series)}}}),createChart(self.rawData)}.bind(null,dateRanges)).catch(onQueryError).finally(onQueryCompleted)}}function onQueryError(err){console.error(err)}function onQueryCompleted(){self.isLoading=!1}function createChart(allSeries){var chart={type:self.type,data:[],series:[],labels:[],datasetOverride:null,options:null},longestSeries=_.max(allSeries,function(series){var from=moment(series.dateRange.from),to=moment(series.dateRange.to);return Math.abs(Math.ceil(from.diff(to,self.groupBy,!0)))}),uniqueDateRanges=_.uniq(allSeries,function(s){return s.dateRange.from+s.dateRange.to});allSeries.forEach(function(series){var METRIC_COLUMN_INDEX=series.columns.length-1;series.rows&&series.rows.forEach(function(row){row[0]=new Date(row[0])});var currentDate=moment(series.dateRange.from).startOf("day"),uptoDate=moment(series.dateRange.to).endOf("day"),diffToLongest=currentDate.diff(moment(longestSeries.dateRange.from),"days"),groupedRows=function groupRows(rows,dateIdx,metricIdx){if(null==rows||0===rows.length)return rows;function getDate(rowKey){return new Date(1e3*rowKey)}for(var currentKey=getDateKey(rows[0][dateIdx]),groupedRows=[[getDate(currentKey),rows[0][metricIdx]]],i=1;i<rows.length;i++){var row=rows[i],rowKey=getDateKey(row[dateIdx]);if(rowKey!==currentKey){var newRow=[getDate(rowKey),row[metricIdx]];groupedRows.push(newRow),currentKey=rowKey}else groupedRows[groupedRows.length-1][1]+=row[metricIdx]}return groupedRows}(series.rows,0,METRIC_COLUMN_INDEX),seriesData=[];do{var key=getDateKey(currentDate.clone().add(diffToLongest,"days")),row=groupedRows.find(function(row){var rowKey=getDateKey(moment(row[0]).add(diffToLongest,"days"));return key===rowKey}),metric=0;if(row&&(metric=row[1]),seriesData.push(metric),series===longestSeries){var labels=[],dates=[];allSeries.forEach(function(s,idx){var from=moment(s.dateRange.from),to=moment(s.dateRange.to),differenceToMain=from.diff(moment(longestSeries.dateRange.from),"days"),adjustedDate=currentDate.clone().add(differenceToMain,"days");if(adjustedDate<from||adjustedDate>to)return"";var date=adjustedDate.format("YYYY-MM-DD");dates.push(date);var label=getLabel(adjustedDate);labels.indexOf(label)>-1||(chart.labels.length>0&&chart.labels[chart.labels.length-1][idx]===label?labels.push(""):labels.push(label))}),chart.labels.push(labels),chart.labels.dates=chart.labels.dates||[],chart.labels.dates.push(dates)}currentDate=nextDate(currentDate)}while(currentDate<=uptoDate);if(chart.data.push(seriesData),allSeries.length>1||null!=self.dimension){var seriesLabel="";if(uniqueDateRanges.length>1){var seriesFrom=moment(series.dateRange.from),seriesTo=moment(series.dateRange.to);seriesLabel+=formatDate(seriesFrom)+" – "+formatDate(seriesTo)}if(null!=self.dimension&&series.rows.length>0){var dimensionLabel=series.rows[0][1];seriesLabel.length>0&&(seriesLabel+=" - "),seriesLabel+=dimensionLabel||"(unknown)"}if(self.metrics.length>1){var metricLabel=getColumnName(series.columns[self.dimensions.length]);seriesLabel.length>0&&(seriesLabel+=" | "),seriesLabel+=metricLabel}chart.series.push(seriesLabel)}});var isSinglePoint=chart.data.length>0&&chart.data.every(function(series){return 1===series.length}),isCompare=uniqueDateRanges.length>1,isMulti=null!=self.dimension;if(isSinglePoint){var emptyLabel=[""];chart.labels.splice(0,0,emptyLabel),chart.labels.push(emptyLabel),allSeries.forEach(function(_,idx){var data=chart.data[idx];data.splice(0,0,NaN),data.push(NaN)})}function nextDate(currentDate){return getDateGroup(currentDate).add(1,self.groupBy)}function getLabel(date){switch(self.groupBy){case"day":return date.format("D MMM");case"week":var monday=date.clone().startOf("isoweek"),sunday=date.clone().endOf("isoweek");return monday.format("D MMM")+" - "+sunday.format("D MMM");case"month":return date.clone().startOf("month").format("MMMM")}}function getDateKey(date){return getDateGroup(date).unix()}function getDateGroup(date){var momentDate=moment(date);switch(self.groupBy){case"day":return momentDate.clone().startOf("day");case"week":return momentDate.clone().startOf("isoweek");case"month":return momentDate.clone().startOf("month")}}return chart.datasetOverride=umsChartsSettings.getTheme(self.theme,allSeries.length,self.stack),self.stack&&allSeries.forEach(function(series,idx){var stackId=series.dateRange.from+series.dateRange.to;chart.datasetOverride[idx].stack=stackId}),function getChartAnnotations(series){if(null==series||0===series.length)return $q.when([]);var minFrom=_.min(series,function(series){return moment(series.dateRange.from)}).dateRange.from,maxTo=_.max(series,function(series){return moment(series.dateRange.to)}).dateRange.to;return umsAnnotationsService.getAll(self.contentId,self.culture,minFrom,maxTo).then(function(annotations){return annotations.map(function(annotation){return{icon:annotation.iconPath,content:annotation.description,date:getDateGroup(annotation.timestamp).format("YYYY-MM-DD")}})})}(allSeries).then(function(chartAnnotations){$scope.$on("chart-create",function(evt,chart){if(null!=self.annotationsPlugin&&self.annotationsPlugin.chart===chart)return self.annotationsPlugin.annotations=chartAnnotations,void self.annotationsPlugin.reload();var wasEnabled=null!=self.annotationsPlugin&&self.annotationsPlugin.enabled;function registerPlugin(){chart.$plugins.descriptors.push({plugin:self.annotationsPlugin,options:{}})}self.annotationsPlugin=new umsAnnotationsPluginFactory(chart,chartAnnotations,wasEnabled),registerPlugin(self.annotationsPlugin),self.annotationsPlugin.onResize=function(){setTimeout(function(){registerPlugin(),self.annotationsPlugin.reload()},0)}})}).then(function(){chart.options=umsChartsSettings.getChartOptions(self.type,self.size)||{},function isReportingChart(theme){return"reporting"==theme.split("-")[0]}(self.theme)&&(chart.options=umsChartsSettings.getChartSettings(self.theme).options,chart.datasetOverride=umsChartsSettings.getChartSettings(self.theme).datasetOverride),chart.options.maintainAspectRatio=!self.isFullHeight,chart.options.tooltips.callbacks={title:function(datasets){if(!Array.isArray(datasets)||0===datasets.length)return"";var labels=datasets[0].xLabel;return Array.isArray(labels)?labels.join(" + "):""},label:function(item,data){item.index=Math.min(item.index,data.labels.dates.length-1);var date=data.labels.dates[item.index][item.datasetIndex],label=(data.datasets[item.datasetIndex],"");isCompare&&(label=formatDate(moment(date)));var series=allSeries[item.datasetIndex];isMulti&&series.rows.length>0&&(label.length>0&&(label+=" - "),label+=series.rows[0][self.dimensions.length-1]);self.metrics.length>1&&(label.length>0&&(label+=" | "),label+=getColumnName(allSeries[item.datasetIndex].columns[self.dimensions.length]));var dataPoint=item.yLabel,suffix="";return self.showPercentages?suffix="%":1!==dataPoint||null==self.unit&&null==self.unitSingular?1!==dataPoint&&null!=self.unit&&(suffix=self.unit):suffix=self.unitSingular||self.unit,(label?label+": ":"")+dataPoint+" "+suffix},afterBody:function(items){if(isCompare){var main=items[0],compare=items[1],mainValue=parseInt(main.value),compareValue=parseInt(compare.value);if(!isNaN(mainValue)&&!isNaN(compareValue)&&0!==mainValue){var difference=(compareValue-mainValue)/mainValue;return"Change: "+(difference>0?"+":"")+((100*difference).toFixed(2)+"%")}}}};var anySeriesHasValues=allSeries.some(function(series){return series.rows.length>0});chart.options.legend.display=allSeries.length>1||null!=self.dimension&&anySeriesHasValues,chart.options.labels={fontColor:"#000000",usePointStyle:!0,boxWidth:6,boxHeight:6,pointRadius:0},0!=self.absoluteData.length&&self.absoluteData==chart.data||(self.absoluteData=structuredClone(chart.data)),self.showPercentages&&setPercentageData(chart),chart.options.legend.position="bottom",self.chart=chart})}function formatDate(date){return $filter("umsDate")(date._isAMomentObject?date.toDate():date,!0,!0)}function getColumnName(metric){switch(metric){case"avgTimeOnPage":return"Time on page";case"avgEngagedTimeOnPage":return"Engaged time on page";case ums.constants.metrics.pageSessions:return"Sessions";case ums.constants.metrics.pageVisitors:return"Visitors";case ums.constants.metrics.activeSegmentPageviews:case ums.constants.metrics.activeSegmentSessions:case ums.constants.metrics.activeSegmentProfiles:return"In segment";case ums.constants.metrics.inactiveSegmentPageviews:case ums.constants.metrics.inactiveSegmentSessions:case ums.constants.metrics.inactiveSegmentProfiles:return"Not in segment";case ums.constants.metrics.activePersonalizedSegmentPageviews:case ums.constants.metrics.activePersonalizedSegmentSessions:case ums.constants.metrics.activePersonalizedSegmentProfiles:return"Personalized";case ums.constants.metrics.inactivePersonalizedSegmentPageviews:case ums.constants.metrics.inactivePersonalizedSegmentSessions:case ums.constants.metrics.inactivePersonalizedSegmentProfiles:return"Not personalized";default:return metric}}function setPercentageData(chart){if(null!=chart){self.percentageData=structuredClone(chart.data);var totals=new Array(self.absoluteData[0].length).fill(0);for(let i=0;i<self.absoluteData.length;i++)for(let j=0;j<self.absoluteData[i].length;j++)totals[j]=totals[j]+self.absoluteData[i][j];for(let i=0;i<self.absoluteData.length;i++)for(let j=0;j<self.absoluteData[i].length;j++){var percentage=Number((self.percentageData[i][j]/totals[j]*100).toFixed(2))||0;self.percentageData[i][j]=percentage}if(3===self.percentageData.length&&self.percentageData[0].length===self.percentageData[1].length){var n=self.percentageData[0].length;for(let c=0;c<n;c++){var sum=Number((self.percentageData[0][c]+self.percentageData[1][c]).toFixed(2));if(sum>100){var diff=Number((100-sum).toFixed(2));self.percentageData[0][c]+=diff}}}chart.data=self.percentageData}}destroyFns.push(umsAnalyticsService.registerOnChangeDateCallback(function onDatePicked(from,to){from&&to&&reload()})),self.querySettings={page:1,pageSize:999,filter:null,sort:ums.constants.dimensions.date,ascending:!0,realtime:!1},self.chart=null,self.rawData=null,self.isLoading=!1,self.groupBy="day",self.dimensions=[ums.constants.dimensions.date],self.contentId=umsUtilService.getCurrentContentId(),self.culture=umsUtilService.getCurrentCulture(),self.$onChanges=function onChanges(changes){var metricsChanged=changes.metrics,filterChanged=changes.filter,realtimeChanged=changes.realtime,showPercentagesChanged=changes.showPercentages;metricsChanged||filterChanged||realtimeChanged?(self.theme=self.theme||"default",self.querySettings.filter=self.filter,self.querySettings.realtime=self.realtime,reload()):showPercentagesChanged&&null!=self.chart&&(changes.showPercentages.currentValue?setPercentageData(self.chart):self.chart.data=self.absoluteData)},self.$onDestroy=function onDestroy(){for(var i=0;i<destroyFns.length;i++)destroyFns[i]()},self.$onInit=function onInit(){null!=self.dimension&&self.dimensions.push(self.dimension);destroyFns.push(eventEmitter.on("groupByControls.onChange",function(evt){evt.newValue!==self.groupBy&&(self.groupBy=evt.newValue,null!=self.rawData&&(self.isLoading=!0,createChart(self.rawData).finally(function(){self.isLoading=!1})))},!0),eventEmitter.on("changed.analytics.settings.includeNodeDescendants",function(){$timeout(reload,0)}))},self.annotationsPlugin=null,self.showAnnotations=!0,self.isFullHeight=!1,self.showPercentages=!1,self.absoluteData=[],self.percentageData=[],this.onShowAnnotations=function(){self.annotationsPlugin&&self.annotationsPlugin.enable()},this.onHideAnnotations=function(){self.annotationsPlugin&&self.annotationsPlugin.disable()},this.reload=reload}]}),angular.module("engage").service("umsChartsApi",["umsDownloader",function(Downloader){var dl=new Downloader("/umbraco/backoffice/api/umsdashboardchartsapi");this.getPageviews=function(from,to,contentId,culture,upFrom,upTo){var qs="?from="+from+"&to="+to;return contentId&&(qs+="&contentId="+contentId),culture&&(qs+="&culture="+culture),upFrom&&(qs+="&upFrom="+upFrom),upTo&&(qs+="&upTo="+upTo),dl.get("GetPageviewsPerDay"+qs)},this.getSessions=function(from,to,upFrom,upTo){return dl.get("GetSessionsPerDay?from="+from+"&to="+to+"&upfrom="+upFrom+"&upto="+upTo)},this.getAllGoalCompletions=function(from,to,upFrom,upTo){return dl.get("GetAllGoalCompletions?from="+from+"&to="+to+"&upfrom="+upFrom+"&upto="+upTo)}}]),angular.module("engage").constant("UMS_CHART_PREFABS",{}).run(["umsConfigurationService","UMS_CHART_PREFABS",initializeUmsChartPrefabsConstant]),angular.module("engage").component("umsPrefabChart",{template:'<ums-chart ng-if="!$ctrl.isLoading" metrics="$ctrl.allMetrics" dimension="$ctrl.dimension" filter="$ctrl.filter" realtime="$ctrl.realtime" theme="$ctrl.theme" type="$ctrl.type" size="$ctrl.size" stack="$ctrl.stack" show-annotations="$ctrl.showAnnotations" show-percentages="$ctrl.showPercentages" trendIndex="$ctrl.trendIndex" unit="$ctrl.unit" is-full-height="$ctrl.isFullHeight" unit-singular="$ctrl.unitSingular"></ums-chart>',bindings:{alias:"<",drilldown:"<?",showAnnotations:"<?",theme:"<?",isFullHeight:"<?",showPercentages:"<?",metrics:"<?"},controller:["umsConfigurationService","UMS_CHART_PREFABS",umsPrefabChartController]}),angular.module("engage").component("umsCodemirror",{template:'<textarea ng-model="$ctrl.model"></textarea>',bindings:{mode:"@",value:"=",readonly:"<?",onChange:"&?"},controller:function($element,$timeout){var ctrl=this;this.$onInit=function(){var textArea=$element.find("textarea")[0];if(null!=textArea){var codeMirror=CodeMirror.fromTextArea(textArea,{lineNumbers:!0,mode:this.mode,readOnly:this.readonly});this.value&&codeMirror.setValue(this.value),codeMirror.on("change",function(inst){var value=inst.getValue();$timeout(function(){ctrl.value=value,"function"==typeof ctrl.onChange&&ctrl.onChange({value:value})})})}}}}),angular.module("engage").component("umsConfigurationCleanupLog",{template:'<table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><th class="ums-table__th">Started</th><th class="ums-table__th">Finished</th><th class="ums-table__th">Executor</th><th class="ums-table__th">Status</th><th class="ums-table__th">Error</th></tr></thead><tbody><tr ng-repeat="entry in $ctrl.entries track by $index" ng-style="entry.failed && { \'background-color\': \'#cc0000\', \'color\': \'white\' }" class="ums-table__tr"><td class="ums-table__td" ng-bind="entry.started | date:\'yyyy-MM-dd HH:mm:ss\'"></td><td class="ums-table__td" ng-bind="entry.finished | date:\'yyyy-MM-dd HH:mm:ss\'"></td><td class="ums-table__td" ng-bind="entry.executor"></td><td class="ums-table__td" ng-bind="entry.failed ? \'Failed\' : \'Success\'"></td><td class="ums-table__td" ng-bind="entry.errorMessage"></td></tr></tbody></table>',bindings:{amount:"<?"},controller:["$http",function($http){var $ctrl=this;$ctrl.entries=[],$ctrl.$onChanges=function(){$ctrl.getEntries(this.amount).then(function(entries){$ctrl.entries=entries})},$ctrl.getEntries=function(amount){return $http.get("/umbraco/backoffice/engage/dataCleanup/getlogs?amount="+amount).then(function(response){return response.data||[]})}}]}),angular.module("engage").component("umsConfigurationProfiles",{template:'<div><h3>Profiles</h3></div><div class="ums-boxed__container"><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h3>Potential</h3></span><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Active threshold (in days) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">This threshold specifies in which period the profile is considered active</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.config.potential.activeThresholdInDays" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Engaged time threshold (in seconds) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">This threshold specifies when a profile is consided engaged. If the profile is higher than this number of seconds engaged, the profile potential (on a detailpage of the profile) will show that the profile is engaged.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.config.potential.engagedThresholdInSeconds" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Engaged threshold (in number of sessions) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">This threshold specifies the number of last sessions of a profile that are taken into account</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.config.potential.engagedThresholdNumberOfSessions" disabled></div></div></div><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h3>Identification</h3></span><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Name <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The template to use for the Member name</span></span></label> <input type="text" class="ums-form__input" value ng-model="$ctrl.config.identification.name" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Abbreviation <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The template to use for the Member abbreviation</span></span></label> <input type="text" class="ums-form__input" value ng-model="$ctrl.config.identification.abbreviation" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Image Property Alias <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The property alias of the Member property holding the member avatar image</span></span></label> <input type="text" class="ums-form__input" value ng-model="$ctrl.config.identification.imagePropertyAlias" disabled></div></div></div></div>',bindings:{config:"<"}}),angular.module("engage").component("umsConfigurationReporting",{template:'<div><h3>Reporting</h3></div><div class="ums-boxed__container"><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Data generation enabled <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">If true, reporting data will be generated daily at a configurable time.</span></span></label><div class="ums-form__switch"><input type="radio" name="Reporting_DataGenerationEnabled-1" id="Reporting_DataGenerationEnabled-1" class="ums-form__switch__input" ng-model="$ctrl.config.dataGenerationEnabled" ng-value="true" disabled> <label for="Reporting_DataGenerationEnabled-1" class="ums-form__switch__label">True</label> <input type="radio" name="Reporting_DataGenerationEnabled-2" id="Reporting_DataGenerationEnabled-2" class="ums-form__switch__input" ng-model="$ctrl.config.dataGenerationEnabled" ng-value="false" disabled> <label for="Reporting_DataGenerationEnabled-2" class="ums-form__switch__label">False</label></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Data generation time <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The time each day reporting data will be generated (24 hour format). This uses the local time of the webserver.</span></span></label> <input type="text" class="ums-form__input" value ng-model="$ctrl.config.dataGenerationTime" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Data generation log <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">View the logs of the last 20 attempted data generation runs.</span></span></label> <button type="button" class="btn ums-button ums-button--base" ng-click="$ctrl.showDataGenerationLog = true"><span>View log</span></button></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Regenerate reporting data <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Warning! Regenerating reporting data might have an impact on the performance of the site!</span></span></label> <button type="button" class="btn ums-button ums-button--error" ng-click="$ctrl.confirmRegenerate()" ng-disabled="$ctrl.regenerateButtonDisabled"><span>{{ $ctrl.regenerateButtonText }}</span></button></div></div></div></div><ums-overlay large="true" close="$ctrl.showDataGenerationLog = false" ng-if="$ctrl.showDataGenerationLog"><ums-overlay-header><h4 class="h2 umsHeading">Data Generation Log</h4></ums-overlay-header><ums-overlay-body><ums-reporting-data-generation-log amount="20"></ums-reporting-data-generation-log></ums-overlay-body></ums-overlay><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" text="$ctrl.state.confirm.text" confirm-yes-text="\'Regenerate Reporting Data\'" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.closeConfirm()"></ums-ui-confirm-overlay>',bindings:{config:"<"},controller:["$scope","$http","$interval",umsConfigurationReportingController]}),angular.module("engage").component("umsConfiguration",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--1-1 ums-flexgrid__item--lg-1-4 is-animated"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/illustration-settings-config.png" alt><br><h2>Configuration</h2><p>Here you find an overview of all the settings of Umbraco Engage. It is not possible to change these setting here directly, because you have to restart your website. The settings can be changed in the appsettings.json file.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 ums-flexgrid__item--lg-3-4 is-animated" ng-if="!$ctrl.state.isLoading"><div><h3 style="margin-top: 0;">Settings</h3></div><div class="ums-boxed__container"><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Database Connection Name <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">In this database the data of Umbraco Engage will be stored. By default this is the same database as Umbraco is stored, but this could be set to another database instance</span></span></label> <input type="text" class="ums-form__input" value ng-model="$ctrl.state.configuration.settings.databaseConnectionStringName" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Umbraco Engage enabled? <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">If Umbraco Engage is disabled, no data will be collected and no personalization or A/B testing is applied.<span ng-show="!$ctrl.state.configuration.settings.enabled"><br><br>Umbraco Engage is turned off in configuration so cannot be enabled at runtime. To enable/disable Umbraco Engage at runtime it must be enabled in configuration.</span></span></span></label><div class="ums-form__switch"><input type="radio" name="Activity-1" id="Activity-1-1" class="ums-form__switch__input" ng-value="true" ng-model="$ctrl.state.enabled" ng-disabled="!$ctrl.state.configuration.settings.enabled" ng-click="$ctrl.umsActivityChanges($event, true)"> <label for="Activity-1-1" class="ums-form__switch__label ums-form__switch__label--success">Enabled</label> <input type="radio" name="Activity-1" id="Activity-2-1" class="ums-form__switch__input" ng-value="false" ng-model="$ctrl.state.enabled" ng-disabled="!$ctrl.state.configuration.settings.enabled" ng-click="$ctrl.umsActivityChanges($event, false)"> <label for="Activity-2-1" class="ums-form__switch__label ums-form__switch__label--error">Disabled</label></div></div></div></div></div><br><div><h3>Analytics</h3></div><div class="ums-boxed__container"><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h3>Visitor Cookie</h3></span><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Expiration (in days) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">This specifies the default expiration days of the cookie of the visitor. It is a sliding expiration. Every visit the cookies is reinitialized with this expiration.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.visitorCookie.expirationInDays" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Cookie Name <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The name of the cookie that is set to track a visitor.</span></span></label> <input type="text" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.visitorCookie.cookieName" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Include Subdomains <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">This setting defines whether subdomains can use the cookie as well. By default only the exact domain can use the cookie.</span></span></label><div class="ums-form__switch"><input type="radio" name="IncludeSubdomains-1" id="IncludeSubdomains-1-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.visitorCookie.includeSubdomains" ng-value="true" disabled> <label for="IncludeSubdomains-1-1" class="ums-form__switch__label">True</label> <input type="radio" name="IncludeSubdomains-1" id="IncludeSubdomains-2-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.visitorCookie.includeSubdomains" ng-value="false" disabled> <label for="IncludeSubdomains-2-1" class="ums-form__switch__label">False</label></div></div></div></div><br><hr><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h3>Data Collection</h3></span><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Anonymize IP Address <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Indicates whether the IP Address of the visitor is anonymized. When it is anonymized the last octet of an IPv4 IP address or last 80 bits of a IPv6 address is set to zeros.</span></span></label><div class="ums-form__switch"><input type="radio" name="AnonymizeIPAddress-1" id="AnonymizeIPAddress-1-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.dataCollection.anonymizeIPAddress" ng-value="true" disabled> <label for="AnonymizeIPAddress-1-1" class="ums-form__switch__label">True</label> <input type="radio" name="AnonymizeIPAddress-1" id="AnonymizeIPAddress-2-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.dataCollection.anonymizeIPAddress" ng-value="false" disabled> <label for="AnonymizeIPAddress-2-1" class="ums-form__switch__label">False</label></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Flush rate (in records) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">When this number of records is reached in memory it will be sent from memory to the database.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataCollection.flushRateInRecords" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Flush interval (in seconds) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">When this number of seconds is reached, the data in memory will be sent to the database.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataCollection.flushIntervalInSeconds" disabled></div></div></div><br><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h4 class="h3" style="font-size: 13px !important">Internal Site Search</h4></span><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Is automatic search tracking enabled? <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Internal site searches are automatically tracked based on the specified querystring parameters. When set to false, you will need to include javascript or C# calls to track searches</span></span></label><div class="ums-form__switch"><input type="radio" name="automaticSearchTracking-1" id="automaticSearchTracking-1-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.automaticSearchTracking" ng-value="true" disabled> <label for="automaticSearchTracking-1-1" class="ums-form__switch__label">True</label> <input type="radio" name="automaticSearchTracking-1" id="automaticSearchTracking-2-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.automaticSearchTracking" ng-value="false" disabled> <label for="automaticSearchTracking-2-1" class="ums-form__switch__label">False</label></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Searchterm querystring parameter(s) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">This querystring parameter indicates the part in the url that holds the searchterm</span></span></label> <span ng-if="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.searchTermParameters.length === 0" class="ums-form__input ums-form__input--disabled ums-form__input--empty">No parameter found.</span><ul class="ums-form__array" ng-if="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.searchTermParameters.length > 0"><li ng-repeat="searchParam in $ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.searchTermParameters" ng-bind="searchParam" class="ums-form__input ums-form__input--disabled ums-form__input--filter ums-form__input--auto"></li></ul></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Searchbox querystring parameter(s) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">When there are multiple searchboxes on one page this parameter can be used to indicate which searchbox was used</span></span></label> <span ng-if="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.searchBoxParameters.length === 0" class="ums-form__input ums-form__input--disabled ums-form__input--empty">No parameter found.</span><ul class="ums-form__array" ng-if="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.searchBoxParameters.length > 0"><li ng-repeat="searchParam in $ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.searchBoxParameters" ng-bind="searchParam" class="ums-form__input ums-form__input--disabled ums-form__input--filter ums-form__input--auto"></li></ul></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Searchterm category parameter(s) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">If there is an option to search within a specific category, this querystring parameter indicates the category.</span></span></label> <span ng-if="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.categoryParameters.length === 0" class="ums-form__input ums-form__input--disabled ums-form__input--empty">No parameter found.</span><ul class="ums-form__array" ng-if="$ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.categoryParameters.length > 0"><li ng-repeat="searchParam in $ctrl.state.configuration.analytics.dataCollection.internalSiteSearch.categoryParameters" ng-bind="searchParam" class="ums-form__input ums-form__input--disabled ums-form__input--filter ums-form__input--auto"></li></ul></div></div></div><br><hr><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h3>Data Processing</h3></span><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Data processing interval (in seconds) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The setting specifies the interval that is used to process records. By default every 30 seconds the rawdata table is checked wheter there are any records to process</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataProcessing.intervalInSeconds" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Session length (in minutes) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Specifies which seperate page requests of one visitor are linked together to one session</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataProcessing.sessionLengthInMinutes" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Is a processing server? <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Indicates whether this server is the processing server. For performance optimization the processing of the data could be outsourced to another server. Processing is done on the raw data. Possible options: true and false.</span></span></label><div class="ums-form__switch"><input type="radio" name="IsProcessingServer-1" id="IsProcessingServer-1-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.dataProcessing.isProcessingServer" ng-value="true" disabled> <label for="IsProcessingServer-1-1" class="ums-form__switch__label">True</label> <input type="radio" name="IsProcessingServer-1" id="IsProcessingServer-2-1" class="ums-form__switch__input" ng-model="$ctrl.state.configuration.analytics.dataProcessing.isProcessingServer" ng-value="false" disabled> <label for="IsProcessingServer-2-1" class="ums-form__switch__label">False</label></div></div></div></div><br><hr><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h3>Data Storage</h3></span><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Anonymize analytics data after (in days) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Specifies the maximum number of days that individual page requests can be linked to a specific visitor. After these days the data is still available (for aggregate reporting for example) but cannot be linked to the individual visitor anymore.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataStorage.anonymizeAnalyticsDataAfterDays" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Delete analytics data after (in days) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">After this number of days the data will be deleted from the database</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataStorage.deleteAnalyticsDataAfterDays" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Delete raw data after (in days) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The number of days that raw data is stored in the database. Raw data is relatively big and is not needed anymore once it is processed. Only if you want to reprocess data at a later moment it can be useful to set to a higher number.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataStorage.deleteRawDataAfterDays" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Keep control group data active for (in days) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">After this number of days the visitors control group data will be deleted from the database</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataStorage.deleteControlGroupDataAfterDays" disabled></div></div></div><br><hr><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><span class="ums-flexgrid__item"><h3>Data Cleanup</h3></span><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Start delay (in seconds) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The number of seconds Umbraco Engage will wait before starting the periodic cleanup process. This value should be incremented if your website has a long(er) startup time.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataCleanup.startAfterSeconds" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Cleanup interval (in seconds) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The delay (in seconds) between periodic cleanups. If your website has high traffic loads, this value should be decreased to keep up with the raw (pageview) data being inserted into your database.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataCleanup.intervalInSeconds" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Cleanup batch size (in rows) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">The maximum number of rows (pageviews) that should be cleaned up from the raw data tables in each cleanup cycle. The number of records divided by the cleanup interval (in seconds) determines the avarage cleanup rate per second. This value should be higher than the number of pageviews your website handles per second.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.analytics.dataCleanup.numberOfRows" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Data Cleanup log <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">View the logs of the last 20 attempted data cleanup runs.</span></span></label> <button type="button" class="btn ums-button ums-button--base" ng-click="$ctrl.showCleanupLog = true"><span>View log</span></button></div></div></div></div><br><div><h3>A/B Testing</h3></div><div class="ums-boxed__container"><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Required % Visitors Before Showing Advice <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">This percentage of visitors should be reached before Umbraco Engage gives any advice about a running A/B Test.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.abTesting.requiredVisitorPercentageBeforeShowingAdvice" disabled></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><label class="ums-form__label">Minimum % Macro Goal Warning <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Indicates the threshold of a macro goal warning. If the macro goal conversion is decreased/increased with this percentage a warning is given that the A/B Test is harming the macro goal.</span></span></label> <input type="number" class="ums-form__input" value ng-model="$ctrl.state.configuration.abTesting.minimumPercentageMacroGoalWarning" disabled></div></div></div></div><br><ums-configuration-profiles config="$ctrl.state.configuration.profiles"></ums-configuration-profiles><br><ums-configuration-reporting config="$ctrl.state.configuration.reporting"></ums-configuration-reporting><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" text="$ctrl.state.confirm.text" confirm-yes-text="\'Disable Umbraco Engage\'" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.closeConfirm()"></ums-ui-confirm-overlay></div></div></div><ums-overlay large="true" close="$ctrl.showCleanupLog = false" ng-if="$ctrl.showCleanupLog"><ums-overlay-header><h4 class="h2 umsHeading">Data Cleanup Log</h4></ums-overlay-header><ums-overlay-body><ums-configuration-cleanup-log amount="20"></ums-configuration-cleanup-log></ums-overlay-body></ums-overlay>',controller:["umsConfigurationService","notificationsService",umsConfigurationController]}),angular.module("engage").service("umsConfigurationService",["$http","$q","userService",umsConfigurationService]),angular.module("engage").service("umsContentTypeService",["$http",umsContentTypeService]),angular.module("engage").component("umsCssJsEditor",{template:'<ums-accordion-item name="CSS"><ums-accordion-item-status><span class="ums-accordion__flex-holder ums-accordion__flex-holder--small ums-accordion__added" ng-class="{\'s-active\': $ctrl.hasCss}"><span>Added</span><ums-icon id="icon-checkmark-rounded" modifier="sm" css-class="icon-checkmark"></ums-icon></span></ums-accordion-item-status><ums-codemirror mode="css" value="$ctrl.css" on-change="$ctrl.hasCss = $ctrl.hasContent(value)"></ums-codemirror></ums-accordion-item><ums-accordion-item name="JavaScript"><ums-accordion-item-status><span class="ums-accordion__flex-holder ums-accordion__flex-holder--small ums-accordion__added" ng-class="{\'s-active\': $ctrl.hasJs}"><span>Added</span><ums-icon id="icon-checkmark-rounded" modifier="sm" css-class="icon-checkmark"></ums-icon></span></ums-accordion-item-status><ums-codemirror mode="javascript" value="$ctrl.js" on-change="$ctrl.hasJs = $ctrl.hasContent(value)"></ums-codemirror></ums-accordion-item>',bindings:{css:"=",js:"="},controller:[umsCssJsEditorCtrl]}),angular.module("engage").constant("umsCustomComponents",{profiles:{externalProfileData:null}}),angular.module("engage").constant("UMS_DATERANGEPICKER_MODES",{CUSTOM:"custom",TODAY:"today",YESTERDAY:"yesterday",LAST_7_DAYS:"last-7-days",LAST_30_DAYS:"last-30-days",THIS_MONTH:"this-month",LAST_MONTH:"last-month",THIS_YEAR:"this-year",LAST_YEAR:"last-year",PREVIOUS_YEAR:"previous-year",PREVIOUS_PERIOD:"previous-period"}),angular.module("engage").factory("UmsDateRangePicker",["umsUtilService","UMS_DATERANGEPICKER_MODES",function(utilService,MODE){function UmsDateRangePicker(loadFn,saveFn){this.loadFn=loadFn,this.saveFn=saveFn,this.dateFormat="YYYY-MM-DDTHH:mm:ss[Z]",this.state={config:{compare:!1,primary:{mode:MODE.LAST_7_DAYS,args:null},secondary:{mode:MODE.PREVIOUS_PERIOD,args:null}},range:{primary:{from:null,to:null},secondary:{from:null,to:null}},eventEmitter:utilService.createEventEmitter()},this.init()}return Object.assign(UmsDateRangePicker.prototype,{init:function(){this.initData()},initData:function(){this.load(function(data){null!=data&&Object.assign(this.state.config,data),this.computeRange(this.state.config.primary,this.state.range.primary),this.computeRange(this.state.config.secondary,this.state.range.secondary,this.state.config.primary,this.state.range.primary)}.bind(this))},computeRange:function(config,range,compareToConfig,compareToRange){var from,to;switch(config.mode){case MODE.TODAY:from=moment().startOf("day"),to=moment().endOf("day");break;case MODE.YESTERDAY:from=moment().add(-1,"days").startOf("day"),to=moment().add(-1,"days").endOf("day");break;case MODE.LAST_7_DAYS:from=moment().add(-7,"days").startOf("day"),to=moment().add(-1,"days").endOf("day");break;case MODE.LAST_30_DAYS:from=moment().add(-30,"days").startOf("day"),to=moment().add(-1,"days").endOf("day");break;case MODE.THIS_MONTH:from=moment().startOf("month"),to=moment().endOf("day");break;case MODE.LAST_MONTH:from=moment().startOf("month").add(-1,"months"),to=moment().endOf("month").add(-1,"months");break;case MODE.THIS_YEAR:from=moment().startOf("year"),to=moment().endOf("day");break;case MODE.LAST_YEAR:from=moment().add(-1,"years").startOf("year"),to=moment().add(-1,"years").endOf("year");break;case MODE.CUSTOM:null!=range&&null!=range.from&&null!=range.to&&(config.args={from:range.from,to:range.to}),null!=config.args&&null!=config.args.from&&null!=config.args.to&&(from=moment(config.args.from),to=moment(config.args.to));break;case MODE.PREVIOUS_PERIOD:case MODE.PREVIOUS_YEAR:if(null==compareToRange)throw new Error("Modes '"+MODE.PREVIOUS_PERIOD+"' and '"+MODE.PREVIOUS_YEAR+"' require `compareToRange` to be passed in");this.computePreviousRange(compareToConfig.mode,compareToRange,config.mode,function(previousFrom,previousTo){from=previousFrom,to=previousTo});break;default:throw new Error("Invalid mode: "+config.mode)}range.from=from&&from.utc().format(this.dateFormat),range.to=to&&to.utc().format(this.dateFormat)},computePreviousRange:function(sourceMode,sourceRange,targetMode,callback){var from,to;if(null!=sourceRange.from&&null!=sourceRange.to){var sourceFrom=moment(sourceRange.from),sourceTo=moment(sourceRange.to);switch(targetMode){case MODE.PREVIOUS_PERIOD:switch(sourceMode){case MODE.THIS_MONTH:from=sourceFrom.add(-1,"months").startOf("month"),to=sourceTo.add(-1,"months");break;case MODE.LAST_MONTH:from=sourceFrom.add(-1,"months").startOf("month"),to=sourceTo.add(-1,"months").endOf("month");break;case MODE.THIS_YEAR:from=sourceFrom.add(-1,"years").startOf("year"),to=sourceTo.add(-1,"years");break;default:var numDays=sourceTo.diff(sourceFrom,"days")+1;from=sourceFrom.add(-1*numDays,"days"),to=sourceTo.add(-1*numDays,"days")}break;case MODE.PREVIOUS_YEAR:from=sourceFrom.add(-1,"years"),to=sourceTo.add(-1,"years")}}callback(from,to)},load:function(callback){null!=this.loadFn?callback(this.loadFn()):callback(null)},save:function(){null!=this.saveFn&&this.saveFn(this.state.config)},triggerChange:function(){this.state.eventEmitter.emit("change",this.state.config,this.state.range)},getRange:function(){return angular.copy(this.state.range)},getRanges:function(){return[angular.copy(this.state.range.primary),angular.copy(this.state.range.secondary)]},getConfig:function(){return this.state.config},broadcast:function(config,range){this.state.config=config,this.state.range=range,this.computeRange(config.primary,this.state.range.primary),this.computeRange(config.secondary,this.state.range.secondary,this.state.config.primary,this.state.range.primary),this.save(),this.triggerChange()},onChange:function(callback){return this.state.eventEmitter.on("change",callback)}}),UmsDateRangePicker}]),angular.module("engage").component("umsDaterangepicker",{template:'<div class="ums-datepicker__wrapper"><div class="ums-form__input-iconwrap" ng-click="$ctrl.toggle()"><div class="ums-datepicker__button" ng-class="{\'is-compared\': $ctrl.showCompare && $ctrl.state.config.compare === true}"><strong class="ums-datepicker__button__origin" ng-bind="$ctrl.fn.displayPrimaryRange()"></strong><br><div class="ums-datepicker__button__compare" ng-if="$ctrl.showCompare && $ctrl.state.config.compare"><span>Compare to:</span><strong ng-bind="$ctrl.fn.displaySecondaryRange()"></strong></div></div><span class="ums-form__input-icon"><ums-icon id="icon-date-select" modifier="sm"></ums-icon></span></div><div ng-if="!$ctrl.state.ui.isHidden" ng-click="$ctrl.cancel()" class="ums-datepicker__popup__close" ng-style="$ctrl.noShadow && {\'background\': \'none\'}"></div><div class="ums-datepicker__popup" ng-class="{\'is-hidden\': $ctrl.state.ui.isHidden, \'is-align-left\': $ctrl.alignLeft }"><div class="ums-datepicker__popup__select-range" ng-class="{\'is-align-left\': $ctrl.alignLeft }"><div class="ums-legenda__container"><ul class="ums-legenda__list"><li class="ums-legenda__item"><div class="ums-legenda__bullet umsBackground-graph01"></div><div class="umsLabel">Date range</div></li><li class="ums-legenda__item"><div class="ums-legenda__bullet umsBackground-graph02"></div><div class="umsLabel">Compared range</div></li><li class="ums-legenda__item"><div class="ums-legenda__bullet umsBackground-graph03"></div><div class="umsLabel">Overlapped range</div></li></ul></div></div><div class="ums-datepicker__popup__select-compare"><div class="ums-form__row"><label for="select-easy-range" class="ums-form__label">Date range:</label><div class="ums-form__input-iconwrap"><select id="select-easy-range" class="ums-form__select ums-form__select--dark ums-datepicker__easy-range" ng-model="$ctrl.state.config.primary.mode" ng-change="$ctrl.sync()" no-dirty-check><option value="today" ng-show="$ctrl.state.showToday">Today</option><option value="yesterday">Yesterday</option><option value="last-7-days">Last 7 days</option><option value="last-30-days">Last 30 days</option><option value="this-month">This month</option><option value="last-month">Last month</option><option value="this-year">This year</option><option value="last-year">Last year</option><option value="custom">Custom</option></select><span class="ums-form__input-icon ums-form__input-icon--dark"><ums-icon id="icon-date-search" modifier="sm"></ums-icon></span></div></div><div class="ums-form__row"><div class="ums-form__input-iconwrap"><umb-flatpickr options="$ctrl.options" on-setup="$ctrl.onSetupPrimary(fpItem)" on-change="$ctrl.flatPickrOnChange($ctrl.state.range.primary, $ctrl.state.config.primary, selectedDates)" class="ums-datepicker__holder" ng-class="{\'is-disabled\': $ctrl.state.config.primary.mode !== \'custom\'}"></umb-flatpickr><span class="ums-form__input-icon ums-form__input-icon--dark"><ums-icon id="icon-date-select" modifier="sm"></ums-icon></span></div></div><span ng-if="$ctrl.showCompare"><br></span><div ng-if="$ctrl.showCompare"><div class="ums-form__row"><div class="ums-form__toggle ums-form__toggle--datepicker"><label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label">&nbsp;</label> <input type="checkbox" name="toggle-2" id="toggle-2-1" class="ums-form__toggle__input" no-dirty-check ng-model="$ctrl.state.config.compare"> <label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label" ng-class="{\'ums-form__toggle__label--archived\': $ctrl.state.project.archived}"><span ng-show="!$ctrl.state.project.archived">Compare</span> <span ng-show="$ctrl.state.project.archived">Not compare</span></label></div></div><div ng-show="$ctrl.state.config.compare"><div class="ums-form__row"><div class="ums-form__input-iconwrap"><select class="ums-form__select ums-form__select--dark" ng-model="$ctrl.state.config.secondary.mode" ng-change="$ctrl.sync()" no-dirty-check><option value="previous-period">Previous period</option><option value="previous-year">Previous year</option><option value="custom">Custom</option></select><span class="ums-form__input-icon ums-form__input-icon--dark"><ums-icon id="icon-date-search" modifier="sm"></ums-icon></span></div></div><div class="ums-form__row"><div class="ums-form__input-iconwrap"><umb-flatpickr options="$ctrl.options" on-setup="$ctrl.onSetupSecondary(fpItem)" on-change="$ctrl.flatPickrOnChange($ctrl.state.range.secondary, $ctrl.state.config.secondary, selectedDates)" ng-class="{\'is-disabled\': $ctrl.state.config.secondary.mode !== \'custom\'}"></umb-flatpickr><span class="ums-form__input-icon ums-form__input-icon--dark"><ums-icon id="icon-date-compare" modifier="sm"></ums-icon></span></div></div></div></div><br><button class="ums-button ums-button--main ums-button--sm ums-datepicker__popup__button" type="button" ng-click="$ctrl.apply()">Apply</button> <button class="ums-button ums-button--line-w ums-button--sm ums-datepicker__popup__button" type="button" ng-click="$ctrl.cancel()">Cancel</button></div></div></div>',bindings:{onChange:"&",showCompare:"<?",service:"<?",noShadow:"<?",alignLeft:"<?"},controller:function umsDaterangepickerController(umsDaterangepickerService,UMS_DATERANGEPICKER_MODES,$element,umsConfigurationService){var dateRangePickerService,ctrl=this,state={config:null,range:null,ui:{isHidden:!0},pickers:{primary:null,secondary:null},dateFormat:null,showToday:!0},constants={mode:UMS_DATERANGEPICKER_MODES},currentDate=new Date;function setConfig(config){state.config=angular.copy(config)}function setRange(range){state.range=angular.copy(range)}function setPrimaryDate(){null!=state.pickers.primary&&state.pickers.primary.setDate([state.range.primary.from,state.range.primary.to],!1)}function setSecondaryDate(){null!=state.pickers.secondary&&state.pickers.secondary.setDate([state.range.secondary.from,state.range.secondary.to],!1)}function sync(){dateRangePickerService.computeRange(state.config.primary,state.range.primary),dateRangePickerService.computeRange(state.config.secondary,state.range.secondary,state.config.primary,state.range.primary),function setDates(){setPrimaryDate(),setSecondaryDate()}()}currentDate.setHours(23,59,99,0),this.$onInit=function(){dateRangePickerService=this.service||umsDaterangepickerService,state.config=dateRangePickerService.getConfig(),state.range=dateRangePickerService.getRange(),state.dateFormat=dateRangePickerService.dateFormat,this.$onDestroy=dateRangePickerService.onChange(function(config,range){setConfig(config),setRange(range),"function"==typeof ctrl.onChange&&ctrl.onChange({from:state.range.primary.from,to:state.range.primary.to,fromCompare:state.range.secondary.from,toCompare:state.range.secondary.to})}),umsConfigurationService.getConfiguration().then(function(config){null!=config&&null!=config.reporting&&!0===config.reporting.dataGenerationEnabled&&(state.showToday=!1)}),sync()},this.flatPickrOnChange=function(range,config,selectedDates){null!=selectedDates&&2===selectedDates.length&&(range.from=moment(selectedDates[0]).startOf("day").utc().format(state.dateFormat),range.to=moment(selectedDates[1]).endOf("day").utc().format(state.dateFormat),config.mode=UMS_DATERANGEPICKER_MODES.CUSTOM,ctrl.sync())},this.onSetupPrimary=function(fpItem){state.pickers.primary=fpItem,setPrimaryDate()},this.onSetupSecondary=function(fpItem){state.pickers.secondary=fpItem,setSecondaryDate()},this.options={mode:"range",dateFormat:"M d, Y",allowInput:!0,showMonths:3,appendTo:$element.find(".ums-datepicker__popup__select-range")[0],disable:[function(date){return(date=new Date(date).setHours(23,59,99,0))>currentDate}]},this.apply=function(){dateRangePickerService.broadcast(state.config,state.range),this.hide()},this.cancel=function(){setConfig(dateRangePickerService.getConfig()),setRange(dateRangePickerService.getRange()),sync(),this.hide()},this.show=function(){state.ui.isHidden=!1},this.hide=function(){state.ui.isHidden=!0},this.toggle=function(){state.ui.isHidden=!state.ui.isHidden},this.sync=sync;var fn={displayPrimaryRange:function(){return this.displayRange(state.range.primary)},displaySecondaryRange:function(){return this.displayRange(state.range.secondary)},displayRange:function(range){var from=range.from,to=range.to;if(null==from||null==to)return"";var fromDate=moment(from),toDate=moment(to);function format(date){return date.local().format("MMM DD, YYYY")}return fromDate.isSame(toDate)?format(fromDate):format(fromDate)+" to "+format(toDate)}};ctrl.state=state,ctrl.fn=fn,ctrl.constants=constants}}),angular.module("engage").factory("umsDaterangepickerService",["umsLocalStorageService","UmsDateRangePicker",function(localStorageService,UmsDateRangePicker){var storageKey="ums-daterangepicker";return new UmsDateRangePicker(function load(){return localStorageService.get(storageKey)},function save(data){localStorageService.save(storageKey,data)})}]),function(){angular.module("engage").config(["$provide",function($provide){$provide.decorator("navigationService",["$delegate",function($delegate){var retainQueryStrings=$delegate.retainQueryStrings;$delegate.retainQueryStrings=function(currRouteParams,nextRouteParams){return"engage"===nextRouteParams.section?null:retainQueryStrings.call(this,currRouteParams,nextRouteParams)};var isRouteChangingNavigation=$delegate.isRouteChangingNavigation;return $delegate.isRouteChangingNavigation=function(currUrlParams,nextUrlParams){return(!isUms(currUrlParams)||!isUms(nextUrlParams))&&isRouteChangingNavigation.call(this,currUrlParams,nextUrlParams);function isUms(params){return angular.isString(params)?params.indexOf("/engage")>-1:null!=params&&"engage"===params.section}},$delegate}]),$provide.decorator("contentResource",["$delegate",function($delegate){var original=$delegate.getById;return $delegate.getById=function(id){return original.call(this,id).then(function(content){null!=content&&Array.isArray(content.apps)&&content.apps.length>0&&(null==_.find(content.apps,{active:!0})&&(content.apps[0].active=!0));return content})},$delegate}])}]),function editDirectiveTemplate(directiveName,editFn){angular.module("umbraco").decorator(function camelCase(input){return input.replace(/-([a-z])/g,function(m){return m[1].toUpperCase()})}(directiveName)+"Directive",function($delegate){if(0===$delegate.length)return $delegate;var umbProperty=$delegate[0];return null!=umbProperty.template&&(umbProperty.template=editFn(umbProperty.template)),$delegate})}("umb-editor-content-header",function(template){return template.replace('ng-bind="subVariant.segment"','ng-bind="subVariant.displayName"')})}(),angular.module("engage").component("umsEmailSms",{template:'<div class="ums-topbar__container"><div class="ums-content ums-topbar__content"><div class="ums-topbar__icon"><ums-icon id="icon-email-sms" modifier="lg"></ums-icon></div><div class="ums-topbar__title">E-mail &amp; SMS</div><ums-package-status></ums-package-status></div></div>',controller:function(){this.$onInit=function(){}}}),angular.module("engage").filter("umsDate",function($filter){return function(input,shortDate,skipTime){input=new Date(input);var umsDateDate=$filter("date")(input,shortDate?"mediumDate":"longDate");return skipTime?umsDateDate:umsDateDate+" "+$filter("date")(input,"shortTime")}}),angular.module("engage").filter("umsDotSeparator",function($filter){return function(input){return input?input.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):input}}),angular.module("engage").filter("percentage",[function(){return function(input,decimals){return null==input||isNaN(input)?"":(100*input).toFixed(decimals).replace(/(\d+)\.0+$/g,"$1").replace(/(\d+\.[1-9]+)0+$/g,"$1")+"%"}}]),angular.module("engage").service("umsGoalsService",["umsDownloader",function(UmsDownloader){var api=new UmsDownloader("/umbraco/backoffice/engage/goals/");this.getAll=function(){return api.get("getAll")},this.getMainGoals=function(){return api.get("getMainGoals")}}]),angular.module("engage").component("umsGroupByControls",{template:'<div class="ums-group-by-controls"><button type="button" class="control" ng-class="{selected:$ctrl.state.groupBy === \'day\'}" ng-click="$ctrl.update(\'day\')">Day</button> <button type="button" class="control" ng-class="{selected:$ctrl.state.groupBy === \'week\'}" ng-click="$ctrl.update(\'week\')">Week</button> <button type="button" class="control" ng-class="{selected:$ctrl.state.groupBy === \'month\'}" ng-click="$ctrl.update(\'month\')">Month</button></div>',bindings:{onChange:"&?"},controller:["umsEventEmitter","umsLocalStorageService",groupByControlsController]}),angular.module("engage").component("umsIcon",{template:'<svg class="ums-icon" ng-class="{\'ums-icon--{{$ctrl.modifier}}\': $ctrl.modifier, \'{{$ctrl.cssClass}}\': $ctrl.cssClass}"><use href="/App_Plugins/Umbraco.Engage/assets/icons.svg#{{$ctrl.id}}"></use></svg>',bindings:{id:"@",modifier:"@",cssClass:"@"}}),function(){!function addRequestInterceptor(requestFn){angular.module("umbraco").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(function(){return{request:requestFn}})}])}(function(config){return/^views\/engage\//gi.test(config.url)&&(config.url="views/common/dashboard.html"),config})}(),angular.module("engage").component("umsIpFilterEditor",{template:'<ums-overlay close="$ctrl.close()" small="true"><ums-overlay-header><h3 ng-if="$ctrl.state.ipFilter.id === 0">Create IP Filter</h3><h3 ng-if="$ctrl.state.ipFilter.id !== 0">Edit IP Filter "{{$ctrl.state.ipFilter.name}}"</h3></ums-overlay-header><ums-overlay-body><form id="ip-filter-editor-form" name="$ctrl.form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row"><label class="ums-form__label" for="ipfilter-name">Name *</label> <input class="ums-form__input" id="ipfilter-name" type="text" required no-dirty-check ng-model="$ctrl.state.ipFilter.name"></div><div class="ums-form__row"><label class="ums-form__label" for="ipfilter-description">Description *</label> <textarea class="ums-form__input" id="ipfilter-description" no-dirty-check ng-model="$ctrl.state.ipFilter.description"></textarea></div><div class="ums-form__row"><div class="ums-form__label">Filter Type *</div><div class="ums-form__switch"><input type="radio" name="filterType" id="ipfilter-filtertype-0" no-dirty-check ng-model="$ctrl.state.ipFilter.filterType" ng-value="0" class="ums-form__switch__input" required> <label for="ipfilter-filtertype-0" class="ums-form__switch__label">List of IPs</label> <input type="radio" name="filterType" id="ipfilter-filtertype-1" no-dirty-check ng-model="$ctrl.state.ipFilter.filterType" ng-value="1" class="ums-form__switch__input" required> <label for="ipfilter-filtertype-1" class="ums-form__switch__label">Regular Expression</label></div></div><div ng-if="$ctrl.state.ipFilter.filterType === 0" class="ums-form__row"><div class="ums-form__label">List of IPs *</div><div ng-repeat="ipAddress in $ctrl.state.ipFilter.ipAddresses track by $index" class="ums-form__row" style="margin-top: 3px; width: 100%; max-width: 350px"><input class="ums-form__input ums-form__input--flex" type="text" no-dirty-check ng-model="$ctrl.state.ipFilter.ipAddresses[$index]" name="ipAddress_{{$index}}" required placeholder="192.168.0.1" ums-valid-ip-address> <button type="button" class="btn ums-button ums-button--light ums-button--square-icon" ng-click="$ctrl.fn.removeIpAddress($index)"><ums-icon id="icon-delete" modifier="xs"></ums-icon></button><div class="ums-errorText" style="width: 100%;" ng-show="($ctrl.form.$submitted || $ctrl.form[\'ipAddress_\' + $index].$dirty) && $ctrl.form[\'ipAddress_\' + $index].$error.umsValidIpAddress">Invalid IP address</div></div><button type="button" style="width: 310px; max-width: 100%;" class="umb-node-preview-add" ng-click="$ctrl.fn.addIpAddress()"><span>Add IP address</span></button> <input type="hidden" name="ipAddresses" no-dirty-check ng-model="$ctrl.state.ipFilter.ipAddresses" ums-required-array><div class="ums-error" ng-show="$ctrl.form.$submitted && $ctrl.form.ipAddresses.$invalid">At least one 1 IP address should be entered</div></div><div ng-if="$ctrl.state.ipFilter.filterType === 1"><br><label class="ums-form__label">Regular Expression</label> <input class="ums-form__input" type="text" required no-dirty-check ng-model="$ctrl.state.ipFilter.regularExpression"></div></form></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button type="button" class="ums-button ums-button--light" ng-click="$ctrl.close()">Close</button> <button type="submit" form="ip-filter-editor-form" class="ums-button ums-button--success ums-button--icon" ng-click="$ctrl.state.formWasSaved = true"><span>Save</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></ums-overlay-footer></ums-overlay>',bindings:{ipFilter:"=",close:"&",onSave:"&?"},controller:["umsIpFiltersService","umsUtilService",umsIpFilterEditorController]}),angular.module("engage").component("umsIpFilters",{template:'<div class="ums-content"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container"><h2>Setup your IP filters</h2><div class="umsDescription"><p>In some cases you want to exclude the traffic from specific IP addresses. A good example is that you normally exclude your own IP address, so it doesn\'t have an impact on the digital Analytics reporting. Here you can specify a specific IP adresses or a regular expression.</p></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3 is-animated"><table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="3"><strong class="umsFzLg">All excluded IP addresses</strong></td><td class="ums-table__td" style="text-align: right;"><button class="ums-button ums-button--success" type="button" ng-click="$ctrl.fn.add()">Create new IP filter</button></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Name</div></th><th class="ums-table__th"><div class="umsLabel">Description</div></th><th class="ums-table__th"><div class="umsLabel">IP addresses</div></th><th class="ums-table__th" width="220px">&nbsp;</th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="4">Loading ...</td></tr><tr class="ums-table__tr" ng-if="!$ctrl.state.loading && ($ctrl.state.ipFilters == null || $ctrl.state.ipFilters.length === 0)"><td class="ums-table__td" colspan="4">No IP addresses have been excluded yet.</td></tr><tr class="ums-table__tr" ng-if="!$ctrl.state.loading && $ctrl.state.ipFilters.length > 0" ng-repeat="ipFilter in $ctrl.state.ipFilters track by ipFilter.id"><td class="ums-table__td" ng-bind="ipFilter.name"></td><td class="ums-table__td" ng-bind="ipFilter.description"></td><td class="ums-table__td" ng-if="ipFilter.filterType === 0"><div ng-repeat="ipAddress in ipFilter.ipAddresses"><code ng-bind="ipAddress"></code></div></td><td class="ums-table__td" ng-if="ipFilter.filterType === 1"><code ng-bind="ipFilter.regularExpression"></code></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(ipFilter)" on-delete-click="$ctrl.fn.remove(ipFilter)"></ums-ui-table-action-buttons></td></tr></tbody></table></div></div></div><ums-ip-filter-editor ng-if="$ctrl.state.edit.ipFilter" ip-filter="$ctrl.state.edit.ipFilter" close="$ctrl.state.edit.ipFilter = null" on-save="$ctrl.fn.refresh()"></ums-ip-filter-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay>',controller:["umsIpFiltersService","notificationsService",umsIpFiltersController]}),angular.module("engage").service("umsIpFiltersService",["umsDownloader","$q","$timeout",umsIpFiltersService]),"undefined"!=typeof navigator&&(root=window||{},factory=function(window){"use strict";var svgNS="http://www.w3.org/2000/svg",locationHref="",initialDefaultFrame=-999999,subframeEnabled=!0,expressionsPlugin,isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),cachedColors={},bm_rounder=Math.round,bm_rnd,bm_pow=Math.pow,bm_sqrt=Math.sqrt,bm_abs=Math.abs,bm_floor=Math.floor,bm_max=Math.max,bm_min=Math.min,blitter=10,BMMath={};function ProjectInterface(){return{}}!function(){var t,e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],r=e.length;for(t=0;t<r;t+=1)BMMath[e[t]]=Math[e[t]]}(),BMMath.random=Math.random,BMMath.abs=function(t){if("object"==typeof t&&t.length){var e,r=createSizedArray(t.length),i=t.length;for(e=0;e<i;e+=1)r[e]=Math.abs(t[e]);return r}return Math.abs(t)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function roundValues(t){bm_rnd=t?Math.round:function(t){return t}}function styleDiv(t){t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.display="block",t.style.transformOrigin=t.style.webkitTransformOrigin="0 0",t.style.backfaceVisibility=t.style.webkitBackfaceVisibility="visible",t.style.transformStyle=t.style.webkitTransformStyle=t.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(t,e,r,i){this.type=t,this.currentTime=e,this.totalTime=r,this.direction=i<0?-1:1}function BMCompleteEvent(t,e){this.type=t,this.direction=e<0?-1:1}function BMCompleteLoopEvent(t,e,r,i){this.type=t,this.currentLoop=r,this.totalLoops=e,this.direction=i<0?-1:1}function BMSegmentStartEvent(t,e,r){this.type=t,this.firstFrame=e,this.totalFrames=r}function BMDestroyEvent(t,e){this.type=t,this.target=e}function BMRenderFrameErrorEvent(t,e){this.type="renderFrameError",this.nativeError=t,this.currentTime=e}function BMConfigErrorEvent(t){this.type="configError",this.nativeError=t}function BMAnimationConfigErrorEvent(t,e){this.type=t,this.nativeError=e,this.currentTime=currentTime}roundValues(!1);var createElementID=(G=0,function(){return"__lottie_element_"+ ++G}),G;function HSVtoRGB(t,e,r){var i,s,a,n,o,h,p,l;switch(h=r*(1-e),p=r*(1-(o=6*t-(n=Math.floor(6*t)))*e),l=r*(1-(1-o)*e),n%6){case 0:i=r,s=l,a=h;break;case 1:i=p,s=r,a=h;break;case 2:i=h,s=r,a=l;break;case 3:i=h,s=p,a=r;break;case 4:i=l,s=h,a=r;break;case 5:i=r,s=h,a=p}return[i,s,a]}function RGBtoHSV(t,e,r){var i,s=Math.max(t,e,r),a=Math.min(t,e,r),n=s-a,o=0===s?0:n/s,h=s/255;switch(s){case a:i=0;break;case t:i=e-r+n*(e<r?6:0),i/=6*n;break;case e:i=r-t+2*n,i/=6*n;break;case r:i=t-e+4*n,i/=6*n}return[i,o,h]}function addSaturationToRGB(t,e){var r=RGBtoHSV(255*t[0],255*t[1],255*t[2]);return r[1]+=e,1<r[1]?r[1]=1:r[1]<=0&&(r[1]=0),HSVtoRGB(r[0],r[1],r[2])}function addBrightnessToRGB(t,e){var r=RGBtoHSV(255*t[0],255*t[1],255*t[2]);return r[2]+=e,1<r[2]?r[2]=1:r[2]<0&&(r[2]=0),HSVtoRGB(r[0],r[1],r[2])}function addHueToRGB(t,e){var r=RGBtoHSV(255*t[0],255*t[1],255*t[2]);return r[0]+=e/360,1<r[0]?r[0]-=1:r[0]<0&&(r[0]+=1),HSVtoRGB(r[0],r[1],r[2])}var rgbToHex=function(){var t,e,i=[];for(t=0;t<256;t+=1)e=t.toString(16),i[t]=1==e.length?"0"+e:e;return function(t,e,r){return t<0&&(t=0),e<0&&(e=0),r<0&&(r=0),"#"+i[t]+i[e]+i[r]}}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(t,e){if(this._cbs[t])for(var r=this._cbs[t].length,i=0;i<r;i++)this._cbs[t][i](e)},addEventListener:function(t,e){return this._cbs[t]||(this._cbs[t]=[]),this._cbs[t].push(e),function(){this.removeEventListener(t,e)}.bind(this)},removeEventListener:function(t,e){if(e){if(this._cbs[t]){for(var r=0,i=this._cbs[t].length;r<i;)this._cbs[t][r]===e&&(this._cbs[t].splice(r,1),r-=1,i-=1),r+=1;this._cbs[t].length||(this._cbs[t]=null)}}else this._cbs[t]=null}};var createTypedArray="function"==typeof Uint8ClampedArray&&"function"==typeof Float32Array?function(t,e){return"float32"===t?new Float32Array(e):"int16"===t?new Int16Array(e):"uint8c"===t?new Uint8ClampedArray(e):void 0}:function(t,e){var r,i=0,s=[];switch(t){case"int16":case"uint8c":r=1;break;default:r=1.1}for(i=0;i<e;i+=1)s.push(r);return s};function createSizedArray(t){return Array.apply(null,{length:t})}function createNS(t){return document.createElementNS(svgNS,t)}function createTag(t){return document.createElement(t)}function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(t){-1===this.dynamicProperties.indexOf(t)&&(this.dynamicProperties.push(t),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var t,e=this.dynamicProperties.length;for(t=0;t<e;t+=1)this.dynamicProperties[t].getValue(),this.dynamicProperties[t]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(t){this.container=t,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var getBlendMode=(Pa={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"},function(t){return Pa[t]||""}),Pa,Matrix=function(){var s=Math.cos,a=Math.sin,n=Math.tan,i=Math.round;function t(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function e(t){if(0===t)return this;var e=s(t),r=a(t);return this._t(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1)}function r(t){if(0===t)return this;var e=s(t),r=a(t);return this._t(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1)}function o(t){if(0===t)return this;var e=s(t),r=a(t);return this._t(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1)}function h(t){if(0===t)return this;var e=s(t),r=a(t);return this._t(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1)}function p(t,e){return this._t(1,e,t,1,0,0)}function l(t,e){return this.shear(n(t),n(e))}function f(t,e){var r=s(e),i=a(e);return this._t(r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,n(t),1,0,0,0,0,1,0,0,0,0,1)._t(r,-i,0,0,i,r,0,0,0,0,1,0,0,0,0,1)}function m(t,e,r){return r||0===r||(r=1),1===t&&1===e&&1===r?this:this._t(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)}function c(t,e,r,i,s,a,n,o,h,p,l,f,m,c,d,u){return this.props[0]=t,this.props[1]=e,this.props[2]=r,this.props[3]=i,this.props[4]=s,this.props[5]=a,this.props[6]=n,this.props[7]=o,this.props[8]=h,this.props[9]=p,this.props[10]=l,this.props[11]=f,this.props[12]=m,this.props[13]=c,this.props[14]=d,this.props[15]=u,this}function d(t,e,r){return r=r||0,0!==t||0!==e||0!==r?this._t(1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1):this}function u(t,e,r,i,s,a,n,o,h,p,l,f,m,c,d,u){var y=this.props;if(1===t&&0===e&&0===r&&0===i&&0===s&&1===a&&0===n&&0===o&&0===h&&0===p&&1===l&&0===f)return y[12]=y[12]*t+y[15]*m,y[13]=y[13]*a+y[15]*c,y[14]=y[14]*l+y[15]*d,y[15]=y[15]*u,this._identityCalculated=!1,this;var g=y[0],v=y[1],b=y[2],P=y[3],_=y[4],A=y[5],S=y[6],x=y[7],E=y[8],k=y[9],T=y[10],M=y[11],D=y[12],F=y[13],I=y[14],C=y[15];return y[0]=g*t+v*s+b*h+P*m,y[1]=g*e+v*a+b*p+P*c,y[2]=g*r+v*n+b*l+P*d,y[3]=g*i+v*o+b*f+P*u,y[4]=_*t+A*s+S*h+x*m,y[5]=_*e+A*a+S*p+x*c,y[6]=_*r+A*n+S*l+x*d,y[7]=_*i+A*o+S*f+x*u,y[8]=E*t+k*s+T*h+M*m,y[9]=E*e+k*a+T*p+M*c,y[10]=E*r+k*n+T*l+M*d,y[11]=E*i+k*o+T*f+M*u,y[12]=D*t+F*s+I*h+C*m,y[13]=D*e+F*a+I*p+C*c,y[14]=D*r+F*n+I*l+C*d,y[15]=D*i+F*o+I*f+C*u,this._identityCalculated=!1,this}function y(){return this._identityCalculated||(this._identity=!(1!==this.props[0]||0!==this.props[1]||0!==this.props[2]||0!==this.props[3]||0!==this.props[4]||1!==this.props[5]||0!==this.props[6]||0!==this.props[7]||0!==this.props[8]||0!==this.props[9]||1!==this.props[10]||0!==this.props[11]||0!==this.props[12]||0!==this.props[13]||0!==this.props[14]||1!==this.props[15]),this._identityCalculated=!0),this._identity}function g(t){for(var e=0;e<16;){if(t.props[e]!==this.props[e])return!1;e+=1}return!0}function v(t){var e;for(e=0;e<16;e+=1)t.props[e]=this.props[e]}function b(t){var e;for(e=0;e<16;e+=1)this.props[e]=t[e]}function P(t,e,r){return{x:t*this.props[0]+e*this.props[4]+r*this.props[8]+this.props[12],y:t*this.props[1]+e*this.props[5]+r*this.props[9]+this.props[13],z:t*this.props[2]+e*this.props[6]+r*this.props[10]+this.props[14]}}function _(t,e,r){return t*this.props[0]+e*this.props[4]+r*this.props[8]+this.props[12]}function A(t,e,r){return t*this.props[1]+e*this.props[5]+r*this.props[9]+this.props[13]}function S(t,e,r){return t*this.props[2]+e*this.props[6]+r*this.props[10]+this.props[14]}function x(){var t=this.props[0]*this.props[5]-this.props[1]*this.props[4],e=this.props[5]/t,r=-this.props[1]/t,i=-this.props[4]/t,s=this.props[0]/t,a=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/t,n=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/t,o=new Matrix;return o.props[0]=e,o.props[1]=r,o.props[4]=i,o.props[5]=s,o.props[12]=a,o.props[13]=n,o}function E(t){return this.getInverseMatrix().applyToPointArray(t[0],t[1],t[2]||0)}function k(t){var e,r=t.length,i=[];for(e=0;e<r;e+=1)i[e]=E(t[e]);return i}function T(t,e,r){var i=createTypedArray("float32",6);if(this.isIdentity())i[0]=t[0],i[1]=t[1],i[2]=e[0],i[3]=e[1],i[4]=r[0],i[5]=r[1];else{var s=this.props[0],a=this.props[1],n=this.props[4],o=this.props[5],h=this.props[12],p=this.props[13];i[0]=t[0]*s+t[1]*n+h,i[1]=t[0]*a+t[1]*o+p,i[2]=e[0]*s+e[1]*n+h,i[3]=e[0]*a+e[1]*o+p,i[4]=r[0]*s+r[1]*n+h,i[5]=r[0]*a+r[1]*o+p}return i}function M(t,e,r){return this.isIdentity()?[t,e,r]:[t*this.props[0]+e*this.props[4]+r*this.props[8]+this.props[12],t*this.props[1]+e*this.props[5]+r*this.props[9]+this.props[13],t*this.props[2]+e*this.props[6]+r*this.props[10]+this.props[14]]}function D(t,e){if(this.isIdentity())return t+","+e;var r=this.props;return Math.round(100*(t*r[0]+e*r[4]+r[12]))/100+","+Math.round(100*(t*r[1]+e*r[5]+r[13]))/100}function F(){for(var t=0,e=this.props,r="matrix3d(";t<16;)r+=i(1e4*e[t])/1e4,r+=15===t?")":",",t+=1;return r}function I(t){return t<1e-6&&0<t||-1e-6<t&&t<0?i(1e4*t)/1e4:t}function C(){var t=this.props;return"matrix("+I(t[0])+","+I(t[1])+","+I(t[4])+","+I(t[5])+","+I(t[12])+","+I(t[13])+")"}return function(){this.reset=t,this.rotate=e,this.rotateX=r,this.rotateY=o,this.rotateZ=h,this.skew=l,this.skewFromAxis=f,this.shear=p,this.scale=m,this.setTransform=c,this.translate=d,this.transform=u,this.applyToPoint=P,this.applyToX=_,this.applyToY=A,this.applyToZ=S,this.applyToPointArray=M,this.applyToTriplePoints=T,this.applyToPointStringified=D,this.toCSS=F,this.to2dCSS=C,this.clone=v,this.cloneFromProps=b,this.equals=g,this.inversePoints=k,this.inversePoint=E,this.getInverseMatrix=x,this._t=this.transform,this.isIdentity=y,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();!function(o,h){var p,l=this,f=256,c="random",d=h.pow(f,6),u=h.pow(2,52),y=2*u,g=f-1;function v(t){var e,r=t.length,n=this,i=0,s=n.i=n.j=0,a=n.S=[];for(r||(t=[r++]);i<f;)a[i]=i++;for(i=0;i<f;i++)a[i]=a[s=g&s+t[i%r]+(e=a[i])],a[s]=e;n.g=function(t){for(var e,r=0,i=n.i,s=n.j,a=n.S;t--;)e=a[i=g&i+1],r=r*f+a[g&(a[i]=a[s=g&s+e])+(a[s]=e)];return n.i=i,n.j=s,r}}function b(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function P(t,e){for(var r,i=t+"",s=0;s<i.length;)e[g&s]=g&(r^=19*e[g&s])+i.charCodeAt(s++);return _(e)}function _(t){return String.fromCharCode.apply(0,t)}h["seed"+c]=function(t,e,r){var i=[],s=P(function t(e,r){var i,s=[],a=typeof e;if(r&&"object"==a)for(i in e)try{s.push(t(e[i],r-1))}catch(t){}return s.length?s:"string"==a?e:e+"\0"}((e=!0===e?{entropy:!0}:e||{}).entropy?[t,_(o)]:null===t?function(){try{p;var t=new Uint8Array(f);return(l.crypto||l.msCrypto).getRandomValues(t),_(t)}catch(t){var e=l.navigator,r=e&&e.plugins;return[+new Date,l,r,l.screen,_(o)]}}():t,3),i),a=new v(i),n=function(){for(var t=a.g(6),e=d,r=0;t<u;)t=(t+r)*f,e*=f,r=a.g(1);for(;y<=t;)t/=2,e/=2,r>>>=1;return(t+r)/e};return n.int32=function(){return 0|a.g(4)},n.quick=function(){return a.g(4)/4294967296},n.double=n,P(_(a.S),o),(e.pass||r||function(t,e,r,i){return i&&(i.S&&b(i,a),t.state=function(){return b(a,{})}),r?(h[c]=t,e):t})(n,s,"global"in e?e.global:this==h,e.state)},P(h.random(),o)}([],BMMath);var BezierFactory=function(){var t={getBezierEasing:function(t,e,r,i,s){var a=s||("bez_"+t+"_"+e+"_"+r+"_"+i).replace(/\./g,"p");if(o[a])return o[a];var n=new h([t,e,r,i]);return o[a]=n}},o={},p=11,l=1/(p-1),e="function"==typeof Float32Array;function i(t,e){return 1-3*e+3*t}function s(t,e){return 3*e-6*t}function a(t){return 3*t}function f(t,e,r){return((i(e,r)*t+s(e,r))*t+a(e))*t}function m(t,e,r){return 3*i(e,r)*t*t+2*s(e,r)*t+a(e)}function h(t){this._p=t,this._mSampleValues=e?new Float32Array(p):new Array(p),this._precomputed=!1,this.get=this.get.bind(this)}return h.prototype={get:function(t){var e=this._p[0],r=this._p[1],i=this._p[2],s=this._p[3];return this._precomputed||this._precompute(),e===r&&i===s?t:0===t?0:1===t?1:f(this._getTForX(t),r,s)},_precompute:function(){var t=this._p[0],e=this._p[1],r=this._p[2],i=this._p[3];this._precomputed=!0,t===e&&r===i||this._calcSampleValues()},_calcSampleValues:function(){for(var t=this._p[0],e=this._p[2],r=0;r<p;++r)this._mSampleValues[r]=f(r*l,t,e)},_getTForX:function(t){for(var e=this._p[0],r=this._p[2],i=this._mSampleValues,s=0,a=1,n=p-1;a!==n&&i[a]<=t;++a)s+=l;var o=s+(t-i[--a])/(i[a+1]-i[a])*l,h=m(o,e,r);return.001<=h?function(t,e,r,i){for(var s=0;s<4;++s){var a=m(e,r,i);if(0===a)return e;e-=(f(e,r,i)-t)/a}return e}(t,o,e,r):0===h?o:function(t,e,r,i,s){for(var a,n,o=0;0<(a=f(n=e+(r-e)/2,i,s)-t)?r=n:e=n,1e-7<Math.abs(a)&&++o<10;);return n}(t,s,s+l,e,r)}},t}();function extendPrototype(t,e){var r,i,s=t.length;for(r=0;r<s;r+=1)for(var a in i=t[r].prototype)i.hasOwnProperty(a)&&(e.prototype[a]=i[a])}function getDescriptor(t,e){return Object.getOwnPropertyDescriptor(t,e)}function createProxyFunction(t){function e(){}return e.prototype=t,e}function bezFunction(){function y(t,e,r,i,s,a){var n=t*i+e*s+r*a-s*i-a*t-r*e;return-.001<n&&n<.001}Math;var l=function(t,e,r,i){var s,a,n,o,h,p,l=defaultCurveSegments,f=0,m=[],c=[],d=bezier_length_pool.newElement();for(n=r.length,s=0;s<l;s+=1){for(h=s/(l-1),a=p=0;a<n;a+=1)o=bm_pow(1-h,3)*t[a]+3*bm_pow(1-h,2)*h*r[a]+3*(1-h)*bm_pow(h,2)*i[a]+bm_pow(h,3)*e[a],m[a]=o,null!==c[a]&&(p+=bm_pow(m[a]-c[a],2)),c[a]=m[a];p&&(f+=p=bm_sqrt(p)),d.percents[s]=h,d.lengths[s]=f}return d.addedLength=f,d};function g(t){this.segmentLength=0,this.points=new Array(t)}function v(t,e){this.partialLength=t,this.point=e}var b,t=(b={},function(t,e,r,i){var s=(t[0]+"_"+t[1]+"_"+e[0]+"_"+e[1]+"_"+r[0]+"_"+r[1]+"_"+i[0]+"_"+i[1]).replace(/\./g,"p");if(!b[s]){var a,n,o,h,p,l,f,m=defaultCurveSegments,c=0,d=null;2===t.length&&(t[0]!=e[0]||t[1]!=e[1])&&y(t[0],t[1],e[0],e[1],t[0]+r[0],t[1]+r[1])&&y(t[0],t[1],e[0],e[1],e[0]+i[0],e[1]+i[1])&&(m=2);var u=new g(m);for(o=r.length,a=0;a<m;a+=1){for(f=createSizedArray(o),p=a/(m-1),n=l=0;n<o;n+=1)h=bm_pow(1-p,3)*t[n]+3*bm_pow(1-p,2)*p*(t[n]+r[n])+3*(1-p)*bm_pow(p,2)*(e[n]+i[n])+bm_pow(p,3)*e[n],f[n]=h,null!==d&&(l+=bm_pow(f[n]-d[n],2));c+=l=bm_sqrt(l),u.points[a]=new v(l,f),d=f}u.segmentLength=c,b[s]=u}return b[s]});function D(t,e){var r=e.percents,i=e.lengths,s=r.length,a=bm_floor((s-1)*t),n=t*e.addedLength,o=0;if(a===s-1||0===a||n===i[a])return r[a];for(var h=i[a]>n?-1:1,p=!0;p;)if(i[a]<=n&&i[a+1]>n?(o=(n-i[a])/(i[a+1]-i[a]),p=!1):a+=h,a<0||s-1<=a){if(a===s-1)return r[a];p=!1}return r[a]+(r[a+1]-r[a])*o}var F=createTypedArray("float32",8);return{getSegmentsLength:function(t){var e,r=segments_length_pool.newElement(),i=t.c,s=t.v,a=t.o,n=t.i,o=t._length,h=r.lengths,p=0;for(e=0;e<o-1;e+=1)h[e]=l(s[e],s[e+1],a[e],n[e+1]),p+=h[e].addedLength;return i&&o&&(h[e]=l(s[e],s[0],a[e],n[0]),p+=h[e].addedLength),r.totalLength=p,r},getNewSegment:function(t,e,r,i,s,a,n){var o,h=D(s=s<0?0:1<s?1:s,n),p=D(a=1<a?1:a,n),l=t.length,f=1-h,m=1-p,c=f*f*f,d=h*f*f*3,u=h*h*f*3,y=h*h*h,g=f*f*m,v=h*f*m+f*h*m+f*f*p,b=h*h*m+f*h*p+h*f*p,P=h*h*p,_=f*m*m,A=h*m*m+f*p*m+f*m*p,S=h*p*m+f*p*p+h*m*p,x=h*p*p,E=m*m*m,k=p*m*m+m*p*m+m*m*p,T=p*p*m+m*p*p+p*m*p,M=p*p*p;for(o=0;o<l;o+=1)F[4*o]=Math.round(1e3*(c*t[o]+d*r[o]+u*i[o]+y*e[o]))/1e3,F[4*o+1]=Math.round(1e3*(g*t[o]+v*r[o]+b*i[o]+P*e[o]))/1e3,F[4*o+2]=Math.round(1e3*(_*t[o]+A*r[o]+S*i[o]+x*e[o]))/1e3,F[4*o+3]=Math.round(1e3*(E*t[o]+k*r[o]+T*i[o]+M*e[o]))/1e3;return F},getPointInSegment:function(t,e,r,i,s,a){var n=D(s,a),o=1-n;return[Math.round(1e3*(o*o*o*t[0]+(n*o*o+o*n*o+o*o*n)*r[0]+(n*n*o+o*n*n+n*o*n)*i[0]+n*n*n*e[0]))/1e3,Math.round(1e3*(o*o*o*t[1]+(n*o*o+o*n*o+o*o*n)*r[1]+(n*n*o+o*n*n+n*o*n)*i[1]+n*n*n*e[1]))/1e3]},buildBezierData:t,pointOnLine2D:y,pointOnLine3D:function(t,e,r,i,s,a,n,o,h){if(0===r&&0===a&&0===h)return y(t,e,i,s,n,o);var p,l=Math.sqrt(Math.pow(i-t,2)+Math.pow(s-e,2)+Math.pow(a-r,2)),f=Math.sqrt(Math.pow(n-t,2)+Math.pow(o-e,2)+Math.pow(h-r,2)),m=Math.sqrt(Math.pow(n-i,2)+Math.pow(o-s,2)+Math.pow(h-a,2));return-1e-4<(p=f<l?m<l?l-f-m:m-f-l:f<m?m-f-l:f-l-m)&&p<1e-4}}}!function(){for(var a=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var r=(new Date).getTime(),i=Math.max(0,16-(r-a)),s=setTimeout(function(){t(r+i)},i);return a=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var bez=bezFunction();function dataFunctionManager(){function f(t,e,r){var i,s,a,n,o,h,p=t.length;for(s=0;s<p;s+=1)if("ks"in(i=t[s])&&!i.completed){if(i.completed=!0,i.tt&&(t[s-1].td=i.tt),i.hasMask){var l=i.masksProperties;for(n=l.length,a=0;a<n;a+=1)if(l[a].pt.k.i)d(l[a].pt.k);else for(h=l[a].pt.k.length,o=0;o<h;o+=1)l[a].pt.k[o].s&&d(l[a].pt.k[o].s[0]),l[a].pt.k[o].e&&d(l[a].pt.k[o].e[0])}0===i.ty?(i.layers=m(i.refId,e),f(i.layers,e,r)):4===i.ty?c(i.shapes):5==i.ty&&u(i,r)}}function m(t,e){for(var r=0,i=e.length;r<i;){if(e[r].id===t)return e[r].layers.__used?JSON.parse(JSON.stringify(e[r].layers)):(e[r].layers.__used=!0,e[r].layers);r+=1}}function c(t){var e,r,i;for(e=t.length-1;0<=e;e-=1)if("sh"==t[e].ty)if(t[e].ks.k.i)d(t[e].ks.k);else for(i=t[e].ks.k.length,r=0;r<i;r+=1)t[e].ks.k[r].s&&d(t[e].ks.k[r].s[0]),t[e].ks.k[r].e&&d(t[e].ks.k[r].e[0]);else"gr"==t[e].ty&&c(t[e].it)}function d(t){var e,r=t.i.length;for(e=0;e<r;e+=1)t.i[e][0]+=t.v[e][0],t.i[e][1]+=t.v[e][1],t.o[e][0]+=t.v[e][0],t.o[e][1]+=t.v[e][1]}function o(t,e){var r=e?e.split("."):[100,100,100];return t[0]>r[0]||!(r[0]>t[0])&&(t[1]>r[1]||!(r[1]>t[1])&&(t[2]>r[2]||!(r[2]>t[2])&&void 0))}var h,r=function(){var i=[4,4,14];function s(t){var e,r,i,s=t.length;for(e=0;e<s;e+=1)5===t[e].ty&&(i=(r=t[e]).t.d,r.t.d={k:[{s:i,t:0}]})}return function(t){if(o(i,t.v)&&(s(t.layers),t.assets)){var e,r=t.assets.length;for(e=0;e<r;e+=1)t.assets[e].layers&&s(t.assets[e].layers)}}}(),i=(h=[4,7,99],function(t){if(t.chars&&!o(h,t.v)){var e,r,i,s,a,n=t.chars.length;for(e=0;e<n;e+=1)if(t.chars[e].data&&t.chars[e].data.shapes)for(i=(a=t.chars[e].data.shapes[0].it).length,r=0;r<i;r+=1)(s=a[r].ks.k).__converted||(d(a[r].ks.k),s.__converted=!0)}}),s=function(){var i=[4,1,9];function a(t){var e,r,i,s=t.length;for(e=0;e<s;e+=1)if("gr"===t[e].ty)a(t[e].it);else if("fl"===t[e].ty||"st"===t[e].ty)if(t[e].c.k&&t[e].c.k[0].i)for(i=t[e].c.k.length,r=0;r<i;r+=1)t[e].c.k[r].s&&(t[e].c.k[r].s[0]/=255,t[e].c.k[r].s[1]/=255,t[e].c.k[r].s[2]/=255,t[e].c.k[r].s[3]/=255),t[e].c.k[r].e&&(t[e].c.k[r].e[0]/=255,t[e].c.k[r].e[1]/=255,t[e].c.k[r].e[2]/=255,t[e].c.k[r].e[3]/=255);else t[e].c.k[0]/=255,t[e].c.k[1]/=255,t[e].c.k[2]/=255,t[e].c.k[3]/=255}function s(t){var e,r=t.length;for(e=0;e<r;e+=1)4===t[e].ty&&a(t[e].shapes)}return function(t){if(o(i,t.v)&&(s(t.layers),t.assets)){var e,r=t.assets.length;for(e=0;e<r;e+=1)t.assets[e].layers&&s(t.assets[e].layers)}}}(),a=function(){var i=[4,4,18];function p(t){var e,r,i;for(e=t.length-1;0<=e;e-=1)if("sh"==t[e].ty)if(t[e].ks.k.i)t[e].ks.k.c=t[e].closed;else for(i=t[e].ks.k.length,r=0;r<i;r+=1)t[e].ks.k[r].s&&(t[e].ks.k[r].s[0].c=t[e].closed),t[e].ks.k[r].e&&(t[e].ks.k[r].e[0].c=t[e].closed);else"gr"==t[e].ty&&p(t[e].it)}function s(t){var e,r,i,s,a,n,o=t.length;for(r=0;r<o;r+=1){if((e=t[r]).hasMask){var h=e.masksProperties;for(s=h.length,i=0;i<s;i+=1)if(h[i].pt.k.i)h[i].pt.k.c=h[i].cl;else for(n=h[i].pt.k.length,a=0;a<n;a+=1)h[i].pt.k[a].s&&(h[i].pt.k[a].s[0].c=h[i].cl),h[i].pt.k[a].e&&(h[i].pt.k[a].e[0].c=h[i].cl)}4===e.ty&&p(e.shapes)}}return function(t){if(o(i,t.v)&&(s(t.layers),t.assets)){var e,r=t.assets.length;for(e=0;e<r;e+=1)t.assets[e].layers&&s(t.assets[e].layers)}}}();function u(t,e){0!==t.t.a.length||"m"in t.t.p||(t.singleShape=!0)}var t={completeData:function(t,e){t.__complete||(s(t),r(t),i(t),a(t),f(t.layers,t.assets,e),t.__complete=!0)}};return t.checkColors=s,t.checkChars=i,t.checkShapes=a,t.completeLayers=f,t}var dataManager=dataFunctionManager(),FontManager=function(){var a={w:0,size:0,shapes:[]},t=[];function u(t,e){var r=createTag("span");r.style.fontFamily=e;var i=createTag("span");i.innerHTML="giItT1WQy@!-/#",r.style.position="absolute",r.style.left="-10000px",r.style.top="-10000px",r.style.fontSize="300px",r.style.fontVariant="normal",r.style.fontStyle="normal",r.style.fontWeight="normal",r.style.letterSpacing="0",r.appendChild(i),document.body.appendChild(r);var s=i.offsetWidth;return i.style.fontFamily=t+", "+e,{node:i,w:s,parent:r}}t=t.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var e=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this.initTime=Date.now()};return e.getCombinedCharacterCodes=function(){return t},e.prototype.addChars=function(t){if(t){this.chars||(this.chars=[]);var e,r,i,s=t.length,a=this.chars.length;for(e=0;e<s;e+=1){for(r=0,i=!1;r<a;)this.chars[r].style===t[e].style&&this.chars[r].fFamily===t[e].fFamily&&this.chars[r].ch===t[e].ch&&(i=!0),r+=1;i||(this.chars.push(t[e]),a+=1)}}},e.prototype.addFonts=function(t,e){if(t){if(this.chars)return this.isLoaded=!0,void(this.fonts=t.list);var r,i,s,a,n=t.list,o=n.length,h=o;for(r=0;r<o;r+=1){var p,l,f=!0;if(n[r].loaded=!1,n[r].monoCase=u(n[r].fFamily,"monospace"),n[r].sansCase=u(n[r].fFamily,"sans-serif"),n[r].fPath){if("p"===n[r].fOrigin||3===n[r].origin){if(0<(p=document.querySelectorAll('style[f-forigin="p"][f-family="'+n[r].fFamily+'"], style[f-origin="3"][f-family="'+n[r].fFamily+'"]')).length&&(f=!1),f){var m=createTag("style");m.setAttribute("f-forigin",n[r].fOrigin),m.setAttribute("f-origin",n[r].origin),m.setAttribute("f-family",n[r].fFamily),m.type="text/css",m.innerHTML="@font-face {font-family: "+n[r].fFamily+"; font-style: normal; src: url('"+n[r].fPath+"');}",e.appendChild(m)}}else if("g"===n[r].fOrigin||1===n[r].origin){for(p=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),l=0;l<p.length;l++)-1!==p[l].href.indexOf(n[r].fPath)&&(f=!1);if(f){var c=createTag("link");c.setAttribute("f-forigin",n[r].fOrigin),c.setAttribute("f-origin",n[r].origin),c.type="text/css",c.rel="stylesheet",c.href=n[r].fPath,document.body.appendChild(c)}}else if("t"===n[r].fOrigin||2===n[r].origin){for(p=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),l=0;l<p.length;l++)n[r].fPath===p[l].src&&(f=!1);if(f){var d=createTag("link");d.setAttribute("f-forigin",n[r].fOrigin),d.setAttribute("f-origin",n[r].origin),d.setAttribute("rel","stylesheet"),d.setAttribute("href",n[r].fPath),e.appendChild(d)}}}else n[r].loaded=!0,h-=1;n[r].helper=(i=e,s=n[r],a=void 0,(a=createNS("text")).style.fontSize="100px",a.setAttribute("font-family",s.fFamily),a.setAttribute("font-style",s.fStyle),a.setAttribute("font-weight",s.fWeight),a.textContent="1",s.fClass?(a.style.fontFamily="inherit",a.setAttribute("class",s.fClass)):a.style.fontFamily=s.fFamily,i.appendChild(a),createTag("canvas").getContext("2d").font=s.fWeight+" "+s.fStyle+" 100px "+s.fFamily,a),n[r].cache={},this.fonts.push(n[r])}0===h?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}else this.isLoaded=!0},e.prototype.getCharData=function(t,e,r){for(var i=0,s=this.chars.length;i<s;){if(this.chars[i].ch===t&&this.chars[i].style===e&&this.chars[i].fFamily===r)return this.chars[i];i+=1}return("string"==typeof t&&13!==t.charCodeAt(0)||!t)&&console&&console.warn&&console.warn("Missing character from exported characters list: ",t,e,r),a},e.prototype.getFontByName=function(t){for(var e=0,r=this.fonts.length;e<r;){if(this.fonts[e].fName===t)return this.fonts[e];e+=1}return this.fonts[0]},e.prototype.measureText=function(t,e,r){var i=this.getFontByName(e),s=t.charCodeAt(0);if(!i.cache[s+1]){var a=i.helper;if(" "===t){a.textContent="|"+t+"|";var n=a.getComputedTextLength();a.textContent="||";var o=a.getComputedTextLength();i.cache[s+1]=(n-o)/100}else a.textContent=t,i.cache[s+1]=a.getComputedTextLength()/100}return i.cache[s+1]*r},e.prototype.checkLoadedFonts=function(){var t,e,r,i=this.fonts.length,s=i;for(t=0;t<i;t+=1)this.fonts[t].loaded?s-=1:"n"===this.fonts[t].fOrigin||0===this.fonts[t].origin?this.fonts[t].loaded=!0:(e=this.fonts[t].monoCase.node,r=this.fonts[t].monoCase.w,e.offsetWidth!==r?(s-=1,this.fonts[t].loaded=!0):(e=this.fonts[t].sansCase.node,r=this.fonts[t].sansCase.w,e.offsetWidth!==r&&(s-=1,this.fonts[t].loaded=!0)),this.fonts[t].loaded&&(this.fonts[t].sansCase.parent.parentNode.removeChild(this.fonts[t].sansCase.parent),this.fonts[t].monoCase.parent.parentNode.removeChild(this.fonts[t].monoCase.parent)));0!==s&&Date.now()-this.initTime<5e3?setTimeout(this.checkLoadedFonts.bind(this),20):setTimeout(function(){this.isLoaded=!0}.bind(this),0)},e.prototype.loaded=function(){return this.isLoaded},e}(),PropertyFactory=function(){var f=initialDefaultFrame,s=Math.abs;function m(t,e){var r,i=this.offsetTime;"multidimensional"===this.propType&&(r=createTypedArray("float32",this.pv.length));for(var s,a,n,o,h,p,l,f,m=e.lastIndex,c=m,d=this.keyframes.length-1,u=!0;u;){if(s=this.keyframes[c],a=this.keyframes[c+1],c===d-1&&t>=a.t-i){s.h&&(s=a),m=0;break}if(a.t-i>t){m=c;break}c<d-1?c+=1:(m=0,u=!1)}var y,g,v,b,P,_,A,S,x,E,k=a.t-i,T=s.t-i;if(s.to){s.bezierData||(s.bezierData=bez.buildBezierData(s.s,a.s||s.e,s.to,s.ti));var M=s.bezierData;if(k<=t||t<T){var D=k<=t?M.points.length-1:0;for(o=M.points[D].point.length,n=0;n<o;n+=1)r[n]=M.points[D].point[n]}else{s.__fnct?f=s.__fnct:(f=BezierFactory.getBezierEasing(s.o.x,s.o.y,s.i.x,s.i.y,s.n).get,s.__fnct=f),h=f((t-T)/(k-T));var F,I=M.segmentLength*h,C=e.lastFrame<t&&e._lastKeyframeIndex===c?e._lastAddedLength:0;for(l=e.lastFrame<t&&e._lastKeyframeIndex===c?e._lastPoint:0,u=!0,p=M.points.length;u;){if(C+=M.points[l].partialLength,0===I||0===h||l===M.points.length-1){for(o=M.points[l].point.length,n=0;n<o;n+=1)r[n]=M.points[l].point[n];break}if(C<=I&&I<C+M.points[l+1].partialLength){for(F=(I-C)/M.points[l+1].partialLength,o=M.points[l].point.length,n=0;n<o;n+=1)r[n]=M.points[l].point[n]+(M.points[l+1].point[n]-M.points[l].point[n])*F;break}l<p-1?l+=1:u=!1}e._lastPoint=l,e._lastAddedLength=C-M.points[l].partialLength,e._lastKeyframeIndex=c}}else{var w,V,R,L,G;if(d=s.s.length,y=a.s||s.e,this.sh&&1!==s.h)if(k<=t)r[0]=y[0],r[1]=y[1],r[2]=y[2];else if(t<=T)r[0]=s.s[0],r[1]=s.s[1],r[2]=s.s[2];else{g=r,b=(v=function(t,e,r){var i,s,a,n,o,h=[],p=t[0],l=t[1],f=t[2],m=t[3],c=e[0],d=e[1],u=e[2],y=e[3];return(s=p*c+l*d+f*u+m*y)<0&&(s=-s,c=-c,d=-d,u=-u,y=-y),o=1e-6<1-s?(i=Math.acos(s),a=Math.sin(i),n=Math.sin((1-r)*i)/a,Math.sin(r*i)/a):(n=1-r,r),h[0]=n*p+o*c,h[1]=n*l+o*d,h[2]=n*f+o*u,h[3]=n*m+o*y,h}(z(s.s),z(y),(t-T)/(k-T)))[0],P=v[1],_=v[2],A=v[3],S=Math.atan2(2*P*A-2*b*_,1-2*P*P-2*_*_),x=Math.asin(2*b*P+2*_*A),E=Math.atan2(2*b*A-2*P*_,1-2*b*b-2*_*_),g[0]=S/degToRads,g[1]=x/degToRads,g[2]=E/degToRads}else for(c=0;c<d;c+=1)1!==s.h&&(h=k<=t?1:t<T?0:(s.o.x.constructor===Array?(s.__fnct||(s.__fnct=[]),s.__fnct[c]?f=s.__fnct[c]:(w=void 0===s.o.x[c]?s.o.x[0]:s.o.x[c],V=void 0===s.o.y[c]?s.o.y[0]:s.o.y[c],R=void 0===s.i.x[c]?s.i.x[0]:s.i.x[c],L=void 0===s.i.y[c]?s.i.y[0]:s.i.y[c],f=BezierFactory.getBezierEasing(w,V,R,L).get,s.__fnct[c]=f)):s.__fnct?f=s.__fnct:(w=s.o.x,V=s.o.y,R=s.i.x,L=s.i.y,f=BezierFactory.getBezierEasing(w,V,R,L).get,s.__fnct=f),f((t-T)/(k-T)))),y=a.s||s.e,G=1===s.h?s.s[c]:s.s[c]+(y[c]-s.s[c])*h,"multidimensional"===this.propType?r[c]=G:r=G}return e.lastIndex=m,r}function z(t){var e=t[0]*degToRads,r=t[1]*degToRads,i=t[2]*degToRads,s=Math.cos(e/2),a=Math.cos(r/2),n=Math.cos(i/2),o=Math.sin(e/2),h=Math.sin(r/2),p=Math.sin(i/2);return[o*h*n+s*a*p,o*a*n+s*h*p,s*h*n-o*a*p,s*a*n-o*h*p]}function c(){var t=this.comp.renderedFrame-this.offsetTime,e=this.keyframes[0].t-this.offsetTime,r=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(t===this._caching.lastFrame||this._caching.lastFrame!==f&&(this._caching.lastFrame>=r&&r<=t||this._caching.lastFrame<e&&t<e))){this._caching.lastFrame>=t&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var i=this.interpolateValue(t,this._caching);this.pv=i}return this._caching.lastFrame=t,this.pv}function d(t){var e;if("unidimensional"===this.propType)e=t*this.mult,1e-5<s(this.v-e)&&(this.v=e,this._mdf=!0);else for(var r=0,i=this.v.length;r<i;)e=t[r]*this.mult,1e-5<s(this.v[r]-e)&&(this.v[r]=e,this._mdf=!0),r+=1}function u(){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{this.lock=!0,this._mdf=this._isFirstFrame;var t,e=this.effectsSequence.length,r=this.kf?this.pv:this.data.k;for(t=0;t<e;t+=1)r=this.effectsSequence[t](r);this.setVValue(r),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function y(t){this.effectsSequence.push(t),this.container.addDynamicProperty(this)}function n(t,e,r,i){this.propType="unidimensional",this.mult=r||1,this.data=e,this.v=r?e.k*r:e.k,this.pv=e.k,this._mdf=!1,this.elem=t,this.container=i,this.comp=t.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=u,this.setVValue=d,this.addEffect=y}function o(t,e,r,i){this.propType="multidimensional",this.mult=r||1,this.data=e,this._mdf=!1,this.elem=t,this.container=i,this.comp=t.comp,this.k=!1,this.kf=!1,this.frameId=-1;var s,a=e.k.length;for(this.v=createTypedArray("float32",a),this.pv=createTypedArray("float32",a),createTypedArray("float32",a),this.vel=createTypedArray("float32",a),s=0;s<a;s+=1)this.v[s]=e.k[s]*this.mult,this.pv[s]=e.k[s];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=u,this.setVValue=d,this.addEffect=y}function h(t,e,r,i){this.propType="unidimensional",this.keyframes=e.k,this.offsetTime=t.data.st,this.frameId=-1,this._caching={lastFrame:f,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=e,this.mult=r||1,this.elem=t,this.container=i,this.comp=t.comp,this.v=f,this.pv=f,this._isFirstFrame=!0,this.getValue=u,this.setVValue=d,this.interpolateValue=m,this.effectsSequence=[c.bind(this)],this.addEffect=y}function p(t,e,r,i){this.propType="multidimensional";var s,a,n,o,h,p=e.k.length;for(s=0;s<p-1;s+=1)e.k[s].to&&e.k[s].s&&e.k[s+1]&&e.k[s+1].s&&(a=e.k[s].s,n=e.k[s+1].s,o=e.k[s].to,h=e.k[s].ti,(2===a.length&&(a[0]!==n[0]||a[1]!==n[1])&&bez.pointOnLine2D(a[0],a[1],n[0],n[1],a[0]+o[0],a[1]+o[1])&&bez.pointOnLine2D(a[0],a[1],n[0],n[1],n[0]+h[0],n[1]+h[1])||3===a.length&&(a[0]!==n[0]||a[1]!==n[1]||a[2]!==n[2])&&bez.pointOnLine3D(a[0],a[1],a[2],n[0],n[1],n[2],a[0]+o[0],a[1]+o[1],a[2]+o[2])&&bez.pointOnLine3D(a[0],a[1],a[2],n[0],n[1],n[2],n[0]+h[0],n[1]+h[1],n[2]+h[2]))&&(e.k[s].to=null,e.k[s].ti=null),a[0]===n[0]&&a[1]===n[1]&&0===o[0]&&0===o[1]&&0===h[0]&&0===h[1]&&(2===a.length||a[2]===n[2]&&0===o[2]&&0===h[2])&&(e.k[s].to=null,e.k[s].ti=null));this.effectsSequence=[c.bind(this)],this.keyframes=e.k,this.offsetTime=t.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=r||1,this.elem=t,this.container=i,this.comp=t.comp,this.getValue=u,this.setVValue=d,this.interpolateValue=m,this.frameId=-1;var l=e.k[0].s.length;for(this.v=createTypedArray("float32",l),this.pv=createTypedArray("float32",l),s=0;s<l;s+=1)this.v[s]=f,this.pv[s]=f;this._caching={lastFrame:f,lastIndex:0,value:createTypedArray("float32",l)},this.addEffect=y}return{getProp:function(t,e,r,i,s){var a;if(e.k.length)if("number"==typeof e.k[0])a=new o(t,e,i,s);else switch(r){case 0:a=new h(t,e,i,s);break;case 1:a=new p(t,e,i,s)}else a=new n(t,e,i,s);return a.effectsSequence.length&&s.addDynamicProperty(a),a}}}(),TransformPropertyFactory=function(){var n=[0,0];function i(t,e,r){if(this.elem=t,this.frameId=-1,this.propType="transform",this.data=e,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(r||t),e.p&&e.p.s?(this.px=PropertyFactory.getProp(t,e.p.x,0,0,this),this.py=PropertyFactory.getProp(t,e.p.y,0,0,this),e.p.z&&(this.pz=PropertyFactory.getProp(t,e.p.z,0,0,this))):this.p=PropertyFactory.getProp(t,e.p||{k:[0,0,0]},1,0,this),e.rx){if(this.rx=PropertyFactory.getProp(t,e.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(t,e.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(t,e.rz,0,degToRads,this),e.or.k[0].ti){var i,s=e.or.k.length;for(i=0;i<s;i+=1)e.or.k[i].to=e.or.k[i].ti=null}this.or=PropertyFactory.getProp(t,e.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(t,e.r||{k:0},0,degToRads,this);e.sk&&(this.sk=PropertyFactory.getProp(t,e.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(t,e.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(t,e.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(t,e.s||{k:[100,100,100]},1,.01,this),e.o?this.o=PropertyFactory.getProp(t,e.o,0,.01,t):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}return i.prototype={applyToMatrix:function(t){var e=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||e,this.a&&t.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&t.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&t.skewFromAxis(-this.sk.v,this.sa.v),this.r?t.rotate(-this.r.v):t.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?t.translate(this.px.v,this.py.v,-this.pz.v):t.translate(this.px.v,this.py.v,0):t.translate(this.p.v[0],this.p.v[1],-this.p.v[2])},getValue:function(t){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||t){if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var e,r,i=this.elem.globalData.frameRate;if(this.p&&this.p.keyframes&&this.p.getValueAtTime)r=this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(e=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/i,0),this.p.getValueAtTime(this.p.keyframes[0].t/i,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(e=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/i,0),this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/i,0)):(e=this.p.pv,this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/i,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){e=[],r=[];var s=this.px,a=this.py;s._caching.lastFrame+s.offsetTime<=s.keyframes[0].t?(e[0]=s.getValueAtTime((s.keyframes[0].t+.01)/i,0),e[1]=a.getValueAtTime((a.keyframes[0].t+.01)/i,0),r[0]=s.getValueAtTime(s.keyframes[0].t/i,0),r[1]=a.getValueAtTime(a.keyframes[0].t/i,0)):s._caching.lastFrame+s.offsetTime>=s.keyframes[s.keyframes.length-1].t?(e[0]=s.getValueAtTime(s.keyframes[s.keyframes.length-1].t/i,0),e[1]=a.getValueAtTime(a.keyframes[a.keyframes.length-1].t/i,0),r[0]=s.getValueAtTime((s.keyframes[s.keyframes.length-1].t-.01)/i,0),r[1]=a.getValueAtTime((a.keyframes[a.keyframes.length-1].t-.01)/i,0)):(e=[s.pv,a.pv],r[0]=s.getValueAtTime((s._caching.lastFrame+s.offsetTime-.01)/i,s.offsetTime),r[1]=a.getValueAtTime((a._caching.lastFrame+a.offsetTime-.01)/i,a.offsetTime))}else e=r=n;this.v.rotate(-Math.atan2(e[1]-r[1],e[0]-r[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}},precalculateMatrix:function(){if(!this.a.k&&(this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1,!this.s.effectsSequence.length)){if(this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2,this.sk){if(this.sk.effectsSequence.length||this.sa.effectsSequence.length)return;this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3}if(this.r){if(this.r.effectsSequence.length)return;this.pre.rotate(-this.r.v),this.appliedTransformations=4}else this.rz.effectsSequence.length||this.ry.effectsSequence.length||this.rx.effectsSequence.length||this.or.effectsSequence.length||(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}},autoOrient:function(){}},extendPrototype([DynamicPropertyContainer],i),i.prototype.addDynamicProperty=function(t){this._addDynamicProperty(t),this.elem.addDynamicProperty(t),this._isDirty=!0},i.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty,{getTransformProperty:function(t,e,r){return new i(t,e,r)}}}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(t,e){this.c=t,this.setLength(e);for(var r=0;r<e;)this.v[r]=point_pool.newElement(),this.o[r]=point_pool.newElement(),this.i[r]=point_pool.newElement(),r+=1},ShapePath.prototype.setLength=function(t){for(;this._maxLength<t;)this.doubleArrayLength();this._length=t},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(t,e,r,i,s){var a;switch(this._length=Math.max(this._length,i+1),this._length>=this._maxLength&&this.doubleArrayLength(),r){case"v":a=this.v;break;case"i":a=this.i;break;case"o":a=this.o}(!a[i]||a[i]&&!s)&&(a[i]=point_pool.newElement()),a[i][0]=t,a[i][1]=e},ShapePath.prototype.setTripleAt=function(t,e,r,i,s,a,n,o){this.setXYAt(t,e,"v",n,o),this.setXYAt(r,i,"o",n,o),this.setXYAt(s,a,"i",n,o)},ShapePath.prototype.reverse=function(){var t=new ShapePath;t.setPathData(this.c,this._length);var e=this.v,r=this.o,i=this.i,s=0;this.c&&(t.setTripleAt(e[0][0],e[0][1],i[0][0],i[0][1],r[0][0],r[0][1],0,!1),s=1);var a,n=this._length-1,o=this._length;for(a=s;a<o;a+=1)t.setTripleAt(e[n][0],e[n][1],i[n][0],i[n][1],r[n][0],r[n][1],a,!1),n-=1;return t};var ShapePropertyFactory=function(){var s=-999999;function t(t,e,r){var i,s,a,n,o,h,p,l,f,m=r.lastIndex,c=this.keyframes;if(t<c[0].t-this.offsetTime)i=c[0].s[0],a=!0,m=0;else if(t>=c[c.length-1].t-this.offsetTime)i=c[c.length-1].s?c[c.length-1].s[0]:c[c.length-2].e[0],a=!0;else{for(var d,u,y=m,g=c.length-1,v=!0;v&&(d=c[y],!((u=c[y+1]).t-this.offsetTime>t));)y<g-1?y+=1:v=!1;if(m=y,!(a=1===d.h)){if(t>=u.t-this.offsetTime)l=1;else if(t<d.t-this.offsetTime)l=0;else{var b;d.__fnct?b=d.__fnct:(b=BezierFactory.getBezierEasing(d.o.x,d.o.y,d.i.x,d.i.y).get,d.__fnct=b),l=b((t-(d.t-this.offsetTime))/(u.t-this.offsetTime-(d.t-this.offsetTime)))}s=u.s?u.s[0]:d.e[0]}i=d.s[0]}for(h=e._length,p=i.i[0].length,r.lastIndex=m,n=0;n<h;n+=1)for(o=0;o<p;o+=1)f=a?i.i[n][o]:i.i[n][o]+(s.i[n][o]-i.i[n][o])*l,e.i[n][o]=f,f=a?i.o[n][o]:i.o[n][o]+(s.o[n][o]-i.o[n][o])*l,e.o[n][o]=f,f=a?i.v[n][o]:i.v[n][o]+(s.v[n][o]-i.v[n][o])*l,e.v[n][o]=f}function a(){this.paths=this.localShapeCollection}function e(t){(function(t,e){if(t._length!==e._length||t.c!==e.c)return!1;var r,i=t._length;for(r=0;r<i;r+=1)if(t.v[r][0]!==e.v[r][0]||t.v[r][1]!==e.v[r][1]||t.o[r][0]!==e.o[r][0]||t.o[r][1]!==e.o[r][1]||t.i[r][0]!==e.i[r][0]||t.i[r][1]!==e.i[r][1])return!1;return!0})(this.v,t)||(this.v=shape_pool.clone(t),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function r(){if(this.elem.globalData.frameId!==this.frameId)if(this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{this.lock=!0,this._mdf=!1;var t,e=this.kf?this.pv:this.data.ks?this.data.ks.k:this.data.pt.k,r=this.effectsSequence.length;for(t=0;t<r;t+=1)e=this.effectsSequence[t](e);this.setVValue(e),this.lock=!1,this.frameId=this.elem.globalData.frameId}else this._mdf=!1}function n(t,e,r){this.propType="shape",this.comp=t.comp,this.container=t,this.elem=t,this.data=e,this.k=!1,this.kf=!1,this._mdf=!1;var i=3===r?e.pt.k:e.ks.k;this.v=shape_pool.clone(i),this.pv=shape_pool.clone(this.v),this.localShapeCollection=shapeCollection_pool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=a,this.effectsSequence=[]}function i(t){this.effectsSequence.push(t),this.container.addDynamicProperty(this)}function o(t,e,r){this.propType="shape",this.comp=t.comp,this.elem=t,this.container=t,this.offsetTime=t.data.st,this.keyframes=3===r?e.pt.k:e.ks.k,this.k=!0,this.kf=!0;var i=this.keyframes[0].s[0].i.length;this.keyframes[0].s[0].i[0].length,this.v=shape_pool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,i),this.pv=shape_pool.clone(this.v),this.localShapeCollection=shapeCollection_pool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=s,this.reset=a,this._caching={lastFrame:s,lastIndex:0},this.effectsSequence=[function(){var t=this.comp.renderedFrame-this.offsetTime,e=this.keyframes[0].t-this.offsetTime,r=this.keyframes[this.keyframes.length-1].t-this.offsetTime,i=this._caching.lastFrame;return i!==s&&(i<e&&t<e||r<i&&r<t)||(this._caching.lastIndex=i<t?this._caching.lastIndex:0,this.interpolateShape(t,this.pv,this._caching)),this._caching.lastFrame=t,this.pv}.bind(this)]}n.prototype.interpolateShape=t,n.prototype.getValue=r,n.prototype.setVValue=e,n.prototype.addEffect=i,o.prototype.getValue=r,o.prototype.interpolateShape=t,o.prototype.setVValue=e,o.prototype.addEffect=i;var h=function(){var n=roundCorner;function t(t,e){this.v=shape_pool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollection_pool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=e.d,this.elem=t,this.comp=t.comp,this.frameId=-1,this.initDynamicPropertyContainer(t),this.p=PropertyFactory.getProp(t,e.p,1,0,this),this.s=PropertyFactory.getProp(t,e.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return t.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var t=this.p.v[0],e=this.p.v[1],r=this.s.v[0]/2,i=this.s.v[1]/2,s=3!==this.d,a=this.v;a.v[0][0]=t,a.v[0][1]=e-i,a.v[1][0]=s?t+r:t-r,a.v[1][1]=e,a.v[2][0]=t,a.v[2][1]=e+i,a.v[3][0]=s?t-r:t+r,a.v[3][1]=e,a.i[0][0]=s?t-r*n:t+r*n,a.i[0][1]=e-i,a.i[1][0]=s?t+r:t-r,a.i[1][1]=e-i*n,a.i[2][0]=s?t+r*n:t-r*n,a.i[2][1]=e+i,a.i[3][0]=s?t-r:t+r,a.i[3][1]=e+i*n,a.o[0][0]=s?t+r*n:t-r*n,a.o[0][1]=e-i,a.o[1][0]=s?t+r:t-r,a.o[1][1]=e+i*n,a.o[2][0]=s?t-r*n:t+r*n,a.o[2][1]=e+i,a.o[3][0]=s?t-r:t+r,a.o[3][1]=e-i*n}},extendPrototype([DynamicPropertyContainer],t),t}(),p=function(){function t(t,e){this.v=shape_pool.newElement(),this.v.setPathData(!0,0),this.elem=t,this.comp=t.comp,this.data=e,this.frameId=-1,this.d=e.d,this.initDynamicPropertyContainer(t),1===e.sy?(this.ir=PropertyFactory.getProp(t,e.ir,0,0,this),this.is=PropertyFactory.getProp(t,e.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(t,e.pt,0,0,this),this.p=PropertyFactory.getProp(t,e.p,1,0,this),this.r=PropertyFactory.getProp(t,e.r,0,degToRads,this),this.or=PropertyFactory.getProp(t,e.or,0,0,this),this.os=PropertyFactory.getProp(t,e.os,0,.01,this),this.localShapeCollection=shapeCollection_pool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return t.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var t,e,r,i,s=2*Math.floor(this.pt.v),a=2*Math.PI/s,n=!0,o=this.or.v,h=this.ir.v,p=this.os.v,l=this.is.v,f=2*Math.PI*o/(2*s),m=2*Math.PI*h/(2*s),c=-Math.PI/2;c+=this.r.v;var d=3===this.data.d?-1:1;for(t=this.v._length=0;t<s;t+=1){r=n?p:l,i=n?f:m;var u=(e=n?o:h)*Math.cos(c),y=e*Math.sin(c),g=0===u&&0===y?0:y/Math.sqrt(u*u+y*y),v=0===u&&0===y?0:-u/Math.sqrt(u*u+y*y);u+=+this.p.v[0],y+=+this.p.v[1],this.v.setTripleAt(u,y,u-g*i*r*d,y-v*i*r*d,u+g*i*r*d,y+v*i*r*d,t,!0),n=!n,c+=a*d}},convertPolygonToPath:function(){var t,e=Math.floor(this.pt.v),r=2*Math.PI/e,i=this.or.v,s=this.os.v,a=2*Math.PI*i/(4*e),n=-Math.PI/2,o=3===this.data.d?-1:1;for(n+=this.r.v,t=this.v._length=0;t<e;t+=1){var h=i*Math.cos(n),p=i*Math.sin(n),l=0===h&&0===p?0:p/Math.sqrt(h*h+p*p),f=0===h&&0===p?0:-h/Math.sqrt(h*h+p*p);h+=+this.p.v[0],p+=+this.p.v[1],this.v.setTripleAt(h,p,h-l*a*s*o,p-f*a*s*o,h+l*a*s*o,p+f*a*s*o,t,!0),n+=r*o}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],t),t}(),l=function(){function t(t,e){this.v=shape_pool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollection_pool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=t,this.comp=t.comp,this.frameId=-1,this.d=e.d,this.initDynamicPropertyContainer(t),this.p=PropertyFactory.getProp(t,e.p,1,0,this),this.s=PropertyFactory.getProp(t,e.s,1,0,this),this.r=PropertyFactory.getProp(t,e.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return t.prototype={convertRectToPath:function(){var t=this.p.v[0],e=this.p.v[1],r=this.s.v[0]/2,i=this.s.v[1]/2,s=bm_min(r,i,this.r.v),a=s*(1-roundCorner);this.v._length=0,2===this.d||1===this.d?(this.v.setTripleAt(t+r,e-i+s,t+r,e-i+s,t+r,e-i+a,0,!0),this.v.setTripleAt(t+r,e+i-s,t+r,e+i-a,t+r,e+i-s,1,!0),0!==s?(this.v.setTripleAt(t+r-s,e+i,t+r-s,e+i,t+r-a,e+i,2,!0),this.v.setTripleAt(t-r+s,e+i,t-r+a,e+i,t-r+s,e+i,3,!0),this.v.setTripleAt(t-r,e+i-s,t-r,e+i-s,t-r,e+i-a,4,!0),this.v.setTripleAt(t-r,e-i+s,t-r,e-i+a,t-r,e-i+s,5,!0),this.v.setTripleAt(t-r+s,e-i,t-r+s,e-i,t-r+a,e-i,6,!0),this.v.setTripleAt(t+r-s,e-i,t+r-a,e-i,t+r-s,e-i,7,!0)):(this.v.setTripleAt(t-r,e+i,t-r+a,e+i,t-r,e+i,2),this.v.setTripleAt(t-r,e-i,t-r,e-i+a,t-r,e-i,3))):(this.v.setTripleAt(t+r,e-i+s,t+r,e-i+a,t+r,e-i+s,0,!0),0!==s?(this.v.setTripleAt(t+r-s,e-i,t+r-s,e-i,t+r-a,e-i,1,!0),this.v.setTripleAt(t-r+s,e-i,t-r+a,e-i,t-r+s,e-i,2,!0),this.v.setTripleAt(t-r,e-i+s,t-r,e-i+s,t-r,e-i+a,3,!0),this.v.setTripleAt(t-r,e+i-s,t-r,e+i-a,t-r,e+i-s,4,!0),this.v.setTripleAt(t-r+s,e+i,t-r+s,e+i,t-r+a,e+i,5,!0),this.v.setTripleAt(t+r-s,e+i,t+r-a,e+i,t+r-s,e+i,6,!0),this.v.setTripleAt(t+r,e+i-s,t+r,e+i-s,t+r,e+i-a,7,!0)):(this.v.setTripleAt(t-r,e-i,t-r+a,e-i,t-r,e-i,1,!0),this.v.setTripleAt(t-r,e+i,t-r,e+i-a,t-r,e+i,2,!0),this.v.setTripleAt(t+r,e+i,t+r-a,e+i,t+r,e+i,3,!0)))},getValue:function(t){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:a},extendPrototype([DynamicPropertyContainer],t),t}();return{getShapeProp:function(t,e,r){var i;return 3===r||4===r?i=(3===r?e.pt:e.ks).k.length?new o(t,e,r):new n(t,e,r):5===r?i=new l(t,e):6===r?i=new h(t,e):7===r&&(i=new p(t,e)),i.k&&t.addDynamicProperty(i),i},getConstructorFunction:function(){return n},getKeyframedConstructorFunction:function(){return o}}}(),ShapeModifiers=($r={},_r={},$r.registerModifier=function(t,e){_r[t]||(_r[t]=e)},$r.getModifier=function(t,e,r){return new _r[t](e,r)},$r),$r,_r;function ShapeModifier(){}function TrimModifier(){}function RoundCornersModifier(){}function RepeaterModifier(){}function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}function DashProperty(t,e,r,i){this.elem=t,this.frameId=-1,this.dataProps=createSizedArray(e.length),this.renderer=r,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",e.length?e.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(i);var s,a,n=e.length||0;for(s=0;s<n;s+=1)a=PropertyFactory.getProp(t,e[s].v,0,0,this),this.k=a.k||this.k,this.dataProps[s]={n:e[s].n,p:a};this.k||this.getValue(!0),this._isAnimated=this.k}function GradientProperty(t,e,r){this.data=e,this.c=createTypedArray("uint8c",4*e.p);var i=e.k.k[0].s?e.k.k[0].s.length-4*e.p:e.k.k.length-4*e.p;this.o=createTypedArray("float32",i),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=i,this.initDynamicPropertyContainer(r),this.prop=PropertyFactory.getProp(t,e.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(t){if(!this.closed){t.sh.container.addDynamicProperty(t.sh);var e={shape:t.sh,data:t,localShapeCollection:shapeCollection_pool.newShapeCollection()};this.shapes.push(e),this.addShapeToModifier(e),this._isAnimated&&t.setAsAnimated()}},ShapeModifier.prototype.init=function(t,e){this.shapes=[],this.elem=t,this.initDynamicPropertyContainer(t),this.initModifierProperties(t,e),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(t,e){this.s=PropertyFactory.getProp(t,e.s,0,.01,this),this.e=PropertyFactory.getProp(t,e.e,0,.01,this),this.o=PropertyFactory.getProp(t,e.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=e.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(t){t.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(t,e,r,i,s){var a=[];e<=1?a.push({s:t,e:e}):1<=t?a.push({s:t-1,e:e-1}):(a.push({s:t,e:1}),a.push({s:0,e:e-1}));var n,o,h=[],p=a.length;for(n=0;n<p;n+=1){var l,f;(o=a[n]).e*s<i||o.s*s>i+r||(l=o.s*s<=i?0:(o.s*s-i)/r,f=o.e*s>=i+r?1:(o.e*s-i)/r,h.push([l,f]))}return h.length||h.push([0,0]),h},TrimModifier.prototype.releasePathsData=function(t){var e,r=t.length;for(e=0;e<r;e+=1)segments_length_pool.release(t[e]);return t.length=0,t},TrimModifier.prototype.processShapes=function(t){var e,r,i;if(this._mdf||t){var s=this.o.v%360/360;if(s<0&&(s+=1),e=(1<this.s.v?1:this.s.v<0?0:this.s.v)+s,(r=(1<this.e.v?1:this.e.v<0?0:this.e.v)+s)<e){var a=e;e=r,r=a}e=1e-4*Math.round(1e4*e),r=1e-4*Math.round(1e4*r),this.sValue=e,this.eValue=r}else e=this.sValue,r=this.eValue;var n,o,h,p,l,f,m=this.shapes.length,c=0;if(r===e)for(n=0;n<m;n+=1)this.shapes[n].localShapeCollection.releaseShapes(),this.shapes[n].shape._mdf=!0,this.shapes[n].shape.paths=this.shapes[n].localShapeCollection;else if(1===r&&0===e||0===r&&1===e){if(this._mdf)for(n=0;n<m;n+=1)this.shapes[n].pathsData.length=0,this.shapes[n].shape._mdf=!0}else{var d,u,y=[];for(n=0;n<m;n+=1)if((d=this.shapes[n]).shape._mdf||this._mdf||t||2===this.m){if(h=(i=d.shape.paths)._length,f=0,!d.shape._mdf&&d.pathsData.length)f=d.totalShapeLength;else{for(p=this.releasePathsData(d.pathsData),o=0;o<h;o+=1)l=bez.getSegmentsLength(i.shapes[o]),p.push(l),f+=l.totalLength;d.totalShapeLength=f,d.pathsData=p}c+=f,d.shape._mdf=!0}else d.shape.paths=d.localShapeCollection;var g,v=e,b=r,P=0;for(n=m-1;0<=n;n-=1)if((d=this.shapes[n]).shape._mdf){for((u=d.localShapeCollection).releaseShapes(),2===this.m&&1<m?(g=this.calculateShapeEdges(e,r,d.totalShapeLength,P,c),P+=d.totalShapeLength):g=[[v,b]],h=g.length,o=0;o<h;o+=1){v=g[o][0],b=g[o][1],y.length=0,b<=1?y.push({s:d.totalShapeLength*v,e:d.totalShapeLength*b}):1<=v?y.push({s:d.totalShapeLength*(v-1),e:d.totalShapeLength*(b-1)}):(y.push({s:d.totalShapeLength*v,e:d.totalShapeLength}),y.push({s:0,e:d.totalShapeLength*(b-1)}));var _=this.addShapes(d,y[0]);if(y[0].s!==y[0].e){if(1<y.length)if(d.shape.paths.shapes[d.shape.paths._length-1].c){var A=_.pop();this.addPaths(_,u),_=this.addShapes(d,y[1],A)}else this.addPaths(_,u),_=this.addShapes(d,y[1]);this.addPaths(_,u)}}d.shape.paths=u}}},TrimModifier.prototype.addPaths=function(t,e){var r,i=t.length;for(r=0;r<i;r+=1)e.addShape(t[r])},TrimModifier.prototype.addSegment=function(t,e,r,i,s,a,n){s.setXYAt(e[0],e[1],"o",a),s.setXYAt(r[0],r[1],"i",a+1),n&&s.setXYAt(t[0],t[1],"v",a),s.setXYAt(i[0],i[1],"v",a+1)},TrimModifier.prototype.addSegmentFromArray=function(t,e,r,i){e.setXYAt(t[1],t[5],"o",r),e.setXYAt(t[2],t[6],"i",r+1),i&&e.setXYAt(t[0],t[4],"v",r),e.setXYAt(t[3],t[7],"v",r+1)},TrimModifier.prototype.addShapes=function(t,e,r){var i,s,a,n,o,h,p,l,f=t.pathsData,m=t.shape.paths.shapes,c=t.shape.paths._length,d=0,u=[],y=!0;for(l=r?(o=r._length,r._length):(r=shape_pool.newElement(),o=0),u.push(r),i=0;i<c;i+=1){for(h=f[i].lengths,r.c=m[i].c,a=m[i].c?h.length:h.length+1,s=1;s<a;s+=1)if(d+(n=h[s-1]).addedLength<e.s)d+=n.addedLength,r.c=!1;else{if(d>e.e){r.c=!1;break}e.s<=d&&e.e>=d+n.addedLength?(this.addSegment(m[i].v[s-1],m[i].o[s-1],m[i].i[s],m[i].v[s],r,o,y),y=!1):(p=bez.getNewSegment(m[i].v[s-1],m[i].v[s],m[i].o[s-1],m[i].i[s],(e.s-d)/n.addedLength,(e.e-d)/n.addedLength,h[s-1]),this.addSegmentFromArray(p,r,o,y),y=!1,r.c=!1),d+=n.addedLength,o+=1}if(m[i].c&&h.length){if(n=h[s-1],d<=e.e){var g=h[s-1].addedLength;e.s<=d&&e.e>=d+g?(this.addSegment(m[i].v[s-1],m[i].o[s-1],m[i].i[0],m[i].v[0],r,o,y),y=!1):(p=bez.getNewSegment(m[i].v[s-1],m[i].v[0],m[i].o[s-1],m[i].i[0],(e.s-d)/g,(e.e-d)/g,h[s-1]),this.addSegmentFromArray(p,r,o,y),y=!1,r.c=!1)}else r.c=!1;d+=n.addedLength,o+=1}if(r._length&&(r.setXYAt(r.v[l][0],r.v[l][1],"i",l),r.setXYAt(r.v[r._length-1][0],r.v[r._length-1][1],"o",r._length-1)),d>e.e)break;i<c-1&&(r=shape_pool.newElement(),y=!0,u.push(r),o=0)}return u},ShapeModifiers.registerModifier("tm",TrimModifier),extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(t,e){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(t,e.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(t,e){var r=shape_pool.newElement();r.c=t.c;var i,s,a,n,o,h,p,l,f,m,c,d,u,y=t._length,g=0;for(i=0;i<y;i+=1)s=t.v[i],n=t.o[i],a=t.i[i],s[0]===n[0]&&s[1]===n[1]&&s[0]===a[0]&&s[1]===a[1]?0!==i&&i!==y-1||t.c?(o=0===i?t.v[y-1]:t.v[i-1],p=(h=Math.sqrt(Math.pow(s[0]-o[0],2)+Math.pow(s[1]-o[1],2)))?Math.min(h/2,e)/h:0,l=d=s[0]+(o[0]-s[0])*p,f=u=s[1]-(s[1]-o[1])*p,m=l-(l-s[0])*roundCorner,c=f-(f-s[1])*roundCorner,r.setTripleAt(l,f,m,c,d,u,g),g+=1,o=i===y-1?t.v[0]:t.v[i+1],p=(h=Math.sqrt(Math.pow(s[0]-o[0],2)+Math.pow(s[1]-o[1],2)))?Math.min(h/2,e)/h:0,l=m=s[0]+(o[0]-s[0])*p,f=c=s[1]+(o[1]-s[1])*p,d=l-(l-s[0])*roundCorner,u=f-(f-s[1])*roundCorner,r.setTripleAt(l,f,m,c,d,u,g)):r.setTripleAt(s[0],s[1],n[0],n[1],a[0],a[1],g):r.setTripleAt(t.v[i][0],t.v[i][1],t.o[i][0],t.o[i][1],t.i[i][0],t.i[i][1],g),g+=1;return r},RoundCornersModifier.prototype.processShapes=function(t){var e,r,i,s,a,n,o=this.shapes.length,h=this.rd.v;if(0!==h)for(r=0;r<o;r+=1){if((a=this.shapes[r]).shape.paths,n=a.localShapeCollection,a.shape._mdf||this._mdf||t)for(n.releaseShapes(),a.shape._mdf=!0,e=a.shape.paths.shapes,s=a.shape.paths._length,i=0;i<s;i+=1)n.addShape(this.processPath(e[i],h));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},ShapeModifiers.registerModifier("rd",RoundCornersModifier),extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(t,e){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(t,e.c,0,null,this),this.o=PropertyFactory.getProp(t,e.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(t,e.tr,this),this.so=PropertyFactory.getProp(t,e.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(t,e.tr.eo,0,.01,this),this.data=e,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(t,e,r,i,s,a){var n=a?-1:1,o=i.s.v[0]+(1-i.s.v[0])*(1-s),h=i.s.v[1]+(1-i.s.v[1])*(1-s);t.translate(i.p.v[0]*n*s,i.p.v[1]*n*s,i.p.v[2]),e.translate(-i.a.v[0],-i.a.v[1],i.a.v[2]),e.rotate(-i.r.v*n*s),e.translate(i.a.v[0],i.a.v[1],i.a.v[2]),r.translate(-i.a.v[0],-i.a.v[1],i.a.v[2]),r.scale(a?1/o:o,a?1/h:h),r.translate(i.a.v[0],i.a.v[1],i.a.v[2])},RepeaterModifier.prototype.init=function(t,e,r,i){for(this.elem=t,this.arr=e,this.pos=r,this.elemsData=i,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(t),this.initModifierProperties(t,e[r]);0<r;)r-=1,this._elements.unshift(e[r]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(t){var e,r=t.length;for(e=0;e<r;e+=1)t[e]._processed=!1,"gr"===t[e].ty&&this.resetElements(t[e].it)},RepeaterModifier.prototype.cloneElements=function(t){t.length;var e=JSON.parse(JSON.stringify(t));return this.resetElements(e),e},RepeaterModifier.prototype.changeGroupRender=function(t,e){var r,i=t.length;for(r=0;r<i;r+=1)t[r]._render=e,"gr"===t[r].ty&&this.changeGroupRender(t[r].it,e)},RepeaterModifier.prototype.processShapes=function(t){var e,r,i,s,a;if(this._mdf||t){var n,o=Math.ceil(this.c.v);if(this._groups.length<o){for(;this._groups.length<o;){var h={it:this.cloneElements(this._elements),ty:"gr"};h.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,h),this._groups.splice(0,0,h),this._currentCopies+=1}this.elem.reloadShapes()}for(i=a=0;i<=this._groups.length-1;i+=1)n=a<o,this._groups[i]._render=n,this.changeGroupRender(this._groups[i].it,n),a+=1;this._currentCopies=o;var p=this.o.v,l=p%1,f=0<p?Math.floor(p):Math.ceil(p),m=(this.tr.v.props,this.pMatrix.props),c=this.rMatrix.props,d=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var u,y,g=0;if(0<p){for(;g<f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),g+=1;l&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,l,!1),g+=l)}else if(p<0){for(;f<g;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),g-=1;l&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-l,!0),g-=l)}for(i=1===this.data.m?0:this._currentCopies-1,s=1===this.data.m?1:-1,a=this._currentCopies;a;){if(y=(r=(e=this.elemsData[i].it)[e.length-1].transform.mProps.v.props).length,e[e.length-1].transform.mProps._mdf=!0,e[e.length-1].transform.op._mdf=!0,e[e.length-1].transform.op.v=this.so.v+(this.eo.v-this.so.v)*(i/(this._currentCopies-1)),0!==g){for((0!==i&&1===s||i!==this._currentCopies-1&&-1===s)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15]),this.matrix.transform(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15]),this.matrix.transform(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]),u=0;u<y;u+=1)r[u]=this.matrix.props[u];this.matrix.reset()}else for(this.matrix.reset(),u=0;u<y;u+=1)r[u]=this.matrix.props[u];g+=1,a-=1,i+=s}}else for(a=this._currentCopies,i=0,s=1;a;)r=(e=this.elemsData[i].it)[e.length-1].transform.mProps.v.props,e[e.length-1].transform.mProps._mdf=!1,e[e.length-1].transform.op._mdf=!1,a-=1,i+=s},RepeaterModifier.prototype.addShape=function(){},ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeCollection.prototype.addShape=function(t){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=t,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var t;for(t=0;t<this._length;t+=1)shape_pool.release(this.shapes[t]);this._length=0},DashProperty.prototype.getValue=function(t){if((this.elem.globalData.frameId!==this.frameId||t)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||t,this._mdf)){var e=0,r=this.dataProps.length;for("svg"===this.renderer&&(this.dashStr=""),e=0;e<r;e+=1)"o"!=this.dataProps[e].n?"svg"===this.renderer?this.dashStr+=" "+this.dataProps[e].p.v:this.dashArray[e]=this.dataProps[e].p.v:this.dashoffset[0]=this.dataProps[e].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),GradientProperty.prototype.comparePoints=function(t,e){for(var r=0,i=this.o.length/2;r<i;){if(.01<Math.abs(t[4*r]-t[4*e+2*r]))return!1;r+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!=this.c.length/4)return!1;if(this.data.k.k[0].s)for(var t=0,e=this.data.k.k.length;t<e;){if(!this.comparePoints(this.data.k.k[t].s,this.data.p))return!1;t+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(t){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||t){var e,r,i,s=4*this.data.p;for(e=0;e<s;e+=1)r=e%4==0?100:255,i=Math.round(this.prop.v[e]*r),this.c[e]!==i&&(this.c[e]=i,this._cmdf=!t);if(this.o.length)for(s=this.prop.v.length,e=4*this.data.p;e<s;e+=1)r=e%2==0?100:1,i=e%2==0?Math.round(100*this.prop.v[e]):this.prop.v[e],this.o[e-4*this.data.p]!==i&&(this.o[e-4*this.data.p]=i,this._omdf=!t);this._mdf=!t}},extendPrototype([DynamicPropertyContainer],GradientProperty);var buildShapeString=function(t,e,r,i){if(0===e)return"";var s,a=t.o,n=t.i,o=t.v,h=" M"+i.applyToPointStringified(o[0][0],o[0][1]);for(s=1;s<e;s+=1)h+=" C"+i.applyToPointStringified(a[s-1][0],a[s-1][1])+" "+i.applyToPointStringified(n[s][0],n[s][1])+" "+i.applyToPointStringified(o[s][0],o[s][1]);return r&&e&&(h+=" C"+i.applyToPointStringified(a[s-1][0],a[s-1][1])+" "+i.applyToPointStringified(n[0][0],n[0][1])+" "+i.applyToPointStringified(o[0][0],o[0][1]),h+="z"),h},ImagePreloader=function(){var s=function(){var t=createTag("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),t}();function t(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function e(t){var e=function(t,e,r){var i="";if(t.e)i=t.p;else if(e){var s=t.p;-1!==s.indexOf("images/")&&(s=s.split("/")[1]),i=e+s}else i=r,i+=t.u?t.u:"",i+=t.p;return i}(t,this.assetsPath,this.path),r=createTag("img");r.crossOrigin="anonymous",r.addEventListener("load",this._imageLoaded.bind(this),!1),r.addEventListener("error",function(){i.img=s,this._imageLoaded()}.bind(this),!1),r.src=e;var i={img:r,assetData:t};return i}function r(t,e){this.imagesLoadedCb=e;var r,i=t.length;for(r=0;r<i;r+=1)t[r].layers||(this.totalImages+=1,this.images.push(this._createImageData(t[r])))}function i(t){this.path=t||""}function a(t){this.assetsPath=t||""}function n(t){for(var e=0,r=this.images.length;e<r;){if(this.images[e].assetData===t)return this.images[e].img;e+=1}}function o(){this.imagesLoadedCb=null,this.images.length=0}function h(){return this.totalImages===this.loadedAssets}return function(){this.loadAssets=r,this.setAssetsPath=a,this.setPath=i,this.loaded=h,this.destroy=o,this.getImage=n,this._createImageData=e,this._imageLoaded=t,this.assetsPath="",this.path="",this.totalImages=0,this.loadedAssets=0,this.imagesLoadedCb=null,this.images=[]}}(),featureSupport=(sw={maskType:!0},(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(sw.maskType=!1),sw),sw,filtersFactory=(tw={},tw.createFilter=function(t){var e=createNS("filter");return e.setAttribute("id",t),e.setAttribute("filterUnits","objectBoundingBox"),e.setAttribute("x","0%"),e.setAttribute("y","0%"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),e},tw.createAlphaToLuminanceFilter=function(){var t=createNS("feColorMatrix");return t.setAttribute("type","matrix"),t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),t},tw),tw,assetLoader=function(){function a(t){return t.response&&"object"==typeof t.response?t.response:t.response&&"string"==typeof t.response?JSON.parse(t.response):t.responseText?JSON.parse(t.responseText):void 0}return{load:function(t,e,r){var i,s=new XMLHttpRequest;s.open("GET",t,!0);try{s.responseType="json"}catch(t){}s.send(),s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status)i=a(s),e(i);else try{i=a(s),e(i)}catch(t){r&&r(t)}}}}}();function TextAnimatorProperty(t,e,r){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=t,this._renderType=e,this._elem=r,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(r)}function TextAnimatorDataProperty(t,e,r){var i={propType:!1},s=PropertyFactory.getProp,a=e.a;this.a={r:a.r?s(t,a.r,0,degToRads,r):i,rx:a.rx?s(t,a.rx,0,degToRads,r):i,ry:a.ry?s(t,a.ry,0,degToRads,r):i,sk:a.sk?s(t,a.sk,0,degToRads,r):i,sa:a.sa?s(t,a.sa,0,degToRads,r):i,s:a.s?s(t,a.s,1,.01,r):i,a:a.a?s(t,a.a,1,0,r):i,o:a.o?s(t,a.o,0,.01,r):i,p:a.p?s(t,a.p,1,0,r):i,sw:a.sw?s(t,a.sw,0,0,r):i,sc:a.sc?s(t,a.sc,1,0,r):i,fc:a.fc?s(t,a.fc,1,0,r):i,fh:a.fh?s(t,a.fh,0,0,r):i,fs:a.fs?s(t,a.fs,0,.01,r):i,fb:a.fb?s(t,a.fb,0,.01,r):i,t:a.t?s(t,a.t,0,0,r):i},this.s=TextSelectorProp.getTextSelectorProp(t,e.s,r),this.s.t=e.s.t}function LetterProps(t,e,r,i,s,a){this.o=t,this.sw=e,this.sc=r,this.fc=i,this.m=s,this.p=a,this._mdf={o:!0,sw:!!e,sc:!!r,fc:!!i,m:!0,p:!0}}function TextProperty(t,e){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,this.data=e,this.elem=t,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextAnimatorProperty.prototype.searchProperties=function(){var t,e,r=this._textData.a.length,i=PropertyFactory.getProp;for(t=0;t<r;t+=1)e=this._textData.a[t],this._animatorsData[t]=new TextAnimatorDataProperty(this._elem,e,this);this._textData.p&&"m"in this._textData.p?(this._pathData={f:i(this._elem,this._textData.p.f,0,0,this),l:i(this._elem,this._textData.p.l,0,0,this),r:this._textData.p.r,m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=i(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(t,e){if(this.lettersChangedFlag=e,this._mdf||this._isFirstFrame||e||this._hasMaskedPath&&this._pathData.m._mdf){this._isFirstFrame=!1;var r,i,s,a,n,o,h,p,l,f,m,c,d,u,y,g,v,b,P,_=this._moreOptions.alignment.v,A=this._animatorsData,S=this._textData,x=this.mHelper,E=this._renderType,k=this.renderedLetters.length,T=(this.data,t.l);if(this._hasMaskedPath){if(P=this._pathData.m,!this._pathData.n||this._pathData._mdf){var M,D=P.v;for(this._pathData.r&&(D=D.reverse()),n={tLength:0,segments:[]},a=D._length-1,s=g=0;s<a;s+=1)M=bez.buildBezierData(D.v[s],D.v[s+1],[D.o[s][0]-D.v[s][0],D.o[s][1]-D.v[s][1]],[D.i[s+1][0]-D.v[s+1][0],D.i[s+1][1]-D.v[s+1][1]]),n.tLength+=M.segmentLength,n.segments.push(M),g+=M.segmentLength;s=a,P.v.c&&(M=bez.buildBezierData(D.v[s],D.v[0],[D.o[s][0]-D.v[s][0],D.o[s][1]-D.v[s][1]],[D.i[0][0]-D.v[0][0],D.i[0][1]-D.v[0][1]]),n.tLength+=M.segmentLength,n.segments.push(M),g+=M.segmentLength),this._pathData.pi=n}if(n=this._pathData.pi,o=this._pathData.f.v,f=1,l=!(p=m=0),u=n.segments,o<0&&P.v.c)for(n.tLength<Math.abs(o)&&(o=-Math.abs(o)%n.tLength),f=(d=u[m=u.length-1].points).length-1;o<0;)o+=d[f].partialLength,(f-=1)<0&&(f=(d=u[m-=1].points).length-1);c=(d=u[m].points)[f-1],y=(h=d[f]).partialLength}a=T.length,i=r=0;var F,I,C,w,V=1.2*t.finalSize*.714,R=!0;C=A.length;var L,G,N,B,z,O,j,q,H,W,K,X,$,Y=-1,U=o,Z=m,J=f,Q=-1,tt="",et=this.defaultPropsArray;if(2===t.j||1===t.j){var rt=0,it=0,st=2===t.j?-.5:-1,at=0,nt=!0;for(s=0;s<a;s+=1)if(T[s].n){for(rt&&(rt+=it);at<s;)T[at].animatorJustifyOffset=rt,at+=1;nt=!(rt=0)}else{for(I=0;I<C;I+=1)(F=A[I].a).t.propType&&(nt&&2===t.j&&(it+=F.t.v*st),(L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars)).length?rt+=F.t.v*L[0]*st:rt+=F.t.v*L*st);nt=!1}for(rt&&(rt+=it);at<s;)T[at].animatorJustifyOffset=rt,at+=1}for(s=0;s<a;s+=1){if(x.reset(),z=1,T[s].n)r=0,i+=t.yOffset,i+=R?1:0,o=U,R=!1,this._hasMaskedPath&&(f=J,c=(d=u[m=Z].points)[f-1],y=(h=d[f]).partialLength,p=0),$=W=X=tt="",et=this.defaultPropsArray;else{if(this._hasMaskedPath){if(Q!==T[s].line){switch(t.j){case 1:o+=g-t.lineWidths[T[s].line];break;case 2:o+=(g-t.lineWidths[T[s].line])/2}Q=T[s].line}Y!==T[s].ind&&(T[Y]&&(o+=T[Y].extra),o+=T[s].an/2,Y=T[s].ind),o+=_[0]*T[s].an/200;var ot=0;for(I=0;I<C;I+=1)(F=A[I].a).p.propType&&((L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars)).length?ot+=F.p.v[0]*L[0]:ot+=F.p.v[0]*L),F.a.propType&&((L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars)).length?ot+=F.a.v[0]*L[0]:ot+=F.a.v[0]*L);for(l=!0;l;)o+ot<=p+y||!d?(v=(o+ot-p)/h.partialLength,N=c.point[0]+(h.point[0]-c.point[0])*v,B=c.point[1]+(h.point[1]-c.point[1])*v,x.translate(-_[0]*T[s].an/200,-_[1]*V/100),l=!1):d&&(p+=h.partialLength,(f+=1)>=d.length&&(f=0,d=u[m+=1]?u[m].points:P.v.c?u[m=f=0].points:(p-=h.partialLength,null)),d&&(c=h,y=(h=d[f]).partialLength));G=T[s].an/2-T[s].add,x.translate(-G,0,0)}else G=T[s].an/2-T[s].add,x.translate(-G,0,0),x.translate(-_[0]*T[s].an/200,-_[1]*V/100,0);for(T[s].l,I=0;I<C;I+=1)(F=A[I].a).t.propType&&(L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars),0===r&&0===t.j||(this._hasMaskedPath?L.length?o+=F.t.v*L[0]:o+=F.t.v*L:L.length?r+=F.t.v*L[0]:r+=F.t.v*L));for(T[s].l,t.strokeWidthAnim&&(j=t.sw||0),t.strokeColorAnim&&(O=t.sc?[t.sc[0],t.sc[1],t.sc[2]]:[0,0,0]),t.fillColorAnim&&t.fc&&(q=[t.fc[0],t.fc[1],t.fc[2]]),I=0;I<C;I+=1)(F=A[I].a).a.propType&&((L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars)).length?x.translate(-F.a.v[0]*L[0],-F.a.v[1]*L[1],F.a.v[2]*L[2]):x.translate(-F.a.v[0]*L,-F.a.v[1]*L,F.a.v[2]*L));for(I=0;I<C;I+=1)(F=A[I].a).s.propType&&((L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars)).length?x.scale(1+(F.s.v[0]-1)*L[0],1+(F.s.v[1]-1)*L[1],1):x.scale(1+(F.s.v[0]-1)*L,1+(F.s.v[1]-1)*L,1));for(I=0;I<C;I+=1){if(F=A[I].a,L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars),F.sk.propType&&(L.length?x.skewFromAxis(-F.sk.v*L[0],F.sa.v*L[1]):x.skewFromAxis(-F.sk.v*L,F.sa.v*L)),F.r.propType&&(L.length?x.rotateZ(-F.r.v*L[2]):x.rotateZ(-F.r.v*L)),F.ry.propType&&(L.length?x.rotateY(F.ry.v*L[1]):x.rotateY(F.ry.v*L)),F.rx.propType&&(L.length?x.rotateX(F.rx.v*L[0]):x.rotateX(F.rx.v*L)),F.o.propType&&(L.length?z+=(F.o.v*L[0]-z)*L[0]:z+=(F.o.v*L-z)*L),t.strokeWidthAnim&&F.sw.propType&&(L.length?j+=F.sw.v*L[0]:j+=F.sw.v*L),t.strokeColorAnim&&F.sc.propType)for(H=0;H<3;H+=1)L.length?O[H]=O[H]+(F.sc.v[H]-O[H])*L[0]:O[H]=O[H]+(F.sc.v[H]-O[H])*L;if(t.fillColorAnim&&t.fc){if(F.fc.propType)for(H=0;H<3;H+=1)L.length?q[H]=q[H]+(F.fc.v[H]-q[H])*L[0]:q[H]=q[H]+(F.fc.v[H]-q[H])*L;F.fh.propType&&(q=L.length?addHueToRGB(q,F.fh.v*L[0]):addHueToRGB(q,F.fh.v*L)),F.fs.propType&&(q=L.length?addSaturationToRGB(q,F.fs.v*L[0]):addSaturationToRGB(q,F.fs.v*L)),F.fb.propType&&(q=L.length?addBrightnessToRGB(q,F.fb.v*L[0]):addBrightnessToRGB(q,F.fb.v*L))}}for(I=0;I<C;I+=1)(F=A[I].a).p.propType&&(L=A[I].s.getMult(T[s].anIndexes[I],S.a[I].s.totalChars),this._hasMaskedPath?L.length?x.translate(0,F.p.v[1]*L[0],-F.p.v[2]*L[1]):x.translate(0,F.p.v[1]*L,-F.p.v[2]*L):L.length?x.translate(F.p.v[0]*L[0],F.p.v[1]*L[1],-F.p.v[2]*L[2]):x.translate(F.p.v[0]*L,F.p.v[1]*L,-F.p.v[2]*L));if(t.strokeWidthAnim&&(W=j<0?0:j),t.strokeColorAnim&&(K="rgb("+Math.round(255*O[0])+","+Math.round(255*O[1])+","+Math.round(255*O[2])+")"),t.fillColorAnim&&t.fc&&(X="rgb("+Math.round(255*q[0])+","+Math.round(255*q[1])+","+Math.round(255*q[2])+")"),this._hasMaskedPath){if(x.translate(0,-t.ls),x.translate(0,_[1]*V/100+i,0),S.p.p){b=(h.point[1]-c.point[1])/(h.point[0]-c.point[0]);var ht=180*Math.atan(b)/Math.PI;h.point[0]<c.point[0]&&(ht+=180),x.rotate(-ht*Math.PI/180)}x.translate(N,B,0),o-=_[0]*T[s].an/200,T[s+1]&&Y!==T[s+1].ind&&(o+=T[s].an/2,o+=t.tr/1e3*t.finalSize)}else{switch(x.translate(r,i,0),t.ps&&x.translate(t.ps[0],t.ps[1]+t.ascent,0),t.j){case 1:x.translate(T[s].animatorJustifyOffset+t.justifyOffset+(t.boxWidth-t.lineWidths[T[s].line]),0,0);break;case 2:x.translate(T[s].animatorJustifyOffset+t.justifyOffset+(t.boxWidth-t.lineWidths[T[s].line])/2,0,0)}x.translate(0,-t.ls),x.translate(G,0,0),x.translate(_[0]*T[s].an/200,_[1]*V/100,0),r+=T[s].l+t.tr/1e3*t.finalSize}"html"===E?tt=x.toCSS():"svg"===E?tt=x.to2dCSS():et=[x.props[0],x.props[1],x.props[2],x.props[3],x.props[4],x.props[5],x.props[6],x.props[7],x.props[8],x.props[9],x.props[10],x.props[11],x.props[12],x.props[13],x.props[14],x.props[15]],$=z}this.lettersChangedFlag=k<=s?(w=new LetterProps($,W,K,X,tt,et),this.renderedLetters.push(w),k+=1,!0):(w=this.renderedLetters[s]).update($,W,K,X,tt,et)||this.lettersChangedFlag}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),LetterProps.prototype.update=function(t,e,r,i,s,a){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1;var n=this._mdf.p=!1;return this.o!==t&&(this.o=t,n=this._mdf.o=!0),this.sw!==e&&(this.sw=e,n=this._mdf.sw=!0),this.sc!==r&&(this.sc=r,n=this._mdf.sc=!0),this.fc!==i&&(this.fc=i,n=this._mdf.fc=!0),this.m!==s&&(this.m=s,n=this._mdf.m=!0),!a.length||this.p[0]===a[0]&&this.p[1]===a[1]&&this.p[4]===a[4]&&this.p[5]===a[5]&&this.p[12]===a[12]&&this.p[13]===a[13]||(this.p=a,n=this._mdf.p=!0),n},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},TextProperty.prototype.setCurrentData=function(t){t.__complete||this.completeTextData(t),this.currentData=t,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=1<this.data.d.k.length,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(t){this.effectsSequence.push(t),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(t){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length||t){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var e=this.currentData,r=this.keysIndex;if(this.lock)this.setCurrentData(this.currentData);else{this.lock=!0,this._mdf=!1;var i,s=this.effectsSequence.length,a=t||this.data.d.k[this.keysIndex].s;for(i=0;i<s;i+=1)a=r!==this.keysIndex?this.effectsSequence[i](a,a.t):this.effectsSequence[i](this.currentData,a.t);e!==a&&this.setCurrentData(a),this.pv=this.v=this.currentData,this.lock=!1,this.frameId=this.elem.globalData.frameId}}},TextProperty.prototype.getKeyframeValue=function(){for(var t=this.data.d.k,e=this.elem.comp.renderedFrame,r=0,i=t.length;r<=i-1&&(t[r].s,!(r===i-1||t[r+1].t>e));)r+=1;return this.keysIndex!==r&&(this.keysIndex=r),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(t){for(var e,r=FontManager.getCombinedCharacterCodes(),i=[],s=0,a=t.length;s<a;)e=t.charCodeAt(s),-1!==r.indexOf(e)?i[i.length-1]+=t.charAt(s):55296<=e&&e<=56319&&56320<=(e=t.charCodeAt(s+1))&&e<=57343?(i.push(t.substr(s,2)),++s):i.push(t.charAt(s)),s+=1;return i},TextProperty.prototype.completeTextData=function(t){t.__complete=!0;var e,r,i,s,a,n,o,h=this.elem.globalData.fontManager,p=this.data,l=[],f=0,m=p.m.g,c=0,d=0,u=0,y=[],g=0,v=0,b=h.getFontByName(t.f),P=0,_=b.fStyle?b.fStyle.split(" "):[],A="normal",S="normal";for(r=_.length,e=0;e<r;e+=1)switch(_[e].toLowerCase()){case"italic":S="italic";break;case"bold":A="700";break;case"black":A="900";break;case"medium":A="500";break;case"regular":case"normal":A="400";break;case"light":case"thin":A="200"}t.fWeight=b.fWeight||A,t.fStyle=S,t.finalSize=t.s,t.finalText=this.buildFinalText(t.t),r=t.finalText.length,t.finalLineHeight=t.lh;var x,E=t.tr/1e3*t.finalSize;if(t.sz)for(var k,T,M=!0,D=t.sz[0],F=t.sz[1];M;){g=k=0,r=(T=this.buildFinalText(t.t)).length,E=t.tr/1e3*t.finalSize;var I=-1;for(e=0;e<r;e+=1)x=T[e].charCodeAt(0),i=!1," "===T[e]?I=e:13!==x&&3!==x||(i=!(g=0),k+=t.finalLineHeight||1.2*t.finalSize),D<g+(P=h.chars?(o=h.getCharData(T[e],b.fStyle,b.fFamily),i?0:o.w*t.finalSize/100):h.measureText(T[e],t.f,t.finalSize))&&" "!==T[e]?(-1===I?r+=1:e=I,k+=t.finalLineHeight||1.2*t.finalSize,T.splice(e,I===e?1:0,"\r"),I=-1,g=0):(g+=P,g+=E);k+=b.ascent*t.finalSize/100,this.canResize&&t.finalSize>this.minimumFontSize&&F<k?(t.finalSize-=1,t.finalLineHeight=t.finalSize*t.lh/t.s):(t.finalText=T,r=t.finalText.length,M=!1)}g=-E;var C,w=P=0;for(e=0;e<r;e+=1)if(i=!1,x=(C=t.finalText[e]).charCodeAt(0)," "===C?s=" ":13===x||3===x?(w=0,y.push(g),v=v<g?g:v,g=-2*E,i=!(s=""),u+=1):s=t.finalText[e],P=h.chars?(o=h.getCharData(C,b.fStyle,h.getFontByName(t.f).fFamily),i?0:o.w*t.finalSize/100):h.measureText(s,t.f,t.finalSize)," "===C?w+=P+E:(g+=P+E+w,w=0),l.push({l:P,an:P,add:c,n:i,anIndexes:[],val:s,line:u,animatorJustifyOffset:0}),2==m){if(c+=P,""===s||" "===s||e===r-1){for(""!==s&&" "!==s||(c-=P);d<=e;)l[d].an=c,l[d].ind=f,l[d].extra=P,d+=1;f+=1,c=0}}else if(3==m){if(c+=P,""===s||e===r-1){for(""===s&&(c-=P);d<=e;)l[d].an=c,l[d].ind=f,l[d].extra=P,d+=1;c=0,f+=1}}else l[f].ind=f,l[f].extra=0,f+=1;if(t.l=l,v=v<g?g:v,y.push(g),t.sz)t.boxWidth=t.sz[0],t.justifyOffset=0;else switch(t.boxWidth=v,t.j){case 1:t.justifyOffset=-t.boxWidth;break;case 2:t.justifyOffset=-t.boxWidth/2;break;default:t.justifyOffset=0}t.lineWidths=y;var V,R,L=p.a;n=L.length;var G,N,B=[];for(a=0;a<n;a+=1){for((V=L[a]).a.sc&&(t.strokeColorAnim=!0),V.a.sw&&(t.strokeWidthAnim=!0),(V.a.fc||V.a.fh||V.a.fs||V.a.fb)&&(t.fillColorAnim=!0),N=0,G=V.s.b,e=0;e<r;e+=1)(R=l[e]).anIndexes[a]=N,(1==G&&""!==R.val||2==G&&""!==R.val&&" "!==R.val||3==G&&(R.n||" "==R.val||e==r-1)||4==G&&(R.n||e==r-1))&&(1===V.s.rn&&B.push(N),N+=1);p.a[a].s.totalChars=N;var z,O=-1;if(1===V.s.rn)for(e=0;e<r;e+=1)O!=(R=l[e]).anIndexes[a]&&(O=R.anIndexes[a],z=B.splice(Math.floor(Math.random()*B.length),1)[0]),R.anIndexes[a]=z}t.yOffset=t.finalLineHeight||1.2*t.finalSize,t.ls=t.ls||0,t.ascent=b.ascent*t.finalSize/100},TextProperty.prototype.updateDocumentData=function(t,e){e=void 0===e?this.keysIndex:e;var r=this.copyData({},this.data.d.k[e].s);r=this.copyData(r,t),this.data.d.k[e].s=r,this.recalculate(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(t){var e=this.data.d.k[t].s;e.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(e)},TextProperty.prototype.canResizeFont=function(t){this.canResize=t,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(t){this.minimumFontSize=Math.floor(t)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var c=Math.max,d=Math.min,u=Math.floor;function i(t,e){this._currentTextLength=-1,this.k=!1,this.data=e,this.elem=t,this.comp=t.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(t),this.s=PropertyFactory.getProp(t,e.s||{k:0},0,0,this),this.e="e"in e?PropertyFactory.getProp(t,e.e,0,0,this):{v:100},this.o=PropertyFactory.getProp(t,e.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(t,e.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(t,e.ne||{k:0},0,0,this),this.a=PropertyFactory.getProp(t,e.a,0,.01,this),this.dynamicProperties.length||this.getValue()}return i.prototype={getMult:function(t){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var e=0,r=0,i=1,s=1;0<this.ne.v?e=this.ne.v/100:r=-this.ne.v/100,0<this.xe.v?i=1-this.xe.v/100:s=1+this.xe.v/100;var a=BezierFactory.getBezierEasing(e,r,i,s).get,n=0,o=this.finalS,h=this.finalE,p=this.data.sh;if(2===p)n=a(n=h===o?h<=t?1:0:c(0,d(.5/(h-o)+(t-o)/(h-o),1)));else if(3===p)n=a(n=h===o?h<=t?0:1:1-c(0,d(.5/(h-o)+(t-o)/(h-o),1)));else if(4===p)h===o?n=0:(n=c(0,d(.5/(h-o)+(t-o)/(h-o),1)))<.5?n*=2:n=1-2*(n-.5),n=a(n);else if(5===p){if(h===o)n=0;else{var l=h-o,f=-l/2+(t=d(c(0,t+.5-o),h-o)),m=l/2;n=Math.sqrt(1-f*f/(m*m))}n=a(n)}else n=6===p?a(n=h===o?0:(t=d(c(0,t+.5-o),h-o),(1+Math.cos(Math.PI+2*Math.PI*t/(h-o)))/2)):(t>=u(o)&&(n=c(0,d(t-o<0?d(h,1)-(o-t):h-t,1))),a(n));return n*this.a.v},getValue:function(t){this.iterateDynamicProperties(),this._mdf=t||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,t&&2===this.data.r&&(this.e.v=this._currentTextLength);var e=2===this.data.r?1:100/this.data.totalChars,r=this.o.v/e,i=this.s.v/e+r,s=this.e.v/e+r;if(s<i){var a=i;i=s,s=a}this.finalS=i,this.finalE=s}},extendPrototype([DynamicPropertyContainer],i),{getTextSelectorProp:function(t,e,r){return new i(t,e,r)}}}(),pool_factory=function(t,e,r,i){var s=0,a=t,n=createSizedArray(a);return{newElement:function o(){return s?n[s-=1]:e()},release:function(t){s===a&&(n=pooling.double(n),a*=2),r&&r(t),n[s]=t,s+=1}}},pooling={double:function(t){return t.concat(createSizedArray(t.length))}},point_pool=pool_factory(8,function(){return createTypedArray("float32",2)}),shape_pool=(KA=pool_factory(4,function(){return new ShapePath},function(t){var e,r=t._length;for(e=0;e<r;e+=1)point_pool.release(t.v[e]),point_pool.release(t.i[e]),point_pool.release(t.o[e]),t.v[e]=null,t.i[e]=null,t.o[e]=null;t._length=0,t.c=!1}),KA.clone=function(t){var e,r=KA.newElement(),i=void 0===t._length?t.v.length:t._length;for(r.setLength(i),r.c=t.c,e=0;e<i;e+=1)r.setTripleAt(t.v[e][0],t.v[e][1],t.o[e][0],t.o[e][1],t.i[e][0],t.i[e][1],e);return r},KA),KA,shapeCollection_pool=(TA={newShapeCollection:function(){return UA?WA[UA-=1]:new ShapeCollection},release:function(t){var e,r=t._length;for(e=0;e<r;e+=1)shape_pool.release(t.shapes[e]);t._length=0,UA===VA&&(WA=pooling.double(WA),VA*=2),WA[UA]=t,UA+=1}},UA=0,VA=4,WA=createSizedArray(VA),TA),TA,UA,VA,WA,segments_length_pool=pool_factory(8,function(){return{lengths:[],totalLength:0}},function(t){var e,r=t.lengths.length;for(e=0;e<r;e+=1)bezier_length_pool.release(t.lengths[e]);t.lengths.length=0}),bezier_length_pool=pool_factory(8,function(){return{addedLength:0,percents:createTypedArray("float32",defaultCurveSegments),lengths:createTypedArray("float32",defaultCurveSegments)}});function BaseRenderer(){}function SVGRenderer(t,e){this.animationItem=t,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var r="";if(e&&e.title){var i=createNS("title"),s=createElementID();i.setAttribute("id",s),i.textContent=e.title,this.svgElement.appendChild(i),r+=s}if(e&&e.description){var a=createNS("desc"),n=createElementID();a.setAttribute("id",n),a.textContent=e.description,this.svgElement.appendChild(a),r+=" "+n}r&&this.svgElement.setAttribute("aria-labelledby",r);var o=createNS("defs");this.svgElement.appendChild(o);var h=createNS("g");this.svgElement.appendChild(h),this.layerElement=h,this.renderConfig={preserveAspectRatio:e&&e.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",progressiveLoad:e&&e.progressiveLoad||!1,hideOnTransparent:!e||!1!==e.hideOnTransparent,viewBoxOnly:e&&e.viewBoxOnly||!1,viewBoxSize:e&&e.viewBoxSize||!1,className:e&&e.className||"",id:e&&e.id||"",focusable:e&&e.focusable},this.globalData={_mdf:!1,frameNum:-1,defs:o,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function MaskElement(t,e,r){this.data=t,this.element=e,this.globalData=r,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var i,s=this.globalData.defs,a=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(a),this.solidPath="";var n,o,h,p,l,f,m,c=this.masksProperties,d=0,u=[],y=createElementID(),g="clipPath",v="clip-path";for(i=0;i<a;i++)if(("a"!==c[i].mode&&"n"!==c[i].mode||c[i].inv||100!==c[i].o.k||c[i].o.x)&&(v=g="mask"),"s"!=c[i].mode&&"i"!=c[i].mode||0!==d?p=null:((p=createNS("rect")).setAttribute("fill","#ffffff"),p.setAttribute("width",this.element.comp.data.w||0),p.setAttribute("height",this.element.comp.data.h||0),u.push(p)),n=createNS("path"),"n"!=c[i].mode){var b;if(d+=1,n.setAttribute("fill","s"===c[i].mode?"#000000":"#ffffff"),n.setAttribute("clip-rule","nonzero"),0!==c[i].x.k?(v=g="mask",m=PropertyFactory.getProp(this.element,c[i].x,0,null,this.element),b=createElementID(),(l=createNS("filter")).setAttribute("id",b),(f=createNS("feMorphology")).setAttribute("operator","erode"),f.setAttribute("in","SourceGraphic"),f.setAttribute("radius","0"),l.appendChild(f),s.appendChild(l),n.setAttribute("stroke","s"===c[i].mode?"#000000":"#ffffff")):m=f=null,this.storedData[i]={elem:n,x:m,expan:f,lastPath:"",lastOperator:"",filterId:b,lastRadius:0},"i"==c[i].mode){h=u.length;var P=createNS("g");for(o=0;o<h;o+=1)P.appendChild(u[o]);var _=createNS("mask");_.setAttribute("mask-type","alpha"),_.setAttribute("id",y+"_"+d),_.appendChild(n),s.appendChild(_),P.setAttribute("mask","url("+locationHref+"#"+y+"_"+d+")"),u.length=0,u.push(P)}else u.push(n);c[i].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[i]={elem:n,lastPath:"",op:PropertyFactory.getProp(this.element,c[i].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[i],3),invRect:p},this.viewData[i].prop.k||this.drawPath(c[i],this.viewData[i].prop.v,this.viewData[i])}else this.viewData[i]={op:PropertyFactory.getProp(this.element,c[i].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[i],3),elem:n,lastPath:""},s.appendChild(n);for(this.maskElement=createNS(g),a=u.length,i=0;i<a;i+=1)this.maskElement.appendChild(u[i]);0<d&&(this.maskElement.setAttribute("id",y),this.element.maskedElement.setAttribute(v,"url("+locationHref+"#"+y+")"),s.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}function HierarchyElement(){}function FrameElement(){}function TransformElement(){}function RenderableElement(){}function RenderableDOMElement(){}function ProcessedElement(t,e){this.elem=t,this.pos=e}function SVGStyleData(t,e){this.data=t,this.type=t.ty,this.d="",this.lvl=e,this._mdf=!1,this.closed=!0===t.hd,this.pElem=createNS("path"),this.msElem=null}function SVGShapeData(t,e,r){this.caches=[],this.styles=[],this.transformers=t,this.lStr="",this.sh=r,this.lvl=e,this._isAnimated=!!r.k;for(var i=0,s=t.length;i<s;){if(t[i].mProps.dynamicProperties.length){this._isAnimated=!0;break}i+=1}}function SVGTransformData(t,e,r){this.transform={mProps:t,op:e,container:r},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}function SVGStrokeStyleData(t,e,r){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(t,e.o,0,.01,this),this.w=PropertyFactory.getProp(t,e.w,0,null,this),this.d=new DashProperty(t,e.d||{},"svg",this),this.c=PropertyFactory.getProp(t,e.c,1,255,this),this.style=r,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(t,e,r){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(t,e.o,0,.01,this),this.c=PropertyFactory.getProp(t,e.c,1,255,this),this.style=r}function SVGGradientFillStyleData(t,e,r){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.initGradientData(t,e,r)}function SVGGradientStrokeStyleData(t,e,r){this.initDynamicPropertyContainer(t),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(t,e.w,0,null,this),this.d=new DashProperty(t,e.d||{},"svg",this),this.initGradientData(t,e,r),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}BaseRenderer.prototype.checkLayers=function(t){var e,r,i=this.layers.length;for(this.completeLayers=!0,e=i-1;0<=e;e--)this.elements[e]||(r=this.layers[e]).ip-r.st<=t-this.layers[e].st&&r.op-r.st>t-this.layers[e].st&&this.buildItem(e),this.completeLayers=!!this.elements[e]&&this.completeLayers;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(t){switch(t.ty){case 2:return this.createImage(t);case 0:return this.createComp(t);case 1:return this.createSolid(t);case 3:return this.createNull(t);case 4:return this.createShape(t);case 5:return this.createText(t);case 13:return this.createCamera(t)}return this.createNull(t)},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.buildAllItems=function(){var t,e=this.layers.length;for(t=0;t<e;t+=1)this.buildItem(t);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(t){this.completeLayers=!1;var e,r,i=t.length,s=this.layers.length;for(e=0;e<i;e+=1)for(r=0;r<s;){if(this.layers[r].id==t[e].id){this.layers[r]=t[e];break}r+=1}},BaseRenderer.prototype.setProjectInterface=function(t){this.globalData.projectInterface=t},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(t,e,r){for(var i=this.elements,s=this.layers,a=0,n=s.length;a<n;)s[a].ind==e&&(i[a]&&!0!==i[a]?(r.push(i[a]),i[a].setAsParent(),void 0!==s[a].parent?this.buildElementParenting(t,s[a].parent,r):t.setHierarchy(r)):(this.buildItem(a),this.addPendingElement(t))),a+=1},BaseRenderer.prototype.addPendingElement=function(t){this.pendingElements.push(t)},BaseRenderer.prototype.searchExtraCompositions=function(t){var e,r=t.length;for(e=0;e<r;e+=1)if(t[e].xt){var i=this.createComp(t[e]);i.initExpressions(),this.globalData.projectInterface.registerComposition(i)}},BaseRenderer.prototype.setupGlobalData=function(t,e){this.globalData.fontManager=new FontManager,this.globalData.fontManager.addChars(t.chars),this.globalData.fontManager.addFonts(t.fonts,e),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.frameId=0,this.globalData.frameRate=t.fr,this.globalData.nm=t.nm,this.globalData.compSize={w:t.w,h:t.h}},extendPrototype([BaseRenderer],SVGRenderer),SVGRenderer.prototype.createNull=function(t){return new NullElement(t,this.globalData,this)},SVGRenderer.prototype.createShape=function(t){return new SVGShapeElement(t,this.globalData,this)},SVGRenderer.prototype.createText=function(t){return new SVGTextElement(t,this.globalData,this)},SVGRenderer.prototype.createImage=function(t){return new IImageElement(t,this.globalData,this)},SVGRenderer.prototype.createComp=function(t){return new SVGCompElement(t,this.globalData,this)},SVGRenderer.prototype.createSolid=function(t){return new ISolidElement(t,this.globalData,this)},SVGRenderer.prototype.configAnimation=function(t){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+t.w+" "+t.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",t.w),this.svgElement.setAttribute("height",t.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)"),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),void 0!==this.renderConfig.focusable&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var e=this.globalData.defs;this.setupGlobalData(t,e),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=t;var r=createNS("clipPath"),i=createNS("rect");i.setAttribute("width",t.w),i.setAttribute("height",t.h),i.setAttribute("x",0),i.setAttribute("y",0);var s=createElementID();r.setAttribute("id",s),r.appendChild(i),this.layerElement.setAttribute("clip-path","url("+locationHref+"#"+s+")"),e.appendChild(r),this.layers=t.layers,this.elements=createSizedArray(t.layers.length)},SVGRenderer.prototype.destroy=function(){this.animationItem.wrapper.innerHTML="",this.layerElement=null,this.globalData.defs=null;var t,e=this.layers?this.layers.length:0;for(t=0;t<e;t++)this.elements[t]&&this.elements[t].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRenderer.prototype.updateContainerSize=function(){},SVGRenderer.prototype.buildItem=function(t){var e=this.elements;if(!e[t]&&99!=this.layers[t].ty){e[t]=!0;var r=this.createItem(this.layers[t]);e[t]=r,expressionsPlugin&&(0===this.layers[t].ty&&this.globalData.projectInterface.registerComposition(r),r.initExpressions()),this.appendElementInPos(r,t),this.layers[t].tt&&(this.elements[t-1]&&!0!==this.elements[t-1]?r.setMatte(e[t-1].layerId):(this.buildItem(t-1),this.addPendingElement(r)))}},SVGRenderer.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var t=this.pendingElements.pop();if(t.checkParenting(),t.data.tt)for(var e=0,r=this.elements.length;e<r;){if(this.elements[e]===t){t.setMatte(this.elements[e-1].layerId);break}e+=1}}},SVGRenderer.prototype.renderFrame=function(t){if(this.renderedFrame!==t&&!this.destroyed){null===t?t=this.renderedFrame:this.renderedFrame=t,this.globalData.frameNum=t,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=t,this.globalData._mdf=!1;var e,r=this.layers.length;for(this.completeLayers||this.checkLayers(t),e=r-1;0<=e;e--)(this.completeLayers||this.elements[e])&&this.elements[e].prepareFrame(t-this.layers[e].st);if(this.globalData._mdf)for(e=0;e<r;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()}},SVGRenderer.prototype.appendElementInPos=function(t,e){var r=t.getBaseElement();if(r){for(var i,s=0;s<e;)this.elements[s]&&!0!==this.elements[s]&&this.elements[s].getBaseElement()&&(i=this.elements[s].getBaseElement()),s+=1;i?this.layerElement.insertBefore(r,i):this.layerElement.appendChild(r)}},SVGRenderer.prototype.hide=function(){this.layerElement.style.display="none"},SVGRenderer.prototype.show=function(){this.layerElement.style.display="block"},MaskElement.prototype.getMaskProperty=function(t){return this.viewData[t].prop},MaskElement.prototype.renderFrame=function(t){var e,r=this.element.finalTransform.mat,i=this.masksProperties.length;for(e=0;e<i;e++)if((this.viewData[e].prop._mdf||t)&&this.drawPath(this.masksProperties[e],this.viewData[e].prop.v,this.viewData[e]),(this.viewData[e].op._mdf||t)&&this.viewData[e].elem.setAttribute("fill-opacity",this.viewData[e].op.v),"n"!==this.masksProperties[e].mode&&(this.viewData[e].invRect&&(this.element.finalTransform.mProp._mdf||t)&&this.viewData[e].invRect.setAttribute("transform",r.getInverseMatrix().to2dCSS()),this.storedData[e].x&&(this.storedData[e].x._mdf||t))){var s=this.storedData[e].expan;this.storedData[e].x.v<0?("erode"!==this.storedData[e].lastOperator&&(this.storedData[e].lastOperator="erode",this.storedData[e].elem.setAttribute("filter","url("+locationHref+"#"+this.storedData[e].filterId+")")),s.setAttribute("radius",-this.storedData[e].x.v)):("dilate"!==this.storedData[e].lastOperator&&(this.storedData[e].lastOperator="dilate",this.storedData[e].elem.setAttribute("filter",null)),this.storedData[e].elem.setAttribute("stroke-width",2*this.storedData[e].x.v))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var t="M0,0 ";return t+=" h"+this.globalData.compSize.w,t+=" v"+this.globalData.compSize.h,(t+=" h-"+this.globalData.compSize.w)+" v-"+this.globalData.compSize.h+" "},MaskElement.prototype.drawPath=function(t,e,r){var i,s,a=" M"+e.v[0][0]+","+e.v[0][1];for(s=e._length,i=1;i<s;i+=1)a+=" C"+e.o[i-1][0]+","+e.o[i-1][1]+" "+e.i[i][0]+","+e.i[i][1]+" "+e.v[i][0]+","+e.v[i][1];if(e.c&&1<s&&(a+=" C"+e.o[i-1][0]+","+e.o[i-1][1]+" "+e.i[0][0]+","+e.i[0][1]+" "+e.v[0][0]+","+e.v[0][1]),r.lastPath!==a){var n="";r.elem&&(e.c&&(n=t.inv?this.solidPath+a:a),r.elem.setAttribute("d",n)),r.lastPath=a}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(t){this.hierarchy=t},setAsParent:function(){this._isParent=!0},checkParenting:function(){void 0!==this.data.parent&&this.comp.buildElementParenting(this,this.data.parent,[])}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(t,e){var r,i=this.dynamicProperties.length;for(r=0;r<i;r+=1)(e||this._isParent&&"transform"===this.dynamicProperties[r].propType)&&(this.dynamicProperties[r].getValue(),this.dynamicProperties[r]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(t){-1===this.dynamicProperties.indexOf(t)&&this.dynamicProperties.push(t)}},TransformElement.prototype={initTransform:function(){this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_opMdf:!1,mat:new Matrix},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var t,e=this.finalTransform.mat,r=0,i=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;r<i;){if(this.hierarchy[r].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}r+=1}if(this.finalTransform._matMdf)for(t=this.finalTransform.mProp.v.props,e.cloneFromProps(t),r=0;r<i;r+=1)t=this.hierarchy[r].finalTransform.mProp.v.props,e.transform(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}},globalToLocal:function(t){var e=[];e.push(this.finalTransform);for(var r=!0,i=this.comp;r;)i.finalTransform?(i.data.hasMask&&e.splice(0,0,i.finalTransform),i=i.comp):r=!1;var s,a,n=e.length;for(s=0;s<n;s+=1)a=e[s].mat.applyToPointArray(0,0,0),t=[t[0]-a[0],t[1]-a[1],0];return t},mHelper:new Matrix},RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(t){-1===this.renderableComponents.indexOf(t)&&this.renderableComponents.push(t)},removeRenderableComponent:function(t){-1!==this.renderableComponents.indexOf(t)&&this.renderableComponents.splice(this.renderableComponents.indexOf(t),1)},prepareRenderableFrame:function(t){this.checkLayerLimits(t)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(t){this.data.ip-this.data.st<=t&&this.data.op-this.data.st>t?!0!==this.isInRange&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):!1!==this.isInRange&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var t,e=this.renderableComponents.length;for(t=0;t<e;t+=1)this.renderableComponents[t].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return 5===this.data.ty?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}},extendPrototype([RenderableElement,createProxyFunction({initElement:function(t,e,r){this.initFrame(),this.initBaseData(t,e,r),this.initTransform(t,e,r),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){this.hidden||this.isInRange&&!this.isTransparent||((this.baseElement||this.layerElement).style.display="none",this.hidden=!0)},show:function(){this.isInRange&&!this.isTransparent&&(this.data.hd||((this.baseElement||this.layerElement).style.display="block"),this.hidden=!1,this._isFirstFrame=!0)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(t){this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}})],RenderableDOMElement),SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),SVGGradientFillStyleData.prototype.initGradientData=function(t,e,r){this.o=PropertyFactory.getProp(t,e.o,0,.01,this),this.s=PropertyFactory.getProp(t,e.s,1,null,this),this.e=PropertyFactory.getProp(t,e.e,1,null,this),this.h=PropertyFactory.getProp(t,e.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(t,e.a||{k:0},0,degToRads,this),this.g=new GradientProperty(t,e.g,this),this.style=r,this.stops=[],this.setGradientData(r.pElem,e),this.setGradientOpacity(e,r),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(t,e){var r=createElementID(),i=createNS(1===e.t?"linearGradient":"radialGradient");i.setAttribute("id",r),i.setAttribute("spreadMethod","pad"),i.setAttribute("gradientUnits","userSpaceOnUse");var s,a,n,o=[];for(n=4*e.g.p,a=0;a<n;a+=4)s=createNS("stop"),i.appendChild(s),o.push(s);t.setAttribute("gf"===e.ty?"fill":"stroke","url("+locationHref+"#"+r+")"),this.gf=i,this.cst=o},SVGGradientFillStyleData.prototype.setGradientOpacity=function(t,e){if(this.g._hasOpacity&&!this.g._collapsable){var r,i,s,a=createNS("mask"),n=createNS("path");a.appendChild(n);var o=createElementID(),h=createElementID();a.setAttribute("id",h);var p=createNS(1===t.t?"linearGradient":"radialGradient");p.setAttribute("id",o),p.setAttribute("spreadMethod","pad"),p.setAttribute("gradientUnits","userSpaceOnUse"),s=t.g.k.k[0].s?t.g.k.k[0].s.length:t.g.k.k.length;var l=this.stops;for(i=4*t.g.p;i<s;i+=2)(r=createNS("stop")).setAttribute("stop-color","rgb(255,255,255)"),p.appendChild(r),l.push(r);n.setAttribute("gf"===t.ty?"fill":"stroke","url("+locationHref+"#"+o+")"),this.of=p,this.ms=a,this.ost=l,this.maskId=h,e.msElem=n}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);var SVGElementsRenderer=function(){var y=new Matrix,g=new Matrix;function e(t,e,r){(r||e.transform.op._mdf)&&e.transform.container.setAttribute("opacity",e.transform.op.v),(r||e.transform.mProps._mdf)&&e.transform.container.setAttribute("transform",e.transform.mProps.v.to2dCSS())}function r(t,e,r){var i,s,a,n,o,h,p,l,f,m,c,d=e.styles.length,u=e.lvl;for(h=0;h<d;h+=1){if(n=e.sh._mdf||r,e.styles[h].lvl<u){for(l=g.reset(),m=u-e.styles[h].lvl,c=e.transformers.length-1;!n&&0<m;)n=e.transformers[c].mProps._mdf||n,m--,c--;if(n)for(m=u-e.styles[h].lvl,c=e.transformers.length-1;0<m;)f=e.transformers[c].mProps.v.props,l.transform(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]),m--,c--}else l=y;if(s=(p=e.sh.paths)._length,n){for(a="",i=0;i<s;i+=1)(o=p.shapes[i])&&o._length&&(a+=buildShapeString(o,o._length,o.c,l));e.caches[h]=a}else a=e.caches[h];e.styles[h].d+=!0===t.hd?"":a,e.styles[h]._mdf=n||e.styles[h]._mdf}}function i(t,e,r){var i=e.style;(e.c._mdf||r)&&i.pElem.setAttribute("fill","rgb("+bm_floor(e.c.v[0])+","+bm_floor(e.c.v[1])+","+bm_floor(e.c.v[2])+")"),(e.o._mdf||r)&&i.pElem.setAttribute("fill-opacity",e.o.v)}function s(t,e,r){a(t,e,r),n(t,e,r)}function a(t,e,r){var i,s,a,n,o,h=e.gf,p=e.g._hasOpacity,l=e.s.v,f=e.e.v;if(e.o._mdf||r){var m="gf"===t.ty?"fill-opacity":"stroke-opacity";e.style.pElem.setAttribute(m,e.o.v)}if(e.s._mdf||r){var c=1===t.t?"x1":"cx",d="x1"===c?"y1":"cy";h.setAttribute(c,l[0]),h.setAttribute(d,l[1]),p&&!e.g._collapsable&&(e.of.setAttribute(c,l[0]),e.of.setAttribute(d,l[1]))}if(e.g._cmdf||r){i=e.cst;var u=e.g.c;for(a=i.length,s=0;s<a;s+=1)(n=i[s]).setAttribute("offset",u[4*s]+"%"),n.setAttribute("stop-color","rgb("+u[4*s+1]+","+u[4*s+2]+","+u[4*s+3]+")")}if(p&&(e.g._omdf||r)){var y=e.g.o;for(a=(i=e.g._collapsable?e.cst:e.ost).length,s=0;s<a;s+=1)n=i[s],e.g._collapsable||n.setAttribute("offset",y[2*s]+"%"),n.setAttribute("stop-opacity",y[2*s+1])}if(1===t.t)(e.e._mdf||r)&&(h.setAttribute("x2",f[0]),h.setAttribute("y2",f[1]),p&&!e.g._collapsable&&(e.of.setAttribute("x2",f[0]),e.of.setAttribute("y2",f[1])));else if((e.s._mdf||e.e._mdf||r)&&(o=Math.sqrt(Math.pow(l[0]-f[0],2)+Math.pow(l[1]-f[1],2)),h.setAttribute("r",o),p&&!e.g._collapsable&&e.of.setAttribute("r",o)),e.e._mdf||e.h._mdf||e.a._mdf||r){o||(o=Math.sqrt(Math.pow(l[0]-f[0],2)+Math.pow(l[1]-f[1],2)));var g=Math.atan2(f[1]-l[1],f[0]-l[0]),v=o*(1<=e.h.v?.99:e.h.v<=-1?-.99:e.h.v),b=Math.cos(g+e.a.v)*v+l[0],P=Math.sin(g+e.a.v)*v+l[1];h.setAttribute("fx",b),h.setAttribute("fy",P),p&&!e.g._collapsable&&(e.of.setAttribute("fx",b),e.of.setAttribute("fy",P))}}function n(t,e,r){var i=e.style,s=e.d;s&&(s._mdf||r)&&s.dashStr&&(i.pElem.setAttribute("stroke-dasharray",s.dashStr),i.pElem.setAttribute("stroke-dashoffset",s.dashoffset[0])),e.c&&(e.c._mdf||r)&&i.pElem.setAttribute("stroke","rgb("+bm_floor(e.c.v[0])+","+bm_floor(e.c.v[1])+","+bm_floor(e.c.v[2])+")"),(e.o._mdf||r)&&i.pElem.setAttribute("stroke-opacity",e.o.v),(e.w._mdf||r)&&(i.pElem.setAttribute("stroke-width",e.w.v),i.msElem&&i.msElem.setAttribute("stroke-width",e.w.v))}return{createRenderFunction:function(t){switch(t.ty,t.ty){case"fl":return i;case"gf":return a;case"gs":return s;case"st":return n;case"sh":case"el":case"rc":case"sr":return r;case"tr":return e}}}}();function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}function BaseElement(){}function NullElement(t,e,r){this.initFrame(),this.initBaseData(t,e,r),this.initFrame(),this.initTransform(t,e,r),this.initHierarchy()}function SVGBaseElement(){}function IShapeElement(){}function ITextElement(){}function ICompElement(){}function IImageElement(t,e,r){this.assetData=e.getAssetData(t.refId),this.initElement(t,e,r),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ISolidElement(t,e,r){this.initElement(t,e,r)}function SVGCompElement(t,e,r){this.layers=t.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(t,e,r),this.tm=t.tm?PropertyFactory.getProp(this,t.tm,0,e.frameRate,this):{_placeholder:!0}}function SVGTextElement(t,e,r){this.textSpans=[],this.renderType="svg",this.initElement(t,e,r)}function SVGShapeElement(t,e,r){this.shapes=[],this.shapesData=t.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(t,e,r),this.prevViewData=[]}function SVGTintFilter(t,e){this.filterManager=e;var r=createNS("feColorMatrix");if(r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","linearRGB"),r.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),r.setAttribute("result","f1"),t.appendChild(r),(r=createNS("feColorMatrix")).setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),r.setAttribute("result","f2"),t.appendChild(r),this.matrixFilter=r,100!==e.effectElements[2].p.v||e.effectElements[2].p.k){var i,s=createNS("feMerge");t.appendChild(s),(i=createNS("feMergeNode")).setAttribute("in","SourceGraphic"),s.appendChild(i),(i=createNS("feMergeNode")).setAttribute("in","f2"),s.appendChild(i)}}function SVGFillFilter(t,e){this.filterManager=e;var r=createNS("feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),t.appendChild(r),this.matrixFilter=r}function SVGGaussianBlurEffect(t,e){t.setAttribute("x","-100%"),t.setAttribute("y","-100%"),t.setAttribute("width","300%"),t.setAttribute("height","300%"),this.filterManager=e;var r=createNS("feGaussianBlur");t.appendChild(r),this.feGaussianBlur=r}function SVGStrokeEffect(t,e){this.initialized=!1,this.filterManager=e,this.elem=t,this.paths=[]}function SVGTritoneFilter(t,e){this.filterManager=e;var r=createNS("feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","linearRGB"),r.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),r.setAttribute("result","f1"),t.appendChild(r);var i=createNS("feComponentTransfer");i.setAttribute("color-interpolation-filters","sRGB"),t.appendChild(i),this.matrixFilter=i;var s=createNS("feFuncR");s.setAttribute("type","table"),i.appendChild(s),this.feFuncR=s;var a=createNS("feFuncG");a.setAttribute("type","table"),i.appendChild(a),this.feFuncG=a;var n=createNS("feFuncB");n.setAttribute("type","table"),i.appendChild(n),this.feFuncB=n}function SVGProLevelsFilter(t,e){this.filterManager=e;var r=this.filterManager.effectElements,i=createNS("feComponentTransfer");(r[10].p.k||0!==r[10].p.v||r[11].p.k||1!==r[11].p.v||r[12].p.k||1!==r[12].p.v||r[13].p.k||0!==r[13].p.v||r[14].p.k||1!==r[14].p.v)&&(this.feFuncR=this.createFeFunc("feFuncR",i)),(r[17].p.k||0!==r[17].p.v||r[18].p.k||1!==r[18].p.v||r[19].p.k||1!==r[19].p.v||r[20].p.k||0!==r[20].p.v||r[21].p.k||1!==r[21].p.v)&&(this.feFuncG=this.createFeFunc("feFuncG",i)),(r[24].p.k||0!==r[24].p.v||r[25].p.k||1!==r[25].p.v||r[26].p.k||1!==r[26].p.v||r[27].p.k||0!==r[27].p.v||r[28].p.k||1!==r[28].p.v)&&(this.feFuncB=this.createFeFunc("feFuncB",i)),(r[31].p.k||0!==r[31].p.v||r[32].p.k||1!==r[32].p.v||r[33].p.k||1!==r[33].p.v||r[34].p.k||0!==r[34].p.v||r[35].p.k||1!==r[35].p.v)&&(this.feFuncA=this.createFeFunc("feFuncA",i)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(i.setAttribute("color-interpolation-filters","sRGB"),t.appendChild(i),i=createNS("feComponentTransfer")),(r[3].p.k||0!==r[3].p.v||r[4].p.k||1!==r[4].p.v||r[5].p.k||1!==r[5].p.v||r[6].p.k||0!==r[6].p.v||r[7].p.k||1!==r[7].p.v)&&(i.setAttribute("color-interpolation-filters","sRGB"),t.appendChild(i),this.feFuncRComposed=this.createFeFunc("feFuncR",i),this.feFuncGComposed=this.createFeFunc("feFuncG",i),this.feFuncBComposed=this.createFeFunc("feFuncB",i))}function SVGDropShadowEffect(t,e){t.setAttribute("x","-100%"),t.setAttribute("y","-100%"),t.setAttribute("width","400%"),t.setAttribute("height","400%"),this.filterManager=e;var r=createNS("feGaussianBlur");r.setAttribute("in","SourceAlpha"),r.setAttribute("result","drop_shadow_1"),r.setAttribute("stdDeviation","0"),this.feGaussianBlur=r,t.appendChild(r);var i=createNS("feOffset");i.setAttribute("dx","25"),i.setAttribute("dy","0"),i.setAttribute("in","drop_shadow_1"),i.setAttribute("result","drop_shadow_2"),this.feOffset=i,t.appendChild(i);var s=createNS("feFlood");s.setAttribute("flood-color","#00ff00"),s.setAttribute("flood-opacity","1"),s.setAttribute("result","drop_shadow_3"),this.feFlood=s,t.appendChild(s);var a=createNS("feComposite");a.setAttribute("in","drop_shadow_3"),a.setAttribute("in2","drop_shadow_2"),a.setAttribute("operator","in"),a.setAttribute("result","drop_shadow_4"),t.appendChild(a);var n,o=createNS("feMerge");t.appendChild(o),n=createNS("feMergeNode"),o.appendChild(n),(n=createNS("feMergeNode")).setAttribute("in","SourceGraphic"),this.feMergeNode=n,this.feMerge=o,this.originalNodeAdded=!1,o.appendChild(n)}ShapeTransformManager.prototype={addTransformSequence:function(t){var e,r=t.length,i="_";for(e=0;e<r;e+=1)i+=t[e].transform.key+"_";var s=this.sequences[i];return s||(s={transforms:[].concat(t),finalTransform:new Matrix,_mdf:!1},this.sequences[i]=s,this.sequenceList.push(s)),s},processSequence:function(t,e){for(var r,i=0,s=t.transforms.length,a=e;i<s&&!e;){if(t.transforms[i].transform.mProps._mdf){a=!0;break}i+=1}if(a)for(t.finalTransform.reset(),i=s-1;0<=i;i-=1)r=t.transforms[i].transform.mProps.v.props,t.finalTransform.transform(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]);t._mdf=a},processSequences:function(t){var e,r=this.sequenceList.length;for(e=0;e<r;e+=1)this.processSequence(this.sequenceList[e],t)},getNewKey:function(){return"_"+this.transform_key_count++}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var t=0,e=this.data.masksProperties.length;t<e;){if("n"!==this.data.masksProperties[t].mode&&!1!==this.data.masksProperties[t].cl)return!0;t+=1}return!1},initExpressions:function(){this.layerInterface=LayerExpressionInterface(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var t=EffectsExpressionInterface.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(t),0===this.data.ty||this.data.xt?this.compInterface=CompExpressionInterface(this):4===this.data.ty?(this.layerInterface.shapeInterface=ShapeExpressionInterface(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):5===this.data.ty&&(this.layerInterface.textInterface=TextExpressionInterface(this),this.layerInterface.text=this.layerInterface.textInterface)},setBlendMode:function(){var t=getBlendMode(this.data.bm);(this.baseElement||this.layerElement).style["mix-blend-mode"]=t},initBaseData:function(t,e,r){this.globalData=e,this.comp=r,this.data=t,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},NullElement.prototype.prepareFrame=function(t){this.prepareProperties(t,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var t,e,r,i=null;if(this.data.td){if(3==this.data.td||1==this.data.td){var s=createNS("mask");s.setAttribute("id",this.layerId),s.setAttribute("mask-type",3==this.data.td?"luminance":"alpha"),s.appendChild(this.layerElement),i=s,this.globalData.defs.appendChild(s),featureSupport.maskType||1!=this.data.td||(s.setAttribute("mask-type","luminance"),t=createElementID(),e=filtersFactory.createFilter(t),this.globalData.defs.appendChild(e),e.appendChild(filtersFactory.createAlphaToLuminanceFilter()),(r=createNS("g")).appendChild(this.layerElement),i=r,s.appendChild(r),r.setAttribute("filter","url("+locationHref+"#"+t+")"))}else if(2==this.data.td){var a=createNS("mask");a.setAttribute("id",this.layerId),a.setAttribute("mask-type","alpha");var n=createNS("g");a.appendChild(n),t=createElementID(),e=filtersFactory.createFilter(t);var o=createNS("feComponentTransfer");o.setAttribute("in","SourceGraphic"),e.appendChild(o);var h=createNS("feFuncA");h.setAttribute("type","table"),h.setAttribute("tableValues","1.0 0.0"),o.appendChild(h),this.globalData.defs.appendChild(e);var p=createNS("rect");p.setAttribute("width",this.comp.data.w),p.setAttribute("height",this.comp.data.h),p.setAttribute("x","0"),p.setAttribute("y","0"),p.setAttribute("fill","#ffffff"),p.setAttribute("opacity","0"),n.setAttribute("filter","url("+locationHref+"#"+t+")"),n.appendChild(p),n.appendChild(this.layerElement),i=n,featureSupport.maskType||(a.setAttribute("mask-type","luminance"),e.appendChild(filtersFactory.createAlphaToLuminanceFilter()),r=createNS("g"),n.appendChild(p),r.appendChild(this.layerElement),i=r,n.appendChild(r)),this.globalData.defs.appendChild(a)}}else this.data.tt?(this.matteElement.appendChild(this.layerElement),i=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0===this.data.ty&&!this.data.hd){var l=createNS("clipPath"),f=createNS("path");f.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var m=createElementID();if(l.setAttribute("id",m),l.appendChild(f),this.globalData.defs.appendChild(l),this.checkMasks()){var c=createNS("g");c.setAttribute("clip-path","url("+locationHref+"#"+m+")"),c.appendChild(this.layerElement),this.transformedElement=c,i?i.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+locationHref+"#"+m+")")}0!==this.data.bm&&this.setBlendMode()},renderElement:function(){this.finalTransform._matMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.mat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.mProp.o.v)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this)},setMatte:function(t){this.matteElement&&this.matteElement.setAttribute("mask","url("+locationHref+"#"+t+")")}},IShapeElement.prototype={addShapeToModifiers:function(t){var e,r=this.shapeModifiers.length;for(e=0;e<r;e+=1)this.shapeModifiers[e].addShape(t)},isShapeInAnimatedModifiers:function(t){for(var e=this.shapeModifiers.length;0<e;)if(this.shapeModifiers[0].isAnimatedWithShape(t))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var t,e=this.shapes.length;for(t=0;t<e;t+=1)this.shapes[t].sh.reset();for(t=(e=this.shapeModifiers.length)-1;0<=t;t-=1)this.shapeModifiers[t].processShapes(this._isFirstFrame)}},lcEnum:{1:"butt",2:"round",3:"square"},ljEnum:{1:"miter",2:"round",3:"bevel"},searchProcessedElement:function(t){for(var e=this.processedElements,r=0,i=e.length;r<i;){if(e[r].elem===t)return e[r].pos;r+=1}return 0},addProcessedElement:function(t,e){for(var r=this.processedElements,i=r.length;i;)if(r[i-=1].elem===t)return void(r[i].pos=e);r.push(new ProcessedElement(t,e))},prepareFrame:function(t){this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange)}},ITextElement.prototype.initElement=function(t,e,r){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(t,e,r),this.textProperty=new TextProperty(this,t.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(t.t,this.renderType,this),this.initTransform(t,e,r),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(t){this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)},ITextElement.prototype.createPathShape=function(t,e){var r,i,s=e.length,a="";for(r=0;r<s;r+=1)i=e[r].ks.k,a+=buildShapeString(i,i.i.length,!0,t);return a},ITextElement.prototype.updateDocumentData=function(t,e){this.textProperty.updateDocumentData(t,e)},ITextElement.prototype.canResizeFont=function(t){this.textProperty.canResizeFont(t)},ITextElement.prototype.setMinimumFontSize=function(t){this.textProperty.setMinimumFontSize(t)},ITextElement.prototype.applyTextPropertiesToMatrix=function(t,e,r,i,s){switch(t.ps&&e.translate(t.ps[0],t.ps[1]+t.ascent,0),e.translate(0,-t.ls,0),t.j){case 1:e.translate(t.justifyOffset+(t.boxWidth-t.lineWidths[r]),0,0);break;case 2:e.translate(t.justifyOffset+(t.boxWidth-t.lineWidths[r])/2,0,0)}e.translate(i,s,0)},ITextElement.prototype.buildColor=function(t){return"rgb("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(t,e,r){this.initFrame(),this.initBaseData(t,e,r),this.initTransform(t,e,r),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),!this.data.xt&&e.progressiveLoad||this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(t){if(this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),this.isInRange||this.data.xt){if(this.tm._placeholder)this.renderedFrame=t/this.data.sr;else{var e=this.tm.v;e===this.data.op&&(e=this.data.op-1),this.renderedFrame=e}var r,i=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),r=i-1;0<=r;r-=1)(this.completeLayers||this.elements[r])&&(this.elements[r].prepareFrame(this.renderedFrame-this.layers[r].st),this.elements[r]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var t,e=this.layers.length;for(t=0;t<e;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()},ICompElement.prototype.setElements=function(t){this.elements=t},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var t,e=this.layers.length;for(t=0;t<e;t+=1)this.elements[t]&&this.elements[t].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var t=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",t),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var t=createNS("rect");t.setAttribute("width",this.data.sw),t.setAttribute("height",this.data.sh),t.setAttribute("fill",this.data.sc),this.layerElement.appendChild(t)},extendPrototype([SVGRenderer,ICompElement,SVGBaseElement],SVGCompElement),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextElement),SVGTextElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextElement.prototype.buildTextContents=function(t){for(var e=0,r=t.length,i=[],s="";e<r;)t[e]===String.fromCharCode(13)||t[e]===String.fromCharCode(3)?(i.push(s),s=""):s+=t[e],e+=1;return i.push(s),i},SVGTextElement.prototype.buildNewText=function(){var t,e,r=this.textProperty.currentData;this.renderedLetters=createSizedArray(r?r.l.length:0),r.fc?this.layerElement.setAttribute("fill",this.buildColor(r.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),r.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(r.sc)),this.layerElement.setAttribute("stroke-width",r.sw)),this.layerElement.setAttribute("font-size",r.finalSize);var i=this.globalData.fontManager.getFontByName(r.f);if(i.fClass)this.layerElement.setAttribute("class",i.fClass);else{this.layerElement.setAttribute("font-family",i.fFamily);var s=r.fWeight,a=r.fStyle;this.layerElement.setAttribute("font-style",a),this.layerElement.setAttribute("font-weight",s)}this.layerElement.setAttribute("aria-label",r.t);var n,o=r.l||[],h=!!this.globalData.fontManager.chars;e=o.length;var p,l=this.mHelper,f="",m=this.data.singleShape,c=0,d=0,u=!0,y=r.tr/1e3*r.finalSize;if(!m||h||r.sz){var g,v,b=this.textSpans.length;for(t=0;t<e;t+=1)h&&m&&0!==t||(n=t<b?this.textSpans[t]:createNS(h?"path":"text"),b<=t&&(n.setAttribute("stroke-linecap","butt"),n.setAttribute("stroke-linejoin","round"),n.setAttribute("stroke-miterlimit","4"),this.textSpans[t]=n,this.layerElement.appendChild(n)),n.style.display="inherit"),l.reset(),l.scale(r.finalSize/100,r.finalSize/100),m&&(o[t].n&&(c=-y,d+=r.yOffset,d+=u?1:0,u=!1),this.applyTextPropertiesToMatrix(r,l,o[t].line,c,d),c+=o[t].l||0,c+=y),h?(p=(g=(v=this.globalData.fontManager.getCharData(r.finalText[t],i.fStyle,this.globalData.fontManager.getFontByName(r.f).fFamily))&&v.data||{}).shapes?g.shapes[0].it:[],m?f+=this.createPathShape(l,p):n.setAttribute("d",this.createPathShape(l,p))):(m&&n.setAttribute("transform","translate("+l.props[12]+","+l.props[13]+")"),n.textContent=o[t].val,n.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"));m&&n&&n.setAttribute("d",f)}else{var P=this.textContainer,_="start";switch(r.j){case 1:_="end";break;case 2:_="middle"}P.setAttribute("text-anchor",_),P.setAttribute("letter-spacing",y);var A=this.buildTextContents(r.finalText);for(e=A.length,d=r.ps?r.ps[1]+r.ascent:0,t=0;t<e;t+=1)(n=this.textSpans[t]||createNS("tspan")).textContent=A[t],n.setAttribute("x",0),n.setAttribute("y",d),n.style.display="inherit",P.appendChild(n),this.textSpans[t]=n,d+=r.finalLineHeight;this.layerElement.appendChild(P)}for(;t<this.textSpans.length;)this.textSpans[t].style.display="none",t+=1;this._sizeChanged=!0},SVGTextElement.prototype.sourceRectAtTime=function(t){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextElement.prototype.renderInnerContent=function(){if(!this.data.singleShape&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){var t,e;this._sizeChanged=!0;var r,i,s=this.textAnimator.renderedLetters,a=this.textProperty.currentData.l;for(e=a.length,t=0;t<e;t+=1)a[t].n||(r=s[t],i=this.textSpans[t],r._mdf.m&&i.setAttribute("transform",r.m),r._mdf.o&&i.setAttribute("opacity",r.o),r._mdf.sw&&i.setAttribute("stroke-width",r.sw),r._mdf.sc&&i.setAttribute("stroke",r.sc),r._mdf.fc&&i.setAttribute("fill",r.fc))}},extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var t,e,r,i,s=this.shapes.length,a=this.stylesList.length,n=[],o=!1;for(r=0;r<a;r+=1){for(i=this.stylesList[r],o=!1,t=n.length=0;t<s;t+=1)-1!==(e=this.shapes[t]).styles.indexOf(i)&&(n.push(e),o=e._isAnimated||o);1<n.length&&o&&this.setShapesAsAnimated(n)}},SVGShapeElement.prototype.setShapesAsAnimated=function(t){var e,r=t.length;for(e=0;e<r;e+=1)t[e].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(t,e){var r,i=new SVGStyleData(t,e),s=i.pElem;return"st"===t.ty?r=new SVGStrokeStyleData(this,t,i):"fl"===t.ty?r=new SVGFillStyleData(this,t,i):"gf"!==t.ty&&"gs"!==t.ty||(r=new("gf"===t.ty?SVGGradientFillStyleData:SVGGradientStrokeStyleData)(this,t,i),this.globalData.defs.appendChild(r.gf),r.maskId&&(this.globalData.defs.appendChild(r.ms),this.globalData.defs.appendChild(r.of),s.setAttribute("mask","url("+locationHref+"#"+r.maskId+")"))),"st"!==t.ty&&"gs"!==t.ty||(s.setAttribute("stroke-linecap",this.lcEnum[t.lc]||"round"),s.setAttribute("stroke-linejoin",this.ljEnum[t.lj]||"round"),s.setAttribute("fill-opacity","0"),1===t.lj&&s.setAttribute("stroke-miterlimit",t.ml)),2===t.r&&s.setAttribute("fill-rule","evenodd"),t.ln&&s.setAttribute("id",t.ln),t.cl&&s.setAttribute("class",t.cl),t.bm&&(s.style["mix-blend-mode"]=getBlendMode(t.bm)),this.stylesList.push(i),this.addToAnimatedContents(t,r),r},SVGShapeElement.prototype.createGroupElement=function(t){var e=new ShapeGroupData;return t.ln&&e.gr.setAttribute("id",t.ln),t.cl&&e.gr.setAttribute("class",t.cl),t.bm&&(e.gr.style["mix-blend-mode"]=getBlendMode(t.bm)),e},SVGShapeElement.prototype.createTransformElement=function(t,e){var r=TransformPropertyFactory.getTransformProperty(this,t,this),i=new SVGTransformData(r,r.o,e);return this.addToAnimatedContents(t,i),i},SVGShapeElement.prototype.createShapeElement=function(t,e,r){var i=4;"rc"===t.ty?i=5:"el"===t.ty?i=6:"sr"===t.ty&&(i=7);var s=new SVGShapeData(e,r,ShapePropertyFactory.getShapeProp(this,t,i,this));return this.shapes.push(s),this.addShapeToModifiers(s),this.addToAnimatedContents(t,s),s},SVGShapeElement.prototype.addToAnimatedContents=function(t,e){for(var r=0,i=this.animatedContents.length;r<i;){if(this.animatedContents[r].element===e)return;r+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(t),element:e,data:t})},SVGShapeElement.prototype.setElementStyles=function(t){var e,r=t.styles,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].closed||r.push(this.stylesList[e])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var t,e=this.itemsData.length;for(t=0;t<e;t+=1)this.prevViewData[t]=this.itemsData[t];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),e=this.dynamicProperties.length,t=0;t<e;t+=1)this.dynamicProperties[t].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(t,e,r,i,s,a,n){var o,h,p,l,f,m,c=[].concat(a),d=t.length-1,u=[],y=[];for(o=d;0<=o;o-=1){if((m=this.searchProcessedElement(t[o]))?e[o]=r[m-1]:t[o]._render=n,"fl"==t[o].ty||"st"==t[o].ty||"gf"==t[o].ty||"gs"==t[o].ty)m?e[o].style.closed=!1:e[o]=this.createStyleElement(t[o],s),t[o]._render&&i.appendChild(e[o].style.pElem),u.push(e[o].style);else if("gr"==t[o].ty){if(m)for(p=e[o].it.length,h=0;h<p;h+=1)e[o].prevViewData[h]=e[o].it[h];else e[o]=this.createGroupElement(t[o]);this.searchShapes(t[o].it,e[o].it,e[o].prevViewData,e[o].gr,s+1,c,n),t[o]._render&&i.appendChild(e[o].gr)}else"tr"==t[o].ty?(m||(e[o]=this.createTransformElement(t[o],i)),l=e[o].transform,c.push(l)):"sh"==t[o].ty||"rc"==t[o].ty||"el"==t[o].ty||"sr"==t[o].ty?(m||(e[o]=this.createShapeElement(t[o],c,s)),this.setElementStyles(e[o])):"tm"==t[o].ty||"rd"==t[o].ty||"ms"==t[o].ty?(m?(f=e[o]).closed=!1:((f=ShapeModifiers.getModifier(t[o].ty)).init(this,t[o]),e[o]=f,this.shapeModifiers.push(f)),y.push(f)):"rp"==t[o].ty&&(m?(f=e[o]).closed=!0:(f=ShapeModifiers.getModifier(t[o].ty),(e[o]=f).init(this,t,o,e),this.shapeModifiers.push(f),n=!1),y.push(f));this.addProcessedElement(t[o],o+1)}for(d=u.length,o=0;o<d;o+=1)u[o].closed=!0;for(d=y.length,o=0;o<d;o+=1)y[o].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var t,e=this.stylesList.length;for(t=0;t<e;t+=1)this.stylesList[t].reset();for(this.renderShape(),t=0;t<e;t+=1)(this.stylesList[t]._mdf||this._isFirstFrame)&&(this.stylesList[t].msElem&&(this.stylesList[t].msElem.setAttribute("d",this.stylesList[t].d),this.stylesList[t].d="M0 0"+this.stylesList[t].d),this.stylesList[t].pElem.setAttribute("d",this.stylesList[t].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var t,e,r=this.animatedContents.length;for(t=0;t<r;t+=1)e=this.animatedContents[t],(this._isFirstFrame||e.element._isAnimated)&&!0!==e.data&&e.fn(e.data,e.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},SVGTintFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,r=this.filterManager.effectElements[1].p.v,i=this.filterManager.effectElements[2].p.v/100;this.matrixFilter.setAttribute("values",r[0]-e[0]+" 0 0 0 "+e[0]+" "+(r[1]-e[1])+" 0 0 0 "+e[1]+" "+(r[2]-e[2])+" 0 0 0 "+e[2]+" 0 0 0 "+i+" 0")}},SVGFillFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=this.filterManager.effectElements[2].p.v,r=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+e[0]+" 0 0 0 0 "+e[1]+" 0 0 0 0 "+e[2]+" 0 0 0 "+r+" 0")}},SVGGaussianBlurEffect.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=.3*this.filterManager.effectElements[0].p.v,r=this.filterManager.effectElements[1].p.v,i=3==r?0:e,s=2==r?0:e;this.feGaussianBlur.setAttribute("stdDeviation",i+" "+s);var a=1==this.filterManager.effectElements[2].p.v?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",a)}},SVGStrokeEffect.prototype.initialize=function(){var t,e,r,i,s=this.elem.layerElement.children||this.elem.layerElement.childNodes;for(1===this.filterManager.effectElements[1].p.v?(i=this.elem.maskManager.masksProperties.length,r=0):i=1+(r=this.filterManager.effectElements[0].p.v-1),(e=createNS("g")).setAttribute("fill","none"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-dashoffset",1);r<i;r+=1)t=createNS("path"),e.appendChild(t),this.paths.push({p:t,m:r});if(3===this.filterManager.effectElements[10].p.v){var a=createNS("mask"),n=createElementID();a.setAttribute("id",n),a.setAttribute("mask-type","alpha"),a.appendChild(e),this.elem.globalData.defs.appendChild(a);var o=createNS("g");for(o.setAttribute("mask","url("+locationHref+"#"+n+")");s[0];)o.appendChild(s[0]);this.elem.layerElement.appendChild(o),this.masker=a,e.setAttribute("stroke","#fff")}else if(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v){if(2===this.filterManager.effectElements[10].p.v)for(s=this.elem.layerElement.children||this.elem.layerElement.childNodes;s.length;)this.elem.layerElement.removeChild(s[0]);this.elem.layerElement.appendChild(e),this.elem.layerElement.removeAttribute("mask"),e.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=e},SVGStrokeEffect.prototype.renderFrame=function(t){this.initialized||this.initialize();var e,r,i,s=this.paths.length;for(e=0;e<s;e+=1)if(-1!==this.paths[e].m&&(r=this.elem.maskManager.viewData[this.paths[e].m],i=this.paths[e].p,(t||this.filterManager._mdf||r.prop._mdf)&&i.setAttribute("d",r.lastPath),t||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||r.prop._mdf)){var a;if(0!==this.filterManager.effectElements[7].p.v||100!==this.filterManager.effectElements[8].p.v){var n=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)/100,o=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)/100,h=i.getTotalLength();a="0 0 0 "+h*n+" ";var p,l=h*(o-n),f=1+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v/100,m=Math.floor(l/f);for(p=0;p<m;p+=1)a+="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v/100+" ";a+="0 "+10*h+" 0 0"}else a="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v/100;i.setAttribute("stroke-dasharray",a)}if((t||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",2*this.filterManager.effectElements[4].p.v),(t||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v)&&(t||this.filterManager.effectElements[3].p._mdf)){var c=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bm_floor(255*c[0])+","+bm_floor(255*c[1])+","+bm_floor(255*c[2])+")")}},SVGTritoneFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,r=this.filterManager.effectElements[1].p.v,i=this.filterManager.effectElements[2].p.v,s=i[0]+" "+r[0]+" "+e[0],a=i[1]+" "+r[1]+" "+e[1],n=i[2]+" "+r[2]+" "+e[2];this.feFuncR.setAttribute("tableValues",s),this.feFuncG.setAttribute("tableValues",a),this.feFuncB.setAttribute("tableValues",n)}},SVGProLevelsFilter.prototype.createFeFunc=function(t,e){var r=createNS(t);return r.setAttribute("type","table"),e.appendChild(r),r},SVGProLevelsFilter.prototype.getTableValue=function(t,e,r,i,s){for(var a,n,o=0,h=Math.min(t,e),p=Math.max(t,e),l=Array.call(null,{length:256}),f=0,m=s-i,c=e-t;o<=256;)n=(a=o/256)<=h?c<0?s:i:p<=a?c<0?i:s:i+m*Math.pow((a-t)/c,1/r),l[f++]=n,o+=256/255;return l.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){var e,r=this.filterManager.effectElements;this.feFuncRComposed&&(t||r[3].p._mdf||r[4].p._mdf||r[5].p._mdf||r[6].p._mdf||r[7].p._mdf)&&(e=this.getTableValue(r[3].p.v,r[4].p.v,r[5].p.v,r[6].p.v,r[7].p.v),this.feFuncRComposed.setAttribute("tableValues",e),this.feFuncGComposed.setAttribute("tableValues",e),this.feFuncBComposed.setAttribute("tableValues",e)),this.feFuncR&&(t||r[10].p._mdf||r[11].p._mdf||r[12].p._mdf||r[13].p._mdf||r[14].p._mdf)&&(e=this.getTableValue(r[10].p.v,r[11].p.v,r[12].p.v,r[13].p.v,r[14].p.v),this.feFuncR.setAttribute("tableValues",e)),this.feFuncG&&(t||r[17].p._mdf||r[18].p._mdf||r[19].p._mdf||r[20].p._mdf||r[21].p._mdf)&&(e=this.getTableValue(r[17].p.v,r[18].p.v,r[19].p.v,r[20].p.v,r[21].p.v),this.feFuncG.setAttribute("tableValues",e)),this.feFuncB&&(t||r[24].p._mdf||r[25].p._mdf||r[26].p._mdf||r[27].p._mdf||r[28].p._mdf)&&(e=this.getTableValue(r[24].p.v,r[25].p.v,r[26].p.v,r[27].p.v,r[28].p.v),this.feFuncB.setAttribute("tableValues",e)),this.feFuncA&&(t||r[31].p._mdf||r[32].p._mdf||r[33].p._mdf||r[34].p._mdf||r[35].p._mdf)&&(e=this.getTableValue(r[31].p.v,r[32].p.v,r[33].p.v,r[34].p.v,r[35].p.v),this.feFuncA.setAttribute("tableValues",e))}},SVGDropShadowEffect.prototype.renderFrame=function(t){if(t||this.filterManager._mdf){if((t||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),t||this.filterManager.effectElements[0].p._mdf){var e=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(255*e[0]),Math.round(255*e[1]),Math.round(255*e[2])))}if((t||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),t||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var r=this.filterManager.effectElements[3].p.v,i=(this.filterManager.effectElements[2].p.v-90)*degToRads,s=r*Math.cos(i),a=r*Math.sin(i);this.feOffset.setAttribute("dx",s),this.feOffset.setAttribute("dy",a)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(t,e,r){this.initialized=!1,this.filterManager=e,this.filterElem=t,(this.elem=r).matteElement=createNS("g"),r.matteElement.appendChild(r.layerElement),r.matteElement.appendChild(r.transformedElement),r.baseElement=r.matteElement}function SVGEffects(t){var e,r,i=t.data.ef?t.data.ef.length:0,s=createElementID(),a=filtersFactory.createFilter(s),n=0;for(this.filters=[],e=0;e<i;e+=1)r=null,20===t.data.ef[e].ty?(n+=1,r=new SVGTintFilter(a,t.effectsManager.effectElements[e])):21===t.data.ef[e].ty?(n+=1,r=new SVGFillFilter(a,t.effectsManager.effectElements[e])):22===t.data.ef[e].ty?r=new SVGStrokeEffect(t,t.effectsManager.effectElements[e]):23===t.data.ef[e].ty?(n+=1,r=new SVGTritoneFilter(a,t.effectsManager.effectElements[e])):24===t.data.ef[e].ty?(n+=1,r=new SVGProLevelsFilter(a,t.effectsManager.effectElements[e])):25===t.data.ef[e].ty?(n+=1,r=new SVGDropShadowEffect(a,t.effectsManager.effectElements[e])):28===t.data.ef[e].ty?r=new SVGMatte3Effect(a,t.effectsManager.effectElements[e],t):29===t.data.ef[e].ty&&(n+=1,r=new SVGGaussianBlurEffect(a,t.effectsManager.effectElements[e])),r&&this.filters.push(r);n&&(t.globalData.defs.appendChild(a),t.layerElement.setAttribute("filter","url("+locationHref+"#"+s+")")),this.filters.length&&t.addRenderableComponent(this)}SVGMatte3Effect.prototype.findSymbol=function(t){for(var e=0,r=_svgMatteSymbols.length;e<r;){if(_svgMatteSymbols[e]===t)return _svgMatteSymbols[e];e+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(t,e){var r=t.layerElement.parentNode;if(r){for(var i,s=r.children,a=0,n=s.length;a<n&&s[a]!==t.layerElement;)a+=1;a<=n-2&&(i=s[a+1]);var o=createNS("use");o.setAttribute("href","#"+e),i?r.insertBefore(o,i):r.appendChild(o)}},SVGMatte3Effect.prototype.setElementAsMask=function(t,e){if(!this.findSymbol(e)){var r=createElementID(),i=createNS("mask");i.setAttribute("id",e.layerId),i.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(e);var s=t.globalData.defs;s.appendChild(i);var a=createNS("symbol");a.setAttribute("id",r),this.replaceInParent(e,r),a.appendChild(e.layerElement),s.appendChild(a);var n=createNS("use");n.setAttribute("href","#"+r),i.appendChild(n),e.data.hd=!1,e.show()}t.setMatte(e.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var t=this.filterManager.effectElements[0].p.v,e=this.elem.comp.elements,r=0,i=e.length;r<i;)e[r]&&e[r].data.ind===t&&this.setElementAsMask(this.elem,e[r]),r+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()},SVGEffects.prototype.renderFrame=function(t){var e,r=this.filters.length;for(e=0;e<r;e+=1)this.filters[e].renderFrame(t)};var animationManager=function(){var t={},s=[],i=0,a=0,n=0,o=!0,h=!1;function r(t){for(var e=0,r=t.target;e<a;)s[e].animation===r&&(s.splice(e,1),e-=1,a-=1,r.isPaused||f()),e+=1}function p(t,e){if(!t)return null;for(var r=0;r<a;){if(s[r].elem==t&&null!==s[r].elem)return s[r].animation;r+=1}var i=new AnimationItem;return m(i,t),i.setData(t,e),i}function l(){n+=1,d()}function f(){n-=1}function m(t,e){t.addEventListener("destroy",r),t.addEventListener("_active",l),t.addEventListener("_idle",f),s.push({elem:e,animation:t}),a+=1}function c(t){var e,r=t-i;for(e=0;e<a;e+=1)s[e].animation.advanceTime(r);i=t,n&&!h?window.requestAnimationFrame(c):o=!0}function e(t){i=t,window.requestAnimationFrame(c)}function d(){!h&&n&&o&&(window.requestAnimationFrame(e),o=!1)}return t.registerAnimation=p,t.loadAnimation=function(t){var e=new AnimationItem;return m(e,null),e.setParams(t),e},t.setSpeed=function(t,e){var r;for(r=0;r<a;r+=1)s[r].animation.setSpeed(t,e)},t.setDirection=function(t,e){var r;for(r=0;r<a;r+=1)s[r].animation.setDirection(t,e)},t.play=function(t){var e;for(e=0;e<a;e+=1)s[e].animation.play(t)},t.pause=function(t){var e;for(e=0;e<a;e+=1)s[e].animation.pause(t)},t.stop=function(t){var e;for(e=0;e<a;e+=1)s[e].animation.stop(t)},t.togglePause=function(t){var e;for(e=0;e<a;e+=1)s[e].animation.togglePause(t)},t.searchAnimations=function(t,e,r){var i,s=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),a=s.length;for(i=0;i<a;i+=1)r&&s[i].setAttribute("data-bm-type",r),p(s[i],t);if(e&&0===a){r||(r="svg");var n=document.getElementsByTagName("body")[0];n.innerHTML="";var o=createTag("div");o.style.width="100%",o.style.height="100%",o.setAttribute("data-bm-type",r),n.appendChild(o),p(o,t)}},t.resize=function(){var t;for(t=0;t<a;t+=1)s[t].animation.resize()},t.goToAndStop=function(t,e,r){var i;for(i=0;i<a;i+=1)s[i].animation.goToAndStop(t,e,r)},t.destroy=function(t){var e;for(e=a-1;0<=e;e-=1)s[e].animation.destroy(t)},t.freeze=function(){h=!0},t.unfreeze=function(){h=!1,d()},t.getRegisteredAnimations=function(){var t,e=s.length,r=[];for(t=0;t<e;t+=1)r.push(s[t].animation);return r},t}(),AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.subframeEnabled=subframeEnabled,this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(t){t.context&&(this.context=t.context),(t.wrapper||t.container)&&(this.wrapper=t.wrapper||t.container);var e=t.animType?t.animType:t.renderer?t.renderer:"svg";switch(e){case"canvas":this.renderer=new CanvasRenderer(this,t.rendererSettings);break;case"svg":this.renderer=new SVGRenderer(this,t.rendererSettings);break;default:this.renderer=new HybridRenderer(this,t.rendererSettings)}this.renderer.setProjectInterface(this.projectInterface),this.animType=e,""===t.loop||null===t.loop||(!1===t.loop?this.loop=!1:!0===t.loop?this.loop=!0:this.loop=parseInt(t.loop)),this.autoplay=!("autoplay"in t)||t.autoplay,this.name=t.name?t.name:"",this.autoloadSegments=!t.hasOwnProperty("autoloadSegments")||t.autoloadSegments,this.assetsPath=t.assetsPath,t.animationData?this.configAnimation(t.animationData):t.path&&(-1!==t.path.lastIndexOf("\\")?this.path=t.path.substr(0,t.path.lastIndexOf("\\")+1):this.path=t.path.substr(0,t.path.lastIndexOf("/")+1),this.fileName=t.path.substr(t.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),assetLoader.load(t.path,this.configAnimation.bind(this),function(){this.trigger("data_failed")}.bind(this)))},AnimationItem.prototype.setData=function(t,e){var r={wrapper:t,animationData:e?"object"==typeof e?e:JSON.parse(e):null},i=t.attributes;r.path=i.getNamedItem("data-animation-path")?i.getNamedItem("data-animation-path").value:i.getNamedItem("data-bm-path")?i.getNamedItem("data-bm-path").value:i.getNamedItem("bm-path")?i.getNamedItem("bm-path").value:"",r.animType=i.getNamedItem("data-anim-type")?i.getNamedItem("data-anim-type").value:i.getNamedItem("data-bm-type")?i.getNamedItem("data-bm-type").value:i.getNamedItem("bm-type")?i.getNamedItem("bm-type").value:i.getNamedItem("data-bm-renderer")?i.getNamedItem("data-bm-renderer").value:i.getNamedItem("bm-renderer")?i.getNamedItem("bm-renderer").value:"canvas";var s=i.getNamedItem("data-anim-loop")?i.getNamedItem("data-anim-loop").value:i.getNamedItem("data-bm-loop")?i.getNamedItem("data-bm-loop").value:i.getNamedItem("bm-loop")?i.getNamedItem("bm-loop").value:"";""===s||(r.loop="false"!==s&&("true"===s||parseInt(s)));var a=i.getNamedItem("data-anim-autoplay")?i.getNamedItem("data-anim-autoplay").value:i.getNamedItem("data-bm-autoplay")?i.getNamedItem("data-bm-autoplay").value:!i.getNamedItem("bm-autoplay")||i.getNamedItem("bm-autoplay").value;r.autoplay="false"!==a,r.name=i.getNamedItem("data-name")?i.getNamedItem("data-name").value:i.getNamedItem("data-bm-name")?i.getNamedItem("data-bm-name").value:i.getNamedItem("bm-name")?i.getNamedItem("bm-name").value:"","false"===(i.getNamedItem("data-anim-prerender")?i.getNamedItem("data-anim-prerender").value:i.getNamedItem("data-bm-prerender")?i.getNamedItem("data-bm-prerender").value:i.getNamedItem("bm-prerender")?i.getNamedItem("bm-prerender").value:"")&&(r.prerender=!1),this.setParams(r)},AnimationItem.prototype.includeLayers=function(t){t.op>this.animationData.op&&(this.animationData.op=t.op,this.totalFrames=Math.floor(t.op-this.animationData.ip));var e,r,i=this.animationData.layers,s=i.length,a=t.layers,n=a.length;for(r=0;r<n;r+=1)for(e=0;e<s;){if(i[e].id==a[r].id){i[e]=a[r];break}e+=1}if((t.chars||t.fonts)&&(this.renderer.globalData.fontManager.addChars(t.chars),this.renderer.globalData.fontManager.addFonts(t.fonts,this.renderer.globalData.defs)),t.assets)for(s=t.assets.length,e=0;e<s;e+=1)this.animationData.assets.push(t.assets[e]);this.animationData.__complete=!1,dataManager.completeData(this.animationData,this.renderer.globalData.fontManager),this.renderer.includeLayers(t.layers),expressionsPlugin&&expressionsPlugin.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var t=this.animationData.segments;if(!t||0===t.length||!this.autoloadSegments)return this.trigger("data_ready"),void(this.timeCompleted=this.totalFrames);var e=t.shift();this.timeCompleted=e.time*this.frameRate;var r=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,assetLoader.load(r,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){this.animationData.segments||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(t){if(this.renderer)try{this.animationData=t,this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.renderer.configAnimation(t),t.assets||(t.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.firstFrame=Math.round(this.animationData.ip),this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(t.assets),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded()}catch(t){this.triggerConfigError(t)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.loaded()?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){this.isLoaded||!this.renderer.globalData.fontManager.loaded()||!this.imagePreloader.loaded()&&"canvas"===this.renderer.rendererType||(this.isLoaded=!0,dataManager.completeData(this.animationData,this.renderer.globalData.fontManager),expressionsPlugin&&expressionsPlugin.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play())},AnimationItem.prototype.resize=function(){this.renderer.updateContainerSize()},AnimationItem.prototype.setSubframe=function(t){this.subframeEnabled=!!t},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.subframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame()},AnimationItem.prototype.renderFrame=function(){if(!1!==this.isLoaded)try{this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(t){this.triggerRenderFrameError(t)}},AnimationItem.prototype.play=function(t){t&&this.name!=t||!0===this.isPaused&&(this.isPaused=!1,this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(t){t&&this.name!=t||!1===this.isPaused&&(this.isPaused=!0,this._idle=!0,this.trigger("_idle"))},AnimationItem.prototype.togglePause=function(t){t&&this.name!=t||(!0===this.isPaused?this.play():this.pause())},AnimationItem.prototype.stop=function(t){t&&this.name!=t||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.goToAndStop=function(t,e,r){r&&this.name!=r||(e?this.setCurrentRawFrameValue(t):this.setCurrentRawFrameValue(t*this.frameModifier),this.pause())},AnimationItem.prototype.goToAndPlay=function(t,e,r){this.goToAndStop(t,e,r),this.play()},AnimationItem.prototype.advanceTime=function(t){if(!0!==this.isPaused&&!1!==this.isLoaded){var e=this.currentRawFrame+t*this.frameModifier,r=!1;e>=this.totalFrames-1&&0<this.frameModifier?this.loop&&this.playCount!==this.loop?e>=this.totalFrames?(this.playCount+=1,this.checkSegments(e%this.totalFrames)||(this.setCurrentRawFrameValue(e%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(e):this.checkSegments(e>this.totalFrames?e%this.totalFrames:0)||(r=!0,e=this.totalFrames-1):e<0?this.checkSegments(e%this.totalFrames)||(!this.loop||this.playCount--<=0&&!0!==this.loop?(r=!0,e=0):(this.setCurrentRawFrameValue(this.totalFrames+e%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0)):this.setCurrentRawFrameValue(e),r&&(this.setCurrentRawFrameValue(e),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(t,e){this.playCount=0,t[1]<t[0]?(0<this.frameModifier&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.timeCompleted=this.totalFrames=t[0]-t[1],this.firstFrame=t[1],this.setCurrentRawFrameValue(this.totalFrames-.001-e)):t[1]>t[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.timeCompleted=this.totalFrames=t[1]-t[0],this.firstFrame=t[0],this.setCurrentRawFrameValue(.001+e)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(t,e){var r=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<t?r=t:this.currentRawFrame+this.firstFrame>e&&(r=e-t)),this.firstFrame=t,this.timeCompleted=this.totalFrames=e-t,-1!==r&&this.goToAndStop(r,!0)},AnimationItem.prototype.playSegments=function(t,e){if(e&&(this.segments.length=0),"object"==typeof t[0]){var r,i=t.length;for(r=0;r<i;r+=1)this.segments.push(t[r])}else this.segments.push(t);this.segments.length&&e&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(t){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),t&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(t){return!!this.segments.length&&(this.adjustSegment(this.segments.shift(),t),!0)},AnimationItem.prototype.destroy=function(t){t&&this.name!=t||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=this.onLoopComplete=this.onComplete=this.onSegmentStart=this.onDestroy=null,this.renderer=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(t){this.currentRawFrame=t,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(t){this.playSpeed=t,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(t){this.playDirection=t<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(t){var e="";if(t.e)e=t.p;else if(this.assetsPath){var r=t.p;-1!==r.indexOf("images/")&&(r=r.split("/")[1]),e=this.assetsPath+r}else e=this.path,e+=t.u?t.u:"",e+=t.p;return e},AnimationItem.prototype.getAssetData=function(t){for(var e=0,r=this.assets.length;e<r;){if(t==this.assets[e].id)return this.assets[e];e+=1}},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(t){return t?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.trigger=function(t){if(this._cbs&&this._cbs[t])switch(t){case"enterFrame":this.triggerEvent(t,new BMEnterFrameEvent(t,this.currentFrame,this.totalFrames,this.frameModifier));break;case"loopComplete":this.triggerEvent(t,new BMCompleteLoopEvent(t,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(t,new BMCompleteEvent(t,this.frameMult));break;case"segmentStart":this.triggerEvent(t,new BMSegmentStartEvent(t,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(t,new BMDestroyEvent(t,this));break;default:this.triggerEvent(t)}"enterFrame"===t&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(t,this.currentFrame,this.totalFrames,this.frameMult)),"loopComplete"===t&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(t,this.loop,this.playCount,this.frameMult)),"complete"===t&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(t,this.frameMult)),"segmentStart"===t&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(t,this.firstFrame,this.totalFrames)),"destroy"===t&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(t,this))},AnimationItem.prototype.triggerRenderFrameError=function(t){var e=new BMRenderFrameErrorEvent(t,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)},AnimationItem.prototype.triggerConfigError=function(t){var e=new BMConfigErrorEvent(t,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)};var Expressions=(KO={},KO.initExpressions=function(t){var e=0,r=[];t.renderer.compInterface=CompExpressionInterface(t.renderer),t.renderer.globalData.projectInterface.registerComposition(t.renderer),t.renderer.globalData.pushExpression=function(){e+=1},t.renderer.globalData.popExpression=function(){0==(e-=1)&&function i(){var t,e=r.length;for(t=0;t<e;t+=1)r[t].release();r.length=0}()},t.renderer.globalData.registerExpressionProperty=function(t){-1===r.indexOf(t)&&r.push(t)}},KO),KO;expressionsPlugin=Expressions;var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null;function $bm_isInstanceOfArray(t){return t.constructor===Array||t.constructor===Float32Array}function isNumerable(t,e){return"number"===t||"boolean"===t||"string"===t||e instanceof Number}function $bm_neg(t){var e=typeof t;if("number"===e||"boolean"===e||t instanceof Number)return-t;if($bm_isInstanceOfArray(t)){var r,i=t.length,s=[];for(r=0;r<i;r+=1)s[r]=-t[r];return s}return t.propType?t.v:void 0}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(t,e){var r=typeof t,i=typeof e;if("string"===r||"string"===i)return t+e;if(isNumerable(r,t)&&isNumerable(i,e))return t+e;if($bm_isInstanceOfArray(t)&&isNumerable(i,e))return(t=t.slice(0))[0]=t[0]+e,t;if(isNumerable(r,t)&&$bm_isInstanceOfArray(e))return(e=e.slice(0))[0]=t+e[0],e;if($bm_isInstanceOfArray(t)&&$bm_isInstanceOfArray(e)){for(var s=0,a=t.length,n=e.length,o=[];s<a||s<n;)("number"==typeof t[s]||t[s]instanceof Number)&&("number"==typeof e[s]||e[s]instanceof Number)?o[s]=t[s]+e[s]:o[s]=void 0===e[s]?t[s]:t[s]||e[s],s+=1;return o}return 0}var add=sum;function sub(t,e){var r=typeof t,i=typeof e;if(isNumerable(r,t)&&isNumerable(i,e))return"string"===r&&(t=parseInt(t)),"string"===i&&(e=parseInt(e)),t-e;if($bm_isInstanceOfArray(t)&&isNumerable(i,e))return(t=t.slice(0))[0]=t[0]-e,t;if(isNumerable(r,t)&&$bm_isInstanceOfArray(e))return(e=e.slice(0))[0]=t-e[0],e;if($bm_isInstanceOfArray(t)&&$bm_isInstanceOfArray(e)){for(var s=0,a=t.length,n=e.length,o=[];s<a||s<n;)("number"==typeof t[s]||t[s]instanceof Number)&&("number"==typeof e[s]||e[s]instanceof Number)?o[s]=t[s]-e[s]:o[s]=void 0===e[s]?t[s]:t[s]||e[s],s+=1;return o}return 0}function mul(t,e){var r,i,s,a=typeof t,n=typeof e;if(isNumerable(a,t)&&isNumerable(n,e))return t*e;if($bm_isInstanceOfArray(t)&&isNumerable(n,e)){for(s=t.length,r=createTypedArray("float32",s),i=0;i<s;i+=1)r[i]=t[i]*e;return r}if(isNumerable(a,t)&&$bm_isInstanceOfArray(e)){for(s=e.length,r=createTypedArray("float32",s),i=0;i<s;i+=1)r[i]=t*e[i];return r}return 0}function div(t,e){var r,i,s,a=typeof t,n=typeof e;if(isNumerable(a,t)&&isNumerable(n,e))return t/e;if($bm_isInstanceOfArray(t)&&isNumerable(n,e)){for(s=t.length,r=createTypedArray("float32",s),i=0;i<s;i+=1)r[i]=t[i]/e;return r}if(isNumerable(a,t)&&$bm_isInstanceOfArray(e)){for(s=e.length,r=createTypedArray("float32",s),i=0;i<s;i+=1)r[i]=t/e[i];return r}return 0}function mod(t,e){return"string"==typeof t&&(t=parseInt(t)),"string"==typeof e&&(e=parseInt(e)),t%e}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(t,e,r){if(r<e){var i=r;r=e,e=i}return Math.min(Math.max(t,e),r)}function radiansToDegrees(t){return t/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(t){return t*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(t,e){if("number"==typeof t||t instanceof Number)return e=e||0,Math.abs(t-e);e||(e=helperLengthArray);var r,i=Math.min(t.length,e.length),s=0;for(r=0;r<i;r+=1)s+=Math.pow(e[r]-t[r],2);return Math.sqrt(s)}function normalize(t){return div(t,length(t))}function rgbToHsl(t){var e,r,i=t[0],s=t[1],a=t[2],n=Math.max(i,s,a),o=Math.min(i,s,a),h=(n+o)/2;if(n==o)e=r=0;else{var p=n-o;switch(r=.5<h?p/(2-n-o):p/(n+o),n){case i:e=(s-a)/p+(s<a?6:0);break;case s:e=(a-i)/p+2;break;case a:e=(i-s)/p+4}e/=6}return[e,r,h,t[3]]}function hue2rgb(t,e,r){return r<0&&(r+=1),1<r&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function hslToRgb(t){var e,r,i,s=t[0],a=t[1],n=t[2];if(0===a)e=r=i=n;else{var o=n<.5?n*(1+a):n+a-n*a,h=2*n-o;e=hue2rgb(h,o,s+1/3),r=hue2rgb(h,o,s),i=hue2rgb(h,o,s-1/3)}return[e,r,i,t[3]]}function linear(t,e,r,i,s){if(void 0!==i&&void 0!==s||(i=e,s=r,e=0,r=1),r<e){var a=r;r=e,e=a}if(t<=e)return i;if(r<=t)return s;var n=r===e?0:(t-e)/(r-e);if(!i.length)return i+(s-i)*n;var o,h=i.length,p=createTypedArray("float32",h);for(o=0;o<h;o+=1)p[o]=i[o]+(s[o]-i[o])*n;return p}function random(t,e){if(void 0===e&&(void 0===t?(t=0,e=1):(e=t,t=void 0)),e.length){var r,i=e.length;t||(t=createTypedArray("float32",i));var s=createTypedArray("float32",i),a=BMMath.random();for(r=0;r<i;r+=1)s[r]=t[r]+a*(e[r]-t[r]);return s}return void 0===t&&(t=0),t+BMMath.random()*(e-t)}function createPath(t,e,r,i){var s,a=t.length,n=shape_pool.newElement();n.setPathData(!!i,a);var o,h,p=[0,0];for(s=0;s<a;s+=1)o=e&&e[s]?e[s]:p,h=r&&r[s]?r[s]:p,n.setTripleAt(t[s][0],t[s][1],h[0]+t[s][0],h[1]+t[s][1],o[0]+t[s][0],o[1]+t[s][1],s,!0);return n}function initiateExpression(elem,data,property){var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=-1!==val.indexOf("random"),elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,__expression_functions=[],scoped_bm_rt;if(data.xf){var i,len=data.xf.length;for(i=0;i<len;i+=1)__expression_functions[i]=eval("(function(){ return "+data.xf[i]+"}())")}var expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||!0!==this.data.hd,wiggle=function(t,e){var r,i,s=this.pv.length?this.pv.length:1,a=createTypedArray("float32",s),n=Math.floor(5*time);for(i=r=0;r<n;){for(i=0;i<s;i+=1)a[i]+=-e+2*e*BMMath.random();r+=1}var o=5*time,h=o-Math.floor(o),p=createTypedArray("float32",s);if(1<s){for(i=0;i<s;i+=1)p[i]=this.pv[i]+a[i]+(-e+2*e*BMMath.random())*h;return p}return this.pv+a[0]+(-e+2*e*BMMath.random())*h}.bind(this);function loopInDuration(t,e){return loopIn(t,e,!0)}function loopOutDuration(t,e){return loopOut(t,e,!0)}thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty)),this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface),time,velocity,value,text,textIndex,textTotal,selectorValue;function lookAt(t,e){var r=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],i=Math.atan2(r[0],Math.sqrt(r[1]*r[1]+r[2]*r[2]))/degToRads;return[-Math.atan2(r[1],r[2])/degToRads,i,0]}function easeOut(t,e,r,i,s){return applyEase(easeOutBez,t,e,r,i,s)}function easeIn(t,e,r,i,s){return applyEase(easeInBez,t,e,r,i,s)}function ease(t,e,r,i,s){return applyEase(easeInOutBez,t,e,r,i,s)}function applyEase(t,e,r,i,s,a){void 0===s?(s=r,a=i):e=(e-r)/(i-r);var n=t(e=1<e?1:e<0?0:e);if($bm_isInstanceOfArray(s)){var o,h=s.length,p=createTypedArray("float32",h);for(o=0;o<h;o+=1)p[o]=(a[o]-s[o])*n+s[o];return p}return(a-s)*n+s}function nearestKey(t){var e,r,i,s=data.k.length;if(data.k.length&&"number"!=typeof data.k[0])if(r=-1,(t*=elem.comp.globalData.frameRate)<data.k[0].t)r=1,i=data.k[0].t;else{for(e=0;e<s-1;e+=1){if(t===data.k[e].t){r=e+1,i=data.k[e].t;break}if(t>data.k[e].t&&t<data.k[e+1].t){i=t-data.k[e].t>data.k[e+1].t-t?(r=e+2,data.k[e+1].t):(r=e+1,data.k[e].t);break}}-1===r&&(r=e+1,i=data.k[e].t)}else i=r=0;var a={};return a.index=r,a.time=i/elem.comp.globalData.frameRate,a}function key(t){var e,r,i;if(!data.k.length||"number"==typeof data.k[0])throw new Error("The property has no keyframe at index "+t);t-=1,e={time:data.k[t].t/elem.comp.globalData.frameRate,value:[]};var s=data.k[t].hasOwnProperty("s")?data.k[t].s:data.k[t-1].e;for(i=s.length,r=0;r<i;r+=1)e[r]=s[r],e.value[r]=s[r];return e}function framesToTime(t,e){return e||(e=elem.comp.globalData.frameRate),t/e}function timeToFrames(t,e){return t||0===t||(t=time),e||(e=elem.comp.globalData.frameRate),t*e}function seedRandom(t){BMMath.seedrandom(randSeed+t)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(t,e){return"string"==typeof value?void 0===e?value.substring(t):value.substring(t,e):""}function substr(t,e){return"string"==typeof value?void 0===e?value.substr(t):value.substr(t,e):""}function posterizeTime(t){time=0===t?0:Math.floor(time*t)/t,value=valueAtTime(time)}var index=elem.data.ind,hasParent=!(!elem.hierarchy||!elem.hierarchy.length),parent,randSeed=Math.floor(1e6*Math.random()),globalData=elem.globalData;function executeExpression(t){return value=t,_needsRandom&&seedRandom(randSeed),this.frameExpressionId===elem.globalData.frameId&&"textSelector"!==this.propType?value:("textSelector"===this.propType&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),($bm_transform=transform)&&(anchorPoint=transform.anchorPoint)),4!==elemType||content||(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),(hasParent=!(!elem.hierarchy||!elem.hierarchy.length))&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,"shape"===scoped_bm_rt.propType&&(scoped_bm_rt=scoped_bm_rt.v),scoped_bm_rt)}return executeExpression}return ob.initiateExpression=initiateExpression,ob}(),expressionHelpers={searchExpressions:function(t,e,r){e.x&&(r.k=!0,r.x=!0,r.initiateExpression=ExpressionManager.initiateExpression,r.effectsSequence.push(r.initiateExpression(t,e,r).bind(r)))},getSpeedAtTime:function(t){var e=this.getValueAtTime(t),r=this.getValueAtTime(t+-.01),i=0;if(e.length){var s;for(s=0;s<e.length;s+=1)i+=Math.pow(r[s]-e[s],2);i=100*Math.sqrt(i)}else i=0;return i},getVelocityAtTime:function(t){if(void 0!==this.vel)return this.vel;var e,r,i=this.getValueAtTime(t),s=this.getValueAtTime(t+-.001);if(i.length)for(e=createTypedArray("float32",i.length),r=0;r<i.length;r+=1)e[r]=(s[r]-i[r])/-.001;else e=(s-i)/-.001;return e},getValueAtTime:function(t){return t*=this.elem.globalData.frameRate,(t-=this.offsetTime)!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<t?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(t,this._cachingAtTime),this._cachingAtTime.lastFrame=t),this._cachingAtTime.value},getStaticValueAtTime:function(){return this.pv},setGroupProperty:function(t){this.propertyGroup=t}};!function(){function o(t,e,r){if(!this.k||!this.keyframes)return this.pv;t=t?t.toLowerCase():"";var i,s,a,n,o,h=this.comp.renderedFrame,p=this.keyframes,l=p[p.length-1].t;if(h<=l)return this.pv;if(r?s=l-(i=e?Math.abs(l-elem.comp.globalData.frameRate*e):Math.max(0,l-this.elem.data.ip)):((!e||e>p.length-1)&&(e=p.length-1),i=l-(s=p[p.length-1-e].t)),"pingpong"===t){if(Math.floor((h-s)/i)%2!=0)return this.getValueAtTime((i-(h-s)%i+s)/this.comp.globalData.frameRate,0)}else{if("offset"===t){var f=this.getValueAtTime(s/this.comp.globalData.frameRate,0),m=this.getValueAtTime(l/this.comp.globalData.frameRate,0),c=this.getValueAtTime(((h-s)%i+s)/this.comp.globalData.frameRate,0),d=Math.floor((h-s)/i);if(this.pv.length){for(n=(o=new Array(f.length)).length,a=0;a<n;a+=1)o[a]=(m[a]-f[a])*d+c[a];return o}return(m-f)*d+c}if("continue"===t){var u=this.getValueAtTime(l/this.comp.globalData.frameRate,0),y=this.getValueAtTime((l-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(n=(o=new Array(u.length)).length,a=0;a<n;a+=1)o[a]=u[a]+(u[a]-y[a])*((h-l)/this.comp.globalData.frameRate)/5e-4;return o}return u+(h-l)/.001*(u-y)}}return this.getValueAtTime(((h-s)%i+s)/this.comp.globalData.frameRate,0)}function h(t,e,r){if(!this.k)return this.pv;t=t?t.toLowerCase():"";var i,s,a,n,o,h=this.comp.renderedFrame,p=this.keyframes,l=p[0].t;if(l<=h)return this.pv;if(r?s=l+(i=e?Math.abs(elem.comp.globalData.frameRate*e):Math.max(0,this.elem.data.op-l)):((!e||e>p.length-1)&&(e=p.length-1),i=(s=p[e].t)-l),"pingpong"===t){if(Math.floor((l-h)/i)%2==0)return this.getValueAtTime(((l-h)%i+l)/this.comp.globalData.frameRate,0)}else{if("offset"===t){var f=this.getValueAtTime(l/this.comp.globalData.frameRate,0),m=this.getValueAtTime(s/this.comp.globalData.frameRate,0),c=this.getValueAtTime((i-(l-h)%i+l)/this.comp.globalData.frameRate,0),d=Math.floor((l-h)/i)+1;if(this.pv.length){for(n=(o=new Array(f.length)).length,a=0;a<n;a+=1)o[a]=c[a]-(m[a]-f[a])*d;return o}return c-(m-f)*d}if("continue"===t){var u=this.getValueAtTime(l/this.comp.globalData.frameRate,0),y=this.getValueAtTime((l+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(n=(o=new Array(u.length)).length,a=0;a<n;a+=1)o[a]=u[a]+(u[a]-y[a])*(l-h)/.001;return o}return u+(u-y)*(l-h)/.001}}return this.getValueAtTime((i-(l-h)%i+l)/this.comp.globalData.frameRate,0)}function p(t,e){if(!this.k)return this.pv;if(t=.5*(t||.4),(e=Math.floor(e||5))<=1)return this.pv;var r,i,s=this.comp.renderedFrame/this.comp.globalData.frameRate,a=s-t,n=1<e?(s+t-a)/(e-1):1,o=0,h=0;for(r=this.pv.length?createTypedArray("float32",this.pv.length):0;o<e;){if(i=this.getValueAtTime(a+o*n),this.pv.length)for(h=0;h<this.pv.length;h+=1)r[h]+=i[h];else r+=i;o+=1}if(this.pv.length)for(h=0;h<this.pv.length;h+=1)r[h]/=e;else r/=e;return r}var s=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(t,e,r){var i=s(t,e,r);return i.dynamicProperties.length?i.getValueAtTime=function(t){console.warn("Transform at time not supported")}.bind(i):i.getValueAtTime=function(t){}.bind(i),i.setGroupProperty=expressionHelpers.setGroupProperty,i};var l=PropertyFactory.getProp;PropertyFactory.getProp=function(t,e,r,i,s){var a=l(t,e,r,i,s);a.kf?a.getValueAtTime=expressionHelpers.getValueAtTime.bind(a):a.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(a),a.setGroupProperty=expressionHelpers.setGroupProperty,a.loopOut=o,a.loopIn=h,a.smooth=p,a.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(a),a.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(a),a.numKeys=1===e.a?e.k.length:0,a.propertyIndex=e.ix;var n=0;return 0!==r&&(n=createTypedArray("float32",1===e.a?e.k[0].s.length:e.k.length)),a._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:n},expressionHelpers.searchExpressions(t,e,a),a.k&&s.addDynamicProperty(a),a};var t=ShapePropertyFactory.getConstructorFunction(),e=ShapePropertyFactory.getKeyframedConstructorFunction();function r(){}r.prototype={vertices:function(t,e){this.k&&this.getValue();var r=this.v;void 0!==e&&(r=this.getValueAtTime(e,0));var i,s=r._length,a=r[t],n=r.v,o=createSizedArray(s);for(i=0;i<s;i+=1)o[i]="i"===t||"o"===t?[a[i][0]-n[i][0],a[i][1]-n[i][1]]:[a[i][0],a[i][1]];return o},points:function(t){return this.vertices("v",t)},inTangents:function(t){return this.vertices("i",t)},outTangents:function(t){return this.vertices("o",t)},isClosed:function(){return this.v.c},pointOnPath:function(t,e){var r=this.v;void 0!==e&&(r=this.getValueAtTime(e,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(r));for(var i,s=this._segmentsLength,a=s.lengths,n=s.totalLength*t,o=0,h=a.length,p=0;o<h;){if(p+a[o].addedLength>n){var l=o,f=r.c&&o===h-1?0:o+1,m=(n-p)/a[o].addedLength;i=bez.getPointInSegment(r.v[l],r.v[f],r.o[l],r.i[f],m,a[o]);break}p+=a[o].addedLength,o+=1}return i||(i=r.c?[r.v[0][0],r.v[0][1]]:[r.v[r._length-1][0],r.v[r._length-1][1]]),i},vectorOnPath:function(t,e,r){t=1==t?this.v.c?0:.999:t;var i=this.pointOnPath(t,e),s=this.pointOnPath(t+.001,e),a=s[0]-i[0],n=s[1]-i[1],o=Math.sqrt(Math.pow(a,2)+Math.pow(n,2));return 0===o?[0,0]:"tangent"===r?[a/o,n/o]:[-n/o,a/o]},tangentOnPath:function(t,e){return this.vectorOnPath(t,e,"tangent")},normalOnPath:function(t,e){return this.vectorOnPath(t,e,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([r],t),extendPrototype([r],e),e.prototype.getValueAtTime=function(t){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shape_pool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),t*=this.elem.globalData.frameRate,(t-=this.offsetTime)!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<t?this._caching.lastIndex:0,this._cachingAtTime.lastTime=t,this.interpolateShape(t,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue},e.prototype.initiateExpression=ExpressionManager.initiateExpression;var n=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(t,e,r,i,s){var a=n(t,e,r,i,s);return a.propertyIndex=e.ix,a.lock=!1,3===r?expressionHelpers.searchExpressions(t,e.pt,a):4===r&&expressionHelpers.searchExpressions(t,e.ks,a),a.k&&t.addDynamicProperty(a),a}}(),TextProperty.prototype.getExpressionValue=function(t,e){var r=this.calculateExpression(e);if(t.t===r)return t;var i={};return this.copyData(i,t),i.t=r.toString(),i.__complete=!1,i},TextProperty.prototype.searchProperty=function(){var t=this.searchKeyframes(),e=this.searchExpressions();return this.kf=t||e,this.kf},TextProperty.prototype.searchExpressions=function(){if(this.data.d.x)return this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0};var ShapeExpressionInterface=function(){function f(t,e,r){var i,s=[],a=t?t.length:0;for(i=0;i<a;i+=1)"gr"==t[i].ty?s.push(n(t[i],e[i],r)):"fl"==t[i].ty?s.push(o(t[i],e[i],r)):"st"==t[i].ty?s.push(h(t[i],e[i],r)):"tm"==t[i].ty?s.push(p(t[i],e[i],r)):"tr"==t[i].ty||("el"==t[i].ty?s.push(l(t[i],e[i],r)):"sr"==t[i].ty?s.push(m(t[i],e[i],r)):"sh"==t[i].ty?s.push(y(t[i],e[i],r)):"rc"==t[i].ty?s.push(c(t[i],e[i],r)):"rd"==t[i].ty?s.push(d(t[i],e[i],r)):"rp"==t[i].ty&&s.push(u(t[i],e[i],r)));return s}function n(t,e,r){var i=function(t){switch(t){case"ADBE Vectors Group":case"Contents":case 2:return i.content;default:return i.transform}};i.propertyGroup=function(t){return 1===t?i:r(t-1)};var s,a,n,o,h,p=(s=t,a=e,n=i.propertyGroup,(h=function(t){for(var e=0,r=o.length;e<r;){if(o[e]._name===t||o[e].mn===t||o[e].propertyIndex===t||o[e].ix===t||o[e].ind===t)return o[e];e+=1}if("number"==typeof t)return o[t-1]}).propertyGroup=function(t){return 1===t?h:n(t-1)},o=f(s.it,a.it,h.propertyGroup),h.numProperties=o.length,h.propertyIndex=s.cix,h._name=s.nm,h),l=function(e,t,r){function i(t){return 1==t?s:r(--t)}function s(t){return e.a.ix===t||"Anchor Point"===t?s.anchorPoint:e.o.ix===t||"Opacity"===t?s.opacity:e.p.ix===t||"Position"===t?s.position:e.r.ix===t||"Rotation"===t||"ADBE Vector Rotation"===t?s.rotation:e.s.ix===t||"Scale"===t?s.scale:e.sk&&e.sk.ix===t||"Skew"===t?s.skew:e.sa&&e.sa.ix===t||"Skew Axis"===t?s.skewAxis:void 0}return t.transform.mProps.o.setGroupProperty(i),t.transform.mProps.p.setGroupProperty(i),t.transform.mProps.a.setGroupProperty(i),t.transform.mProps.s.setGroupProperty(i),t.transform.mProps.r.setGroupProperty(i),t.transform.mProps.sk&&(t.transform.mProps.sk.setGroupProperty(i),t.transform.mProps.sa.setGroupProperty(i)),t.transform.op.setGroupProperty(i),Object.defineProperties(s,{opacity:{get:ExpressionPropertyInterface(t.transform.mProps.o)},position:{get:ExpressionPropertyInterface(t.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(t.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(t.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(t.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(t.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(t.transform.mProps.sa)},_name:{value:e.nm}}),s.ty="tr",s.mn=e.mn,s.propertyGroup=r,s}(t.it[t.it.length-1],e.it[e.it.length-1],i.propertyGroup);return i.content=p,i.transform=l,Object.defineProperty(i,"_name",{get:function(){return t.nm}}),i.numProperties=t.np,i.propertyIndex=t.ix,i.nm=t.nm,i.mn=t.mn,i}function o(t,e,r){function i(t){return"Color"===t||"color"===t?i.color:"Opacity"===t||"opacity"===t?i.opacity:void 0}return Object.defineProperties(i,{color:{get:ExpressionPropertyInterface(e.c)},opacity:{get:ExpressionPropertyInterface(e.o)},_name:{value:t.nm},mn:{value:t.mn}}),e.c.setGroupProperty(r),e.o.setGroupProperty(r),i}function h(t,e,r){function i(t){return 1===t?ob:r(t-1)}function s(t){return 1===t?h:i(t-1)}var a,n,o=t.d?t.d.length:0,h={};for(a=0;a<o;a+=1)n=a,Object.defineProperty(h,t.d[n].nm,{get:ExpressionPropertyInterface(e.d.dataProps[n].p)}),e.d.dataProps[a].p.setGroupProperty(s);function p(t){return"Color"===t||"color"===t?p.color:"Opacity"===t||"opacity"===t?p.opacity:"Stroke Width"===t||"stroke width"===t?p.strokeWidth:void 0}return Object.defineProperties(p,{color:{get:ExpressionPropertyInterface(e.c)},opacity:{get:ExpressionPropertyInterface(e.o)},strokeWidth:{get:ExpressionPropertyInterface(e.w)},dash:{get:function(){return h}},_name:{value:t.nm},mn:{value:t.mn}}),e.c.setGroupProperty(i),e.o.setGroupProperty(i),e.w.setGroupProperty(i),p}function p(e,t,r){function i(t){return 1==t?s:r(--t)}function s(t){return t===e.e.ix||"End"===t||"end"===t?s.end:t===e.s.ix?s.start:t===e.o.ix?s.offset:void 0}return s.propertyIndex=e.ix,t.s.setGroupProperty(i),t.e.setGroupProperty(i),t.o.setGroupProperty(i),s.propertyIndex=e.ix,s.propertyGroup=r,Object.defineProperties(s,{start:{get:ExpressionPropertyInterface(t.s)},end:{get:ExpressionPropertyInterface(t.e)},offset:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm}}),s.mn=e.mn,s}function l(e,t,r){function i(t){return 1==t?a:r(--t)}a.propertyIndex=e.ix;var s="tm"===t.sh.ty?t.sh.prop:t.sh;function a(t){return e.p.ix===t?a.position:e.s.ix===t?a.size:void 0}return s.s.setGroupProperty(i),s.p.setGroupProperty(i),Object.defineProperties(a,{size:{get:ExpressionPropertyInterface(s.s)},position:{get:ExpressionPropertyInterface(s.p)},_name:{value:e.nm}}),a.mn=e.mn,a}function m(e,t,r){function i(t){return 1==t?a:r(--t)}var s="tm"===t.sh.ty?t.sh.prop:t.sh;function a(t){return e.p.ix===t?a.position:e.r.ix===t?a.rotation:e.pt.ix===t?a.points:e.or.ix===t||"ADBE Vector Star Outer Radius"===t?a.outerRadius:e.os.ix===t?a.outerRoundness:!e.ir||e.ir.ix!==t&&"ADBE Vector Star Inner Radius"!==t?e.is&&e.is.ix===t?a.innerRoundness:void 0:a.innerRadius}return a.propertyIndex=e.ix,s.or.setGroupProperty(i),s.os.setGroupProperty(i),s.pt.setGroupProperty(i),s.p.setGroupProperty(i),s.r.setGroupProperty(i),e.ir&&(s.ir.setGroupProperty(i),s.is.setGroupProperty(i)),Object.defineProperties(a,{position:{get:ExpressionPropertyInterface(s.p)},rotation:{get:ExpressionPropertyInterface(s.r)},points:{get:ExpressionPropertyInterface(s.pt)},outerRadius:{get:ExpressionPropertyInterface(s.or)},outerRoundness:{get:ExpressionPropertyInterface(s.os)},innerRadius:{get:ExpressionPropertyInterface(s.ir)},innerRoundness:{get:ExpressionPropertyInterface(s.is)},_name:{value:e.nm}}),a.mn=e.mn,a}function c(e,t,r){function i(t){return 1==t?a:r(--t)}var s="tm"===t.sh.ty?t.sh.prop:t.sh;function a(t){return e.p.ix===t?a.position:e.r.ix===t?a.roundness:e.s.ix===t||"Size"===t||"ADBE Vector Rect Size"===t?a.size:void 0}return a.propertyIndex=e.ix,s.p.setGroupProperty(i),s.s.setGroupProperty(i),s.r.setGroupProperty(i),Object.defineProperties(a,{position:{get:ExpressionPropertyInterface(s.p)},roundness:{get:ExpressionPropertyInterface(s.r)},size:{get:ExpressionPropertyInterface(s.s)},_name:{value:e.nm}}),a.mn=e.mn,a}function d(e,t,r){var i=t;function s(t){if(e.r.ix===t||"Round Corners 1"===t)return s.radius}return s.propertyIndex=e.ix,i.rd.setGroupProperty(function(t){return 1==t?s:r(--t)}),Object.defineProperties(s,{radius:{get:ExpressionPropertyInterface(i.rd)},_name:{value:e.nm}}),s.mn=e.mn,s}function u(e,t,r){function i(t){return 1==t?a:r(--t)}var s=t;function a(t){return e.c.ix===t||"Copies"===t?a.copies:e.o.ix===t||"Offset"===t?a.offset:void 0}return a.propertyIndex=e.ix,s.c.setGroupProperty(i),s.o.setGroupProperty(i),Object.defineProperties(a,{copies:{get:ExpressionPropertyInterface(s.c)},offset:{get:ExpressionPropertyInterface(s.o)},_name:{value:e.nm}}),a.mn=e.mn,a}function y(t,e,r){var i=e.sh;function s(t){if("Shape"===t||"shape"===t||"Path"===t||"path"===t||"ADBE Vector Shape"===t||2===t)return s.path}return i.setGroupProperty(function(t){return 1==t?s:r(--t)}),Object.defineProperties(s,{path:{get:function(){return i.k&&i.getValue(),i}},shape:{get:function(){return i.k&&i.getValue(),i}},_name:{value:t.nm},ix:{value:t.ix},propertyIndex:{value:t.ix},mn:{value:t.mn}}),s}return function(t,e,r){var i;function s(t){if("number"==typeof t)return i[t-1];for(var e=0,r=i.length;e<r;){if(i[e]._name===t)return i[e];e+=1}}return s.propertyGroup=r,i=f(t,e,s),s.numProperties=i.length,s}}(),TextExpressionInterface=function(e){var r;function t(){}return Object.defineProperty(t,"sourceText",{get:function(){e.textProperty.getValue();var t=e.textProperty.currentData.t;return void 0!==t&&(e.textProperty.currentData.t=void 0,(r=new String(t)).value=t||new String(t)),r}}),t},LayerExpressionInterface=function(){function s(t,e){var r=new Matrix;if(r.reset(),this._elem.finalTransform.mProp.applyToMatrix(r),this._elem.hierarchy&&this._elem.hierarchy.length){var i,s=this._elem.hierarchy.length;for(i=0;i<s;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(r);return r.applyToPointArray(t[0],t[1],t[2]||0)}return r.applyToPointArray(t[0],t[1],t[2]||0)}function a(t,e){var r=new Matrix;if(r.reset(),this._elem.finalTransform.mProp.applyToMatrix(r),this._elem.hierarchy&&this._elem.hierarchy.length){var i,s=this._elem.hierarchy.length;for(i=0;i<s;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(r);return r.inversePoint(t)}return r.inversePoint(t)}function n(t){var e=new Matrix;if(e.reset(),this._elem.finalTransform.mProp.applyToMatrix(e),this._elem.hierarchy&&this._elem.hierarchy.length){var r,i=this._elem.hierarchy.length;for(r=0;r<i;r+=1)this._elem.hierarchy[r].finalTransform.mProp.applyToMatrix(e);return e.inversePoint(t)}return e.inversePoint(t)}function o(){return[1,1,1,1]}return function(e){var r;function i(t){switch(t){case"ADBE Root Vectors Group":case"Contents":case 2:return i.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return r;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return i.effect}}i.toWorld=s,i.fromWorld=a,i.toComp=s,i.fromComp=n,i.sampleImage=o,i.sourceRectAtTime=e.sourceRectAtTime.bind(e);var t=getDescriptor(r=TransformExpressionInterface((i._elem=e).finalTransform.mProp),"anchorPoint");return Object.defineProperties(i,{hasParent:{get:function(){return e.hierarchy.length}},parent:{get:function(){return e.hierarchy[0].layerInterface}},rotation:getDescriptor(r,"rotation"),scale:getDescriptor(r,"scale"),position:getDescriptor(r,"position"),opacity:getDescriptor(r,"opacity"),anchorPoint:t,anchor_point:t,transform:{get:function(){return r}},active:{get:function(){return e.isInRange}}}),i.startTime=e.data.st,i.index=e.data.ind,i.source=e.data.refId,i.height=0===e.data.ty?e.data.h:100,i.width=0===e.data.ty?e.data.w:100,i.inPoint=e.data.ip/e.comp.globalData.frameRate,i.outPoint=e.data.op/e.comp.globalData.frameRate,i._name=e.data.nm,i.registerMaskInterface=function(t){i.mask=new MaskManagerInterface(t,e)},i.registerEffectsInterface=function(t){i.effect=t},i}}(),CompExpressionInterface=function(i){function t(t){for(var e=0,r=i.layers.length;e<r;){if(i.layers[e].nm===t||i.layers[e].ind===t)return i.elements[e].layerInterface;e+=1}return null}return Object.defineProperty(t,"_name",{value:i.data.nm}),(t.layer=t).pixelAspect=1,t.height=i.data.h||i.globalData.compSize.h,t.width=i.data.w||i.globalData.compSize.w,t.pixelAspect=1,t.frameDuration=1/i.globalData.frameRate,t.displayStartTime=0,t.numLayers=i.layers.length,t},TransformExpressionInterface=function(t){function e(t){switch(t){case"scale":case"Scale":case"ADBE Scale":case 6:return e.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return e.rotation;case"ADBE Rotate X":return e.xRotation;case"ADBE Rotate Y":return e.yRotation;case"position":case"Position":case"ADBE Position":case 2:return e.position;case"ADBE Position_0":return e.xPosition;case"ADBE Position_1":return e.yPosition;case"ADBE Position_2":return e.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return e.anchorPoint;case"opacity":case"Opacity":case 11:return e.opacity}}if(Object.defineProperty(e,"rotation",{get:ExpressionPropertyInterface(t.r||t.rz)}),Object.defineProperty(e,"zRotation",{get:ExpressionPropertyInterface(t.rz||t.r)}),Object.defineProperty(e,"xRotation",{get:ExpressionPropertyInterface(t.rx)}),Object.defineProperty(e,"yRotation",{get:ExpressionPropertyInterface(t.ry)}),Object.defineProperty(e,"scale",{get:ExpressionPropertyInterface(t.s)}),t.p)var r=ExpressionPropertyInterface(t.p);return Object.defineProperty(e,"position",{get:function(){return t.p?r():[t.px.v,t.py.v,t.pz?t.pz.v:0]}}),Object.defineProperty(e,"xPosition",{get:ExpressionPropertyInterface(t.px)}),Object.defineProperty(e,"yPosition",{get:ExpressionPropertyInterface(t.py)}),Object.defineProperty(e,"zPosition",{get:ExpressionPropertyInterface(t.pz)}),Object.defineProperty(e,"anchorPoint",{get:ExpressionPropertyInterface(t.a)}),Object.defineProperty(e,"opacity",{get:ExpressionPropertyInterface(t.o)}),Object.defineProperty(e,"skew",{get:ExpressionPropertyInterface(t.sk)}),Object.defineProperty(e,"skewAxis",{get:ExpressionPropertyInterface(t.sa)}),Object.defineProperty(e,"orientation",{get:ExpressionPropertyInterface(t.or)}),e},ProjectInterface=function(){function e(t){this.compositions.push(t)}return function(){function t(t){for(var e=0,r=this.compositions.length;e<r;){if(this.compositions[e].data&&this.compositions[e].data.nm===t)return this.compositions[e].prepareFrame&&this.compositions[e].data.xt&&this.compositions[e].prepareFrame(this.currentFrame),this.compositions[e].compInterface;e+=1}}return t.compositions=[],t.currentFrame=0,t.registerComposition=e,t}}(),EffectsExpressionInterface=function(){function p(s,t,e,r){var i,a=[],n=s.ef.length;for(i=0;i<n;i+=1)5===s.ef[i].ty?a.push(p(s.ef[i],t.effectElements[i],t.effectElements[i].propertyGroup,r)):a.push(l(t.effectElements[i],s.ef[i].ty,r,o));function o(t){return 1===t?h:e(t-1)}var h=function(t){for(var e=s.ef,r=0,i=e.length;r<i;){if(t===e[r].nm||t===e[r].mn||t===e[r].ix)return 5===e[r].ty?a[r]:a[r]();r+=1}return a[0]()};return h.propertyGroup=o,"ADBE Color Control"===s.mn&&Object.defineProperty(h,"color",{get:function(){return a[0]()}}),Object.defineProperty(h,"numProperties",{get:function(){return s.np}}),h.active=h.enabled=0!==s.en,h}function l(t,e,r,i){var s=ExpressionPropertyInterface(t.p);return t.p.setGroupProperty&&t.p.setGroupProperty(i),function(){return 10===e?r.comp.compInterface(t.p.v):s()}}return{createEffectsInterface:function(s,t){if(s.effectsManager){var e,a=[],r=s.data.ef,i=s.effectsManager.effectElements.length;for(e=0;e<i;e+=1)a.push(p(r[e],s.effectsManager.effectElements[e],t,s));return function(t){for(var e=s.data.ef||[],r=0,i=e.length;r<i;){if(t===e[r].nm||t===e[r].mn||t===e[r].ix)return a[r];r+=1}}}}}}(),MaskManagerInterface=function(){function a(t,e){this._mask=t,this._data=e}return Object.defineProperty(a.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(a.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),100*this._mask.op.v}}),function(e,t){var r,i=createSizedArray(e.viewData.length),s=e.viewData.length;for(r=0;r<s;r+=1)i[r]=new a(e.viewData[r],e.masksProperties[r]);return function(t){for(r=0;r<s;){if(e.masksProperties[r].nm===t)return i[r];r+=1}}}}(),ExpressionPropertyInterface=function(){var s={pv:0,v:0,mult:1},n={pv:[0,0,0],v:[0,0,0],mult:1};function o(i,s,a){Object.defineProperty(i,"velocity",{get:function(){return s.getVelocityAtTime(s.comp.currentFrame)}}),i.numKeys=s.keyframes?s.keyframes.length:0,i.key=function(t){if(i.numKeys){var e;e="s"in s.keyframes[t-1]?s.keyframes[t-1].s:"e"in s.keyframes[t-2]?s.keyframes[t-2].e:s.keyframes[t-2].s;var r="unidimensional"===a?new Number(e):Object.assign({},e);return r.time=s.keyframes[t-1].t/s.elem.comp.globalData.frameRate,r}return 0},i.valueAtTime=s.getValueAtTime,i.speedAtTime=s.getSpeedAtTime,i.velocityAtTime=s.getVelocityAtTime,i.propertyGroup=s.propertyGroup}function e(){return s}return function(t){return t?"unidimensional"===t.propType?function(t){t&&"pv"in t||(t=s);var e=1/t.mult,r=t.pv*e,i=new Number(r);return i.value=r,o(i,t,"unidimensional"),function(){return t.k&&t.getValue(),r=t.v*e,i.value!==r&&((i=new Number(r)).value=r,o(i,t,"unidimensional")),i}}(t):function(e){e&&"pv"in e||(e=n);var r=1/e.mult,i=e.pv.length,s=createTypedArray("float32",i),a=createTypedArray("float32",i);return s.value=a,o(s,e,"multidimensional"),function(){e.k&&e.getValue();for(var t=0;t<i;t+=1)s[t]=a[t]=e.v[t]*r;return s}}(t):e}}(),tZ,uZ;function SliderEffect(t,e,r){this.p=PropertyFactory.getProp(e,t.v,0,0,r)}function AngleEffect(t,e,r){this.p=PropertyFactory.getProp(e,t.v,0,0,r)}function ColorEffect(t,e,r){this.p=PropertyFactory.getProp(e,t.v,1,0,r)}function PointEffect(t,e,r){this.p=PropertyFactory.getProp(e,t.v,1,0,r)}function LayerIndexEffect(t,e,r){this.p=PropertyFactory.getProp(e,t.v,0,0,r)}function MaskIndexEffect(t,e,r){this.p=PropertyFactory.getProp(e,t.v,0,0,r)}function CheckboxEffect(t,e,r){this.p=PropertyFactory.getProp(e,t.v,0,0,r)}function NoValueEffect(){this.p={}}function EffectsManager(){}function EffectsManager(t,e){var r=t.ef||[];this.effectElements=[];var i,s,a=r.length;for(i=0;i<a;i++)s=new GroupEffect(r[i],e),this.effectElements.push(s)}function GroupEffect(t,e){this.init(t,e)}tZ=function(){function r(t,e){return this.textIndex=t+1,this.textTotal=e,this.v=this.getValue()*this.mult,this.v}return function(t,e){this.pv=1,this.comp=t.comp,this.elem=t,this.mult=.01,this.propType="textSelector",this.textTotal=e.totalChars,this.selectorValue=100,this.lastValue=[1,1,1],this.k=!0,this.x=!0,this.getValue=ExpressionManager.initiateExpression.bind(this)(t,e,this),this.getMult=r,this.getVelocityAtTime=expressionHelpers.getVelocityAtTime,this.kf?this.getValueAtTime=expressionHelpers.getValueAtTime.bind(this):this.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(this),this.setGroupProperty=expressionHelpers.setGroupProperty}}(),uZ=TextSelectorProp.getTextSelectorProp,TextSelectorProp.getTextSelectorProp=function(t,e,r){return 1===e.t?new tZ(t,e,r):uZ(t,e,r)},extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(t,e){this.data=t,this.effectElements=[],this.initDynamicPropertyContainer(e);var r,i,s=this.data.ef.length,a=this.data.ef;for(r=0;r<s;r+=1){switch(i=null,a[r].ty){case 0:i=new SliderEffect(a[r],e,this);break;case 1:i=new AngleEffect(a[r],e,this);break;case 2:i=new ColorEffect(a[r],e,this);break;case 3:i=new PointEffect(a[r],e,this);break;case 4:case 7:i=new CheckboxEffect(a[r],e,this);break;case 10:i=new LayerIndexEffect(a[r],e,this);break;case 11:i=new MaskIndexEffect(a[r],e,this);break;case 5:i=new EffectsManager(a[r],e,this);break;default:i=new NoValueEffect(a[r],e,this)}i&&this.effectElements.push(i)}};var lottie={},_isFrozen=!1;function setLocationHref(t){locationHref=t}function searchAnimations(){!0===standalone?animationManager.searchAnimations(animationData,standalone,renderer):animationManager.searchAnimations()}function setSubframeRendering(t){subframeEnabled=t}function loadAnimation(t){return!0===standalone&&(t.animationData=JSON.parse(animationData)),animationManager.loadAnimation(t)}function setQuality(t){if("string"==typeof t)switch(t){case"high":defaultCurveSegments=200;break;case"medium":defaultCurveSegments=50;break;case"low":defaultCurveSegments=10}else!isNaN(t)&&1<t&&(defaultCurveSegments=t);roundValues(!(50<=defaultCurveSegments))}function inBrowser(){return"undefined"!=typeof navigator}function installPlugin(t,e){"expressions"===t&&(expressionsPlugin=e)}function getFactory(t){switch(t){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix}}function checkReady(){"complete"===document.readyState&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(t){for(var e=queryString.split("&"),r=0;r<e.length;r++){var i=e[r].split("=");if(decodeURIComponent(i[0])==t)return decodeURIComponent(i[1])}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocationHref,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.__getFactory=getFactory,lottie.version="5.6.2";var standalone="__[STANDALONE]__",animationData="__[ANIMATIONDATA]__",renderer="";if(standalone){var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""},queryString=myScript.src.replace(/^[^\?]+\??/,"");renderer=getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);return lottie},"function"==typeof define&&define.amd?define(function(){return factory(root)}):"object"==typeof module&&module.exports?module.exports=factory(root):(root.lottie=factory(root),root.bodymovin=root.lottie)),angular.module("engage").component("umsLoader",{template:'<div class="ums-loader__fixed" ng-style="$ctrl.state.offset"><div class="ums-loader__small__container ums-loader__animation"><div class="loader-inner"><div class="loader-line-wrap"><div class="loader-line"></div></div><div class="loader-line-wrap"><div class="loader-line"></div></div><div class="loader-line-wrap"><div class="loader-line"></div></div><div class="loader-line-wrap"><div class="loader-line"></div></div><div class="loader-line-wrap"><div class="loader-line"></div></div></div></div></div>',transclude:!0,controller:function($element){var ctrl=this;ctrl.state={offset:{left:0,top:0}};this.$onInit=function(){var container=$element[0].querySelector(".is-animated");!function(){if(ctrl.state.offset.left=$(".navigation-inner-container").outerWidth(),$element.closest("ums-screen").length>0){var closestScreen=$element.closest("ums-screen");closestScreen.find(".ums-container").length>0?ctrl.state.offset.top=closestScreen.find(".ums-container").offset().top:ctrl.state.offset.top=closestScreen.offset().top}else ctrl.state.offset.top=$element.closest(".u-marketing-suite-dashboard").offset().top}(),lottie.loadAnimation({container:container,renderer:"svg",loop:!0,autoplay:!0,animationData:{v:"5.5.10",fr:25,ip:0,op:100,w:720,h:405,nm:"Main",ddd:0,assets:[{id:"comp_0",layers:[{ddd:0,ind:1,ty:4,nm:"Pink Left Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[878.5,469,0],ix:2},a:{a:0,k:[31.5,96,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[3.225,-3.226],[.961,-.511],[2.761,5.198],[0,18.185],[0,0],[-5.811,5.82],[0,0],[-8.219,0],[-5.815,-5.824],[.001,-8.228],[0,0],[5.886,.001],[0,5.887],[0,0],[5.223,.001],[.001,-5.239],[0,0],[-6.852,-12.901]],o:[[-.731,.73],[-5.198,2.761],[-8.481,-15.969],[0,0],[0,-8.229],[0,0],[5.814,-5.814],[8.227,0],[5.812,5.82],[0,0],[.001,5.887],[-5.886,0],[0,0],[0,-5.238],[-5.223,.001],[0,0],[0,14.712],[2.251,4.238]],v:[[-.87,90.759],[-3.413,92.636],[-17.823,88.223],[-30.788,36.017],[-30.788,-64.581],[-21.775,-86.366],[-21.759,-86.382],[0,-95.397],[21.774,-86.366],[30.787,-64.582],[30.787,-61.033],[20.13,-50.375],[9.472,-61.033],[9.472,-64.582],[0,-74.082],[-9.472,-64.581],[-9.472,36.017],[1.001,78.224]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.957000014361,.757000014361,.736999990426,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[31.058,95.938],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Green Bottom Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[974,545,0],ix:2},a:{a:0,k:[97,72,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.019,-.018],[29.708,0],[20.801,19.804],[-4.059,4.264],[-4.263,-4.058],[-23.206,0],[-16.992,16.991],[-.015,.015],[0,24.077],[0,0],[-5.887,.001],[0,-5.886],[0,0],[21.019,-21.048]],o:[[-21.018,21.019],[-28.702,0],[-4.264,-4.059],[4.066,-4.253],[16.82,16.014],[24.012,0],[.015,-.016],[17.001,-17.024],[0,0],[0,-5.886],[5.886,0],[0,0],[0,29.765],[-.018,.019]],v:[[63.599,38.91],[-15.054,71.501],[-91.821,40.791],[-92.192,25.722],[-77.124,25.352],[-15.054,50.185],[48.528,23.838],[48.573,23.792],[74.936,-39.945],[74.936,-60.843],[85.594,-71.501],[96.251,-60.843],[96.251,-39.945],[63.656,38.853]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.184000007779,.694000004787,.588000009574,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[96.715,71.901],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Roze Right Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[1059.5,427,0],ix:2},a:{a:0,k:[11.5,33,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[1.929,-1.929],[2.942,.001],[0,5.886],[0,0],[-5.887,0],[0,-5.886],[0,0]],o:[[-1.928,1.929],[-5.887,0],[0,0],[0,-5.886],[5.886,0],[0,0],[0,2.943]],v:[[7.536,28.976],[.001,32.097],[-10.657,21.44],[-10.657,-21.441],[.001,-32.098],[10.657,-21.441],[10.657,21.44]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.957000014361,.757000014361,.736999990426,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[11.309,32.843],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"Green Top Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[929,400,0],ix:2},a:{a:0,k:[21,59,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[1.928,-1.929],[2.943,.001],[0,5.886],[0,0],[9.409,9.409],[-4.162,4.162],[-4.163,-4.162],[-.001,-19],[0,0]],o:[[-1.929,1.929],[-5.886,0],[0,0],[0,-13.306],[-4.162,-4.162],[4.162,-4.162],[13.434,13.435],[0,0],[.001,2.943]],v:[[16.913,55.064],[9.377,58.186],[-1.281,47.529],[-1.281,-3.728],[-15.872,-38.952],[-15.872,-54.024],[-.8,-54.024],[20.034,-3.728],[20.033,47.529]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.184000007779,.694000004787,.588000009574,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[21.156,59.364],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:5,ty:4,nm:"Rood Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[975.5,465.5,0],ix:2},a:{a:0,k:[48.5,71.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.001,-.001],[8.218,0],[.001,16.992],[0,0],[-5.886,0],[0,-5.886],[0,0],[-5.223,-.001],[-1.787,1.787],[-.001,.001],[-.001,2.542],[0,0],[-5.691,5.919],[-8.269,0],[-5.111,-3.538],[-.599,-.485],[3.704,-4.576],[4.574,3.703],[.201,.138],[2.264,0],[0,-5.403],[0,0],[5.818,-5.821]],o:[[-5.813,5.814],[-16.976,0],[0,0],[0,-5.885],[5.886,0],[0,0],[0,5.238],[2.525,-.001],[.001,-.001],[1.795,-1.795],[0,0],[0,-8.187],[5.839,-6.066],[6.149,-.001],[.637,.441],[4.576,3.704],[-3.711,4.58],[-.188,-.152],[-1.066,-.739],[-5.086,0],[0,0],[0,8.234],[-.002,.001]],v:[[4.89,61.497],[-16.869,70.513],[-47.657,39.698],[-47.656,18.8],[-36.999,8.142],[-26.341,18.801],[-26.341,39.698],[-16.869,49.198],[-10.182,46.426],[-10.18,46.424],[-7.397,39.698],[-7.397,-39.229],[1.429,-61.104],[23.3,-70.512],[40.511,-65.104],[42.374,-63.708],[43.953,-48.719],[28.964,-47.14],[28.377,-47.578],[23.3,-49.198],[13.917,-39.229],[13.917,39.698],[4.895,61.493]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.902000038297,.243000000598,.161000001197,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[48.531,71.258],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:6,ty:4,nm:"Blauw Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[958.5,504.5,0],ix:2},a:{a:0,k:[71.5,72.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[12.882,-12.882],[19.573,0],[13.441,13.434],[0,18.996],[0,0],[-5.886,-.001],[0,-5.886],[0,0],[-9.42,-9.414],[-13.29,0],[0,27.469],[0,0],[-5.886,-.001],[0,-5.886],[0,0]],o:[[-12.862,12.862],[-18.982,0],[-13.448,-13.44],[0,0],[-.001,-5.886],[5.886,0],[0,0],[0,13.3],[9.415,9.41],[27.421,0],[0,0],[0,-5.886],[5.887,0],[0,0],[0,19.625]],v:[[50.226,50.738],[.043,71.565],[-50.235,50.733],[-71.089,.435],[-71.088,-60.608],[-60.431,-71.266],[-49.774,-60.608],[-49.774,.435],[-35.167,35.658],[.043,50.25],[49.774,.435],[49.774,-60.908],[60.431,-71.564],[71.089,-60.908],[71.089,.435]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[71.618,72.521],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0}]}],layers:[{ddd:0,ind:1,ty:4,nm:"u1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:0,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:3,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:50,s:[100]},{t:53,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[100,365,0],ix:2},a:{a:0,k:[18,20.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[.375,1.2],[0,0],[.825,-.625],[.937,-.449],[1.087,-.249],[1.274,0],[1.636,.725],[1.1,1.299],[.574,1.798],[0,2.149],[0,0],[0,0],[0,0],[-.987,-1.188],[-1.95,0],[-1.275,.638],[-1.149,1.101],[0,0]],o:[[0,0],[0,0],[-1.325,0],[0,0],[-.775,.749],[-.825,.625],[-.937,.45],[-1.087,.249],[-2.099,0],[-1.637,-.724],[-1.1,-1.3],[-.575,-1.8],[0,0],[0,0],[0,0],[0,2.149],[.987,1.186],[1.448,0],[1.274,-.638],[0,0],[0,0]],v:[[17.149,-19.623],[17.149,19.024],[10.777,19.024],[8.228,17.225],[7.553,14.526],[5.154,16.588],[2.511,18.199],[-.525,19.249],[-4.067,19.623],[-9.671,18.537],[-13.776,15.501],[-16.287,10.853],[-17.149,4.93],[-17.149,-19.623],[-6.804,-19.623],[-6.804,4.93],[-5.323,9.935],[-.918,11.715],[3.168,10.759],[6.803,8.153],[6.803,-19.623]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.694,20.342],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"m1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:1,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:4,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:51,s:[100]},{t:54,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[156,357,0],ix:2},a:{a:0,k:[30.5,28,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[-.038,.8],[-.1,.825],[0,0],[1.774,0],[0,0],[.675,.413],[.399,.799],[0,0],[-.05,-.812],[0,-.699],[0,0],[0,0],[0,0],[0,0],[-.374,-.024],[-.288,-.112],[-.238,-.238],[-.225,-.425],[0,0],[-.412,-.924],[-.375,-.974],[-.412,.951],[-.475,.875],[0,0],[-.251,.237],[-.288,.113],[-.362,.025],[-.501,0]],o:[[0,0],[0,0],[0,0],[0,-.699],[.037,-.799],[0,0],[-.85,1.624],[0,0],[-.876,0],[-.674,-.412],[0,0],[.076,.875],[.05,.812],[0,0],[0,0],[0,0],[0,0],[.474,0],[.375,.025],[.286,.113],[.237,.237],[0,0],[.475,.875],[.412,.924],[.374,-.999],[.413,-.949],[0,0],[.226,-.425],[.249,-.238],[.287,-.112],[.362,-.024],[0,0]],v:[[29.988,-27.196],[29.988,27.196],[20.054,27.196],[20.054,-6.204],[20.111,-8.453],[20.317,-10.889],[4.761,18.612],[.825,21.048],[-.749,21.048],[-3.074,20.428],[-4.685,18.612],[-20.317,-11.002],[-20.129,-8.471],[-20.054,-6.204],[-20.054,27.196],[-29.988,27.196],[-29.988,-27.196],[-21.441,-27.196],[-20.167,-27.158],[-19.173,-26.952],[-18.386,-26.427],[-17.693,-25.433],[-2.474,3.58],[-1.143,6.279],[.038,9.127],[1.218,6.203],[2.549,3.467],[17.655,-25.433],[18.368,-26.427],[19.174,-26.952],[20.148,-27.158],[21.442,-27.196]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[30.24,28.171],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"a1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:2,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:5,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:52,s:[100]},{t:55,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[209,364.5,0],ix:2},a:{a:0,k:[17,21,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[1.673,-.312],[.987,-.499],[.412,-.638],[0,-.75],[-.838,-.625],[-1.499,0],[-1.262,.613],[-1.25,1.299]],o:[[-2.524,.125],[-1.675,.313],[-.987,.5],[-.412,.637],[0,1.499],[.836,.625],[1.725,0],[1.262,-.612],[0,0]],v:[[6.41,3.242],[.113,3.898],[-3.88,5.116],[-5.979,6.822],[-6.597,8.902],[-5.341,12.089],[-1.837,13.025],[2.643,12.107],[6.41,9.24]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[0,0],[-2.749,1.013],[-3.199,0],[-1.812,-.749],[-1.263,-1.336],[-.675,-1.849],[0,-2.199],[0,0],[0,0],[.512,.275],[.325,.875],[0,0],[.911,-.65],[.975,-.437],[1.112,-.225],[1.374,0],[1.4,.449],[1.012,.888],[.55,1.325],[0,1.724],[-.725,1.424],[-1.762,1.162],[-2.937,.762],[-4.423,.1],[0,0],[1.024,1.138],[1.924,0],[.949,-.338],[.712,-.388],[.625,-.338],[.824,0],[.487,.363],[.324,.5]],o:[[2.273,-2.049],[2.749,-1.011],[2.299,0],[1.811,.75],[1.261,1.338],[.675,1.85],[0,0],[0,0],[-.974,0],[-.512,-.275],[0,0],[-.975,.851],[-.913,.649],[-.974,.437],[-1.112,.226],[-1.7,0],[-1.399,-.45],[-1.012,-.887],[-.549,-1.324],[0,-1.424],[.724,-1.425],[1.761,-1.162],[2.936,-.762],[0,0],[0,-2.424],[-1.025,-1.136],[-1.424,0],[-.95,.337],[-.712,.388],[-.624,.337],[-.725,0],[-.488,-.361],[0,0]],v:[[-14.656,-13.889],[-7.122,-18.48],[1.799,-19.998],[7.966,-18.874],[12.577,-15.744],[15.481,-10.964],[16.493,-4.892],[16.493,19.398],[11.77,19.398],[9.54,18.986],[8.284,17.262],[7.46,14.788],[4.63,17.038],[1.799,18.667],[-1.331,19.661],[-5.06,19.998],[-9.709,19.323],[-13.326,17.317],[-15.669,14],[-16.493,9.427],[-15.406,5.154],[-11.676,1.274],[-4.629,-1.611],[6.41,-2.905],[6.41,-4.892],[4.873,-10.233],[.45,-11.939],[-3.111,-11.433],[-5.604,-10.346],[-7.61,-9.259],[-9.783,-8.752],[-11.601,-9.296],[-12.819,-10.589]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"mm",mm:1,nm:"Merge Paths 1",mn:"ADBE Vector Filter - Merge",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.055,20.968],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:4,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"r1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:3,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:6,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:53,s:[100]},{t:56,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[245.5,364,0],ix:2},a:{a:0,k:[12.5,20.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-1.6,1.274],[-2.149,0],[-1.1,-.824],[0,0],[.262,-.188],[.449,0],[.75,.113],[.65,0],[.737,-.274],[.575,-.5],[.463,-.724],[.4,-.924],[0,0],[0,0],[0,0],[0,0],[-.401,-.375],[-.175,-.924]],o:[[1.224,-2.199],[1.598,-1.274],[1.749,0],[0,0],[-.125,.5],[-.263,.187],[-.4,0],[-.75,-.113],[-.95,0],[-.738,.276],[-.575,.5],[-.462,.725],[0,0],[0,0],[0,0],[0,0],[1.05,0],[.399,.375],[0,0]],v:[[-2.212,-12.576],[2.024,-17.787],[7.646,-19.698],[11.92,-18.462],[11.245,-10.814],[10.664,-9.784],[9.596,-9.503],[7.871,-9.671],[5.772,-9.84],[3.242,-9.428],[1.274,-8.265],[-.282,-6.429],[-1.575,-3.955],[-1.575,19.698],[-11.92,19.698],[-11.92,-18.949],[-5.811,-18.949],[-3.636,-18.387],[-2.774,-16.437]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.566,20.668],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:5,ty:4,nm:"k1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:4,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:7,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:54,s:[100]},{t:57,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[280,356,0],ix:2},a:{a:0,k:[19,28.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[-.375,.187],[-.375,.501],[0,0],[-.537,.3],[-.824,0],[0,0],[0,0],[1.15,-.674],[-.425,-.525],[-.4,-.65],[0,0],[0,0],[.575,.262],[.374,.675],[0,0],[.375,.174],[.75,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[.65,0],[.375,-.188],[0,0],[.425,-.574],[.538,-.299],[0,0],[0,0],[-.875,1.175],[.575,.401],[.425,.524],[0,0],[0,0],[-.799,0],[-.575,-.263],[0,0],[-.35,-.601],[-.375,-.175],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-8.04,-27.945],[-8.04,3.767],[-6.317,3.767],[-4.78,3.486],[-3.655,2.454],[4.891,-8.941],[6.335,-10.253],[8.378,-10.703],[17.823,-10.703],[6.728,3.392],[3.692,6.165],[5.192,7.553],[6.428,9.315],[18.386,27.945],[9.09,27.945],[7.029,27.551],[5.604,26.145],[-3.093,11.939],[-4.179,10.777],[-5.866,10.514],[-8.04,10.514],[-8.04,27.945],[-18.386,27.945],[-18.386,-27.945]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.295,28.422],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:6,ty:4,nm:"e1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:5,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:8,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:55,s:[100]},{t:58,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[316.5,364.5,0],ix:2},a:{a:0,k:[18.5,21,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.287,.974],[.624,.75],[.95,.437],[1.324,0],[1.4,-1.398],[.425,-2.599]],o:[[0,-1.074],[-.287,-.975],[-.625,-.75],[-.949,-.438],[-2.474,0],[-1.4,1.4],[0,0]],v:[[8.659,-4.535],[8.228,-7.609],[6.86,-10.195],[4.498,-11.975],[1.087,-12.632],[-4.723,-10.533],[-7.459,-4.535]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[0,0],[-1.737,-1.674],[-2.799,0],[-1.037,.337],[-.788,.413],[-.637,.337],[-.625,0],[-.45,-.599],[0,0],[1.324,-.837],[1.424,-.487],[1.449,-.186],[1.349,0],[2.336,.887],[1.737,1.736],[.999,2.574],[0,3.399],[-.863,2.324],[-1.624,1.725],[-2.324,1.012],[-2.924,0],[-2.087,-.788],[-1.512,-1.5],[-.837,-2.187],[0,-2.799],[.076,-.5],[.175,-.299],[.299,-.113],[.475,0]],o:[[.324,3.624],[1.737,1.675],[1.424,0],[1.037,-.337],[.787,-.412],[.637,-.338],[.8,0],[0,0],[-1.1,1.275],[-1.325,.838],[-1.425,.488],[-1.45,.188],[-2.699,0],[-2.337,-.886],[-1.736,-1.737],[-1,-2.573],[0,-2.624],[.862,-2.324],[1.625,-1.725],[2.324,-1.012],[2.474,0],[2.086,.787],[1.512,1.499],[.837,2.187],[0,.774],[-.075,.5],[-.174,.3],[-.3,.112],[0,0]],v:[[-7.609,1.612],[-4.517,9.559],[2.287,12.07],[5.979,11.565],[8.716,10.44],[10.852,9.316],[12.745,8.81],[14.619,9.709],[17.618,13.457],[13.982,16.625],[9.859,18.611],[5.548,19.623],[1.35,19.904],[-6.203,18.574],[-12.314,14.639],[-16.418,8.172],[-17.918,-.787],[-16.624,-8.209],[-12.895,-14.281],[-6.972,-18.386],[.9,-19.904],[7.741,-18.723],[13.138,-15.293],[16.662,-9.764],[17.918,-2.286],[17.805,-.374],[17.43,.825],[16.719,1.444],[15.556,1.612]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"mm",mm:1,nm:"Merge Paths 1",mn:"ADBE Vector Filter - Merge",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.786,21.024],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:4,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:7,ty:4,nm:"t1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:6,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:9,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:56,s:[100]},{t:59,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[351,359,0],ix:2},a:{a:0,k:[14,26.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[-.512,-.624],[-.95,0],[-.35,.114],[-.25,.137],[-.212,.113],[-.225,0],[-.2,-.136],[-.2,-.324],[0,0],[1.799,-.574],[1.925,0],[1.35,.511],[.925,.949],[.475,1.35],[0,1.7],[0,0],[0,0],[.387,.35],[0,.701],[0,0],[0,0],[0,0],[-1.25,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,1.075],[.512,.625],[.499,0],[.35,-.112],[.25,-.137],[.212,-.112],[.3,0],[.2,.138],[0,0],[-1.424,1.124],[-1.8,.574],[-1.749,0],[-1.349,-.512],[-.925,-.95],[-.475,-1.35],[0,0],[0,0],[-.55,0],[-.388,-.35],[0,0],[0,0],[0,0],[.275,-1.124],[0,0],[0,0],[0,0],[0,0]],v:[[12.882,-6.428],[2.512,-6.428],[2.512,13.738],[3.28,16.288],[5.473,17.225],[6.747,17.056],[7.647,16.682],[8.34,16.307],[8.997,16.138],[9.746,16.344],[10.346,17.038],[13.457,21.985],[8.622,24.535],[3.036,25.396],[-1.612,24.628],[-5.023,22.436],[-7.122,18.986],[-7.834,14.414],[-7.834,-6.428],[-11.47,-6.428],[-12.876,-6.953],[-13.457,-8.527],[-13.457,-12.576],[-7.272,-13.7],[-5.173,-23.708],[-2.886,-25.396],[2.512,-25.396],[2.512,-13.625],[12.882,-13.625]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.009,26.569],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:8,ty:4,nm:"i1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:7,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:10,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:57,s:[100]},{t:60,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[374.5,356,0],ix:2},a:{a:0,k:[8.5,28.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-.874],[.349,-.762],[.587,-.562],[.787,-.337],[.899,0],[.762,.337],[.574,.563],[.336,.763],[0,.85],[-.338,.763],[-.576,.575],[-.763,.338],[-.85,0],[-.787,-.337],[-.587,-.574],[-.351,-.762]],o:[[0,.85],[-.351,.763],[-.587,.563],[-.787,.337],[-.85,0],[-.763,-.337],[-.576,-.562],[-.338,-.762],[0,-.874],[.336,-.762],[.574,-.574],[.762,-.337],[.899,0],[.787,.338],[.587,.575],[.349,.763]],v:[[6.41,.037],[5.886,2.456],[4.479,4.442],[2.418,5.792],[-.112,6.298],[-2.53,5.792],[-4.535,4.442],[-5.903,2.456],[-6.41,.037],[-5.903,-2.417],[-4.535,-4.424],[-2.53,-5.791],[-.112,-6.298],[2.418,-5.791],[4.479,-4.424],[5.886,-2.417]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.162,6.624],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-7.337,-19.211],[7.337,-19.211],[7.337,19.211],[-2.971,19.211],[-2.971,-12.014],[-7.337,-12.014]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.623,37.156],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:9,ty:4,nm:"n1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:8,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:11,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:58,s:[100]},{t:61,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[407,364,0],ix:2},a:{a:0,k:[18,20.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-.837,.626],[-.937,.449],[-1.087,.25],[-1.274,0],[-1.624,-.723],[-1.113,-1.299],[-.562,-1.799],[0,-2.15],[0,0],[0,0],[0,0],[.999,1.186],[1.949,0],[1.275,-.624],[1.149,-1.125],[0,0],[0,0],[0,0],[0,0],[-.425,-1.199]],o:[[.774,-.75],[.837,-.624],[.937,-.45],[1.087,-.249],[2.1,0],[1.624,.726],[1.112,1.299],[.563,1.8],[0,0],[0,0],[0,0],[0,-2.15],[-1,-1.187],[-1.45,0],[-1.275,.625],[0,0],[0,0],[0,0],[0,0],[1.3,0],[0,0]],v:[[-7.553,-14.525],[-5.135,-16.588],[-2.474,-18.199],[.562,-19.249],[4.104,-19.624],[9.689,-18.537],[13.794,-15.5],[16.306,-10.852],[17.149,-4.929],[17.149,19.624],[6.841,19.624],[6.841,-4.929],[5.343,-9.933],[.918,-11.714],[-3.167,-10.777],[-6.803,-8.153],[-6.803,19.624],[-17.149,19.624],[-17.149,-19.023],[-10.777,-19.023],[-8.19,-17.224]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.956,20.743],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:10,ty:4,nm:"g1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:9,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:12,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:59,s:[100]},{t:62,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[448.5,371,0],ix:2},a:{a:0,k:[19.5,27.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-2.099,0],[-1.012,1.075],[0,1.699],[1.013,1.012],[2.124,0],[.999,-1.013],[0,-1.775],[-1.012,-1.087]],o:[[2.124,0],[1.013,-1.075],[0,-1.775],[-1.012,-1.013],[-2.124,0],[-1,1.012],[0,1.673],[1.013,1.087]],v:[[-1.518,-7.834],[3.185,-9.446],[4.704,-13.606],[3.185,-17.786],[-1.518,-19.305],[-6.204,-17.786],[-7.703,-13.606],[-6.186,-9.465]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[0,.676],[.425,.424],[.713,.25],[.975,.112],[1.098,.064],[1.174,.05],[1.125,.125],[.563,-.712],[0,-.899],[-.288,-.525],[-.674,-.375],[-1.1,-.213],[-1.65,0],[-1.176,.227],[-.726,.412],[-.313,.574]],o:[[0,-.674],[-.424,-.424],[-.711,-.25],[-.974,-.113],[-1.101,-.061],[-1.175,-.05],[-.875,.525],[-.562,.712],[0,.625],[.287,.526],[.675,.375],[1.099,.213],[1.699,0],[1.174,-.224],[.724,-.412],[.312,-.576]],v:[[8.265,14.506],[7.628,12.857],[5.922,11.846],[3.392,11.302],[.281,11.039],[-3.13,10.871],[-6.579,10.608],[-8.735,12.464],[-9.577,14.881],[-9.147,16.605],[-7.703,17.955],[-5.042,18.836],[-.919,19.154],[3.392,18.816],[6.241,17.861],[7.797,16.381]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ind:2,ty:"sh",ix:3,ks:{a:0,k:{i:[[0,0],[0,0],[.337,-.349],[.773,-.175],[0,0],[0,-1.4],[.788,-1.537],[1.374,-1.088],[1.875,-.587],[2.174,0],[1.199,.225],[0,-.774],[-.712,-.324],[-1.162,-.137],[-1.487,-.038],[-1.536,-.125],[-1.487,-.313],[-1.162,-.713],[-.712,-1.175],[0,-1.848],[.85,-1.625],[1.611,-1.275],[2.348,-.774],[2.999,0],[2.186,.562],[1.437,.937],[.7,1.224],[0,1.325],[-1.05,1.199],[-1.849,.726],[.586,.887],[0,1.425],[-.837,1.275],[-1.749,.85],[1.149,1.762],[0,2.349],[-.787,1.55],[-1.399,1.087],[-1.899,.575],[-2.225,0],[-2.524,-1.299]],o:[[0,0],[0,.599],[-.338,.351],[0,0],[.425,1.225],[0,1.925],[-.787,1.537],[-1.374,1.087],[-1.874,.587],[-1.374,0],[-1.05,.651],[0,.725],[.713,.326],[1.162,.137],[1.486,.038],[1.537,.126],[1.487,.312],[1.162,.712],[.712,1.175],[0,1.724],[-.849,1.625],[-1.612,1.274],[-2.35,.775],[-2.974,0],[-2.187,-.561],[-1.437,-.938],[-.699,-1.225],[0,-1.724],[1.049,-1.201],[-.974,-.55],[-.587,-.887],[0,-1.149],[.836,-1.274],[-1.974,-1.049],[-1.15,-1.762],[0,-1.924],[.787,-1.549],[1.4,-1.087],[1.899,-.575],[3.299,0],[0,0]],v:[[18.536,-24.44],[18.536,-20.654],[18.031,-19.23],[16.363,-18.442],[13.213,-17.805],[13.85,-13.869],[12.67,-8.678],[9.427,-4.741],[4.553,-2.23],[-1.518,-1.35],[-5.379,-1.687],[-6.954,.45],[-5.885,2.024],[-3.074,2.718],[.9,2.98],[5.434,3.224],[9.97,3.88],[13.945,5.417],[16.756,8.247],[17.824,12.782],[16.549,17.805],[12.858,22.154],[6.916,25.227],[-1.107,26.389],[-8.846,25.545],[-14.282,23.297],[-17.488,20.055],[-18.536,16.23],[-16.962,11.846],[-12.615,8.959],[-14.957,6.804],[-15.838,3.336],[-14.582,-.3],[-10.702,-3.486],[-15.387,-7.703],[-17.113,-13.869],[-15.931,-19.08],[-12.652,-23.034],[-7.703,-25.527],[-1.518,-26.389],[7.216,-24.44]],c:!0},ix:2},nm:"Path 3",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"mm",mm:1,nm:"Merge Paths 1",mn:"ADBE Vector Filter - Merge",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.225,27.434],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:5,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:11,ty:4,nm:"s1 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:10,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:13,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:60,s:[100]},{t:63,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[487.5,357,0],ix:2},a:{a:0,k:[19.5,28.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.362,-.263],[.576,0],[.638,.388],[.849,.45],[1.099,.387],[1.474,0],[1.299,-1.162],[0,-1.875],[-.713,-.787],[-1.162,-.574],[-1.475,-.45],[-1.55,-.537],[-1.475,-.725],[-1.162,-1.099],[-.712,-1.587],[0,-2.274],[.862,-2.161],[1.624,-1.612],[2.387,-.925],[3.023,0],[1.712,.35],[1.587,.624],[1.398,.875],[1.049,1.075],[0,0],[-.45,.261],[-.5,0],[-.749,-.499],[-.975,-.6],[-1.288,-.499],[-1.798,0],[-1.437,1.2],[0,2.375],[.712,.85],[1.15,.575],[1.473,.412],[1.55,.5],[1.474,.699],[1.149,1.151],[.712,1.7],[0,2.524],[-.8,1.9],[-1.55,1.474],[-2.262,.9],[-2.924,0],[-2.787,-1.012],[-1.924,-1.8]],o:[[-.351,.575],[-.363,.262],[-.549,0],[-.637,-.387],[-.85,-.451],[-1.1,-.387],[-2.599,0],[-1.3,1.162],[0,1.2],[.712,.787],[1.162,.575],[1.474,.45],[1.549,.539],[1.474,.725],[1.162,1.1],[.712,1.587],[0,2.474],[-.862,2.161],[-1.625,1.611],[-2.387,.923],[-1.725,0],[-1.712,-.351],[-1.587,-.625],[-1.401,-.874],[0,0],[.274,-.4],[.45,-.263],[.675,0],[.75,.501],[.974,.599],[1.287,.5],[2.624,0],[1.437,-1.199],[0,-1.374],[-.713,-.849],[-1.149,-.574],[-1.475,-.412],[-1.549,-.499],[-1.474,-.699],[-1.15,-1.149],[-.713,-1.698],[0,-2.023],[.799,-1.898],[1.55,-1.474],[2.261,-.9],[3.274,0],[2.786,1.013],[0,0]],v:[[15.032,-16.774],[13.963,-15.517],[12.557,-15.124],[10.776,-15.705],[8.546,-16.96],[5.623,-18.217],[1.762,-18.798],[-4.085,-17.054],[-6.035,-12.5],[-4.966,-9.52],[-2.155,-7.477],[1.799,-5.941],[6.335,-4.46],[10.871,-2.567],[14.826,.17],[17.637,4.199],[18.705,9.99],[17.412,16.945],[13.682,22.605],[7.666,26.409],[-.45,27.795],[-5.604,27.272],[-10.553,25.809],[-15.03,23.559],[-18.705,20.635],[-15.405,15.314],[-14.319,14.321],[-12.896,13.927],[-10.758,14.676],[-8.171,16.325],[-4.779,17.974],[-.15,18.724],[5.941,16.925],[8.097,11.565],[7.028,8.229],[4.235,6.092],[.3,4.612],[-4.236,3.243],[-8.771,1.445],[-12.708,-1.33],[-15.5,-5.603],[-16.568,-11.938],[-15.369,-17.823],[-11.846,-22.884],[-6.128,-26.445],[1.649,-27.795],[10.739,-26.277],[17.805,-22.058]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.941,28.17],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:12,ty:4,nm:"u2 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:11,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:14,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:61,s:[100]},{t:64,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[529.5,365,0],ix:2},a:{a:0,k:[17.5,20.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[.375,1.2],[0,0],[.825,-.625],[.938,-.449],[1.087,-.249],[1.275,0],[1.636,.725],[1.1,1.299],[.575,1.798],[0,2.149],[0,0],[0,0],[0,0],[-.987,-1.188],[-1.95,0],[-1.275,.638],[-1.149,1.101],[0,0]],o:[[0,0],[0,0],[-1.325,0],[0,0],[-.774,.749],[-.824,.625],[-.936,.45],[-1.087,.249],[-2.099,0],[-1.637,-.724],[-1.099,-1.3],[-.575,-1.8],[0,0],[0,0],[0,0],[0,2.149],[.988,1.186],[1.449,0],[1.274,-.638],[0,0],[0,0]],v:[[17.149,-19.623],[17.149,19.024],[10.777,19.024],[8.228,17.225],[7.553,14.526],[5.154,16.588],[2.511,18.199],[-.525,19.249],[-4.067,19.623],[-9.671,18.537],[-13.776,15.501],[-16.287,10.853],[-17.149,4.93],[-17.149,-19.623],[-6.803,-19.623],[-6.803,4.93],[-5.323,9.935],[-.918,11.715],[3.168,10.759],[6.803,8.153],[6.803,-19.623]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.53,20.342],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:13,ty:4,nm:"i2 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:12,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:15,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:62,s:[100]},{t:65,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[561,356,0],ix:2},a:{a:0,k:[7,28.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[5.172,27.964],[-5.174,27.964],[-5.174,-10.683],[5.172,-10.683]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[0,0]],o:[[0,0]],v:[[5.172,-10.683]],c:!1},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ind:2,ty:"sh",ix:3,ks:{a:0,k:{i:[[0,-.875],[.35,-.75],[.588,-.574],[.787,-.324],[.9,0],[.762,.325],[.576,.575],[.338,.749],[0,.875],[-.338,.763],[-.574,.576],[-.762,.325],[-.85,0],[-.787,-.324],[-.588,-.574],[-.35,-.762]],o:[[0,.875],[-.35,.749],[-.588,.575],[-.787,.325],[-.85,0],[-.762,-.324],[-.574,-.574],[-.338,-.75],[0,-.875],[.338,-.762],[.576,-.574],[.762,-.324],[.9,0],[.787,.325],[.588,.576],[.35,.763]],v:[[6.41,-21.666],[5.885,-19.229],[4.479,-17.243],[2.418,-15.893],[-.113,-15.406],[-2.531,-15.893],[-4.537,-17.243],[-5.904,-19.229],[-6.41,-21.666],[-5.904,-24.121],[-4.537,-26.127],[-2.531,-27.476],[-.113,-27.964],[2.418,-27.476],[4.479,-26.127],[5.885,-24.121]],c:!0},ix:2},nm:"Path 3",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"mm",mm:1,nm:"Merge Paths 1",mn:"ADBE Vector Filter - Merge",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.699,28.402],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:5,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:14,ty:4,nm:"t2 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:13,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:16,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:63,s:[100]},{t:66,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[590,359,0],ix:2},a:{a:0,k:[14,26.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[1.924,0],[1.349,.512],[.924,.949],[.474,1.349],[0,1.7],[0,0],[0,0],[.388,.351],[0,.7],[0,0],[0,0],[0,0],[-1.25,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[-.513,-.624],[-.951,0],[-.351,.113],[-.25,.137],[-.213,.112],[-.226,0],[-.2,-.136],[-.201,-.325],[0,0],[1.799,-.575]],o:[[-1.75,0],[-1.35,-.511],[-.924,-.95],[-.475,-1.35],[0,0],[0,0],[-.55,0],[-.388,-.349],[0,0],[0,0],[0,0],[.275,-1.125],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,1.075],[.512,.625],[.499,0],[.35,-.112],[.249,-.138],[.212,-.112],[.3,0],[.2,.138],[0,0],[-1.425,1.124],[-1.8,.574]],v:[[3.036,25.395],[-1.612,24.628],[-5.024,22.435],[-7.123,18.987],[-7.835,14.413],[-7.835,-6.427],[-11.471,-6.427],[-12.877,-6.953],[-13.457,-8.528],[-13.457,-12.576],[-7.273,-13.7],[-5.174,-23.708],[-2.887,-25.395],[2.511,-25.395],[2.511,-13.626],[12.482,-13.626],[12.482,-6.427],[2.511,-6.427],[2.511,13.739],[3.279,16.287],[5.473,17.224],[6.747,17.055],[7.646,16.681],[8.34,16.306],[8.996,16.137],[9.745,16.344],[10.346,17.037],[13.457,21.986],[8.621,24.534]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.026,26.57],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:15,ty:4,nm:"e2 Outlines",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.333],y:[0]},t:14,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:17,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.167]},t:64,s:[100]},{t:67,s:[0]}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[623.5,364.5,0],ix:2},a:{a:0,k:[18.5,21,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.287,.974],[.624,.75],[.949,.437],[1.324,0],[1.4,-1.398],[.425,-2.599]],o:[[0,-1.074],[-.288,-.975],[-.625,-.75],[-.95,-.438],[-2.475,0],[-1.399,1.4],[0,0]],v:[[8.659,-4.535],[8.228,-7.609],[6.859,-10.195],[4.499,-11.975],[1.087,-12.632],[-4.724,-10.533],[-7.459,-4.535]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[0,0],[-1.737,-1.674],[-2.799,0],[-1.037,.337],[-.787,.413],[-.637,.337],[-.625,0],[-.449,-.599],[0,0],[1.324,-.837],[1.424,-.487],[1.449,-.186],[1.35,0],[2.336,.887],[1.737,1.736],[.999,2.574],[0,3.399],[-.863,2.324],[-1.625,1.725],[-2.324,1.012],[-2.924,0],[-2.087,-.788],[-1.511,-1.5],[-.837,-2.187],[0,-2.799],[.076,-.5],[.175,-.299],[.299,-.113],[.475,0]],o:[[.326,3.624],[1.737,1.675],[1.424,0],[1.036,-.337],[.787,-.412],[.637,-.338],[.8,0],[0,0],[-1.1,1.275],[-1.325,.838],[-1.425,.488],[-1.45,.188],[-2.698,0],[-2.337,-.886],[-1.737,-1.737],[-1,-2.573],[0,-2.624],[.862,-2.324],[1.624,-1.725],[2.324,-1.012],[2.474,0],[2.086,.787],[1.512,1.499],[.837,2.187],[0,.774],[-.075,.5],[-.174,.3],[-.3,.112],[0,0]],v:[[-7.61,1.612],[-4.518,9.559],[2.287,12.07],[5.979,11.565],[8.715,10.44],[10.852,9.316],[12.745,8.81],[14.619,9.709],[17.618,13.457],[13.981,16.625],[9.858,18.611],[5.547,19.623],[1.349,19.904],[-6.204,18.574],[-12.314,14.639],[-16.418,8.172],[-17.917,-.787],[-16.625,-8.209],[-12.896,-14.281],[-6.973,-18.386],[.899,-19.904],[7.74,-18.723],[13.137,-15.293],[16.662,-9.764],[17.917,-2.286],[17.805,-.374],[17.43,.825],[16.718,1.444],[15.556,1.612]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"mm",mm:1,nm:"Merge Paths 1",mn:"ADBE Vector Filter - Merge",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.538,21.024],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:4,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:750,st:0,bm:0},{ddd:0,ind:16,ty:0,nm:"video-logo",refId:"comp_0",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[358,202.5,0],ix:2},a:{a:0,k:[960,540,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,hasMask:!0,masksProperties:[{inv:!1,mode:"n",pt:{a:0,k:{i:[[0,0],[0,-36],[114,0],[0,22],[0,23],[0,-37],[0,-36.75],[-38.25,0],[0,28.25],[0,22],[12,0],[0,-28.25],[0,-22],[15.25,0],[0,19],[0,30],[0,0]],o:[[0,0],[0,36],[-114,0],[0,-22],[0,-23],[0,37],[0,36.75],[38.25,0],[0,-28.25],[0,-22],[-12,0],[0,28.25],[0,22],[-15.25,0],[0,-19],[0,-30],[0,0]],v:[[1059,364],[1059,451],[959,608],[858,485],[861,409],[898,410],[898.25,509],[961.5,565.75],[1020.5,509.75],[1019,438.25],[1001.5,406.5],[980,437.25],[979,499.5],[960,525.5],[938.25,504.5],[939,392],[913,344.5]],c:!1},ix:1},o:{a:0,k:100,ix:3},x:{a:0,k:0,ix:4},nm:"Mask 1"}],ef:[{ty:22,nm:"Stroke",np:13,mn:"ADBE Stroke",ix:1,en:1,ef:[{ty:10,nm:"Path",mn:"ADBE Stroke-0001",ix:1,v:{a:0,k:1,ix:1}},{ty:7,nm:"All Masks",mn:"ADBE Stroke-0010",ix:2,v:{a:0,k:0,ix:2}},{ty:7,nm:"Stroke Sequentially",mn:"ADBE Stroke-0011",ix:3,v:{a:0,k:1,ix:3}},{ty:2,nm:"Color",mn:"ADBE Stroke-0002",ix:4,v:{a:0,k:[1,1,1,1],ix:4}},{ty:0,nm:"Brush Size",mn:"ADBE Stroke-0003",ix:5,v:{a:0,k:20,ix:5}},{ty:0,nm:"Brush Hardness",mn:"ADBE Stroke-0004",ix:6,v:{a:0,k:.75,ix:6}},{ty:0,nm:"Opacity",mn:"ADBE Stroke-0005",ix:7,v:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:49,s:[1]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:50,s:[0]},{t:51,s:[1]}],ix:7}},{ty:0,nm:"Start",mn:"ADBE Stroke-0008",ix:8,v:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:0,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:25,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:49,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:51,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:76,s:[0]},{t:100,s:[100]}],ix:8}},{ty:0,nm:"End",mn:"ADBE Stroke-0009",ix:9,v:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:0,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:25,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:49,s:[100]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:51,s:[0]},{t:76,s:[100]}],ix:9}},{ty:7,nm:"Spacing",mn:"ADBE Stroke-0006",ix:10,v:{a:0,k:15,ix:10}},{ty:7,nm:"Paint Style",mn:"ADBE Stroke-0007",ix:11,v:{a:0,k:3,ix:11}}]}],w:1920,h:1080,ip:0,op:750,st:0,bm:0}],markers:[]}})}}}),angular.module("engage").component("umsMarketingAutomation",{template:'<div class="ums-topbar__container"><div class="ums-content ums-topbar__content"><div class="ums-topbar__icon"><ums-icon id="icon-marketing-automation" modifier="lg"></ums-icon></div><div class="ums-topbar__title">Marketing Automation</div><ums-package-status></ums-package-status></div></div>',controller:function(){this.$onInit=function(){}}}),angular.module("engage").component("umsOverlay",{template:'<div class="ums-overlay__fullscreen" role="dialog"><div class="ums-overlay__scroll-layer"><div class="ums-overlay__container" ng-class="{\'s-closing\': $ctrl.state.isClosing, \'ums-overlay__container--small\': $ctrl.small, \'ums-overlay__container--large\': $ctrl.large, \'ums-overlay__container--fluid\': $ctrl.fluid}"><div class="ums-overlay__close js-closeOverlay" ng-click="$ctrl.closeOverlay()" title aria-label="Close overlay"><span>Close</span><ums-icon id="icon-close" modifier="xs"></ums-icon></div><div class="ums-overlay__header" ng-transclude="header"></div><div class="ums-overlay__content" ng-transclude="body" ng-class="{\'ums-overlay__content--dark\': $ctrl.dark, \'ums-overlay__content--nopadding\': $ctrl.nopadding}"></div><div class="ums-overlay__footer" ng-transclude="footer"></div><div class="ums-overlay__sticky" ng-transclude="sticky"></div></div></div><div class="ums-overlay__closelayer js-closeOverlay"></div></div>',transclude:{header:"?umsOverlayHeader",body:"umsOverlayBody",footer:"?umsOverlayFooter",sticky:"?umsOverlaySticky"},bindings:{close:"&",small:"<?",large:"<?",dark:"<?",fluid:"<?",nopadding:"<?"},controller:function($element,$timeout){var ctrl=this;function closeOnEscape(e){"Escape"===e.key&&$timeout(function(){ctrl.close()})}this.$onInit=function(){$element.parents(".is-animated").removeClass("is-animated"),$element.find(".ums-overlay__container .ums-overlay__close")[0].focus(),document.addEventListener("keyup",closeOnEscape),this.pushBehindUmbracoTree(),this.$onDestroy=function(){document.removeEventListener("keyup",closeOnEscape)}},this.state={isClosing:!1},this.pushBehindUmbracoTree=function(){var offsetLeft=$(".navigation-inner-container").outerWidth();$element.find(".ums-overlay__fullscreen").css("padding-left",offsetLeft)},this.closeOverlay=function(){ctrl.state.isClosing=!0,function closeOnAnimationEnd(){var container=$element.find(".ums-overlay__container")[0];container.addEventListener("animationend",function onAnimationEnd(){ctrl.state.isClosing&&$timeout(function(){ctrl.state.isClosing=!1,ctrl.close()});container.removeEventListener("animationend",onAnimationEnd)})}()}}}),angular.module("engage").service("umsPackageService",["$http",umsPackageService]),angular.module("engage").factory("umsPackageState",["umsPackageService",umsPackageState]),angular.module("engage").component("umsPackageStatus",{bindings:{large:"<?"},template:'<div class="ums-alert__holder"><div ng-if="$ctrl.configuration && !$ctrl.configuration.settings.enabled" class="ums-alert__container ums-alert__container--error" ng-class="{ \'ums-alert__container--sm\' : !$ctrl.large }"><div>Umbraco Engage is disabled and not collecting data.<br><a href="/umbraco/#/engage/settings/configuration">Enable Engage</a></div></div><div ng-if="$ctrl.state.licenseStatus === 1 && $ctrl.state.isTrialMode === true" class="ums-alert__container ums-alert__container--warning" ng-class="{ \'ums-alert__container--sm\' : !$ctrl.large }"><div>You are running in trial mode. Purchase a license <strong><a href="https://umbraco.com/products/add-ons/engage/" target="_blank" class="ums-linkbox__button--link-on-parent">here</a>.</strong></div></div><div ng-if="$ctrl.state.licenseStatus !== 1 || $ctrl.state.expiresSoon === true" class="ums-alert__container ums-alert__container--warning" ng-class="{ \'ums-alert__container--sm\' : !$ctrl.large }"><div ng-if="$ctrl.state.expiresSoon === true">Warning: the current license will expire soon ({{ $ctrl.state.expirationDate | date:\'longDate\' }}).<br>Please consider a renewal.</div><div ng-if="$ctrl.state.licenseStatus === 2">The license has expired.<br>Please renew the license to continue using the Umbraco Engage.</div><div ng-if="$ctrl.state.licenseStatus === 3">There was an error reading the license.<br>Please contact your local administrator or Umbraco Support.</div><div ng-if="$ctrl.state.licenseStatus === 4">Request limit exceeded.<br>Please contact your local administrator or Umbraco Support.</div></div></div>',controller:["umsPackageState","umsConfigurationService",function(packageState,configurationService){var ctrl=this;this.state=packageState,this.configuration=null,this.$onInit=function(){!function getConfiguration(){return configurationService.getConfiguration().then(function(configuration){return ctrl.configuration=configuration,configuration})}()}}]}),angular.module("engage").component("umsPermissionsOverview",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--1-1 ums-flexgrid__item--md-1-3 ums-flexgrid__item--lg-1-4 is-animated"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/illustration-settings-config.png" alt><br><h2>Permissions</h2><p>In this section you can set the permissions per document type and per user group.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 ums-flexgrid__item--md-2-3 ums-flexgrid__item--lg-3-4 is-animated"><div class="ums-filter__container"><div class="ums-filter__row ums-filter__row--auto" style="margin-bottom: 0;"><div class="ums-filter__item"><div class="ums-form__switch ums-form__switch--autosize"><input type="radio" name="subFilter" id="referral-scoring-filter-0" no-dirty-check ng-model="$ctrl.state.subFilter" ng-value="0" class="ums-form__switch__input" required> <label for="referral-scoring-filter-0" class="ums-form__switch__label ums-form__switch__label--lg">Document type permissions</label> <input type="radio" name="subFilter" id="referral-scoring-filter-1" no-dirty-check ng-model="$ctrl.state.subFilter" ng-value="1" class="ums-form__switch__input" required> <label for="referral-scoring-filter-1" class="ums-form__switch__label ums-form__switch__label--lg">User group permissions</label></div></div></div></div><br><br><div><ums-document-type-permissions ng-show="$ctrl.state.subFilter === 0"></ums-document-type-permissions><ums-user-group-permissions ng-show="$ctrl.state.subFilter === 1"></ums-user-group-permissions></div></div></div></div>',controller:[function umsPermissionsOverviewCtrl(){this.state={subFilter:0}}]}),angular.module("engage").component("umsPersonalization",{template:'<ums-section-topbar title="Personalization" icon="icon-personalization"></ums-section-topbar><ums-screens><ums-screen name="Applied Personalization"><ums-applied-personalization-overview></ums-applied-personalization-overview></ums-screen><ums-screen name="Segments"><ums-segment-overview></ums-segment-overview></ums-screen><ums-screen name="Referral Scoring"><ums-referral-scoring></ums-referral-scoring></ums-screen><ums-screen name="Campaign Scoring"><ums-campaign-scoring></ums-campaign-scoring></ums-screen><ums-screen name="Personas"><ums-persona-main></ums-persona-main></ums-screen><ums-screen name="Journeys"><ums-cj-main></ums-cj-main></ums-screen><ums-screen name="Insights"><ums-personalization-insight></ums-personalization-insight></ums-screen></ums-screens>'}),angular.module("engage").component("umsProfiles",{template:'<ums-section-topbar title="Profiles" icon="icon-profiles"></ums-section-topbar><ums-screens no-nav="$ctrl.sharedId != null"><ums-screen name="Profiles"><ums-screens back="/umbraco/#/engage/profiles/profiles/overview" no-nav="$ctrl.sharedId == null"><ums-screen name="Overview" hide="true"><ums-profile-overview visitor-id="$ctrl.sharedId"></ums-profile-overview></ums-screen><ums-screen name="Insights"><ums-profile-location-container shared-visitor-id="$ctrl.sharedId" redirect-url="/engage/profiles/profiles/overview"><ums-profile-insights ng-if="$ctrl.sharedId" visitor-id="$ctrl.sharedId" show-members="true"></ums-profile-insights></ums-profile-location-container></ums-screen><ums-screen name="Activity"><ums-profile-location-container shared-visitor-id="$ctrl.sharedId" redirect-url="/engage/profiles/profiles/overview"><ums-profile-activity ng-if="$ctrl.sharedId" visitor-id="$ctrl.sharedId" show-members="true"></ums-profile-activity></ums-profile-location-container></ums-screen><ums-screen name="Commerce"><ums-profile-location-container shared-visitor-id="$ctrl.sharedId" redirect-url="/engage/profiles/profiles/overview"><ums-profile-commerce ng-if="$ctrl.sharedId" visitor-id="$ctrl.sharedId" show-members="true"></ums-profile-commerce></ums-profile-location-container></ums-screen><ums-screen name="External Profile Data" ng-if="$ctrl.externalProfileDataComponent != null"><ums-profile-location-container shared-visitor-id="$ctrl.sharedId" redirect-url="/engage/profiles/profiles/overview"><ums-profile-external-data visitor-id="$ctrl.sharedId" custom-component="$ctrl.externalProfileDataComponent"></ums-profile-external-data></ums-profile-location-container></ums-screen></ums-screens></ums-screen></ums-screens>',controller:["umsCustomComponents",function(customComponents){this.sharedId=null,this.$onInit=function(){this.externalProfileDataComponent=customComponents.profiles.externalProfileData}}]}),angular.module("engage").component("umsRenderProperty",{template:'<umb-property-editor model="$ctrl.property" ng-if="$ctrl.property"></umb-property-editor><div class="umb-alert umb-alert--warning" ng-if="$ctrl.errorMsg" ng-bind="$ctrl.errorMsg"></div>',bindings:{id:"=?",key:"=?",alias:"=?",name:"=?",label:"=?",description:"=?",showLabel:"=?",config:"=?",getValue:"&?",setValue:"&?",onChange:"&?"},require:{ngModel:"?ngModel"},controller:["umsRenderPropertyService",function(service){this.$onInit=function(){var ctrl=this;if(null==ctrl.id&&null==ctrl.key&&null==ctrl.alias)throw new Error("Pass in either an `id` or `key` or `alias`");var getValue=ctrl.getValue,setValue=ctrl.setValue,onChange=ctrl.onChange;function handleError(error){error&&(error.message||error.errorMsg)?ctrl.errorMsg=error.message||error.errorMsg:ctrl.errorMsg="Property could not be rendered"}function applyScaffold(propertyTypeScaffold){if(null!=propertyTypeScaffold){ctrl.property=propertyTypeScaffold,ctrl.property.hideLabel=!ctrl.label&&!ctrl.showLabel,ctrl.property.label=ctrl.label,ctrl.property.description=ctrl.description,null!=ctrl.config&&null!=ctrl.property.config&&Object.assign(ctrl.property.config,ctrl.config);var getValueIsFn="function"==typeof getValue,setValueIsFn="function"==typeof setValue,onChangeIsFn="function"==typeof onChange,customModel=null!=ctrl.ngModel;if(getValueIsFn||setValueIsFn||onChangeIsFn||customModel){var attributes={};customModel?(attributes.get=function(){return ctrl.ngModel.$modelValue},attributes.set=function(value){ctrl.ngModel.$setViewValue(value),ctrl.ngModel.$processModelValue(value),onChangeIsFn&&onChange({value:value})}):(getValueIsFn&&(attributes.get=function(){return getValue()}),(setValueIsFn||onChangeIsFn)&&(attributes.set=function(value){setValueIsFn&&setValue({value:value}),onChangeIsFn&&onChange({value:value})})),Object.defineProperty(ctrl.property,"value",attributes)}}}null!=ctrl.id?service.getPropertyTypeScaffoldById(ctrl.id).then(applyScaffold,handleError):null!=ctrl.key?service.getPropertyTypeScaffoldByKey(ctrl.key).then(applyScaffold,handleError):service.getPropertyTypeScaffoldByAlias(ctrl.alias,ctrl.name).then(applyScaffold,handleError)}}]}),angular.module("engage").service("umsRenderPropertyService",["contentTypeResource","dataTypeResource",function umsRenderPropertyService(contentTypeResource,dataTypeResource){var cacheByAlias={},cacheByKey={},cacheById={};function getPropertyTypeScaffoldById(id){return null==cacheById[id]&&(cacheById[id]=contentTypeResource.getPropertyTypeScaffold(id)),cacheById[id].then(function(value){return angular.copy(value)},function(e){throw new Error('No property editor with id "'+id+'" was found.')})}this.getPropertyTypeScaffoldByAlias=function getPropertyTypeScaffoldByAlias(alias,name){null==cacheByAlias[alias]&&(cacheByAlias[alias]={});var cached=cacheByAlias[alias][name];return null==cached&&(cached=cacheByAlias[alias][name]=dataTypeResource.getAll().then(function(response){var dataTypes=_.filter(response,{alias:alias});return dataTypes.length>0?getScaffoldFromDataTypes(dataTypes):dataTypeResource.getGroupedDataTypes().then(function(response){var allTypes=_.flatten(_.values(response)),dataTypes=_.filter(allTypes,{alias:alias});if(0===dataTypes.length)throw new Error('No property editor with alias "'+alias+'" was found.');return getScaffoldFromDataTypes(dataTypes)});function getScaffoldFromDataTypes(dataTypes){var dataType=(null!=name?_.filter(dataTypes,{name:name}):dataTypes)[0];if(null==dataType)throw new Error('None of the datatypes with alias "'+alias+'" have a name equal to "'+name+'"');return getPropertyTypeScaffoldById(dataType.id)}})),cached.then(function(value){return angular.copy(value)})},this.getPropertyTypeScaffoldById=getPropertyTypeScaffoldById,this.getPropertyTypeScaffoldByKey=function getPropertyTypeScaffoldByKey(key){var cached=cacheByKey[key];return null==cached&&(cached=cacheByKey[key]=dataTypeResource.getAll().then(function(response){var dataType=_.find(response,{key:key});if(null!=dataType)return getPropertyTypeScaffoldById(dataType.id);throw new Error('No data type found with key "'+key+'"')})),cached.then(function(value){return angular.copy(value)})},this.clearCache=function clearCache(dataType){null!=dataType&&(null!=dataType.alias&&delete cacheByAlias[dataType.alias],null!=dataType.id&&delete cacheById[dataType.id],null!=dataType.key&&delete cacheByKey[dataType.key])}}]),angular.module("engage").decorator("dataTypeResource",["$delegate","$injector",function($delegate,$injector){if("function"==typeof $delegate.save){var saveFn=$delegate.save;$delegate.save=function(){return saveFn.apply(this,arguments).then(function(dataType){return function updateScaffoldCache(dataType){if(null==dataType)return;var propertyService=$injector.get("umsRenderPropertyService");if(null==propertyService)return;propertyService.clearCache(dataType)}(dataType),dataType})}}return $delegate}]),angular.module("engage").component("umsReportingBarchart",{template:'<div class="ums-reporting__graph ums-linkbox"><div class="ums-reporting__graph-label"><h3>{{$ctrl.name}} <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text ums-reporting__info-text">{{$ctrl.tooltip}}</span></span></h3><div class="ums-reporting__graph-toggle" ng-click="$ctrl.togglePercentage()"><ums-icon id="icon-hashtag" ng-class="{\'ums-reporting__graph-toggle--selected\': !$ctrl.showPercentages}" modifier="btn"></ums-icon><label class="ums-reporting__graph-toggle-switch"><input style="display: none;" type="checkbox" ng-checked="$ctrl.showPercentages"> <span ng-class="{\'ums-reporting__graph-toggle-switch--right\': $ctrl.showPercentages, \'ums-reporting__graph-toggle-switch--left\': !$ctrl.showPercentages }"></span></label><ums-icon id="icon-discount" ng-class="{\'ums-reporting__graph-toggle--selected\': $ctrl.showPercentages}" modifier="btn"></ums-icon></div></div><hr><div class="ums-reporting__graph-canvas"><ums-prefab-chart alias="$ctrl.alias" drilldown="$ctrl.drilldown" show-percentages="$ctrl.showPercentages" show-annotations="false" theme="\'reporting-bar\'" is-full-height="true"></ums-prefab-chart></div></div>',bindings:{name:"@",tooltip:"@",alias:"@",drilldown:"<?"},controller:[function umsReportingController(){var $ctrl=this;$ctrl.showPercentages=!1,$ctrl.togglePercentage=function(){$ctrl.showPercentages=!$ctrl.showPercentages}}]}),angular.module("engage").component("umsReportingChartWrapper",{template:'<div class="ums-content umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Goal performance <span class="ums-form__info__bullet" style="position: relative;"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text" style="min-width: 200px; font-size:13px">Compare Goal Performance over the last 180 days for this segment between Control group and Personalized group.</span></span></h2><div class="ums-reporting__graph ums-reporting__graph--scale ums-linkbox"><div class="ums-reporting__graph-label"><h3>{{$ctrl.name}} <span class="ums-form__info__bullet" ng-if="$ctrl.tooltip"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text ums-reporting__info-text">{{$ctrl.tooltip}}</span></span></h3></div><hr><div class="ums-reporting__graph-canvas"><div ng-transclude></div></div></div></div>',bindings:{name:"@",tooltip:"@"},controller:[umsReportingChartWrapperController],transclude:!0}),angular.module("engage").component("umsReportingDataGenerationLog",{template:'<table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><th class="ums-table__th">Started</th><th class="ums-table__th">Finished</th><th class="ums-table__th">Status</th><th class="ums-table__th">Error</th></tr></thead><tbody><tr ng-repeat="entry in $ctrl.entries track by $index" ng-style="entry.failed && { \'background-color\': \'#cc0000\', \'color\': \'white\' }" class="ums-table__tr"><td class="ums-table__td" ng-bind="entry.started | date:\'yyyy-MM-dd HH:mm:ss\'"></td><td class="ums-table__td" ng-bind="entry.finished | date:\'yyyy-MM-dd HH:mm:ss\'"></td><td class="ums-table__td" ng-bind="entry.failed ? \'Failed\' : \'Success\'"></td><td class="ums-table__td" ng-bind="entry.errorMessage"></td></tr></tbody></table>',bindings:{amount:"<?"},controller:["$http",function($http){var $ctrl=this;$ctrl.entries=[],$ctrl.$onChanges=function(){$ctrl.getEntries(this.amount).then(function(entries){$ctrl.entries=entries})},$ctrl.getEntries=function(amount){return $http.get("/umbraco/backoffice/engage/datageneration/getlogs?amount="+amount).then(function(response){return response.data||[]})}}]}),angular.module("engage").component("umsReporting",{template:'<ums-section-topbar title="Reporting" icon="icon-reporting"></ums-section-topbar><ums-screens><ums-screen name="Segments"><div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar ums-reporting__top-bar"><h2 class="umsHeading ums-headerbar__title ums-reporting__h2">Segment</h2><div class="ums-headerbar__options-wrapper"><div class="ums-reporting__button-group"><button type="button" ng-class="{selected:true}" ng-click="$ctrl.update(\'day\')">Last 30 days</button> <button type="button" disabled class="dissabled">Last 3 months</button> <button type="button" disabled class="dissabled">Last year</button></div></div></div><div class="ums-content ums-reporting__segments-container"><div class="ums-linkbox ums-linkbox--license ums-reporting__segment-select"><h3>Select a segment</h3><select class="ums-reporting__selector" ng-model="$ctrl.selectedSegment"><option value disabled selected hidden>Segment ...</option><option ng-repeat="segment in $ctrl.segments track by segment.id" ng-value="segment">{{segment.name}}</option></select><div class="ums-reporting__segment-bg-logo"><svg viewBox="0 0 139.514 139.5"><path d="m131.429 37.217 6.477-6.477a5.457 5.457 0 0 0-3.836-9.317h-15.993V5.48a5.457 5.457 0 0 0-9.317-3.836l-6.477 6.477A68.906 68.906 0 0 0 69.75 0a69.8 69.8 0 1 0 61.679 37.217ZM112.6 32.334h8.27l-10.516 10.512h-13.7v-13.7l10.512-10.512V26.9a5.443 5.443 0 0 0 5.434 5.434Zm-42.85 96.255a58.839 58.839 0 1 1 24.412-112.4l-6.826 6.826a5.35 5.35 0 0 0-1.594 3.836v19.184L65.914 65.864a5.461 5.461 0 0 0 7.722 7.722l19.829-19.829H112.6a5.472 5.472 0 0 0 3.836-1.594l6.826-6.826a58.879 58.879 0 0 1-53.512 83.252ZM112.7 69.75A42.946 42.946 0 1 1 69.75 26.8a5.431 5.431 0 0 1 0 10.861 32.085 32.085 0 1 0 32.085 32.089 5.431 5.431 0 0 1 10.861 0Z"></path><path d="M69.75 3a66.453 66.453 0 0 0-37.337 11.388A66.851 66.851 0 0 0 8.239 43.751a66.738 66.738 0 0 0 6.149 63.336 66.851 66.851 0 0 0 29.363 24.174 66.738 66.738 0 0 0 63.336-6.149 66.85 66.85 0 0 0 24.174-29.363 66.7 66.7 0 0 0-2.483-57.128l-1.038-1.959 8.044-8.044a2.458 2.458 0 0 0-1.715-4.2h-18.992V5.48a2.458 2.458 0 0 0-2.5-2.445 2.339 2.339 0 0 0-1.7.73l-8.051 8.051-1.963-1.05a65.584 65.584 0 0 0-15.037-5.794A66.437 66.437 0 0 0 69.75 3m.025 69.193a2.448 2.448 0 0 0 1.74-.728l20.708-20.708H112.6a2.479 2.479 0 0 0 1.715-.716l9.879-9.879 1.8 3.926a61.8 61.8 0 0 1-56.236 87.5 61.839 61.839 0 1 1 0-123.678 61.242 61.242 0 0 1 25.661 5.553l3.926 1.8-9.879 9.879a2.349 2.349 0 0 0-.716 1.715v20.421L68.035 67.985a2.468 2.468 0 0 0 1.74 4.208M111.6 45.846H93.654V27.9l16.512-16.512V26.9a2.433 2.433 0 0 0 2.431 2.431h15.513L111.6 45.846M69.75 29.8A39.961 39.961 0 0 0 29.8 69.75a39.946 39.946 0 1 0 79.892 0 2.431 2.431 0 0 0-4.861 0A35.085 35.085 0 1 1 69.75 34.665a2.431 2.431 0 0 0 0-4.861m0-29.8a68.906 68.906 0 0 1 32.533 8.121l6.477-6.477a5.457 5.457 0 0 1 9.317 3.836v15.939h15.993a5.458 5.458 0 0 1 3.836 9.317l-6.477 6.477A69.738 69.738 0 1 1 69.75 0Zm.025 75.193a5.468 5.468 0 0 1-3.861-9.329l19.829-19.833V26.854a5.35 5.35 0 0 1 1.594-3.836l6.826-6.826a58.83 58.83 0 1 0 29.1 29.146l-6.826 6.826a5.472 5.472 0 0 1-3.836 1.594H93.465L73.636 73.586a5.443 5.443 0 0 1-3.861 1.607Zm40.58-32.347 10.512-10.512H112.6a5.443 5.443 0 0 1-5.431-5.431v-8.27L96.654 29.146v13.7ZM69.75 26.8a5.431 5.431 0 0 1 0 10.861 32.085 32.085 0 1 0 32.085 32.089 5.431 5.431 0 0 1 10.861 0A42.946 42.946 0 1 1 69.75 26.8Z"></path></svg></div></div><div class="ums-linkbox ums-reporting__segment-details" ng-if="$ctrl.selectedSegment != null"><h2>{{ $ctrl.selectedSegment.name }}</h2><div class="flex"><div class="ums-reporting__segment-details--desc"><h4>Description</h4><p>{{$ctrl.selectedSegment.description}}</p></div><div class="ums-reporting__segment-details--param"><h4>Parameters</h4><div><div ng-repeat="rule in $ctrl.selectedSegment.rules track by rule.type"><ums-segment-rule-display rule="$ctrl.rulesByType[rule.type]" negation="rule.isNegation" config="rule.config"></ums-segment-rule-display></div></div></div></div><hr><div class="ums-reporting__segment-details--stats"><div ng-if="$ctrl.selectedSegment.isTemporary == false"><ums-icon id="icon-segment-core" modifier="md"></ums-icon><span>Segment Type: Core</span></div><div ng-if="$ctrl.selectedSegment.isTemporary == true"><ums-icon id="icon-segment-temporary" modifier="md"></ums-icon><span>Segment Type: Temporary</span></div><div ng-if="$ctrl.selectedSegment.isTemporary == true"><ums-icon id="icon-stopwatch" modifier="md"></ums-icon><span>End date: {{$ctrl.selectedSegment.endTime | umsDate}}</span></div><div ng-if="$ctrl.selectedSegment.controlGroupSize != null"><ums-icon id="icon-persona" modifier="md"></ums-icon><span>Control group size: {{$ctrl.selectedSegment.controlGroupSize * 100}}%</span></div></div></div><div class="ums-linkbox ums-reporting__segment-details ums-reporting__segment-details--empty" ng-if="$ctrl.selectedSegment == null"><h2>Select a segment</h2><p>Select a segment from the dropdown on the left</p></div></div><div class="ums-content umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Segment potential</h2><div class="ums-reporting__graph-container"><ums-reporting-barchart ng-if="$ctrl.drilldown" name="Pageview coverage" tooltip="The number of pageviews that are covered by the segment (regardless of personalization). Switch between numbers or percentages." alias="segmentpageviewcoverage" drilldown="$ctrl.drilldown"></ums-reporting-barchart><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_1.png" alt="unselected graph"></div><ums-reporting-barchart ng-if="$ctrl.drilldown" name="Session coverage" tooltip="The number of sessions that are covered by the segment (regardless of personalization). Switch between numbers or percentages." alias="segmentsessioncoverage" drilldown="$ctrl.drilldown"></ums-reporting-barchart><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_2.png" alt="unselected graph"></div><ums-reporting-barchart ng-if="$ctrl.drilldown" name="Profile coverage" tooltip="The number of profiles that are covered by the segment (regardless of personalization). Switch between numbers or percentages." alias="segmentprofilecoverage" drilldown="$ctrl.drilldown"></ums-reporting-barchart><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_1.png" alt="unselected graph"></div><ums-reporting-segment-potential-sessions-needed ng-if="$ctrl.drilldown" segment-id="$ctrl.selectedSegment.id" name="Sessions needed" tooltip="The number of sessions that a new profile requires to activate the segment (regardless personalization) during the selected period of time."></ums-reporting-segment-potential-sessions-needed><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_3.png" alt="unselected graph"></div></div></div><div class="ums-content umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Segment personalization</h2><div class="ums-reporting__graph-container"><ums-reporting-barchart ng-if="$ctrl.drilldown" name="Personalized pageviews" tooltip="The number of pageviews that have been personalized through this segment. Switch between numbers or percentages." alias="segmentpersonalizationpageviewcoverage" drilldown="$ctrl.drilldown"></ums-reporting-barchart><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_2.png" alt="unselected graph"></div><ums-reporting-barchart ng-if="$ctrl.drilldown" name="Personalized sessions" tooltip="The number of sessions that have been personalized through this segment. Switch between numbers or percentages." alias="segmentpersonalizationsessioncoverage" drilldown="$ctrl.drilldown"></ums-reporting-barchart><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_1.png" alt="unselected graph"></div><ums-reporting-barchart ng-if="$ctrl.drilldown" name="Personalized profiles" tooltip="The number of profiles that have been personalized through this segment. Switch between numbers or percentages." alias="segmentpersonalizationprofilecoverage" drilldown="$ctrl.drilldown"></ums-reporting-barchart><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_2.png" alt="unselected graph"></div><ums-reporting-segment-personalization-sessions-needed ng-if="$ctrl.drilldown" segment-id="$ctrl.selectedSegment.id" name="Sessions needed" tooltip="The number of sessions that a new profile needed to be personalization during the selected period of time."></ums-reporting-segment-personalization-sessions-needed><div ng-if="!$ctrl.drilldown" class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/unselected_3.png" alt="unselected graph"></div></div></div><div class="ums-content umsPaddingTop ums-headerbar__bar" style="display:none"><h2 class="umsHeading ums-headerbar__title">Segment conversion</h2><div class="ums-reporting__graph-container"><div class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/coming_soon_1.png" alt="coming soon graph"></div><div class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/coming_soon_2.png" alt="coming soon graph"></div><div class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/coming_soon_3.png" alt="coming soon graph"></div><div class="ums-reporting__graph ums-reporting__graph--placeholder ums-linkbox"><img src="/assets/Umbraco.Engage/Media/Graphs/coming_soon_4.png" alt="coming soon graph"></div></div></div><ums-reporting-chart-wrapper name="All goals"><ums-reporting-segment-personalization-goal-performance segment-id="$ctrl.selectedSegment.id"></ums-reporting-segment-personalization-goal-performance></ums-reporting-chart-wrapper></div></ums-screen></ums-screens>',controller:["umsSegmentService","umsSegmentRuleRepository","$q","umsDaterangepickerService","UMS_DATERANGEPICKER_MODES","umsEventEmitter",function umsReportingController(service,ruleRepo,$q,umsDaterangepickerService,MODE,eventEmitter){var $ctrl=this;$ctrl.segments=[],$ctrl.selectedSegment=null,$ctrl.rulesByType={},$ctrl.isLoading=!0,Object.defineProperty($ctrl,"drilldown",{get:function(){return $ctrl.selectedSegment?"segmentId=='"+$ctrl.selectedSegment.id+"'":""}}),this.$onInit=function(){(function loadRules(){var rules=ruleRepo.getRules();if(Array.isArray(rules))return $q.all(rules.map(function(rule){return $ctrl.rulesByType[rule.type]=rule,rule.init()}));return $q.when()})().finally(function(){$ctrl.isLoading=!1}),umsDaterangepickerService.broadcast({compare:!1,primary:{mode:MODE.LAST_30_DAYS,args:null},secondary:{mode:MODE.PREVIOUS_PERIOD,args:null}},{primary:{from:null,to:null},secondary:{from:null,to:null}}),eventEmitter.emit("groupByControls.onChange",{sender:this,newValue:"day"})},service.getAll().then(function(segments){$ctrl.segments=segments})}]}),angular.module("engage").service("umsRoutingHelper",["$routeParams","$location",umsRoutingHelper]),angular.module("engage").run(["$rootScope","$routeParams","$route","umsRoutingHelper","umsEventEmitter",umsRouting]),angular.module("engage").service("umsScreenManager",["umsRoutingHelper","$location",umsScreenManagerController]),angular.module("engage").component("umsScreenNavigation",{template:'<div class="ums-nav__container" ng-if="$ctrl.main && $ctrl.inUms && $ctrl.screens.length > 0"><ul class="ums-nav__list"><li class="ums-nav__item" ng-repeat="screen in $ctrl.screens" ng-class="{\'s-active\': screen.active,\'s-disabled\': screen.disabled}"><a ng-if="$ctrl.inUms" ng-href="#/engage{{screen.path}}" class="ums-nav__button" ng-bind="screen.name"></a> <button ng-if="!$ctrl.inUms" type="button" ng-click="$ctrl.activate({screen: screen})" class="ums-nav__button" ng-bind="screen.name"></button><ums-icon id="icon-{{screen.alias}}" css-class="ums-nav__icon" modifier="sm"></ums-icon></li></ul></div><div class="ums-subnav__container" ng-if="(!$ctrl.main || !$ctrl.inUms) && $ctrl.screens.length > 0"><div class="ums-content"><ul class="ums-subnav__list"><li class="ums-subnav__item ums-subnav__backbutton is-animated" ng-if="$ctrl.back"><a ng-href="{{$ctrl.back}}" class="ums-subnav__button"><ums-icon id="icon-arrow" modifier="sm" css-class="ums-icon--rotate-180"></ums-icon><span>Back</span></a></li><li class="ums-subnav__item is-animated" ng-repeat="screen in $ctrl.screens" ng-class="{\'s-active\': screen.active,\'s-disabled\': screen.disabled}"><a ng-if="$ctrl.inUms" ng-href="#/engage{{screen.path}}" class="ums-subnav__button" ng-bind="screen.name"></a> <button ng-if="!$ctrl.inUms" type="button" ng-click="$ctrl.activate({screen: screen})" class="ums-subnav__button" ng-bind="screen.name"></button></li></ul></div><div class="ums-contentbar__badge" ng-if="!$ctrl.inUms && $ctrl.name"><ums-icon id="icon-{{$ctrl.iconName}}" modifier="md"></ums-icon><span ng-bind="$ctrl.name"></span></div></div>',bindings:{screens:"=*",main:"<?",activate:"&?",name:"<?",iconName:"<?",back:"<?"},controller:["umsRoutingHelper",umsScreenNavigationController]}),angular.module("engage").service("umsScreenUtils",[umsScreenUtils]),angular.module("engage").component("umsScreen",{template:'<ng-transclude ng-if="$ctrl.active && !$ctrl.disabled"></ng-transclude>',transclude:!0,bindings:{name:"@",alias:"@?",disabled:"<?",hide:"<?"},require:{screensCtrl:"^umsScreens",parentScreen:"?^^umsScreen"},controller:["umsEventEmitter","umsRoutingHelper","umsScreenUtils","$timeout",umsScreenController]}),angular.module("engage").component("umsScreens",{template:'<ums-screen-navigation ng-if="!$ctrl.noNav" main="$ctrl.parentScreen == null" screens="$ctrl.screens | filter: { hide: false }" activate="$ctrl.activate(screen)" name="$ctrl.name" icon-name="$ctrl.iconName" back="$ctrl.back"></ums-screen-navigation><ng-transclude></ng-transclude>',transclude:!0,bindings:{noNav:"<?",name:"@?",iconName:"@?",back:"@?"},require:{parentScreen:"?^umsScreen"},controller:[umsScreensController]}),angular.module("engage").component("umsSegmentOverview",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--1-4 is-animated"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/illustration-segment-builder.png" alt><br><h2>Segment builder</h2><p>Make use of aggregated implicit and explicit data to setup and manage subsets of users (segments).<br>Segments can be used to recognize your visitors and personalize their digital experience.</p><p>Use core segments for long-term marketing strategy. The personalization of website content based upon the customer journey, for example.</p><p>Setup temporary segments for short-term strategy to be able to, for example, personalize the \'About us\' page for visitors who have read that vacancy page with that key job opening which is hard to fill.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated"><div class="ums-filter__container"><div class="ums-filter__row ums-filter__row--auto" style="margin-bottom: 0;"><div class="ums-filter__item"><div class="ums-form__label ums-filter__label">Filter</div><div class="ums-form__switch ums-form__switch--autosize"><input type="radio" name="subFilter" id="segment-overview-filter-0" ng-model="$ctrl.state.subFilter" ng-value="0" class="ums-form__switch__input" required> <label for="segment-overview-filter-0" class="ums-form__switch__label ums-form__switch__label--lg">All</label> <input type="radio" name="subFilter" id="segment-overview-filter-1" ng-model="$ctrl.state.subFilter" ng-value="1" class="ums-form__switch__input" required> <label for="segment-overview-filter-1" class="ums-form__switch__label ums-form__switch__label--lg">Temporary</label> <input type="radio" name="subFilter" id="segment-overview-filter-2" ng-model="$ctrl.state.subFilter" ng-value="2" class="ums-form__switch__input" required> <label for="segment-overview-filter-2" class="ums-form__switch__label ums-form__switch__label--lg">Core</label></div></div><div class="ums-filter__item" style="height: 40px;justify-content: flex-end;margin-left: 30px;"><select class="ums-form__select" style="padding-top: 14px; padding-bottom: 14px;" disabled><option>Last 30 days</option></select></div></div><div class="ums-filter__row ums-filter__row--auto"><div class="ums-filter__item"><button type="button" class="btn ums-button ums-button--icon ums-button--main" ng-if="!$ctrl.state.loading" ng-click="$ctrl.fn.addNewSegment()"><span>Add new segment</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div><br><div><div class="is-animated" ng-if="$ctrl.state.subFilter === 0 || $ctrl.state.subFilter === 1"><div class="ums-divider__container ums-divider__container--small-margin"><div class="ums-divider__title"><ums-icon id="icon-segment-temporary" modifier="md"></ums-icon><span>Temporary segments</span></div><div class="ums-divider__line"></div></div><br><table class="ums-table__table ums-table__table--no-minwidth"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="6"><h3 class="umsFzLg">Temporary segments</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Name and description</div></th><th class="ums-table__th ums-table__th--fixed-lg"><div class="umsLabel">Used parameters</div></th><th class="ums-table__th ums-table__th--fixed-sm"><div class="umsLabel">End date</div></th><th class="ums-table__th ums-table__th--fixed-xxs"><div class="umsLabel">Applied</div></th><th class="ums-table__th ums-table__th--fixed-xs"><div class="umsLabel">Priority</div></th><th class="ums-table__th ums-table__th--fixed-xs"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="6"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.temporarySegments.length === 0 && !$ctrl.state.loading"><td class="ums-table__td" colspan="6" style="text-align: center;"><span style="display: flex; flex-direction: column; align-items: center;"><span>No temporary segments found.</span> <button type="button" style="margin-top: 15px;" class="btn ums-button ums-button--icon ums-button--main" ng-click="$ctrl.fn.addNewSegment(true)"><span ng-if="$ctrl.state.temporarySegments.length === 0 && $ctrl.state.coreSegments.length === 0">Create your first segment.</span> <span ng-if="$ctrl.state.temporarySegments.length > 0">Add new temporary segment</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.temporarySegments.length !== 0 && !$ctrl.state.loading" ng-repeat="segment in $ctrl.state.temporarySegments | orderBy: [\'sortOrder\', \'name\', \'endTime\']"><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top"><span class="ums-table__td--column"><strong ng-bind="segment.name"></strong> <span ng-bind="segment.description"></span></span></td><td class="ums-table__td"><div class="ums-segmentinfo__parameter__container ums-segmentinfo__parameter__container--tight ums-segmentinfo__parameter__container--tight-margin"><div ng-repeat="rule in segment.rules track by rule.type"><ums-segment-rule-display rule="$ctrl.state.rulesByType[rule.type]" negation="rule.isNegation" config="rule.config"></ums-segment-rule-display></div></div></td><td class="ums-table__td ums-table__td--align-top ums-table__td--extra-padding" ng-bind="segment.endTime | umsDate:true"></td><td class="ums-table__td ums-table__td--align-top ums-table__td--extra-padding"><span class="ums-infoicons__item ums-infoicons__item--static ums-popup__enter" style="top: 3px;"><ums-icon id="icon-personalization" modifier="sm"></ums-icon><span ng-bind="$ctrl.fn.getPersonalizationsBySegmentId(segment.id)"></span>x<div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace" style="padding-top: 10px;"><span>Applied on a single page: {{$ctrl.fn.getPersonalizedSegmentsByType(segment.id, 0).length}}</span> <span>Applied on a document type: {{$ctrl.fn.getPersonalizedSegmentsByType(segment.id, 1).length}}</span> <span>Applied on multiple pages: {{$ctrl.fn.getPersonalizedSegmentsByType(segment.id, 2).length}}</span></div></span></td><td class="ums-table__td ums-table__td--align-top ums-table__td--extra-padding"><ums-segment-sort-buttons segment="segment" segment-array="$ctrl.state.temporarySegments" update="$ctrl.fn.updateSortOrder(segment, $ctrl.state.temporarySegments, isUpOrDown)"></ums-segment-sort-buttons></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top ums-table__td--extra-padding"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(segment)" on-delete-click="$ctrl.fn.remove(segment)"></ums-ui-table-action-buttons></td></tr></tbody></table><br></div><div class="is-animated" ng-if="$ctrl.state.subFilter === 0 || $ctrl.state.subFilter === 2"><div class="ums-divider__container ums-divider__container--small-margin"><div class="ums-divider__title"><ums-icon id="icon-segment-core" modifier="md"></ums-icon><span>Core segments</span></div><div class="ums-divider__line"></div></div><br><table class="ums-table__table ums-table__table--no-minwidth"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="5"><h3 class="umsFzLg">Core segments</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Name and description</div></th><th class="ums-table__th ums-table__th--fixed-xl"><div class="umsLabel">Used parameters</div></th><th class="ums-table__th ums-table__th--fixed-xxs"><div class="umsLabel">Applied</div></th><th class="ums-table__th ums-table__th--fixed-xs"><div class="umsLabel">Priority</div></th><th class="ums-table__th ums-table__th--fixed-xs"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="5"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.coreSegments.length === 0 && !$ctrl.state.loading"><td class="ums-table__td" colspan="5" style="text-align: center;"><span style="display: flex; flex-direction: column; align-items: center;"><span>No core segments found.</span> <button type="button" style="margin-top: 15px;" class="btn ums-button ums-button--icon ums-button--main" ng-click="$ctrl.fn.addNewSegment(false)"><span ng-if="$ctrl.state.temporarySegments.length === 0 && $ctrl.state.coreSegments.length === 0">Create your first segment.</span> <span ng-if="$ctrl.state.coreSegments.length > 0">Add new core segment</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.coreSegments.length !== 0 && !$ctrl.state.loading" ng-repeat="segment in $ctrl.state.coreSegments | orderBy: [\'sortOrder\', \'name\']"><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top"><span class="ums-table__td--column ums-table__td--column-margin"><strong ng-bind="segment.name"></strong> <span ng-bind="segment.description"></span></span></td><td class="ums-table__td"><div class="ums-segmentinfo__parameter__container ums-segmentinfo__parameter__container--tight ums-segmentinfo__parameter__container--tight-margin"><div ng-repeat="rule in segment.rules track by rule.type"><ums-segment-rule-display rule="$ctrl.state.rulesByType[rule.type]" negation="rule.isNegation" config="rule.config"></ums-segment-rule-display></div></div></td><td class="ums-table__td ums-table__td--align-top ums-table__td--extra-padding"><span class="ums-infoicons__item ums-infoicons__item--static ums-popup__enter" style="top: 3px;"><ums-icon id="icon-personalization" modifier="sm"></ums-icon><span ng-bind="$ctrl.fn.getPersonalizationsBySegmentId(segment.id)"></span>x<div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace" style="padding-top: 10px;"><span>Applied on a single page: {{$ctrl.fn.getPersonalizedSegmentsByType(segment.id, 0).length}}</span> <span>Applied on a document type: {{$ctrl.fn.getPersonalizedSegmentsByType(segment.id, 1).length}}</span> <span>Applied on multiple pages: {{$ctrl.fn.getPersonalizedSegmentsByType(segment.id, 2).length}}</span></div></span></td><td class="ums-table__td ums-table__td--align-top ums-table__td--extra-padding"><ums-segment-sort-buttons segment="segment" segment-array="$ctrl.state.coreSegments" update="$ctrl.fn.updateSortOrder(segment, $ctrl.state.coreSegments, isUpOrDown)"></ums-segment-sort-buttons></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top ums-table__td--extra-padding"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(segment)" on-delete-click="$ctrl.fn.remove(segment)"></ums-ui-table-action-buttons></td></tr></tbody></table></div></div><ums-segment-builder ng-if="$ctrl.state.edit" segment="$ctrl.state.edit" close="$ctrl.fn.closeOverlay()" on-save="$ctrl.fn.save(segment, true)" remove="$ctrl.fn.remove($ctrl.state.edit)"></ums-segment-builder><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" text="$ctrl.state.confirm.text" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay><ums-overlay small="true" close="$ctrl.state.notAllowed = null;" ng-if="$ctrl.state.notAllowed"><ums-overlay-header><h2 ng-bind="$ctrl.state.confirm.header"></h2></ums-overlay-header><ums-overlay-body><p>Unfortunately it\'s not possible to delete this segments, because it\'s still in use. Please remove the applied personalizations first, before you can delete this segment.</p><ul class="ums-overlay__magic-list"><li ng-repeat="personalization in $ctrl.state.persBySegmentId[$ctrl.state.notAllowed.id] | filter:{type:0}"><strong ng-if="$first">Single page personalizations:</strong> <a ng-href="/umbraco/#/content/content/edit/{{personalization.pages[0].nodeId}}" class="ums-button--link" ng-class="{\'s-first\': $first}">{{personalization.name}}</a></li><li ng-repeat="personalization in $ctrl.state.persBySegmentId[$ctrl.state.notAllowed.id] | filter:{type:1}"><strong ng-if="$first">Multiple page personalizations:</strong> <a ng-href="/umbraco/#/engage/personalization/applied-personalization/create?id={{personalization.id}}" ng-class="{\'s-first\': $first}" class="ums-button--link">{{personalization.name}}</a></li><li ng-repeat="personalization in $ctrl.state.persBySegmentId[$ctrl.state.notAllowed.id] | filter:{type:2}"><strong ng-if="$first">Document type personalizations:</strong> <a ng-href="/umbraco/#/engage/personalization/applied-personalization/create?id={{personalization.id}}" ng-class="{\'s-first\': $first}" class="ums-button--link">{{personalization.name}}</a></li></ul></ums-overlay-body></ums-overlay></div></div></div>',controller:["umsSegmentService","notificationsService","umsAppliedPersonalizationService","$q","umsSegmentRuleRepository",function umsSegmentOverviewController(service,notificationsService,personalizationService,$q,ruleRepo){var ctrl=this;this.$onInit=function(){ctrl.fn.getAllData()},this.state={loading:!0,saving:!1,coreSegments:[],temporarySegments:[],subFilter:0,edit:null,confirm:null,notAllowed:null,filter:{amountOfDays:30},persBySegmentId:{},rulesByType:{}},this.fn={getAllData:function(){return ctrl.state.loading=!0,$q.all([ctrl.fn.getAll.segments(),ctrl.fn.getAll.personalizations(),ctrl.fn.getAll.segmentRules()]).then(function(){ctrl.state.loading=!1})},getAll:{segments:function(){return service.getAll().then(function(response){return ctrl.fn.buildSegmentsFromGetAll(response),response})},personalizations:function(){return personalizationService.getAll().then(function(response){return ctrl.state.persBySegmentId={},response.forEach(function(p){null!==p.segmentId&&(null==ctrl.state.persBySegmentId[p.segmentId]&&(ctrl.state.persBySegmentId[p.segmentId]=[]),ctrl.state.persBySegmentId[p.segmentId].push(p))}),response})},segmentRules:function(){var rules=ruleRepo.getRules();if(Array.isArray(rules))return ctrl.state.rulesByType={},$q.all(rules.map(function(rule){return ctrl.state.rulesByType[rule.type]=rule,rule.init()}))}},buildSegmentsFromGetAll:function(segments){ctrl.state.coreSegments=segments.filter(function(segment){return!1===segment.isTemporary}),ctrl.state.temporarySegments=segments.filter(function(segment){return!0===segment.isTemporary})},addNewSegment:function(isTemporary){var temporaryValue=!1;isTemporary&&(temporaryValue=!0),ctrl.state.edit={id:0,isTemporary:temporaryValue}},closeOverlay:function(){ctrl.state.edit=null},edit:function(segment){ctrl.state.edit=segment},updateSortOrdersAfterDeletedSegment:function(segment,segmentArray){for(var allUpdates=[],i=0;i<segmentArray.length;i++){var otherSegment=segmentArray[i];otherSegment.sortOrder>segment.sortOrder&&(otherSegment.sortOrder--,allUpdates.push(ctrl.fn.save(otherSegment)))}return allUpdates},remove:function(segment){0!==segment.id&&(ctrl.state.confirm={header:'Remove segment: "'+segment.name+'"',text:"If you delete this segment this segment can no longer be used to personalize your website."},0===ctrl.fn.getPersonalizationsBySegmentId(segment.id)?ctrl.state.confirm.fn=function confirmFn(){var segmentArray=segment.isTemporary?ctrl.state.temporarySegments:ctrl.state.coreSegments;service.delete(segment.id).then(function(){ctrl.state.edit&&(ctrl.state.edit=null),$q.all(ctrl.fn.updateSortOrdersAfterDeletedSegment(segment,segmentArray)).then(function(){ctrl.fn.getAll.segments(),notificationsService.success('Segment "'+segment.name+'" deleted')})})}:ctrl.state.notAllowed=segment)},getDefaultSortOrder:function(segment){return segment.isTemporary?ctrl.state.temporarySegments.length:ctrl.state.coreSegments.length},pushSavedSegmentToCurrentArray:function(segmentId,segment){if(segmentId){var arr=segment.isTemporary?ctrl.state.temporarySegments:ctrl.state.coreSegments,idx=_.findIndex(arr,{id:segmentId});-1!==idx&&(arr[idx]=segment)}else segment.isTemporary?ctrl.state.temporarySegments.push(segment):ctrl.state.coreSegments.push(segment)},save:function(segment,notify){ctrl.state.saving=!0;var isMoved=null!=ctrl.state.edit&&segment.isTemporary!==ctrl.state.edit.isTemporary,updates=[];if((null==segment.id||0==segment.id||isMoved)&&(segment.sortOrder=ctrl.fn.getDefaultSortOrder(segment),isMoved)){var oldArr=segment.isTemporary?ctrl.state.coreSegments:ctrl.state.temporarySegments,idx=_.findIndex(oldArr,{id:segment.id});-1!==idx&&oldArr.splice(idx,1),updates=_.sortBy(oldArr,function(s){return s.sortOrder}).map(function(seg,idx){if(seg.sortOrder!==idx)return seg.sortOrder=idx,service.save(seg)})}return $q.all(updates).then(function(){return service.save(segment)}).then(function(response){return ctrl.fn.pushSavedSegmentToCurrentArray(segment.id,response.data),ctrl.fn.closeOverlay(),ctrl.state.saving=!1,notify&&notificationsService.success('Segment "'+response.data.name+'" saved'),response}).then(function(){if(isMoved)return ctrl.fn.getAll.segments()})},findIndexWithSortOrder:function(allSegments,sortOrder){return _.findIndex(allSegments,function(segment){return segment.sortOrder==sortOrder})},updateSortOrder:function(segment,allSegments,action){var newSortOrder=null,segmentsToSave=[];"increment"==action?newSortOrder=segment.sortOrder+1:"decrement"==action&&segment.sortOrder>0&&(newSortOrder=segment.sortOrder-1);var existingSegmentsWithNewSortOrder=ctrl.fn.findIndexWithSortOrder(allSegments,newSortOrder);if(-1!==existingSegmentsWithNewSortOrder){var existingSegment=allSegments[existingSegmentsWithNewSortOrder];existingSegment.sortOrder=segment.sortOrder,segmentsToSave.push(existingSegment)}segment.sortOrder=newSortOrder,segmentsToSave.push(segment);var saveActions=[];segmentsToSave.forEach(function(loopSegment){saveActions.push(ctrl.fn.save(loopSegment))}),$q.all(saveActions).then(function(){})},getPersonalizationsBySegmentId:function(id){return ctrl.state.persBySegmentId[id]?ctrl.state.persBySegmentId[id].length:0},getPersonalizedSegmentsByType:function(id,type){if(ctrl.state.persBySegmentId[id]){var matchingArr=[];return ctrl.state.persBySegmentId[id].forEach(function(element){element.type===type&&matchingArr.push(element)}),matchingArr}return[]}}}]}),angular.module("engage").component("umsSettings",{template:'<ums-section-topbar title="Settings" icon="icon-settings"></ums-section-topbar><ums-screens><ums-screen name="Goals"><ums-goals-main></ums-goals-main></ums-screen><ums-screen name="IP Filters"><ums-ip-filters></ums-ip-filters></ums-screen><ums-screen name="Configuration"><ums-configuration></ums-configuration></ums-screen><ums-screen name="Permissions"><ums-permissions-overview></ums-permissions-overview></ums-screen><ums-screen name="Statistics"><ums-statistics></ums-statistics></ums-screen></ums-screens>',controller:["umsPackageState",umsSettingsController]}),angular.module("engage").component("umsSplitviewBottombarAbTesting",{template:'<ums-portal ng-if="$ctrl.showControls" to=".umb-editor-footer-content__right-side" prepend="true"><div class="ums-portal-content"><button type="button" class="ums-button ums-button--line ums-button--as-ums-bar-button ums-button--icon" ng-click="$ctrl.backToAbTest()"><span>To the A/B test</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></div></ums-portal>',bindings:{variants:"<"},require:{variantsCtrl:"^umbVariantContentEditors"},controller:["umsEventEmitter",umsSplitviewBottombarAbTestingController]}),angular.module("engage").component("umsSplitviewBottombarPersonalization",{template:'<ums-portal ng-if="$ctrl.showControls" to=".umb-editor-footer-content__right-side" prepend="true"><div class="ums-portal-content"><button type="button" class="ums-button ums-button--line ums-button--as-ums-bar-button ums-button--icon" ng-click="$ctrl.gotoAllVariants()"><span>To all variants</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></div></ums-portal>',bindings:{variants:"<"},require:{variantsCtrl:"^umbVariantContentEditors"},controller:[umsSplitviewBottombarPersonalizationController]}),angular.module("engage").component("umsSplitviewBottombar",{template:'<ums-splitview-bottombar-ab-testing variants="$ctrl.variants"></ums-splitview-bottombar-ab-testing><ums-splitview-bottombar-personalization variants="$ctrl.variants"></ums-splitview-bottombar-personalization>',bindings:{variants:"<"}}),angular.module("engage").component("umsSplitviewControls",{template:'<ums-splitview-topbar ng-if="$ctrl.enableControls" ng-repeat="variant in $ctrl.variants track by variant.culture + variant.segment" variant="variant"></ums-splitview-topbar><ums-splitview-bottombar ng-if="$ctrl.enableControls" variants="$ctrl.variants"></ums-splitview-bottombar>',require:{variantsCtrl:"^umbVariantContentEditors"},controller:["$q","$scope","$timeout","umsEventEmitter","umsAbTestingService","umsAppliedPersonalizationService","umsAbTestingCreateTestState",umsSplitviewControlsController]}),angular.module("engage").decorator("umbVariantContentEditorsDirective",function($delegate){if(Array.isArray($delegate)&&$delegate.length>0){var component=$delegate[0];"string"==typeof component.template&&(component.template+="<ums-splitview-controls></ums-splitview-controls>")}return $delegate}),function(){!function addResponseInterceptor(urlRegex,responseFn){angular.module("umbraco").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(function(){return{response:function(response){return null!=response&&null!=response.data&&200===response.status&&urlRegex.test(response.config.url)&&responseFn(response),response}}})}])}(/views\/content\/overlays\/(publish|unpublish|save|schedule|publishdescendants|sendtopublish)\.html/,function(response){response.data=response.data.replace('ng-bind="variant.segment"','ng-bind="variant.displayName"')})}(),angular.module("engage").component("umsSplitviewTopbarAbTesting",{bindings:{variant:"<"},require:{variantsCtrl:"^umbVariantContentEditors"},template:'<div class="ums-portal-content ums-portal-content--fullwidth"><div class="ums-subnav__container"><div class="ums-content ums-content--small"><button type="button" class="ums-button ums-button--line ums-button--icon" ng-click="$ctrl.showEditor = true"><span>Edit variant</span><ums-icon id="icon-edit" modifier="btn"></ums-icon></button> <button type="button" class="ums-button ums-button--line ums-button--icon" ng-click="$ctrl.saveAndPreview()"><span>Save &amp; Preview</span><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button></div><div class="ums-contentbar__badge"><ums-icon id="icon-ab-testing" modifier="md"></ums-icon><span>A/B Testing</span></div></div></div><ums-ab-testing-variant-editor ng-if="$ctrl.showEditor" variant="$ctrl.testVariant" remove-variant="$ctrl.delete()" index="$ctrl.testVariant.index" save="$ctrl.save()" preview-variant="$ctrl.preview()" close="$ctrl.closeEditor()"></ums-ab-testing-variant-editor>',controller:["umsAbTestingService","umsUmbracoSegmentService","umsUtilService","umsAbTestingCreateTestState","editorState","$q","notificationsService",umsSplitviewTopbarAbTestingController]}),angular.module("engage").component("umsSplitviewTopbarDefault",{template:'<div class="ums-portal-content ums-portal-content--fullwidth"><div class="ums-subnav__container"><div class="ums-content ums-content--small"><button type="button" class="ums-button ums-button--line ums-button--icon" ng-click="$ctrl.preview()" ng-if="$ctrl.previewButton != null"><span>Save &amp; Preview</span><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button></div></div></div>',bindings:{variant:"<"},controller:[umsSplitviewTopbarDefaultCtrl]}),angular.module("engage").component("umsSplitviewTopbarPersonalization",{template:'<div class="ums-portal-content ums-portal-content--fullwidth"><div class="ums-subnav__container"><div class="ums-content ums-content--small"><button type="button" class="ums-button ums-button--line ums-button--icon" ng-click="$ctrl.showEditor = true"><span>Edit variant</span><ums-icon id="icon-edit" modifier="btn"></ums-icon></button> <button type="button" class="ums-button ums-button--line ums-button--icon" ng-click="$ctrl.saveAndPreview($ctrl.personalization)"><span>Save &amp; Preview</span><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button></div><div class="ums-contentbar__badge"><ums-icon id="icon-personalization" modifier="md"></ums-icon><span>Personalization</span></div></div></div><ums-applied-personalization-splitview-editor ng-if="$ctrl.showEditor" input="$ctrl.personalization" save="$ctrl.save(personalization)" save-and-preview="$ctrl.saveAndPreview(personalization)" delete="$ctrl.delete(personalization)" close="$ctrl.closeEditor()"></ums-applied-personalization-splitview-editor>',bindings:{variant:"<"},require:{variantsCtrl:"^umbVariantContentEditors"},controller:["umsAppliedPersonalizationService","umsUmbracoSegmentService","umsUtilService","editorState","$q","notificationsService",umsSplitviewTopbarPersonalizationController]}),angular.module("engage").component("umsSplitviewTopbar",{template:'<ums-portal to=".umb-split-view:nth-child({{$ctrl.variant.index + 1}}) .umb-editor-container" prepend="true"><div ng-switch="$ctrl.variant.type"><ums-splitview-topbar-default ng-switch-when="default" variant="$ctrl.variant"></ums-splitview-topbar-default><ums-splitview-topbar-personalization ng-switch-when="personalization" variant="$ctrl.variant"></ums-splitview-topbar-personalization><ums-splitview-topbar-ab-testing ng-switch-when="ab-testing" variant="$ctrl.variant"></ums-splitview-topbar-ab-testing></div></ums-portal>',bindings:{variant:"<"}}),angular.module("engage").component("umsStartpage",{template:'<div class="ums-container"><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item" style="margin-bottom: -20px;"><span class="ums-startpage__version umsLabel" ng-class="{\'s-invisible\': !$ctrl.state.package}" ng-bind-template="Version {{ ($ctrl.state.package.version || \'\').split(\'+\')[0] }}"></span></div><div class="ums-flexgrid__item ums-startpage__temp__parent ums-flexgrid__item--2-3"><div class="ums-boxed__container ums-boxed__container--fresh is-animated"><div class="ums-startpage-intro__grid"><h1 class="ums-startpage-intro__title">Umbraco Engage</h1><div class="ums-startpage-intro__text ums-boxed__content"><p>Our solution will give you all the tools, data and insights about your website visitors in a privacy-friendly way. Please find your way in this section and please feel free to reach out to us when you have any questions, ideas or suggestions!<br><br><strong>Let’s see how your platform is performing the last 30 days (excluding today):</strong></p></div><ul class="ums-startpage-intro__tiles"><li><div class="ums-startpage-tile__item s-small s-gray"><div class="ums-startpage-tile__icon-holder"><ums-icon id="icon-chart-increase" css-class="umsColor-main"></ums-icon></div><strong class="ums-startpage-tile__title" ng-bind="$ctrl.state.pageviews | number"></strong> <span class="ums-startpage-tile__subtext">Total views</span></div></li><li><div class="ums-startpage-tile__item s-small s-gray"><div class="ums-startpage-tile__icon-holder"><ums-icon id="icon-chart-increase" css-class="umsColor-main"></ums-icon></div><strong class="ums-startpage-tile__title" ng-bind="$ctrl.state.goalCompletions.count | number"></strong> <span class="ums-startpage-tile__subtext">Triggered goals</span></div></li><li><div class="ums-startpage-tile__item s-small s-gray"><div class="ums-startpage-tile__icon-holder"><ums-icon id="icon-chart-increase" css-class="umsColor-main"></ums-icon></div><strong class="ums-startpage-tile__title" ng-bind="$ctrl.state.goalCompletions.totalValue | number"></strong> <span class="ums-startpage-tile__subtext">Triggered goal value</span></div></li></ul><div class="ums-startpage-intro__bgimage"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/illustration-marketing-automation.svg" alt></div></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3"><ums-license-viewer package-info="$ctrl.state.package"></ums-license-viewer></div></div></div></div>',controller:["umsAnalyticsApi","umsConfigurationService",umsStartpageController]}),angular.module("engage").factory("umsState",["umsAbTestingState","umsPackageState","versionHelper",umsState]),angular.module("engage").component("umsStatistics",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><ums-loader ng-if="$ctrl.state.isLoading"></ums-loader><div class="ums-flexgrid__container ums-flexgrid__container--lg" ng-if="!$ctrl.state.isLoading"><div class="ums-flexgrid__item ums-flexgrid__item--1-1 ums-flexgrid__item--md-1-3 ums-flexgrid__item--lg-1-4 is-animated"><div class="ums-boxed__container"><h2>Statistics</h2><p>Shows various Umbraco Engage statistics</p></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 ums-flexgrid__item--md-2-3 ums-flexgrid__item--lg-3-4 is-animated"><div class="ums-boxed__container"><div class="ums-flexgrid__container ums-flexgrid__container--nomargin ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><span class="ums-form__label">Pageviews</span><div class="h2 h2--dark ums-form__textitem" ng-bind="$ctrl.state.statistics.numberOfPageviews | number"></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><span class="ums-form__label">Visitors - Person</span><div class="h2 h2--dark ums-form__textitem" ng-bind="$ctrl.state.statistics.numberOfPersonVisitors | number"></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><span class="ums-form__label">Visitors - Bot</span><div class="h2 h2--dark ums-form__textitem" ng-bind="$ctrl.state.statistics.numberOfBotVisitors | number"></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><span class="ums-form__label">Events</span><div class="h2 h2--dark ums-form__textitem" ng-bind="$ctrl.state.statistics.numberOfEvents | number"></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--wrap-padding"><div class="ums-form__row"><span class="ums-form__label">Visitor Segment Settings</span><div class="h2 h2--dark ums-form__textitem" ng-bind="$ctrl.state.statistics.numberOfSegmentSettings | number"></div></div></div></div></div></div></div></div>',controller:["umsStatisticsService",umsStatisticsController]}),angular.module("engage").service("umsStatisticsService",["$http",umsStatisticsService]),angular.module("engage").constant("UMS_TABLE_PREFABS",{}).run(["umsConfigurationService","UMS_TABLE_PREFABS",initializeUmsTablePrefabsConstant]),angular.module("engage").component("umsPrefabTable",{template:'<ums-table ng-if="!$ctrl.isLoading" name="$ctrl.name" metrics="$ctrl.allMetrics" dimensions="$ctrl.dimensions" filter="$ctrl.filter" sort="$ctrl.sort" ascending="$ctrl.ascending" hide-columns="$ctrl.hideColumns" on-click="$ctrl.onClick({row: row})" can-click="$ctrl.canClick" has-data="$ctrl.hasData" realtime="$ctrl.realtime"></ums-table>',bindings:{alias:"<",onClick:"&?",drilldown:"<?",hideColumns:"<?",canClick:"<?",hasData:"=?",title:"<?",metrics:"<?"},controller:["umsConfigurationService","UMS_TABLE_PREFABS",umsPrefabTableController]}),angular.module("engage").component("umsTable",{template:'<div class="is-animated"><table class="ums-table__table ums-table__table--analytics"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td ums-table__td--first-analytics ums-table__td--analytics-border" colspan="{{$ctrl.visibleDimensions.length}}"><strong ng-if="$ctrl.name" class="umsFzLg" ng-bind-html="$ctrl.name"></strong><br ng-if="$ctrl.name"><input ng-if="$ctrl.dimensions.length > 0" type="text" class="ums-table__search" placeholder="Search..." ng-change="$ctrl.fn.refreshRows()" no-dirty-check ng-model-options="{debounce:200}" ng-model="$ctrl.tableSettings.filterBy"></td><td class="ums-table__td" ng-repeat="metric in $ctrl.metrics | filter: $ctrl.fn.isVisibleMetric track by $index"><strong ng-if="$ctrl.fn.getVisibleMetricTotal($index) != null" class="umsFzLg" ng-bind="$ctrl.fn.getMetricTotal($index) | number"></strong> <span ng-if="$ctrl.fn.getVisibleMetricTotal($index) != null && $ctrl.fn.getColumnName(metric).indexOf(\'(s)\') > -1">sec.</span> <span ng-if="$ctrl.fn.getVisibleMetricTotal($index) != null && $ctrl.fn.getColumnName(metric).indexOf(\'%\') > -1">%</span><br><small class="umsOpacity50" ng-if="$ctrl.fn.getVisibleMetricTotal($index) != null && $ctrl.fn.getMetricTotal($index) !== $ctrl.fn.getVisibleMetricTotal($index)">Showing {{ $ctrl.fn.getVisibleMetricTotal($index) | number }}<br>({{ $ctrl.fn.getMetricTotalPercentage($index) | percentage:1 }} of total)</small></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels" ng-if="!$ctrl.isLoading && $ctrl.table && $ctrl.table.columns && $ctrl.table.columns.length > 0"><th class="ums-table__th" ng-class="{ \'s-ascending\' : $ctrl.tableSettings.ascending, \'s-descending\' : !$ctrl.tableSettings.ascending, \'s-sorting\': $ctrl.tableSettings.sort == column, \'ums-table__td--analytics-border\' : $index == $ctrl.visibleDimensions.length - 1}" ng-click="$ctrl.fn.sortBy(column)" ng-repeat="column in $ctrl.table.columns | filter:$ctrl.fn.isVisibleColumn track by $index" ng-attr-colspan="{{$ctrl.table.columns.length < 2 ? 2 : undefined}}"><div class="umsLabel" ng-class="{ \'ums-table__sort-indicator\' : $ctrl.tableSettings.ascending !== null }"><span ng-bind="$ctrl.fn.getColumnName(column)"></span><ums-icon id="icon-chevron" modifier="xxs" ng-show="$ctrl.tableSettings.ascending && $ctrl.tableSettings.sort == column"></ums-icon><ums-icon id="icon-chevron" modifier="xxs" css-class="ums-icon--rotate-180" ng-show="!$ctrl.tableSettings.ascending && $ctrl.tableSettings.sort == column"></ums-icon></div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.isLoading"><td class="ums-table__td ums-table__td--empty-state ums-table__td--empty-border" colspan="{{$ctrl.visibleColumnCount}}">Loading...</td></tr><tr class="ums-table__tr" ng-if="!$ctrl.isLoading && $ctrl.tableSettings.filterBy && $ctrl.rows && $ctrl.rows.length === 0"><td class="ums-table__td ums-table__td--empty-state" colspan="{{$ctrl.visibleColumnCount}}">No data matches filter!</td></tr><tr class="ums-table__tr" ng-if="!$ctrl.isLoading && $ctrl.table && $ctrl.rows && $ctrl.rows.length === 0 && $ctrl.reportsExist"><td class="ums-table__td ums-table__td--empty-state" colspan="{{$ctrl.visibleColumnCount}}">No data found!</td></tr><tr class="ums-table__tr" ng-if="!$ctrl.isLoading && !$ctrl.reportsExist"><td class="ums-table__td ums-table__td--empty-state" colspan="{{$ctrl.visibleColumnCount}}">No analytics reports have been generated yet. Data will become available within 24 hours</td></tr><tr class="ums-table__tr {{ $ctrl.fn.rowClass($index) }}" ng-if="!$ctrl.isLoading && $ctrl.table && $ctrl.rows && $ctrl.rows.length > 0" ng-repeat-start="row in $ctrl.rows"><td class="ums-table__td ums-table__td--analytics" ng-class="{ \'ums-table__td--analytics-border\': $last }" ng-repeat="dimension in row.dimensions | filter:$ctrl.fn.isVisibleDimension track by $index"><span class="ums-table__item-contents"><button ng-click="$ctrl.onClick({row:row})" ng-class="{ \'s-drilldown\': $ctrl.canClick }" type="button" class="ums-table__drilldown-button" title="Drilldown \'{{dimension}}\'"><strong ng-bind="dimension == null ? \'(unknown)\' : dimension | limitTo : $ctrl.name === \'Video\\\'s\' && $ctrl.fn.isUrl(dimension) ? 20 : undefined"></strong> <strong ng-if="dimension !== null && $ctrl.name === \'Video\\\'s\' && $ctrl.fn.isUrl(dimension) && dimension.length > 20">...</strong></button> <a ng-if="$ctrl.fn.isUrl(dimension)" ng-href="{{dimension}}" target="_blank" title="Go to \'{{dimension}}\'" class="ums-table__fullscreen-button"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></span></td><td class="ums-table__td" ng-attr-colspan="{{$ctrl.table.columns.length < 2 ? 2 : undefined}}" ng-if="row.dateRanges.length === 1" ng-repeat="value in row.dateRanges[0].values | filter:$ctrl.fn.isVisibleMetric track by $index"><span ng-bind="value | number"></span> <span ng-if="$ctrl.fn.getColumnName($ctrl.table.columns[$index + row.dimensions.length]).indexOf(\'(s)\') > -1">sec.</span> <span ng-if="$ctrl.fn.getColumnName($ctrl.table.columns[$index + row.dimensions.length]).indexOf(\'%\') > -1">%</span> <span class="umsOpacity50" ng-bind="$ctrl.fn.getMetricPercentageTotal(value, $index)"></span></td><td class="ums-table__td" ng-if="row.dateRanges.length > 1" colspan="{{$ctrl.visibleMetricCount}}"></td></tr><tr class="ums-table__tr ums-table__tr--sm" ng-if="row.dateRanges.length > 1" ng-repeat="dateRange in row.dateRanges"><td class="ums-table__td" colspan="{{$ctrl.visibleDimensions.length}}"><span class="daterange-label" ng-bind="dateRange.label"></span></td><td class="ums-table__td" ng-repeat="value in dateRange.values | filter: $ctrl.fn.isVisibleMetric track by $index"><span ng-bind="value | number"></span> <span class="umsOpacity50" ng-bind="$ctrl.fn.getMetricPercentageTotal(value, $index)"></span></td></tr><tr ng-repeat-end class="ums-table__tr ums-table__tr--sm ums-table__tr--dark" ng-if="row.dateRanges.length > 1"><td class="ums-table__td" colspan="{{$ctrl.visibleDimensions.length}}"><span class="daterange-label">% Change</span></td><td class="ums-table__td" ng-repeat="difference in $ctrl.differences[$index] | filter: $ctrl.fn.isVisibleMetric track by $index" ng-bind="difference"></td></tr></tbody></table></div><div class="ums-pagination__container"><div class="ums-pagination__col"><label for="pagination-rows" class="ums-pagination__label">Show rows:</label><select class="ums-pagination__select" ng-model="$ctrl.tableSettings.pageSize" ng-options="o for o in $ctrl.pageSizes" ng-change="$ctrl.fn.resetTable()"></select></div><div class="ums-pagination__col"><label class="ums-pagination__label">{{ $ctrl.tableSettings.fromRow }}-{{ $ctrl.tableSettings.toRow }} of {{ $ctrl.table.totalRows }}</label> <button type="button" class="ums-pagination__button" ng-if="$ctrl.tableSettings.page > 1" ng-click="$ctrl.fn.previousPage()"><ums-icon id="icon-arrow" modifier="xs ums-icon--rotate-180"></ums-icon></button> <button type="button" class="ums-pagination__button" ng-if="$ctrl.tableSettings.page < $ctrl.tableSettings.totalPages" ng-click="$ctrl.fn.nextPage()"><ums-icon id="icon-arrow" modifier="xs"></ums-icon></button></div></div>',bindings:{name:"<?",dimensions:"<",metrics:"<",filter:"<",sort:"<",ascending:"<",realtime:"<",onClick:"&?",hideColumns:"<?",canClick:"<?",hasData:"=?"},controller:function(umsAnalyticsService,umsAnalyticsApi,umsEventEmitter,$q,$filter,$timeout){var self=this,destroyFns=[];destroyFns.push(umsAnalyticsService.registerOnChangeDateCallback(function onDatePicked(from,to){from&&to&&reload()}),umsEventEmitter.on("changed.analytics.settings.includeNodeDescendants",function(){$timeout(reload,0)}));var filteredRows=[],metricTotals=[];function refreshPaging(){self.tableSettings.fromRow=1+(self.tableSettings.page-1)*self.tableSettings.pageSize,self.tableSettings.toRow=Math.min(self.table.rows.length,self.tableSettings.fromRow+self.tableSettings.pageSize-1),self.rows=filteredRows.slice(self.tableSettings.fromRow-1,self.tableSettings.toRow),self.differences=function computeDifferences(rows){var differences=[];return rows.forEach(function(row){if(!(row.dateRanges.length<2)){var rangeA=row.dateRanges[0],rangeB=row.dateRanges[1],rowDifferences=[];rangeA.values.forEach(function(valueA,valueIdx){var difference=function computeDifference(valueA,valueB){return 0===valueB?" – ":((valueA-valueB)/valueB*100).toFixed(2)+"%"}(valueA,rangeB.values[valueIdx]);rowDifferences.push(difference)}),differences.push(rowDifferences)}}),differences}(self.rows)}function reload(){if(!self.isLoading){self.isLoading=!0,-1===self.metrics.indexOf(self.querySettings.sort)&&-1===self.dimensions.indexOf(self.querySettings.sort)&&function resetSort(){self.querySettings.sort=self.tableSettings.sort=self.metrics[0],self.querySettings.ascending=self.tableSettings.ascending=!1}();var queryRequests=umsAnalyticsService.buildQueryRequests(self.dimensions,self.metrics,self.querySettings),queryPromises=queryRequests.map(function(queryRequest){return umsAnalyticsApi.query(queryRequest)}),dateRanges=queryRequests.map(function(request){return{from:request.startDate,to:request.endDate}});!function getPageSizeFromStorage(){var storedPageSize=localStorage.getItem("ums-table");storedPageSize&&(storedPageSize=JSON.parse(storedPageSize),self.tableSettings.pageSize=storedPageSize.pageSize)}(),$q.all(queryPromises).then(function(tables){return function mergeTableResponses(tables,dateRanges){if(0===tables.length||null==tables[0])return null;self.reportsExist=tables.every(function(table){return!1!==table.reportsExist});var mergedTable={columns:tables[0].columns.slice(),rows:[]},dimensionCount=self.dimensions&&self.dimensions.length||0,existingDimensionValues={},uniqueDimensionValues=tables.reduce(function(dimensionValues,table){return table.rows.forEach(function(row){var dimensions=row.slice(0,dimensionCount),dimensionValue=dimensions.join(";");existingDimensionValues[dimensionValue]||(dimensionValues.push(dimensions),existingDimensionValues[dimensionValue]=1)}),dimensionValues},[]);mergedTable.totalRows=uniqueDimensionValues.length;var EMPTY_ROW=mergedTable.columns.slice(dimensionCount).map(function(){return 0});return uniqueDimensionValues.forEach(function(dimensions){var mergedRow={dimensions:dimensions,dateRanges:[]},dimensionValue=dimensions.join(";");tables.forEach(function(table,tableIdx){var tableRow=table.rows.find(function(row){return row.slice(0,dimensionCount).join(";")===dimensionValue}),dateRange=dateRanges[tableIdx];mergedRow.dateRanges.push({label:formatDateRange(dateRange),values:tableRow&&tableRow.slice(dimensionCount)||EMPTY_ROW})}),mergedTable.rows.push(mergedRow)}),mergedTable;function formatDateRange(dateRange){if(null==dateRange)throw new Error("Invalid dateRange provided");var from=moment(dateRange.from).toDate(),to=moment(dateRange.to).toDate();function format(date){return $filter("umsDate")(date,!0,!0)}return format(from)+" – "+format(to)}}(tables,dateRanges)}).then(onGetTableResponse).catch(onGetTableError).finally(onGetTableCompleted)}}function onGetTableResponse(table){self.table=function formatTableValues(table){return function formatAvgRelativeVideoPlaytime(){var idx=table.columns.indexOf(ums.constants.metrics.avgRelativeVideoPlaytime);if(idx>-1)for(var i=0;i<table.rows.length;i++)for(var row=table.rows[i],valueIdx=idx-row.dimensions.length,j=0;j<row.dateRanges.length;j++){var dateRange=row.dateRanges[j],value=dateRange.values[valueIdx];"number"==typeof value&&(dateRange.values[valueIdx]=Number(value.toFixed(1)))}}(),table}(table),metricTotals=[];for(var metric=0;metric<self.metrics.length;metric++){var sum=table.rows.reduce(function(val,row){return row.dateRanges.reduce(function(sum,range){return sum+range.values[metric]},val)},0);metricTotals.push(sum)}refreshRows()}function refreshRows(){if(!self.table)return filteredRows=[],void(self.rows=[]);if(filteredRows=self.table.rows.slice(),self.dimensions&&self.dimensions.length>0&&self.tableSettings.filterBy)for(var rowIndex=filteredRows.length-1;rowIndex>=0;rowIndex--){for(var row=filteredRows[rowIndex],matchFound=!1,dimensionIndex=0;dimensionIndex<self.dimensions.length;dimensionIndex++){if(row.dimensions[dimensionIndex].toString().toLowerCase().indexOf(self.tableSettings.filterBy.toLowerCase())>-1){matchFound=!0;break}}matchFound||filteredRows.splice(rowIndex,1)}var columnIndex=self.table.columns.indexOf(self.tableSettings.sort);if(columnIndex<self.dimensions.length){const dimensionIndex=columnIndex;filteredRows=filteredRows.sort(function sortByDimension(columnIdx,rowA,rowB){var a=rowA.dimensions[columnIdx],b=rowB.dimensions[columnIdx],asc=self.tableSettings.ascending?1:-1;if("string"==typeof a&&"string"==typeof b){a=a.replace("http://","").replace("https://",""),b=b.replace("http://","").replace("https://","");var result=a.localeCompare(b);return result*asc}return"number"==typeof a&&"number"==typeof b?(a-b)*asc:0}.bind(null,dimensionIndex))}else{const metricIndex=columnIndex-self.dimensions.length;filteredRows=filteredRows.sort(function sortByMetric(columnIdx,rowA,rowB){var a=rowA.dateRanges[0].values[columnIdx],b=rowB.dateRanges[0].values[columnIdx],asc=self.tableSettings.ascending?1:-1,result=0;a>b?result=1:a<b&&(result=-1);return result*asc}.bind(null,metricIndex))}resetTable()}function resetTable(){self.hasData=filteredRows&&filteredRows.length>0,self.tableSettings.totalPages=Math.ceil(filteredRows.length/self.tableSettings.pageSize),self.tableSettings.page=1,function setPageSizeInStorage(){localStorage.setItem("ums-table",JSON.stringify({pageSize:self.tableSettings.pageSize}))}(),refreshPaging()}function onGetTableError(err){console.log(err)}function onGetTableCompleted(){self.isLoading=!1}function getVisibleMetricTotal(metricIndex){var metric=self.metrics[metricIndex];return null!=metric&&(metric.indexOf("avg")>-1||metric.indexOf("average")>-1)||metric.indexOf("pageSessions")>-1?null:self.rows.reduce(function(val,row){return row.dateRanges.reduce(function(sum,range){return sum+range.values[metricIndex]},val)},0)}function getMetricTotal(metricIndex){return metricTotals[metricIndex]}function isVisibleColumn(_,index){return-1===self.hideColumns.indexOf(index)}self.pageSizes=[10,20,50,100],self.querySettings={page:1,pageSize:9999,filter:null,sort:ums.constants.dimensions.datetime,ascending:!1,realtime:!1},self.tableSettings={page:1,pageSize:self.pageSizes[0],filterBy:null,sort:null,ascending:!1,totalPages:0,fromRow:0,toRow:0},self.table=null,self.isLoading=!1,self.$onDestroy=function onDestroy(){for(var i=0;i<destroyFns.length;i++)destroyFns[i]()},self.$onChanges=function onChange(changes){(changes.metrics||changes.dimensions)&&function updateVisibleColumns(){self.hideColumns=self.hideColumns||[],self.visibleDimensions=self.dimensions.filter(function(dimension,index){return-1===self.hideColumns.indexOf(index)});var dimensionCount=self.dimensions.length;self.visibleMetricCount=self.metrics.length-self.hideColumns.filter(function(idx){return idx>=dimensionCount}).length,self.visibleColumnCount=self.visibleDimensions.length+self.visibleMetricCount}();changes.filter&&(self.querySettings.filter=self.filter);changes.realtime&&(self.querySettings.realtime=self.realtime);changes.sort&&null!=self.sort&&(self.querySettings.sort=self.sort,self.tableSettings.sort=self.sort);changes.ascending&&(self.querySettings.ascending=self.ascending,self.tableSettings.ascending=self.ascending);(changes.filter||changes.metrics||changes.dimensions||changes.realtime)&&reload()},self.rows=[],self.differences=[],self.fn={sortBy:function sortBy(column){self.tableSettings.sort===column?self.tableSettings.ascending=!self.tableSettings.ascending:(self.tableSettings.sort=column,self.tableSettings.ascending=self.dimensions.indexOf(column)>0),refreshRows()},resetTable:resetTable,refreshRows:refreshRows,getMetricTotalPercentage:function getMetricTotalPercentage(metricIndex){var total=getMetricTotal(metricIndex);if(!total||null===total||isNaN(total))return null;var visibleTotal=getVisibleMetricTotal(metricIndex);return!visibleTotal||null===visibleTotal||isNaN(visibleTotal)?null:visibleTotal/total},getVisibleMetricTotal:getVisibleMetricTotal,getMetricTotal:getMetricTotal,getMetricPercentageTotal:function getMetricPercentageTotal(metric,columnIndex){if(!metricTotals||!metric)return null;var metricIndex=columnIndex;if(metricIndex>=metricTotals.length)return null;var totalMetricValue=metricTotals[metricIndex];return null===totalMetricValue||0===totalMetricValue||isNaN(totalMetricValue)?null:"("+(metric/totalMetricValue*100).toFixed(2)+" %)"},getColumnName:function getColumnName(columnType){switch(columnType){case ums.constants.dimensions.usertype:return"User Type";case ums.constants.dimensions.datetime:case ums.constants.dimensions.date:return"Date";case ums.constants.dimensions.pageUrl:return"Page URL";case ums.constants.dimensions.goal:return"Goal";case ums.constants.dimensions.goalId:return"Goal id";case ums.constants.dimensions.goalType:return"Type of goal";case ums.constants.dimensions.isMainGoal:return"Macro goal";case ums.constants.dimensions.botVersion:return"Bot version";case ums.constants.dimensions.fullReferrer:return"Referrer";case ums.constants.dimensions.referralHostname:return"Referrer (domain)";case ums.constants.dimensions.referralPath:return"Referrer (path)";case ums.constants.dimensions.referralPathAndQuery:return"Referrer (path + query)";case ums.constants.dimensions.deviceCategory:return"Device type";case ums.constants.dimensions.eventCategory:return"Event category";case ums.constants.dimensions.eventAction:return"Event action";case ums.constants.dimensions.eventLabel:return"Event label";case ums.constants.dimensions.pageviewSegmentName:return"Segment";case ums.constants.dimensions.campaign:return"Campaign";case ums.constants.dimensions.source:return"Source";case ums.constants.dimensions.medium:return"Medium";case ums.constants.dimensions.sourceMedium:return"Source / Medium";case ums.constants.dimensions.videoName:return"Video Source";case ums.constants.dimensions.videoUrl:return"Video URL";case ums.constants.dimensions.videoEventType:case ums.constants.dimensions.videoEventTypeName:return"Video event type";case ums.constants.dimensions.umbracoFormsName:return"Form";case ums.constants.dimensions.umbracoFormsId:return"Form ID";case ums.constants.dimensions.umbracoFormsFieldName:return"Form Field";case ums.constants.dimensions.umbracoFormsFieldId:return"Form Field ID";case ums.constants.dimensions.umbracoFormsFieldError:return"Form Field Error";case ums.constants.dimensions.sourcePlatform:return"Source platform";case ums.constants.dimensions.creativeFormat:return"Creative format";case ums.constants.dimensions.marketingTactic:return"Marketing tactic";case ums.constants.dimensions.searchTerm:return"Search term";case ums.constants.metrics.pageviews:return"Pageviews";case ums.constants.metrics.uniquePageviews:return"Unique Pageviews";case ums.constants.metrics.goalCompletionsAll:return"Goal completions";case ums.constants.metrics.goalValueAll:return"Goal total value";case ums.constants.metrics.totalEvents:return"Total events";case ums.constants.metrics.eventValue:return"Event value";case ums.constants.metrics.avgEventValue:return"Avg. Value";case ums.constants.metrics.videoPlays:return"Video Plays";case ums.constants.metrics.videoPlaytime:return"Video Playtime (s)";case ums.constants.metrics.videoEvents:return"Video events";case ums.constants.metrics.avgVideoPlaytime:return"Avg. Video Playtime (s)";case ums.constants.metrics.avgRelativeVideoPlaytime:return"Avg. Video Playtime (%)";case ums.constants.metrics.umbracoFormsViews:return"Form Views";case ums.constants.metrics.umbracoFormsSubmissions:return"Form Submissions";case ums.constants.metrics.umbracoFormsStarts:return"Form Starts";case ums.constants.metrics.umbracoFormsAbandons:return"Form abandons";case ums.constants.metrics.umbracoFormsErrors:return"Form errors";case ums.constants.metrics.umbracoFormsFieldFocusses:return"Form focusses";case ums.constants.metrics.umbracoFormsFieldAbandons:return"Form field Abandons";case ums.constants.metrics.umbracoFormsFieldErrors:return"Form Field Errors";case ums.constants.metrics.avgTimeOnPage:return"Avg time on page (s)";case ums.constants.metrics.avgEngagedTimeOnPage:return"Avg engaged time on page (s)";case ums.constants.metrics.pageSessions:return"Sessions";case ums.constants.metrics.pageVisitors:case ums.constants.metrics.pageVisitorsWithSubpages:return"Visitors";case ums.constants.metrics.pageSessionsWithSubpages:return"Sessions";case ums.constants.metrics.pageviewsWithSubpages:return"Pageviews";case ums.constants.metrics.searchVolume:case ums.constants.metrics.searchVolumeWithSubpages:return"Search volume";case ums.constants.metrics.campaignEntries:return"Entries";case ums.constants.metrics.campaignVisitors:return"Visitors";case ums.constants.metrics.campaignGoals:return"Goals";case ums.constants.metrics.campaignGoalValue:return"Goal Value";case ums.constants.metrics.campaignFormSubmissions:return"Form Submissions";case ums.constants.metrics.campaignCommerceOrders:return"Orders";default:return columnType}},nextPage:function nextPage(){self.tableSettings.page<self.tableSettings.totalPages&&(self.tableSettings.page++,refreshPaging())},previousPage:function previousPage(){self.tableSettings.page>1&&(self.tableSettings.page--,refreshPaging())},refreshPaging:refreshPaging,reload:reload,rowClass:function rowClass(index){return index<3&&1===self.tableSettings.page&&!1===self.tableSettings.ascending&&self.metrics.indexOf(self.tableSettings.sort)>-1?"is-rank0"+(index+1).toString():""},isVisibleDimension:function isVisibleDimension(_,index){return isVisibleColumn(0,index)},isVisibleMetric:function isVisibleMetric(_,index){return isVisibleColumn(0,self.dimensions.length+index)},isVisibleColumn:isVisibleColumn,isUrl:function isUrl(input){return/^http(?:s)?:\/\//.test(input)}}}}),angular.module("engage").decorator("umbTreeItemDirective",function($delegate){if(Array.isArray($delegate)&&$delegate.length>0){var component=$delegate[0];"string"==typeof component.template&&(component.template=component.template.replace(/(class="umb-tree-item__inner"[^>]*>)/,"$1<ums-tree-icons></ums-tree-icons>"))}return $delegate}),angular.module("engage").component("umsTreeIcons",{template:'<div class="ums-tree-badge__container" ng-if="$ctrl.nodeId > 0"><div class="ums-tree-badge__item" ng-if="$ctrl.activeAbTest.testType >= 0 || $ctrl.scheduledAbTest"><span class="ums-tree-badge__info"><span ng-if="$ctrl.activeAbTest.testType === 0">Single A/B test</span> <span ng-if="$ctrl.activeAbTest.testType === 1">Multipages test</span> <span ng-if="$ctrl.activeAbTest.testType === 2">Doctype test</span> <span ng-if="$ctrl.activeAbTest.testType === 3">Split Url test</span> <span ng-if="$ctrl.scheduledAbTest">Scheduled A/B test</span></span><div class="ums-tree-badge__icon"><svg class="ums-icon ums-icon--sm" viewBox="0 0 300 300" ng-if="!$ctrl.scheduledAbTest"><path d="M244.3 193l-37.1-23.8c-8.9-5.7-14.2-15.4-14.2-25.9v-36.2h10.8c6 0 10.9-4.9 10.9-10.9s-4.9-10.9-10.9-10.9H96.2c-6 0-10.9 4.9-10.9 10.9s4.9 10.9 10.9 10.9H107v36.2c0 10.5-5.3 20.2-14.2 25.9-47 30.1-35.5 22.7-37.3 23.9-15 9.8-24 26.2-24 44.2 0 29 23.6 52.7 52.7 52.7h131.7c29 0 52.7-23.6 52.7-52.7-.1-18.7-9.8-35-24.3-44.3zm-115.4-49.7v-36.2h42.3v36.2c0 33.8 28.4 46.5 29.9 48H99c1.4-1.5 29.9-14.2 29.9-48zm86.9 124.8H84.2c-17 0-30.8-13.8-30.8-30.8 0-9.5 4.4-18.4 11.8-24.2h169.7c7.4 5.8 11.8 14.6 11.8 24.2-.1 17-13.9 30.8-30.9 30.8zM117.6 64c0-29.8 24.2-54 54-54 6 0 10.9 4.9 10.9 10.9s-4.9 10.9-10.9 10.9c-17.7 0-32.1 14.4-32.1 32.1 0 6-4.9 10.9-10.9 10.9-6.2.1-11-4.8-11-10.8zm46.2-7.8c21-21 55.3-21 76.3 0 4.3 4.3 4.3 11.2 0 15.5-4.3 4.3-11.2 4.3-15.5 0-12.5-12.5-32.9-12.5-45.4 0-4.3 4.3-11.2 4.3-15.5 0-4.2-4.3-4.2-11.2.1-15.5z"></path></svg><svg class="ums-icon ums-icon--sm s-scheduled" viewBox="0 0 559.98 559.98" ng-if="$ctrl.scheduledAbTest"><path d="M279.99,0C125.601,0,0,125.601,0,279.99c0,154.39,125.601,279.99,279.99,279.99c154.39,0,279.99-125.601,279.99-279.99C559.98,125.601,434.38,0,279.99,0z M279.99,498.78c-120.644,0-218.79-98.146-218.79-218.79c0-120.638,98.146-218.79,218.79-218.79s218.79,98.152,218.79,218.79C498.78,400.634,400.634,498.78,279.99,498.78z"></path><path d="M304.226,280.326V162.976c0-13.103-10.618-23.721-23.716-23.721c-13.102,0-23.721,10.618-23.721,23.721v124.928c0,0.373,0.092,0.723,0.11,1.096c-0.312,6.45,1.91,12.999,6.836,17.926l88.343,88.336c9.266,9.266,24.284,9.266,33.543,0c9.26-9.266,9.266-24.284,0-33.544L304.226,280.326z"></path></svg></div></div><div class="ums-tree-badge__item" ng-if="$ctrl.personalizedVariants"><span class="ums-tree-badge__info"><span ng-if="$ctrl.personalizedVariants > 0"><span class="hover"><span ng-show="$ctrl.personalizedVariants === 1">1 variant</span> <span ng-show="$ctrl.personalizedVariants > 1" ng-bind-template="{{$ctrl.personalizedVariants}} variants"></span></span></span></span><div class="ums-tree-badge__icon"><svg class="ums-icon ums-icon--sm" viewBox="0 0 300 300"><path d="M273.8 84.7l13-13c6.9-6.9 2-18.7-7.7-18.7H247V21c0-9.7-11.8-14.6-18.7-7.7l-13 13C195.3 15.6 172.9 10 150 10 72.6 10 10 72.6 10 150s62.6 140 140 140 140-62.6 140-140c0-22.9-5.6-45.3-16.2-65.3zM236 74.9h16.6L231.5 96H204V68.5l21.1-21.1V64c0 6 4.9 10.9 10.9 10.9zm-86 193.2c-65.3 0-118.1-52.8-118.1-118.1S84.7 31.9 150 31.9c17 0 33.7 3.6 49 10.6l-13.7 13.7c-2.1 2.1-3.2 4.8-3.2 7.7v38.5l-39.8 39.8c-4.3 4.3-4.3 11.2 0 15.5s11.2 4.3 15.5 0l39.8-39.8H236c2.9 0 5.7-1.2 7.7-3.2l13.7-13.7c7 15.3 10.6 32 10.6 49 .1 65.3-52.7 118.1-118 118.1zM236.2 150c0 47.6-38.7 86.2-86.2 86.2-47.6 0-86.2-38.7-86.2-86.2s38.7-86.2 86.2-86.2c6 0 10.9 4.9 10.9 10.9S156 85.6 150 85.6c-35.5 0-64.4 28.9-64.4 64.4s28.9 64.4 64.4 64.4 64.4-28.9 64.4-64.4c0-6 4.9-10.9 10.9-10.9s10.9 4.9 10.9 10.9z"></path></svg></div></div></div>',controller:["$scope","umsTreeIconsService","umsUtilService",function umsTreeIconsController($scope,service,umsUtilService){var $ctrl=this;this.activeAbTest=null,this.scheduledAbTest=null,this.personalizedVariants=0,this.nodeId=null,this.contentTypeAlias=null;var destroyFns=[];this.$onInit=function(){null!=$scope.$parent&&"content"===$scope.$parent.section&&($ctrl.nodeId=$scope&&$scope.$parent&&$scope.$parent.node&&parseInt($scope.$parent.node.id,10),null==$ctrl.nodeId||isNaN($ctrl.nodeId)||$ctrl.nodeId<0||$scope.$parent.node.metaData&&!0===$scope.$parent.node.metaData.noAccess||($ctrl.contentTypeAlias=$scope.$parent.node.metaData&&$scope.$parent.node.metaData.contentType,function loadData(nodeId,contentTypeAlias){umsUtilService.getNodeCultures(nodeId).then(function(contentCultures){service.getAbTestsForPage(nodeId,contentTypeAlias,contentCultures).then(function(abTests){for(var i=0;i<abTests.length;i++){var abTest=abTests[i];if(2===abTest.status?$ctrl.activeAbTest=abTest:1===abTest.status&&($ctrl.scheduledAbTest=abTest),null!=$ctrl.activeAbTest&&null!=$ctrl.scheduledAbTest)break}}),service.getPersonalizationsForPage(nodeId,contentTypeAlias,contentCultures).then(function(personalizations){for(var i=0;i<personalizations.length;i++){var personalization=personalizations[i];personalization.isActive&&$ctrl.personalizedVariants++}})})}($ctrl.nodeId,$ctrl.contentTypeAlias)))},this.$onDestroy=function(){destroyFns.forEach(function(fn){fn()})}}]}),angular.module("engage").service("umsTreeIconsService",["umsAbTestingService","umsAppliedPersonalizationService","umsContentTypeService","umsUtilService","$q",function umsTreeIconsService(abTestingService,personalizationService,contentTypeResource,umsUtils,$q){var allAbTestsPromise=null,allPersonalizationsPromise=null,contentTypeIdPromises={},contentTypesPromise=null;function getContentTypeId(contentTypeAlias){return null==contentTypeIdPromises[contentTypeAlias]&&(contentTypeIdPromises[contentTypeAlias]=function getAllContentTypes(){return null==contentTypesPromise&&(contentTypesPromise=contentTypeResource.getAll()),contentTypesPromise}().then(function(contentTypes){for(var i=0;i<contentTypes.length;i++){var contentType=contentTypes[i];if(contentType.alias===contentTypeAlias)return contentType.id}})),contentTypeIdPromises[contentTypeAlias]}function isCultureMatch(nodeCultures,experimentCulture){return null==experimentCulture||0===nodeCultures.length||nodeCultures.some(function(culture){return null==culture||experimentCulture.toLowerCase()===culture.toLowerCase()})}this.getAbTestsForPage=function getAbTestsForPage(nodeId,contentTypeAlias,contentCultures){return $q.all([getContentTypeId(contentTypeAlias),(null==allAbTestsPromise&&(allAbTestsPromise=abTestingService.getAll()),allAbTestsPromise)]).then(function(data){var contentTypeId=data[0];return data[1].filter(function(abTest){return abTest.contentTypes.some(function(ct){return ct.contentTypeId==contentTypeId&&isCultureMatch(contentCultures,ct.culture)})||abTest.umbracoPageVariants.some(function(upv){return upv.nodeId==nodeId&&isCultureMatch(contentCultures,upv.culture)})})})},this.getPersonalizationsForPage=function getPersonalizationsForPage(nodeId,contentTypeAlias,contentCultures){return $q.all([getContentTypeId(contentTypeAlias),(null==allPersonalizationsPromise&&(allPersonalizationsPromise=personalizationService.getAll()),allPersonalizationsPromise)]).then(function(data){var contentTypeId=data[0];return data[1].filter(function(personalization){return 2===personalization.type&&personalization.contentTypes.some(function(ct){return ct.contentTypeId==contentTypeId&&isCultureMatch(contentCultures,ct.culture)})||(0===personalization.type||1===personalization.type)&&personalization.pages.some(function(upv){return upv.nodeId==nodeId&&isCultureMatch(contentCultures,upv.culture)})})})}}]),angular.module("engage").component("umsDefaultUmbracoFormsSubmissions",{template:'<ums-overlay close="$ctrl.state.submission = null" ng-if="$ctrl.state.submission"><ums-overlay-header><h4 class="h2 umsHeading">Umbraco.Engage.Forms</h4></ums-overlay-header><ums-overlay-body><p>In order to view all fields of the submitted form you need to install the <a href="https://www.nuget.org/packages/Umbraco.Engage.Forms/">Umbraco.Engage.Forms</a> add-on package.</p></ums-overlay-body></ums-overlay><ums-umbraco-forms-submissions-list loading="$ctrl.state.loading" submissions="$ctrl.state.submissions" on-click="$ctrl.state.submission = submission"></ums-umbraco-forms-submissions-list>',bindings:{visitorId:"<"},controller:["$http",function umsDefaultUmbracoFormsSubmissions($http){this.state={submissions:[],loading:!1},this.$onInit=function(){this.getSubmissions().then(function(submissions){this.state.submissions=submissions}.bind(this))},this.getSubmissions=function(){return this.state.loading=!0,$http.get("/umbraco/backoffice/engage/umbracoforms/GetFormSubmissionsForVisitor?visitorId="+this.visitorId).then(function(response){return response.data||[]}).finally(function(){this.state.loading=!1}.bind(this))}}]}),angular.module("engage").component("umsUmbracoFormsSubmissionsList",{template:'<table class="ums-table__table ums-table__table--no-minwidth ums-table__table--faketable" style="height: 380px;"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="2"><h3 class="umsFzLg">Umbraco Forms submissions</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Form name</div></th><th class="ums-table__th"><div class="umsLabel">Submitted</div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.submissions.length === 0"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" colspan="2"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-show="$ctrl.loading">Loading ...</span> <span ng-show="!$ctrl.loading">No forms submitted</span></span></td></tr><tr class="ums-table__tr" ng-repeat="submission in $ctrl.submissions | orderBy: \'-timestamp\'" ng-click="$ctrl.onClick && $ctrl.onClick({submission: submission})" style="cursor: pointer"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="submission.formName"></strong></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="submission.timestamp | umsDate"></span></span></td></tr></tbody></table>',bindings:{submissions:"<",onClick:"&?",loading:"<"}}),angular.module("engage").component("umsUmbracoFormsSubmissions",{template:'<ums-default-umbraco-forms-submissions visitor-id="$ctrl.visitorId" ng-if="!$ctrl.addons.umbracoForms"></ums-default-umbraco-forms-submissions><ums-uf-record-submissions visitor-id="$ctrl.visitorId" ng-if="$ctrl.addons.umbracoForms"></ums-uf-record-submissions>',bindings:{visitorId:"<"},controller:["UMS_ADDONS",function umsUmbracoFormsSubmissions(addons){this.$onInit=function(){this.addons=addons}}]}),angular.module("engage").service("umsUmbracoSegmentService",["$http",umsUmbracoSegmentService]),angular.module("engage").service("umsUserService",["$http",umsUserService]),angular.module("engage").directive("umsNotEmpty",function(){return{require:"ngModel",link:function(scope,elm,attrs,ctrl){ctrl.$validators.umsNotEmpty=function(modelValue,viewValue){return null!=modelValue&&modelValue.length>0},scope.$watch(attrs.ngModel,function(){ctrl.$validate()})}}}),angular.module("engage").directive("umsNotNull",function(){return{require:"ngModel",link:function(scope,elm,attrs,ctrl){ctrl.$validators.umsNotNull=function(modelValue,viewValue){return null!=modelValue},scope.$watch(attrs.ngModel,function(){ctrl.$validate()})}}}),angular.module("engage").directive("umsRequiredArray",function(){return{require:"ngModel",link:function(scope,elm,attrs,ctrl){ctrl.$validators.umsRequiredArray=function(modelValue,viewValue){return"[object Array]"===Object.prototype.toString.call(modelValue)&&modelValue.length>=1},scope.$watch(attrs.ngModel,function(){ctrl.$validate()},!0)}}}),angular.module("engage").directive("umsValidIpAddress",function(){return{require:"ngModel",link:function(scope,elm,attrs,ctrl){var regex=/^(::1|((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;ctrl.$validators.umsValidIpAddress=function(modelValue,viewValue){return regex.test(modelValue)}}}}),angular.module("engage").service("umsAbTestingHelper",[function(){this.getVariantLabel=function getVariantLabel(index){return String.fromCharCode(65+index)}}]),angular.module("engage").factory("umsAbTestingState",["umsAbTestingCreateTestState","umsAbTestingTestDetailState","umsAbTestingProjectDetailState",function(createTest,testDetail,projectDetail){return{test:{create:createTest,detail:testDetail},project:{detail:projectDetail}}}]),angular.module("engage").component("umsAbTestingTopbar",{bindings:{hideCreateAbTestProjectButton:"<?",hideCreateAbTestButton:"<?"},template:'<ums-section-topbar title="A/B Testing" icon="icon-ab-testing"><button class="btn ums-button ums-button--base ums-button--icon" type="button" ng-if="!$ctrl.hideCreateAbTestProjectButton" ng-click="$ctrl.overlay.createProject = true"><span>Add new project</span><ums-icon id="icon-project" modifier="btn"></ums-icon></button> <a ng-href="#/engage/ab-testing/create-test{{$ctrl.state.shared.projectDetail.id != null ? \'?projectId=\' + $ctrl.state.shared.projectDetail.id : \'\'}}" ng-if="!$ctrl.hideCreateAbTestButton" class="btn ums-button ums-button--main ums-button--icon"><span>Start new test</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></a></ums-section-topbar><ums-ab-testing-create-project ng-if="$ctrl.overlay.createProject" on-close="$ctrl.overlay.createProject = false" on-create="$ctrl.fn.onProjectCreated(project)"></ums-ab-testing-create-project>',controller:["umsAbTestingProjectDetailState","umsScreenManager","umsEventEmitter",umsAbTestingTopbarController]}),angular.module("engage").component("umsAbTesting",{template:'<ums-ab-testing-topbar hide-create-ab-test-project-button="!$ctrl.state.showButtonCreateAbTestProject" hide-create-ab-test-button="!$ctrl.state.showButtonCreateAbTest"></ums-ab-testing-topbar><ums-screens no-nav="true"><ums-screen name="Project overview"><ums-ab-testing-project-overview on-projects-loaded="$ctrl.fn.onProjectsLoaded(projects)"></ums-ab-testing-project-overview></ums-screen><ums-screen name="Project detail"><ums-ab-testing-project-detail></ums-ab-testing-project-detail></ums-screen><ums-screen name="Test detail"><ums-ab-testing-test-detail back="$ctrl.fn.backToProject(test)"></ums-ab-testing-test-detail></ums-screen><ums-screen name="Create new test" alias="create-test"><ums-ab-testing-create-test back="$ctrl.fn.backToProject(test)" enable-split-url="true"></ums-ab-testing-create-test></ums-screen></ums-screens>',controller:["umsScreenManager","umsEventEmitter","umsRoutingHelper",function(screenManager,eventEmitter,routingHelper){var state=this.state={showButtonCreateAbTestProject:!1,showButtonCreateAbTest:!1};this.$onInit=function(){this.$onDestroy=eventEmitter.on("umsPathChange",this.fn.handlePathChange);var currentPath=routingHelper.getCurrentPath();this.fn.handlePathChange(currentPath)},this.fn={onProjectsLoaded:function(projects){Array.isArray(projects)&&(state.showButtonCreateAbTest=projects.length>0)},backToProject:function(test){test&&null!=test.projectId?screenManager.open("/ab-testing/project-detail",{id:test.projectId}):screenManager.open("/ab-testing/project-overview")},handlePathChange:function(path){switch(path){case"/ab-testing/create-test":state.showButtonCreateAbTest=!1,state.showButtonCreateAbTestProject=!1;break;case"/ab-testing/project-detail":state.showButtonCreateAbTest=!0,state.showButtonCreateAbTestProject=!1;break;default:state.showButtonCreateAbTest=!0,state.showButtonCreateAbTestProject=!0}}}}]}),angular.module("engage").service("umsAbTestingService",["umsDownloader",function(Downloader){var testApi=new Downloader("/umbraco/backoffice/engage/abtest/"),variantApi=new Downloader("/umbraco/backoffice/engage/abtestvariant/");this.createEmpty=function createEmpty(){return testApi.get("createEmpty")},this.getTestDetails=function getTestDetails(id){return testApi.get("get?id="+id)},this.getRuntimeIndication=function getRuntimeIndication(createModel){return testApi.post("GetRuntimeIndication",createModel)},this.getAbTestViewModel=function getAbTestViewModel(id){return testApi.get("GetAbTestViewModel?abTestId="+id)},this.disableVariant=function disableVariant(id){return variantApi.post("Disable?variantId="+id)},this.getVariantDetails=function getVariantDetails(createModel){return testApi.post("GetVariantDetails",createModel)},this.saveTest=function saveTest(test,validate){return"boolean"!=typeof validate&&(validate=!0),testApi.post("Save?validate="+validate.toString(),test)},this.deleteTest=function deleteTest(abTestId){return testApi.get("Delete?abTestId="+abTestId)},this.createSegment=function createSegment(nodeId,culture,segment){return testApi.post("CreateSegment?contentId="+nodeId+"&culture="+culture+"&segment="+segment)},this.getPreviewUrl=function getPreviewUrl(abTestId,variantId){return testApi.get("GetPreviewUrl?abTestId="+abTestId+"&variantId="+variantId)},this.getAllForPage=function getAllForPage(pageId){return testApi.get("GetAllForPage?pageId="+pageId)},this.getVariantBySegment=function getVariantBySegment(segment){return variantApi.get("GetBySegment?segment="+encodeURIComponent(segment)).then(function(response){return response.data})},this.saveVariant=function saveVariant(variant){return variantApi.post("Save",variant).then(function(response){return response.data})},this.deleteVariant=function deleteVariant(variantId){return variantApi.post("Delete?variantId="+variantId)},this.getAll=function getAll(){return testApi.get("All").then(function(response){return response.data})}}]),angular.module("engage").component("umsAbTestingCreateProject",{bindings:{onClose:"&?",onCreate:"&?"},template:'<ums-overlay nopadding="true" large="true" close="$ctrl.onClose()"><ums-overlay-header><h4 class="h2 umsHeading">Add new project</h4></ums-overlay-header><ums-overlay-body><div class="ums-flexgrid__container ums-flexgrid__container--lg ums-overlay__content__grid"><div class="ums-flexgrid__item ums-flexgrid__item--2-5 ums-overlay__content__item umsPaddingTop umsPaddingBottom"><strong class="ums-overlay__content__item__title">Information</strong><form ng-submit="$ctrl.fn.create()" name="$ctrl.form" id="ums-create-project" ng-class="{\'s-checkform\':$ctrl.formSubmitted}"><div class="ums-form__row"><label for="form0123" class="ums-form__label">Project name *</label> <input id="form0123" class="ums-form__input" type="text" required no-dirty-check ng-model="$ctrl.state.project.name"></div><div class="ums-form__row"><label for="textarea1d2a12" class="ums-form__label">Information about this project</label> <textarea id="textarea1d2a12" class="ums-form__input" no-dirty-check ng-model="$ctrl.state.project.description" style="white-space: pre-line;">\n                        </textarea></div></form></div><div class="ums-flexgrid__item ums-flexgrid__item--3-5 ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><strong class="ums-overlay__content__item__title">Preview:</strong><ums-ab-testing-project-preview project="$ctrl.state.project" username="$ctrl.state.currentUser"></ums-ab-testing-project-preview></div></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button ng-click="$ctrl.onClose()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button> <button class="btn ums-button ums-button--success ums-button--icon" form="ums-create-project" ng-click="$ctrl.formSubmitted = true" type="submit">Create project</button></ums-overlay-footer></ums-overlay>',controller:["umsAbTestingProjectApi","userService",function(projectApi,userService){var ctrl=this,state=this.state={project:{},status:null,currentUser:null};this.fn={create:function(){return projectApi.create(ctrl.state.project).then(function(response){var project=response.data;null!=project&&"function"==typeof ctrl.onCreate&&ctrl.onCreate({project:project})},function(){ctrl.state.status="error"})}};this.$onInit=function(){userService.getCurrentUser().then(function(user){null!=user&&(state.currentUser=user.name)})}}]}),angular.module("engage").component("umsAbTestingEditProject",{bindings:{projectId:"<",onClose:"&?",onSave:"&?",onDelete:"&?"},template:'<ums-overlay nopadding="true" close="$ctrl.onClose()" large="true"><ums-overlay-header><h4 class="h2 umsHeading">Edit this project</h4></ums-overlay-header><ums-overlay-body><div class="ums-flexgrid__container ums-flexgrid__container--lg ums-overlay__content__grid"><div class="ums-flexgrid__item ums-flexgrid__item--2-5 ums-overlay__content__item umsPaddingTop umsPaddingBottom"><strong class="ums-overlay__content__item__title">Information</strong><form ng-submit="$ctrl.fn.save()" name="$ctrl.form" id="ums-edit-project"><div class="ums-form__row"><label for="form0123" class="ums-form__label">Project name *</label> <input id="form0123" class="ums-form__input" type="text" required no-dirty-check ng-model="$ctrl.state.project.name"></div><div class="ums-form__row"><label for="textarea1d2a12" class="ums-form__label">Information about this project</label> <textarea id="textarea1d2a12" class="ums-form__input" no-dirty-check ng-model="$ctrl.state.project.description">\n                        </textarea></div></form></div><div class="ums-flexgrid__item ums-flexgrid__item--3-5 ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><strong class="ums-overlay__content__item__title">Preview:</strong><ums-ab-testing-project-preview project="$ctrl.state.project" username="$ctrl.state.currentUser"></ums-ab-testing-project-preview></div></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span style="display: flex; justify-content: space-between; align-items: center;"><button ng-click="$ctrl.onClose()" class="btn ums-button ums-button--light ums-button--icon" style="margin-right: 10px;" type="button">Cancel</button> <span class="ums-popup__enter"><div class="ums-form__toggle" ng-click="$ctrl.state.project.archived = !$ctrl.state.project.archived" ng-disabled="$ctrl.state.project.amountOfActiveTests > 0"><label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular">&nbsp;</label> <input type="checkbox" name="toggle-2" id="toggle-2-1" class="ums-form__toggle__input s-toggleByAngular"> <label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular" ng-class="{\'ums-form__toggle__label--archived\': $ctrl.state.project.archived}"><span ng-show="!$ctrl.state.project.archived">Active project</span> <span ng-show="$ctrl.state.project.archived">Archived</span></label></div><div class="ums-popup__holder" ng-show="$ctrl.state.project.amountOfActiveTests > 0">A project cannot be archived when there are still active a/b tests.</div></span></span> <span><button type="button" ng-show="$ctrl.state.showDelete" ng-click="$ctrl.fn.delete()" class="btn ums-button ums-button--link-error ums-button--icon"><span>Delete this project and all tests</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--success ums-button--icon" form="ums-edit-project" type="submit"><span>Save</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',controller:["umsAbTestingProjectApi","notificationsService","userService","umsDownloadService",function(api,notificationsService,userService,downloadService){var ctrl=this;this.state={project:{},currentUser:null,showDelete:!1},this.fn={save:function(){return api.save(ctrl.state.project).then(function(response){var project=response.data;null!=project&&(notificationsService.success('Project "'+project.name+'" saved successfully'),"function"==typeof ctrl.onSave&&ctrl.onSave({project:project}))},downloadService.handleError)},delete:function(){return api.delete(ctrl.projectId).then(function(){notificationsService.success('Project "'+ctrl.state.project.name+'" deleted successfully'),"function"==typeof ctrl.onDelete&&ctrl.onDelete({project:ctrl.state.project})},downloadService.handleError)}},this.$onInit=function(){api.getById(this.projectId).then(function(response){ctrl.state.project=response.data,ctrl.state.showDelete=ctrl.state.project.abTests.every(function(test){return 5===test.status})}),userService.getCurrentUser().then(function(user){null!=user&&(ctrl.state.currentUser=user.name)})}}]}),angular.module("engage").service("umsAbTestingProjectApi",["umsDownloader",function(Downloader){var api=new Downloader("/umbraco/backoffice/engage/abtestproject/");this.create=function create(project){return api.post("create",project)},this.getAll=function getAll(){return api.get("all")},this.getDetails=function getDetails(id){return api.get("GetProjectDetails?id="+id)},this.save=function save(project){return api.post("Update",project)},this.delete=function deleteProject(id){return api.post("Delete?id="+id)},this.getById=function getById(id){return api.get("Get?id="+id)}}]),angular.module("engage").factory("umsAbTestingProjectDetailState",[function(){return{id:null}}]),angular.module("engage").component("umsAbTestingProjectDetail",{template:'<div class="ums-container"><div class="ums-content" ng-if="$ctrl.state.isLoading || $ctrl.state.errorMessage"><ums-loader ng-if="$ctrl.state.isLoading"></ums-loader><div ng-if="$ctrl.state.errorMessage"><h3 style="color:#c00" ng-bind="$ctrl.state.errorMessage"></h3><a href="#/engage/ab-testing/project-overview" class="btn ums-button ums-button--icon ums-button--line"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>Back to overview</span></a></div></div><div class="ums-content" ng-if="!$ctrl.state.isLoading && !$ctrl.state.errorMessage"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--sidebar-left ums-flexgrid__item--1-3 umsPaddingTop umsPaddingBottom"><div class="umsPaddingTop is-animated"><h2 class="h2"><span ng-bind="$ctrl.state.project.name"></span> <span ng-if="$ctrl.state.project.archived" class="umsOpacity50">(archived)</span></h2><ul class="ums-infoicons__list"><li class="ums-infoicons__item ums-infoicons__item--25 ums-popup__enter"><ums-icon id="icon-test-number" modifier="lg"></ums-icon><span ng-if="$ctrl.state.project.abTests.length === 1">1 test</span> <span ng-if="$ctrl.state.project.abTests.length !== 1">{{$ctrl.state.project.abTests.length}} tests</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Number of tests</div></li><li class="ums-infoicons__item ums-infoicons__item--25 ums-popup__enter"><ums-icon id="icon-status-running"></ums-icon><span ng-if="$ctrl.state.project.nrOfActiveTests === 1">1 active</span> <span ng-if="$ctrl.state.project.nrOfActiveTests !== 1">{{$ctrl.state.project.nrOfActiveTests}} active</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Number of active tests</div></li><li class="ums-infoicons__item ums-infoicons__item--50 ums-popup__enter"><ums-icon id="icon-status-draft"></ums-icon><span ng-bind-template="{{$ctrl.state.project.createdByUmbracoUserName}}"></span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Created by:<div ng-bind-template="{{$ctrl.state.project.createdByUmbracoUserName}}"></div></div></li></ul><br><div class="umsDescription" ng-bind="$ctrl.state.project.description" style="white-space: pre-line;"></div><div class="umsDescription" ng-if="$ctrl.state.project.updated != null"><br>Project last updated by: <span ng-bind-template="{{$ctrl.state.project.updatedByUmbracoUserName}}"></span></div><br><button type="button" class="ums-button ums-button--link-light" ng-click="$ctrl.fn.edit()"><ums-icon id="icon-edit" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>Edit this project</span></button><br><hr><div class="ums-button__wrapper ums-button__wrapper--left"><a href="#/engage/ab-testing/project-overview" class="btn ums-button ums-button--icon ums-button--line"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>Back</span></a> <a ng-href="#/engage/ab-testing/create-test?projectId={{$ctrl.state.shared.id}}" ng-if="!$ctrl.state.project.archived" class="ums-button ums-button--success ums-button--arrow-r"><span>Create new test</span></a></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3 umsPaddingTop umsPaddingBottom" ng-if="$ctrl.state.project.abTests.length === 0"><div class="ums-testdetail__empty__container"><img src="/App_Plugins/Umbraco.Engage/assets/a-b-testing.svg" alt><br><h2>This project is empty.<span ng-if="!$ctrl.state.project.archived">Start testing:</span></h2><a ng-href="#/engage/ab-testing/create-test?projectId={{$ctrl.state.shared.id}}" ng-if="!$ctrl.state.project.archived" class="ums-button ums-button--success ums-button--arrow-r"><span>Create new test</span></a></div></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3 umsPaddingTop umsPaddingBottom" ng-if="$ctrl.state.project.abTests.length > 0"><ums-ab-testing-test-filters filters="$ctrl.state.filters"></ums-ab-testing-test-filters><div class="ums-alert__container ums-alert__container--warning" ng-if="($ctrl.state.project.abTests | filter:$ctrl.fn.filterTests).length === 0">No tests could be found matching your search criteria.</div><ums-ab-testing-test-list tests="$ctrl.state.project.abTests | filter:{status:2} | filter:$ctrl.fn.filterTests" header="Running"></ums-ab-testing-test-list><ums-ab-testing-test-list tests="$ctrl.state.project.abTests | filter:{status:3} | filter:$ctrl.fn.filterTests" header="Stopped"></ums-ab-testing-test-list><ums-ab-testing-test-list tests="$ctrl.state.project.abTests | filter:$ctrl.fn.filterScheduledOrDraft | filter:$ctrl.fn.filterTests" header="New"></ums-ab-testing-test-list><ums-ab-testing-test-list tests="$ctrl.state.project.abTests | filter:{status:4} | filter:$ctrl.fn.filterTests" header="Completed"></ums-ab-testing-test-list></div></div></div></div><ums-ab-testing-edit-project ng-if="$ctrl.state.showEdit" project-id="$ctrl.state.project.id" on-close="$ctrl.state.showEdit = false" on-save="$ctrl.state.showEdit = false; $ctrl.fn.reloadProject()" on-delete="$ctrl.fn.onDelete()"></ums-ab-testing-edit-project>',controller:["umsAbTestingProjectApi","umsAbTestingProjectDetailState","$location","umsEventEmitter",function(projectApi,projectDetailState,$location,eventEmitter){var ctrl=this;this.$onInit=function(){var projectId=$location.search().id;null!=projectId?(state.shared.id=projectId,fn.reloadProject(),this.$onDestroy=function(){}):fn.redirectToProjectOverview()};var state=this.state={shared:projectDetailState,isLoading:!0,errorMessage:null,project:null,projectId:null,filters:{},showEdit:!1},fn=this.fn={getProject:function(id){return projectApi.getDetails(id).then(function(response){return response.data})},filterTests:function(test){return!!(state.filters.waiting||1!==test.status&&5!==test.status)&&(!(!state.filters.running&&2===test.status)&&(!!(state.filters.completed||3!==test.status&&4!==test.status)&&(!state.filters.userId||test.createdByUmbracoUserId==state.filters.userId)))},filterScheduledOrDraft:function(test){return test&&(1===test.status||5===test.status)},edit:function(){state.showEdit=!0},reloadProject:function(){state.isLoading=!0,fn.getProject(state.shared.id).then(function(project){if(null==project)state.errorMessage="Project with id "+state.shared.id+" not found";else if(state.project=project,state.project.archived){function toggleCreateButton(visibility){eventEmitter.emit("abTestingTopbarChangeButtonVisibility",{createTest:visibility})}toggleCreateButton(!1),ctrl.$onDestroy=function(){toggleCreateButton(!0)}}},function(err){}).finally(function(){state.isLoading=!1})},redirectToProjectOverview:function(){$location.path("/engage/ab-testing/project-overview")},onDelete:function(){fn.redirectToProjectOverview()}}}]}),angular.module("engage").component("umsAbTestingProjectList",{template:'<div ng-if="$ctrl.projects.length > 0"><ums-divider ng-if="$ctrl.title" title="{{$ctrl.title}}" icon="{{$ctrl.icon}}"></ums-divider><div class="ums-flexgrid__container ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--1-3" ng-repeat="project in $ctrl.projects track by project.id"><a ng-href="#/engage/ab-testing/project-detail?id={{project.id}}" style="min-height: 180px;" class="ums-boxed__container ums-boxed__container--fullheight" ng-class="{\'ums-boxed__container--archived\': project.archived}"><div class="ums-boxed__content"><h3 ng-bind="project.name"></h3><p ng-bind="project.description" style="white-space: pre-line;"></p><ul class="ums-infoicons__list"><li class="ums-infoicons__item ums-infoicons__item--25 ums-popup__enter"><ums-icon id="icon-test-number"></ums-icon><span ng-if="project.amountOfTests === 1">1 test</span> <span ng-if="project.amountOfTests !== 1">{{project.amountOfTests}} tests</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Number of tests within this project</div></li><li class="ums-infoicons__item ums-infoicons__item--25 ums-popup__enter"><ums-icon id="icon-status-running"></ums-icon><span ng-if="project.amountOfActiveTests === 1">1 active</span> <span ng-if="project.amountOfActiveTests !== 1">{{project.amountOfActiveTests}} active</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Number of active tests</div></li><li class="ums-infoicons__item ums-infoicons__item--50 ums-popup__enter"><ums-icon id="icon-status-draft"></ums-icon><span ng-bind-template="{{project.createdByUmbracoUsername}}"></span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Created by:<div ng-bind-template="{{project.createdByUmbracoUsername}}"></div></div></li></ul></div><span class="ums-gotoarrow ums-gotoarrow"><ums-icon id="icon-arrow"></ums-icon></span></a></div></div></div>',bindings:{projects:"=*",title:"@?",icon:"@?"}}),angular.module("engage").component("umsAbTestingProjectOverview",{bindings:{onProjectsLoaded:"&?"},template:'<div class="ums-container"><div class="ums-content umsPaddingBottom umsPaddingTop"><div class="is-animated" ng-if="!$ctrl.state.isLoading"><div class="ums-flexgrid__container ums-flexgrid__container--flexstart" ng-if="$ctrl.state.projects.length === 0"><div class="ums-testdetail__empty__container"><img src="/App_Plugins/Umbraco.Engage/assets/a-b-testing.svg" alt><br><h2>There are no projects yet. Create your first project:</h2><button type="button" ng-click="$ctrl.state.createProject = true" class="ums-button ums-button--main ums-button--arrow-r"><span>Add new project</span><ums-icon id="icon-project" modifier="btn"></ums-icon></button></div></div><div ng-if="$ctrl.state.projects.length > 0"><div class="ums-filter__container ums-filter__container--right" ng-show="$ctrl.state.archivedProjectCount > 0"><label class="ums-form__checkbox__label" for="archived-projects"><input class="ums-form__checkbox__input" id="archived-projects" type="checkbox" no-dirty-check ng-model="$ctrl.state.filters.showArchivedProjects">Show archived projects</label></div><ums-ab-testing-project-list projects="$ctrl.state.projects | filter:{archived:false} | filter:$ctrl.fn.hasActiveAbTest | orderBy:\'name\'" title="Projects with an active A/B test" icon="icon-project-active"></ums-ab-testing-project-list><ums-ab-testing-project-list projects="$ctrl.state.projects | filter:{archived:false} | filter:$ctrl.fn.hasNoActiveAbTest | orderBy:\'name\'" title="Projects without an active A/B test" icon="icon-project-inactive"></ums-ab-testing-project-list><ums-ab-testing-project-list projects="$ctrl.state.projects | filter:{archived:true} | orderBy:\'name\'" ng-if="$ctrl.state.filters.showArchivedProjects" title="Archived projects" icon="icon-project-archived"></ums-ab-testing-project-list></div></div></div></div><ums-ab-testing-create-project ng-if="$ctrl.state.createProject" on-close="$ctrl.state.createProject = false" on-create="$ctrl.fn.onProjectCreated(project)"></ums-ab-testing-create-project>',controller:["umsAbTestingProjectApi","umsScreenManager",function(projectApi,screenManager){var ctrl=this;this.$onInit=function(){state.isLoading=!0,fn.loadProjects().then(function(projects){state.projects=projects,"function"==typeof ctrl.onProjectsLoaded&&ctrl.onProjectsLoaded({projects:projects}),state.archivedProjectCount=state.projects.filter(function(project){return project.archived}).length,state.filters.showArchivedProjects=state.archivedProjectCount===state.projects.length}).finally(function(){state.isLoading=!1})};var state=this.state={isLoading:!1,archivedProjectCount:0,filters:{showArchivedProjects:!1},projects:[],createProject:!1},fn=this.fn={loadProjects:function(){return projectApi.getAll().then(function(response){return response.data})},hasActiveAbTest:function(project){return project.amountOfActiveTests>0},hasNoActiveAbTest:function(project){return!fn.hasActiveAbTest(project)},onProjectCreated:function(project){state.createProject=!1,project&&project.id>0&&screenManager.open("/ab-testing/project-detail",{id:project.id})}}}]}),angular.module("engage").component("umsAbTestingProjectPreview",{bindings:{project:"<",username:"<"},template:'<div class="ums-boxed__container" ng-if="$ctrl.project != null"><div class="ums-boxed__content"><h3 ng-bind="$ctrl.project.name"></h3><p ng-bind="$ctrl.project.description" style="white-space: pre-line;"></p><ul class="ums-infoicons__list" ng-if="$ctrl.username"><li class="ums-infoicons__item ums-popup__enter"><ums-icon id="icon-status-draft" modifier="md"></ums-icon><span ng-bind="$ctrl.username"></span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Current user:<div ng-bind="$ctrl.username"></div></div></li></ul></div><span class="ums-gotoarrow ums-gotoarrow"><ums-icon id="icon-arrow"></ums-icon></span></div>'}),angular.module("engage").factory("umsAbTestingCreateTestState",["$rootScope","umsEventEmitter",function($rootScope,eventEmitter){var state={projectId:null,test:null};function clearState(){angular.merge(state,{projectId:null,test:null})}return $rootScope.$on("$routeChangeSuccess",clearState),eventEmitter.on("ab-testing.clear-create-state",clearState),state}]),angular.module("engage").component("umsAbTestingCreateTest",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><form ng-submit="$ctrl.fn.submit()" ng-class="{\'s-checkform\': $ctrl.state.formWasSubmitted}" name="$ctrl.state.form"><div class="ums-flexgrid__container" ng-if="!$ctrl.state.confirm"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container ums-boxed__container--fullheight ums-boxed__container--fresh"><h2>1. Information</h2><p class="umsDescription">Provide some information about this test so other users also understand the purpose of it.</p><div class="ums-form__row"><label class="ums-form__label">Title of this test *</label> <input type="text" class="ums-form__input" placeholder="Title of the test" no-dirty-check required ng-model="$ctrl.state.shared.test.name"></div><div class="ums-form__row"><label for="form122" class="ums-form__label">Part of project *</label><select id="form122" class="ums-form__select ums-form__select--flex" required no-dirty-check ng-model="$ctrl.state.shared.test.projectId" ng-options="project.id as project.name for project in $ctrl.state.projects"><option selected disabled value>Select Project...</option></select><button class="btn ums-button ums-button--light ums-button--square-icon ums-popup__enter" type="button" ng-click="$ctrl.state.overlay.createProject.isOpen = true"><ums-icon id="icon-plus" modifier="xxs"></ums-icon><div class="ums-popup__holder">Add new project</div></button></div><div class="ums-form__row"><div class="ums-form__label">Description/hypothesis</div><textarea no-dirty-check ng-model="$ctrl.state.shared.test.description" class="ums-form__input" cols="30" rows="10"></textarea></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container ums-boxed__container--fullheight ums-boxed__container--fresh"><h2>2. Setup Test</h2><p class="umsDescription">Choose if you want to test one specific page or a broader set of pages.</p><div class="ums-form__row" style="margin-bottom: 20px;"><label class="ums-form__label">Select test type *</label><select class="ums-form__select" ng-model="$ctrl.state.shared.test.testType" no-dirty-check required ng-options="type.id as type.name for type in $ctrl.state.testTypes" ng-change="$ctrl.fn.changeTestType();$ctrl.fn.updateEstimatedVisitors()"><option selected disabled value>Select a test type...</option></select></div><div class="ums-form__row" ng-if="$ctrl.state.shared.test.testType === 0"><label class="ums-form__label">Assigning visitors to this A/B Test <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">When checked, visitors will be assigned to this test when visiting any page. Otherwise, visitors are only assigned to this test when arriving on this page.</span></span></label><div class="ums-form__switch" style="width: 100%;"><input type="radio" name="AssignVisitors" id="AssignVisitors-2-2" ng-value="true" class="ums-form__switch__input" no-dirty-check required value="true" aria-invalid="false" ng-model="$ctrl.state.shared.test.assignVisitorsOnAnyPage"> <label style="width: 50%" for="AssignVisitors-2-2" class="ums-form__switch__label">On any page</label> <input type="radio" name="AssignVisitors" id="AssignVisitors-2-1" ng-value="false" class="ums-form__switch__input" no-dirty-check required value="false" aria-invalid="false" ng-model="$ctrl.state.shared.test.assignVisitorsOnAnyPage"> <label style="width: 50%" for="AssignVisitors-2-1" class="ums-form__switch__label">Only on this page</label></div></div><div ng-if="$ctrl.state.shared.test.testType === 1"><label class="ums-form__label">Select multiple pages *</label><p class="umsDescription">The following pages will be subjected to this test.</p><div class="ums-form__row"><select class="ums-form__select" required no-dirty-check ng-if="$ctrl.state.languages.length > 1" ng-model="$ctrl.state.pagePicker.culture" ng-options="lang.culture as lang.name for lang in $ctrl.state.languages" ng-change="$ctrl.fn.pagePicker.setPages()"><option value>Select a culture...</option></select><div class="ums-input--flex"></div><ums-render-property alias="\'Umbraco.MultiNodeTreePicker\'" name="\'Engage - Node Picker\'" style="width: 100%" config="$ctrl.state.pagePicker.config" ng-model="$ctrl.state.pagePicker.pages" ng-change="$ctrl.fn.pagePicker.setPages()"></ums-render-property></div></div><div ng-if="$ctrl.state.shared.test.testType === 2"><label class="ums-form__label">Select document types * <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="sm"></ums-icon><span class="ums-form__info__text">The following document types will be subjected to this test</span></span></label><p ng-show="$ctrl.state.contentTypePicker.contentTypes.length > 0" class="umsDescription">The following document types will be subjected to this test.</p><p ng-show="$ctrl.state.contentTypePicker.contentTypes.length === 0" style="color: #cc0000;">You have not setup any document type to be A/B tested. You can set this up in the settings section of the Marketing section.</p><select class="ums-form__select" required no-dirty-check ng-if="$ctrl.state.languages.length > 1 && $ctrl.state.contentTypePicker.contentTypes.length > 0" ng-model="$ctrl.state.contentTypePicker.culture" ng-options="lang.culture as lang.name for lang in $ctrl.state.languages" ng-change="$ctrl.fn.contentTypePicker.updateCulture()"><option selected disabled value>Select a culture...</option></select><div class="ums-form__scroller"><div ng-repeat="contentType in $ctrl.state.contentTypePicker.contentTypes track by contentType.contentTypeId"><label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" ng-checked="$ctrl.fn.contentTypePicker.isChecked(contentType.contentTypeId)" ng-click="$ctrl.fn.contentTypePicker.toggle(contentType.contentTypeId)"> {{ contentType.name }}</span></label></div></div></div><br><div ng-show="$ctrl.state.shared.test.testType === 0 && $ctrl.state.warning.segmentationRequired"><p>This document type is not setup to be A/B tested. You should "Allow segmentation" for this document type and some properties if you want to A/B test this page.<br><br><a href="#/settings/documentTypes/edit/{{$ctrl.state.contentTypeId}}" class="ums-button--link">Edit this Document Type</a></p></div><hr><div class="ums-form__row" ng-if="!($ctrl.state.shared.test.testType === 0 && $ctrl.state.warning.segmentationRequired) && !($ctrl.state.shared.test.testType === 3)"><label class="ums-form__label">Add variants *</label><p class="umsDescription" ng-if="$ctrl.state.shared.test.variants">Setup your test by adding one or more variants.</p><div class="ums-form__innerrow" ng-repeat="variant in $ctrl.state.shared.test.variants"><div class="ums-form__input-iconwrap ums-form__input-iconwrap--auto"><span class="ums-form__input-icon ums-form__input-icon--auto ums-form__input-icon--color-dark" ng-bind="$ctrl.fn.variants.getLabel($index)"></span> <input type="text" no-dirty-check ng-model="variant.name" class="ums-form__input" placeholder="Name of variant.." required></div><button class="btn" type="button" ng-click="$ctrl.fn.variants.edit(variant)">Edit</button> <button class="btn ums-button ums-button--light ums-button--square-icon" type="button" ng-click="$ctrl.fn.variants.preview(variant)"><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button></div><button type="button" class="umb-node-preview-add" ng-click="$ctrl.fn.variants.add()">Add a variant</button></div><div ng-if="$ctrl.state.shared.test.testType === 3"><label class="ums-form__label">Add pages *</label><p class="umsDescription">Select two or more pages to be subjected to this test. Make sure to only link to one specific variant within navigations and hyperlinks for optimal results.</p><div class="ums-form__row"><select id="form0125" class="ums-form__select" required ng-if="$ctrl.state.languages.length > 1" ng-model="$ctrl.state.splitUrlPagePicker.culture" ng-options="lang.culture as lang.name for lang in $ctrl.state.languages" ng-change="$ctrl.fn.splitUrlPagePicker.setPages()"><option value>Select a culture...</option></select><div class="ums-input--flex"></div><ums-render-property alias="\'Umbraco.MultiNodeTreePicker\'" name="\'Engage - Node Picker\'" style="width: 100%" config="$ctrl.state.splitUrlPagePicker.config" ng-model="$ctrl.state.splitUrlPagePicker.pages" ng-change="$ctrl.fn.splitUrlPagePicker.setPages()"></ums-render-property></div></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container ums-boxed__container--fullheight ums-boxed__container--fresh"><h2>3. Settings</h2><p class="umsDescription">Which conversion goal do you want to improve and which percentage of your visitors should be subjected to the test?</p><div class="ums-form__row"><label for="form0123" class="ums-form__label">Select a conversion goal *</label><select id="form0123" class="ums-form__select ums-form__select--flex" required no-dirty-check ng-model="$ctrl.state.shared.test.goal" ng-options="goal as goal.name for goal in $ctrl.state.goals | filter:{isActive: true, isInvalid: false} | orderBy: \'name\' track by goal.id" ng-change="$ctrl.fn.updateBaselineConversionRate()"><option value selected disabled>Select goal...</option></select><button class="btn ums-button ums-button--light ums-button--square-icon ums-popup__enter" type="button" ng-click="$ctrl.fn.onCreateNewGoal()"><ums-icon id="icon-plus" modifier="xxs"></ums-icon><div class="ums-popup__holder">Add new goal</div></button></div><div class="ums-form__row"><div class="ums-form__label">Set audience percentage</div><rzslider rz-slider-model="$ctrl.state.shared.test.participationPercentage" rz-slider-options="$ctrl.state.sliderOptions"></rzslider></div><br><br><p class="umsDescription">The advanced settings below can be changed if you want to overrule the default values. Please note that changing them may have serious impact on your test.</p><ums-accordion-item name="Advanced settings"><div class="ums-form__row"><label for="form0124" class="ums-form__label">Expected conversion change (MDE) <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="sm"></ums-icon><span class="ums-form__info__text">The Minimal Detectable Effect is used to calculate the number of visitors the test requires before a reliable conclusion can be drawn.</span></span></label><rzslider rz-slider-model="$ctrl.state.shared.test.minimumDetectableEffect" rz-slider-options="$ctrl.state.sliderOptions"></rzslider></div></ums-accordion-item><div class="ums-testadvice__small__container" ng-if="$ctrl.state.shared.test.minimumDetectableEffect != null && $ctrl.state.shared.test.baselineConversionRate != null && $ctrl.state.shared.test.goal != null"><div class="ums-testadvice__icon ums-testadvice__small__icon"><ums-icon id="icon-logo" modifier="md"></ums-icon></div><div class="ums-testadvice__small__textbox">You expect a conversion change of <span>{{$ctrl.state.shared.test.minimumDetectableEffect | percentage}}</span> resulting in a conversion rate of <span>{{$ctrl.state.shared.test.baselineConversionRate * (1 + ($ctrl.state.shared.test.goal.isInverted ? -1 : 1) * $ctrl.state.shared.test.minimumDetectableEffect) | percentage:2}}</span></div></div></div></div></div><div class="ums-flexgrid__container" ng-if="!$ctrl.state.confirm"><div class="ums-flexgrid__item ums-flexgrid__item--1-2"><button ng-if="$ctrl.back" ng-click="$ctrl.back({ test: $ctrl.state.shared.test })" type="button" class="btn ums-button ums-button--icon ums-button--line"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>Back</span></button></div><div class="ums-flexgrid__item ums-flexgrid__item--1-2" style="text-align: right;"><button class="btn ums-button ums-button--error ums-button--icon" type="button" ng-click="$ctrl.state.overlay.deleteTest = true" ng-if="!$ctrl.state.firstSave && $ctrl.state.shared.test.id > 0 && ($ctrl.state.shared.test.status === 1 || $ctrl.state.shared.test.status === 5)"><span>Delete test</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--base ums-button--gear ums-button--icon" type="button" ng-click="$ctrl.fn.saveDraft()" ng-show="!($ctrl.state.shared.test.testType === 0 && $ctrl.state.warning.segmentationRequired)"><span>Save</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--success ums-button--icon" type="submit" ng-click="$ctrl.state.formWasSubmitted = true" ng-show="!($ctrl.state.shared.test.testType === 0 && $ctrl.state.warning.segmentationRequired)"><span>Next step</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></div></div><div class="ums-flexgrid__container ums-flexgrid__container--lg umsPaddingTop" ng-if="$ctrl.state.confirm"><div class="ums-flexgrid__item ums-flexgrid__item--1-2 ums-flexgrid__item--lg-1-3 is-animated"><div class="ums-boxed__container"><ums-ab-testing-test-information ng-if="$ctrl.state.shared.test" test="$ctrl.state.shared.test"></ums-ab-testing-test-information><br><ums-ab-testing-test-indication indication="$ctrl.state.indication"></ums-ab-testing-test-indication></div></div><div class="ums-flexgrid__item ums-flexgrid__item--lg-2-3"><ums-ab-testing-test-variants ng-if="$ctrl.state.variantDetails" variants="$ctrl.state.variantDetails"></ums-ab-testing-test-variants><div class="ums-button__wrapper"><button class="btn ums-button ums-button--icon ums-button--light" type="button" ng-click="$ctrl.state.confirm = false"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>Edit settings</span></button><div ng-show="!$ctrl.state.schedule"><button class="btn ums-button ums-button--error ums-button--icon" type="button" ng-if="$ctrl.state.shared.test.id > 0 && ($ctrl.state.shared.test.status === 1 || $ctrl.state.shared.test.status === 5)" ng-click="$ctrl.state.overlay.deleteTest = true"><span>Delete test</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button> <span>&nbsp; or &nbsp;</span> <button class="btn ums-button ums-button--main ums-button--icon" type="button" ng-click="$ctrl.state.schedule = true"><span>Schedule test</span><ums-icon id="icon-date-select" modifier="sm"></ums-icon></button> <span>&nbsp; or &nbsp;</span> <button class="btn ums-button ums-button--success ums-button--icon" type="submit"><span>Start test now</span><ums-icon id="icon-arrow" modifier="sm"></ums-icon></button></div><div ng-show="$ctrl.state.schedule" class="datepicker-umbraco datepicker-umbraco-flatpickr"><div class="ums-boxed__flexsection--nomargin"><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker" style="max-height: 40px; width: 340px;"><umb-flatpickr options="$ctrl.state.timepicker.options" on-setup="$ctrl.fn.onSetupPicker(fpItem, $ctrl.state.scheduleTime)" on-change="$ctrl.fn.onTimePickerChange($ctrl.state.timepicker.timestamp)" class="ums-segmentparameter__datepicker-input"></umb-flatpickr><span class="ums-form__input-icon"><ums-icon id="icon-date-select" modifier="sm"></ums-icon></span> <button class="ums-segmentparameter__datepicker-btn" ng-if="$ctrl.state.scheduleTime" ng-click="$ctrl.state.timepicker.timestamp.clear()" type="button"><i class="icon-delete"></i></button></div></div><button class="btn ums-button ums-button--main ums-button--icon" type="button" ng-disabled="$ctrl.state.scheduleTime == null" ng-click="$ctrl.fn.saveTestScheduleTime($ctrl.state.scheduleTime)" style="margin-left: 10px;"><span>Schedule test</span><ums-icon id="icon-date-select" modifier="sm"></ums-icon></button></div></div></div></div></form><ums-overlay ng-if="$ctrl.state.validationResults.errors.length > 0 && $ctrl.state.overlay.validationResults.isOpen" close="$ctrl.state.overlay.validationResults.isOpen = false"><ums-overlay-body><div class="ums-flexgrid__container"><ul><li ng-repeat="error in $ctrl.state.validationResults.errors" ng-bind="error" style="color: #cc0000;"></li></ul></div></ums-overlay-body></ums-overlay><ums-ab-testing-variant-editor ng-if="$ctrl.state.overlay.codeOverlay.isOpen" title="Edit variant" has-variants="true" close="$ctrl.fn.overlay.closeCode()" variant="$ctrl.state.shared.test.variants[$ctrl.state.overlay.codeOverlay.index]" index="$ctrl.state.overlay.codeOverlay.index" remove-variant="$ctrl.fn.variants.remove($ctrl.state.overlay.codeOverlay.index)" preview-variant="$ctrl.fn.variants.preview(variant)"></ums-ab-testing-variant-editor></div><ums-ab-testing-create-project ng-if="$ctrl.state.overlay.createProject.isOpen" on-close="$ctrl.state.overlay.createProject.isOpen = false" on-create="$ctrl.fn.onProjectCreated(project)"></ums-ab-testing-create-project><ums-ab-testing-delete-test ng-if="$ctrl.state.overlay.deleteTest" test-id="$ctrl.state.shared.test.id" on-cancel="$ctrl.state.overlay.deleteTest = false" on-delete="$ctrl.fn.onDeleteTest(test)"></ums-ab-testing-delete-test><ums-goal-editor ng-if="$ctrl.state.overlay.createGoal.isOpen" goal="$ctrl.state.newGoal" on-cancel="$ctrl.fn.onCloseGoalPopup()" on-save-goal="$ctrl.fn.onGoalCreated()"></ums-goal-editor>',bindings:{id:"<?",editVariant:"&?",enableSinglePage:"<?",enableSplitUrl:"<?",testType:"<?",onCreated:"&?",back:"&?"},controller:["umsAbTestingService","umsAbTestingHelper","umsGoalsService","umsAbTestingCreateTestState","umsAbTestingCreateTestService","languageResource","$location","umsScreenManager","contentResource","umsAnalyticsApi","notificationsService","$q","umsUtilService","umsRoutingHelper","umsEventEmitter","umsAbTestingProjectApi","umsDocumentTypePermissionsService",umsAbTestingCreateTestController]}),angular.module("engage").service("umsAbTestingCreateTestService",["umsAbTestingCreateTestState","umsAbTestingService","umsUtilService","$q",function umsAbTestingCreateTestService(createTestState,testService,umsUtilService,$q){var state={shared:createTestState},fn={previewVariant:function(variant){var variantIndex=state.shared.test.variants.indexOf(variant);testService.saveTest(state.shared.test,!1).then(function(response){if(null!=response.data.test){state.shared.test=response.data.test;var persistedVariant=state.shared.test.variants[variantIndex];null!=persistedVariant&&persistedVariant.id>0&&function openPreview(variantId){fn.publishVariants().then(function(){testService.getPreviewUrl(state.shared.test.id,variantId).then(function(response){response.data.previewUrl&&window.open(response.data.previewUrl,"_blank")})})}(persistedVariant.id)}})},publishVariants:function(){return fn.saveOrPublishVariants(!0)},saveVariants:function(){return fn.saveOrPublishVariants(!1)},saveOrPublishVariants:function(publish){if(0!==state.shared.test.testType||null==state.shared.test.variants||0===state.shared.test.variants.length)return $q.when();for(var variantIds={},i=0;i<state.shared.test.variants.length;i++){var variant=state.shared.test.variants[i];variantIds[variant.id]=1}var culture=umsUtilService.getCurrentCulture();return(publish&&umsUtilService.publishContent||umsUtilService.saveContent)(function(args){if(null!=args.culture&&args.culture!==culture)return!1;var match=/\d+/.exec(args.segment);if(null==match||1!==match.length)return!1;var variantId=match[0];return null!=variantIds[variantId]})}};this.fn=fn}]),angular.module("engage").component("umsAbTestingDeleteTest",{bindings:{testId:"<?",onCancel:"&?",onDelete:"&?"},template:'<ums-overlay small="true" fluid="true" close="$ctrl.onCancel()"><ums-overlay-header><h2 style="margin: 0;">Permanently delete test \'<strong ng-bind-html="$ctrl.state.test.name"></strong>\'?</h2></ums-overlay-header><ums-overlay-body><p>This A/B Test was created on <strong ng-bind-html="$ctrl.state.test.created | date: \'fullDate\'"></strong> by <strong ng-bind-html="$ctrl.state.test.createdByUmbracoUsername"></strong> <span ng-if="$ctrl.state.test.status === 1">and is scheduled to run on <strong ng-bind-html="$ctrl.state.test.startTime | date:\'fullDate\'"></strong> at <strong ng-bind-html="$ctrl.state.test.startTime| date:\'shortTime\'"></strong>.</span></p><p>Performing this action <span ng-if="$ctrl.state.test.status === 1">will unschedule and</span> remove the A/B Test, and remove all related information. This action is permanent cannot be undone.</p><div ng-if="$ctrl.state.validationResults.errors.length > 0"><br><ul><li ng-repeat="error in $ctrl.state.validationResults.errors" ng-bind="error" style="color: #cc0000;"></li></ul></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span></span> <span><button type="button" class="ums-button ums-button--line" ng-click="$ctrl.fn.cancel()">Cancel</button> <button type="button" class="ums-button ums-button--error" ng-click="$ctrl.fn.delete(true)">Yes, delete</button></span></ums-overlay-footer></ums-overlay>',controller:["umsAbTestingService","notificationsService",function(service,notificationsService){var ctrl=this;ctrl.state={test:null,validationResults:null},this.$onInit=function(){service.getTestDetails(ctrl.testId).then(function(response){ctrl.state.test=response.data})},this.fn={cancel:function(){"function"==typeof ctrl.onCancel&&ctrl.onCancel()},delete:function(){service.deleteTest(ctrl.testId).then(function(response){response.data&&(ctrl.state.validationResults=response.data,response.data&&response.data.isValid&&"function"==typeof ctrl.onDelete&&ctrl.onDelete({test:ctrl.state.test}))},function(){notificationsService.add({type:"error",headline:"An error occurred while trying to delete the A/B test. Please refresh the page and try again."})})}}}]}),angular.module("engage").component("umsAbTestingDisableTestVariant",{bindings:{test:"<?",testVariant:"<?",onCancel:"&?",onDisable:"&?"},template:'<ums-overlay small="true" close="$ctrl.onCancel()"><ums-overlay-header><h4 class="h2 umsHeading">Disable variant <span ng-bind-html="$ctrl.testVariant.label"></span> \'<span ng-bind-html="$ctrl.testVariant.name"></span>\' for test \'<strong ng-bind-html="$ctrl.test.name"></strong>\'</h4></ums-overlay-header><ums-overlay-body><p>New visitors will no longer be served / assigned to this test variant. The test variant will also no longer be considered for the evaluation of the test. This action is permanent and cannot be undone!</p><div ng-if="$ctrl.state.validationResults.errors.length > 0"><br><ul><li ng-repeat="error in $ctrl.state.validationResults.errors" ng-bind="error" style="color: #cc0000;"></li></ul></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button type="button" ng-click="$ctrl.fn.cancel()" class="btn ums-button ums-button--light ums-button--icon">Cancel</button> <button type="button" ng-click="$ctrl.fn.disable()" class="btn ums-button ums-button--success ums-button--icon">Confirm</button></ums-overlay-footer></ums-overlay>',controller:["umsAbTestingService","notificationsService",function(service,notificationsService){var ctrl=this;ctrl.state={status:null},this.fn={cancel:function(){"function"==typeof ctrl.onCancel&&ctrl.onCancel()},disable:function(){service.disableVariant(ctrl.testVariant.id).then(function(){notificationsService.info('Variant "'+ctrl.testVariant.name+'" was disabled'),"function"==typeof ctrl.onDisable&&ctrl.onDisable({testVariant:ctrl.testVariant})},function(){notificationsService.error("An error occurred while trying to disable the A/B test variant. Please refresh the page and try again.")})}}}]}),angular.module("engage").component("umsAbTestingFinishTest",{bindings:{testId:"<?",onCancel:"&?",onFinish:"&?"},template:'<ums-overlay small="true" close="$ctrl.onCancel()"><ums-overlay-header><h4 class="h2 umsHeading">Stop this test</h4></ums-overlay-header><ums-overlay-body><p><strong>You can complete your test by selecting a winner (or no winner) right away.</strong><br>Do you want some time to get into the data? No problem! Simply choose \'Stop and complete later\' and complete the test whenever you are ready.</p></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button ng-click="$ctrl.fn.cancel()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button><div><button ng-click="$ctrl.fn.finish(false)" class="btn ums-button ums-button--main ums-button--icon" type="button">Stop and complete later</button> <span>&nbsp; or &nbsp;</span> <button ng-click="$ctrl.fn.finish(true)" class="btn ums-button ums-button--success ums-button--icon" type="button">Stop and complete now</button></div><div ng-if="$ctrl.state.validationResults.errors.length > 0"><br><ul><li ng-repeat="error in $ctrl.state.validationResults.errors" ng-bind="error" style="color: #cc0000;"></li></ul></div></ums-overlay-footer></ums-overlay>',controller:["umsAbTestingService","userService",function(service,userService){var ctrl=this,state=this.state={test:null,userId:null,validationResults:null};this.$onInit=function(){service.getTestDetails(this.testId).then(function(response){state.test=response.data}),userService.getCurrentUser().then(function(user){state.userId=user.id})},this.fn={cancel:function(){"function"==typeof ctrl.onCancel&&ctrl.onCancel()},finish:function(selectWinnerAfterwards){state.test&&(state.test.endTime=new Date,state.test.stoppedByUmbracoUserId=state.userId,service.saveTest(state.test,!1).then(function(response){var success=!1;if(response.data&&(state.validationResults=response.data.validationResults,response.data.validationResults&&response.data.validationResults.isValid&&(success=!0,"function"==typeof ctrl.onFinish))){var result={test:state.test,selectWinnerAfterwards:selectWinnerAfterwards};ctrl.onFinish(result)}success&&(state.test.endTime=null)},function(){state.test.endTime=null}))}}}]}),angular.module("engage").component("umsAbTestingSelectWinner",{bindings:{testId:"<",variants:"<",onCancel:"&?",onConfirm:"&?"},template:'<ums-overlay dark="true" large="true" close="$ctrl.onCancel()"><ums-overlay-header><h4 class="h2 umsHeading">Select the winning variant</h4></ums-overlay-header><ums-overlay-body><p>Please complete the test by selecting a winning variant. Does it seem that there is no winner? No worries; simply select that option. These results will be used for reporting purposes within your test project.</p><table class="ums-table__table ums-table__table--boxed"><tbody class="is-animated ums-table__winnerselect__container ums-table__winnerselect__container--nowinner" ng-class="{\'is-checked\': $ctrl.state.test.winner == null }"><tr class="ums-table__tr ums-table__tr ums-table__tr--toggle" ng-click="$ctrl.state.test.winner = null"><td style="width: 20px; min-width: 0; text-align: center;"><input class="ums-table__winnerselect__input" type="radio" name="test-winner" id="test-winner-none" ng-model="$ctrl.state.test.winner" ng-value="null"><div class="ums-table__winnerselect__fakecheck"><ums-icon id="icon-checkmark"></ums-icon></div></td><td class="ums-table__td" colspan="7">My test did not result in a winner.</td></tr></tbody><tbody class="ums-table__thead ums-table__thead--labels-alt"><tr class="ums-table__tr ums-table__tr--labels ums-table__tr--labels-alt" colspan="7"><th class="ums-table__th" style="width: 20px; min-width: 0; text-align: center;"></th><th class="ums-table__th"><div class="umsLabel">Variant</div></th><th class="ums-table__th"><div class="umsLabel">Visitors</div></th><th class="ums-table__th"><div class="umsLabel">Goal / Value</div></th><th class="ums-table__th"><div class="umsLabel">Difference</div></th><th class="ums-table__th"><div class="umsLabel">Macro Conversion</div></th><th class="ums-table__th"><div class="umsLabel">Status</div></th></tr></tbody><tbody ng-repeat="variant in $ctrl.variants track by $index" class="is-animated ums-table__winnerselect__container" ng-class="{\'is-checked\': $ctrl.state.test.winner.id === variant.id }"><tr class="ums-table__tr ums-table__tr ums-table__tr--toggle" ng-click="$ctrl.state.test.winner = variant" ng-class="{ \'s-open\': variant.open, \'s-winner\': variant.isWinner, \'ums-table__tr--disabled\': variant.isDisabled, \'ums-table__tr--leading\': variant.isLeading, \'ums-table__tr--warning\': variant.mainGoalWarning}"><td style="width: 20px; min-width: 0; text-align: center;"><span class="leading-sticker leading-sticker--lower" style="display: none">Leading</span> <input class="ums-table__winnerselect__input" type="radio" name="test-winner" id="test-winner-{{ $index }}" ng-model="$ctrl.state.test.winner" ng-value="variant"><div class="ums-table__winnerselect__fakecheck"><ums-icon id="icon-checkmark"></ums-icon></div></td><td class="ums-table__td"><strong ng-bind="$ctrl.fn.getVariantLabel($index)"></strong>&nbsp;&nbsp; {{variant.name}}</td><td class="ums-table__td"><strong>{{$ctrl.state.variantDetailsById[variant.id].currentTotalVisitorCount | number}}<span ng-show="$ctrl.state.variantDetailsById[variant.id].requiredTotalVisitorCount != null"><span class="umsOpacity50">/ {{$ctrl.state.variantDetailsById[variant.id].requiredTotalVisitorCount | number}}</span></span></strong></td><td class="ums-table__td"><strong>{{$ctrl.state.variantDetailsById[variant.id].goalCompletions | number}}x <span class="umsOpacity50">/ &euro; {{$ctrl.state.variantDetailsById[variant.id].goalValue}}</span></strong></td><td class="ums-table__td"><strong ng-bind="$ctrl.state.variantDetailsById[variant.id].difference | percentage:2" ng-class="{ \'umsColor-success\': !$ctrl.state.variantDetailsById[variant.id].goalWarning, \'umsColor-warning\': $ctrl.state.variantDetailsById[variant.id].goalWarning }"></strong></td><td class="ums-table__td"><strong><span class="umsOpacity50" ng-if="!$ctrl.state.variantDetailsById[variant.id].mainGoalWarning">Ok</span> <span class="umsColor-warning" ng-if="$ctrl.state.variantDetailsById[variant.id].mainGoalWarning">Warning!</span></strong></td><td class="ums-table__td" ng-switch="variant.status"><span class="ums-tags ums-tags--running" ng-switch-when="0">Running</span> <span class="ums-tags ums-tags--warning" ng-switch-when="1">Warning</span> <span class="ums-tags ums-tags--disabled" ng-switch-when="2">Disabled</span> <span class="ums-tags ums-tags--reliable" ng-switch-when="3">Reliable</span> <span class="ums-tags ums-tags--stopped" ng-switch-when="4">Stopped</span> <span class="ums-tags ums-tags--waiting" ng-switch-when="5">Scheduled</span> <span class="ums-tags" ng-class="{\'ums-tags--leading\': variant.isWinner}" title="Variant is leading"><ums-icon id="icon-cup" modifier="sm"></ums-icon></span></td></tr></tbody></table><div ng-if="$ctrl.state.validationResults.errors.length > 0"><br><ul><li ng-repeat="error in $ctrl.state.validationResults.errors" ng-bind="error" style="color: #cc0000;"></li></ul></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button ng-click="$ctrl.fn.cancel()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button> <button ng-click="$ctrl.fn.confirm()" class="btn ums-button ums-button--success ums-button--icon" type="button">Confirm</button></ums-overlay-footer></ums-overlay>',controller:["umsAbTestingService","umsAbTestingHelper","userService","notificationsService",function(service,helper,userService,notificationsService){var ctrl=this,state=this.state={test:null,variantDetailsById:{},userId:null,validationResults:null};this.$onInit=function(){state.variantDetailsById=this.variants.reduce(function(byId,detail){return byId[detail.id]=detail,byId},{}),service.getTestDetails(this.testId).then(function(response){state.test=response.data}),userService.getCurrentUser().then(function(user){state.userId=user.id})},this.fn={cancel:function(){"function"==typeof ctrl.onCancel&&ctrl.onCancel()},confirm:function(){state.test&&(state.test.isCompleted=!0,state.test.completedOn=new Date,state.test.completedByUmbracoUserId=state.userId,service.saveTest(state.test,!1).then(function(response){var success=!1;response.data&&(state.validationResults=response.data.validationResults,response.data.validationResults&&response.data.validationResults.isValid&&(success=!0,state.test.winner?notificationsService.add({type:"success",headline:"A/B test Variant '"+state.test.winner.name+"' has been selected as the winner!"}):notificationsService.add({type:"success",headline:"The A/B Test has been concluded with no winner!"}),"function"==typeof ctrl.onConfirm&&ctrl.onConfirm())),success||(state.test.isCompleted=!1,state.test.completedOn=null,state.test.completedByUmbracoUserId=null)},function(){state.test.isCompleted=!1,state.test.completedOn=null,state.test.completedByUmbracoUserId=null,notificationsService.add({type:"error",headline:"An error has occurred. Please refresh the page and try again."})}))},getVariantLabel:function(idx){return helper.getVariantLabel(idx)}}}]}),angular.module("engage").factory("umsAbTestingTestDetailState",[function(){return{id:null}}]),angular.module("engage").component("umsAbTestingTestDetail",{template:'<div class="ums-content umsPaddingBottom"><div ng-if="$ctrl.state.isLoading || $ctrl.state.errorMessage"><ums-loader ng-if="$ctrl.state.isLoading"></ums-loader><h3 style="color:#c00" ng-if="$ctrl.state.errorMessage" ng-bind="$ctrl.state.errorMessage"></h3></div><div class="ums-flexgrid__container ums-flexgrid__container--lg" ng-if="!$ctrl.state.isLoading && $ctrl.state.viewModel"><div class="ums-flexgrid__item ums-flexgrid__item--1-2 ums-flexgrid__item--lg-1-3 is-animated umsPaddingTop"><div class="ums-boxed__container"><ums-ab-testing-test-information ng-if="$ctrl.state.viewModel.test" test="$ctrl.state.viewModel.test" indication="$ctrl.state.viewModel.indication"></ums-ab-testing-test-information><br><ums-ab-testing-test-indication indication="$ctrl.state.viewModel.indication" class="umsLargeOnly"></ums-ab-testing-test-indication></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-2 umsSmallOnly"><ums-ab-testing-test-indication indication="$ctrl.state.viewModel.indication"></ums-ab-testing-test-indication></div><div class="ums-flexgrid__item ums-flexgrid__item--lg-2-3"><div class="umsPaddingTop"><ums-ab-testing-test-variants test="$ctrl.state.viewModel.test" variants="$ctrl.state.viewModel.variants" on-variant-changed="$ctrl.fn.onVariantChanged()"></ums-ab-testing-test-variants><div class="ums-button__wrapper" style="width:1100px"><button ng-if="$ctrl.back != null" ng-click="$ctrl.back({ test: $ctrl.state.viewModel.test })" type="button" class="btn ums-button ums-button--icon ums-button--light"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>Back</span></button><div><button class="btn ums-button ums-button--light ums-button--icon" ng-if="$ctrl.state.viewModel.test.status === 1 && $ctrl.fn.isScheduled($ctrl.state.viewModel.test.startTime)" type="button" ng-click="$ctrl.fn.unschedule($ctrl.state.viewModel.test)"><span>Unschedule test</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button> <span ng-if="$ctrl.state.viewModel.test.status === 1 && $ctrl.fn.isScheduled($ctrl.state.viewModel.test.startTime)">&nbsp; or &nbsp;</span> <button class="btn ums-button ums-button--error ums-button--icon" ng-if="$ctrl.state.viewModel.test.status === 1" type="button" ng-click="$ctrl.overlay.deleteTest = true"><span>Delete test</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></div><button type="button" class="btn ums-button ums-button--success ums-button--icon" ng-if="$ctrl.state.viewModel.test.status === 2" ng-click="$ctrl.overlay.finishTest = true"><span>End test</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--success ums-button--icon" type="button" ng-if="$ctrl.state.viewModel.test.status === 3" ng-click="$ctrl.overlay.selectWinner = true"><span>Select winner</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></div></div></div></div></div><ums-ab-testing-delete-test ng-if="$ctrl.overlay.deleteTest" test-id="$ctrl.state.shared.id" on-cancel="$ctrl.overlay.deleteTest = false" on-delete="$ctrl.fn.onDeleteTest(test)"></ums-ab-testing-delete-test><ums-ab-testing-finish-test ng-if="$ctrl.overlay.finishTest" test-id="$ctrl.state.shared.id" on-cancel="$ctrl.overlay.finishTest = false" on-finish="$ctrl.fn.onFinishTest(selectWinnerAfterwards)"></ums-ab-testing-finish-test><ums-ab-testing-select-winner ng-if="$ctrl.overlay.selectWinner" test-id="$ctrl.state.shared.id" variants="$ctrl.state.viewModel.variants" on-cancel="$ctrl.overlay.selectWinner = false" on-confirm="$ctrl.fn.onConfirmWinner()"></ums-ab-testing-select-winner><ums-ui-confirm-overlay ng-if="$ctrl.state.confirmUnschedule" title="$ctrl.state.confirmUnschedule.header" text="$ctrl.state.confirmUnschedule.text" confirm-yes-action="$ctrl.state.confirmUnschedule.fn(); $ctrl.state.confirmUnschedule = null" confirm-yes-text="$ctrl.state.confirmUnschedule.yesText" close="$ctrl.state.confirmUnschedule = null"></ums-ui-confirm-overlay>',bindings:{testId:"<?",back:"&?"},controller:["umsAbTestingTestDetailState","umsAbTestingService","umsAbTestingHelper","$location","$route","notificationsService",umsAbTestingTestDetailController]}),angular.module("engage").component("umsAbTestingTestFilters",{template:'<div class="ums-filter__container"><div class="ums-filter__row"><div class="ums-form__label ums-filter__label">Show status</div><label class="ums-form__checkbox__label" for="input-filter--01"><input id="input-filter--01" class="ums-form__checkbox__input" type="checkbox" no-dirty-check ng-model="$ctrl.state.filters.waiting">New</label> <label class="ums-form__checkbox__label" for="input-filter--02"><input id="input-filter--02" class="ums-form__checkbox__input" type="checkbox" no-dirty-check ng-model="$ctrl.state.filters.running">Running</label> <label class="ums-form__checkbox__label" for="input-filter--03"><input id="input-filter--03" class="ums-form__checkbox__input" type="checkbox" no-dirty-check ng-model="$ctrl.state.filters.completed">Completed</label></div><div class="ums-filter__row"><div for="input-filter--07" class="ums-form__label ums-filter__label">Created by</div><select class="ums-form__select" name="input-filter--07" ng-model="$ctrl.state.filters.userId" no-dirty-check ng-options="user.id as user.name for user in $ctrl.state.users"><option value>All</option></select></div></div>',bindings:{filters:"="},controller:["umsUserService",function(userService){var state=this.state={filters:null,users:[]};this.$onInit=function(){state.filters=Object.assign(this.filters,{waiting:!0,running:!0,completed:!0,userId:null}),userService.getAll().then(function(users){state.users=users})}}]}),angular.module("engage").component("umsAbTestingTestIndication",{bindings:{indication:"<"},template:'<div ng-if="$ctrl.indication"><div ng-show="$ctrl.indictation.hasSurpassedViableVisitorThreshold && $ctrl.indication.status === 2 && $ctrl.indication.hurtingVariants.length > 0" class="ums-testadvice__container ums-testadvice__container--warning"><div class="ums-testadvice__icon"><ums-icon id="icon-warning" modifier="md"></ums-icon></div><div class="ums-testadvice__textbox"><h3>Your attention is required!</h3><p>One or more variants are affecting the macro conversion(s). You should consider excluding these variants.</p></div></div><div ng-show="(!$ctrl.indication.hasSurpassedViableVisitorThreshold || $ctrl.indication.estimatedRuntimeInDays == null) && ($ctrl.indication.status === 1 || $ctrl.indication.status === 2 || $ctrl.indication.status === 5)" class="ums-testadvice__container ums-testadvice__container--base"><div class="ums-testadvice__icon"><ums-icon id="icon-logo" modifier="md"></ums-icon></div><div class="ums-testadvice__textbox" ng-if="$ctrl.indication.status === 1 || $ctrl.indication.status === 5"><h3>Estimated test duration unknown</h3><p>It is not possible to calculate the expected duration of your test. If the tested pages are relatively new then this can be caused by the lack of sufficient analytics data. In any other case; change the MDE value within the \'Advanced settings\' section and try again. Please be aware that it is ok to start testing anyway!</p></div><div class="ums-testadvice__textbox" ng-if="$ctrl.indication.status === 2"><h3>Waiting for more data...</h3><p>At this moment we have insufficient data on this running test to support you with advice. Don\'t worry, when there is enough data the advice will be shown right away!</p></div><div class="ums-testadvice__image"><img src="/App_Plugins/Umbraco.Engage/assets/advice-02.svg" alt></div></div><div ng-show="$ctrl.indication.hasSurpassedViableVisitorThreshold && ($ctrl.indication.estimatedRuntimeInDays != null || ($ctrl.indication.status === 3 || $ctrl.indication.status === 4))" class="ums-testadvice__container" ng-class="{ \'ums-testadvice__container--waiting\': $ctrl.indication.status === 1 || $ctrl.indication.status === 5, \'ums-testadvice__container--running\': $ctrl.indication.status === 2, \'ums-testadvice__container--stopped\': $ctrl.indication.status === 3, \'ums-testadvice__container--success\': $ctrl.indication.status === 4 }"><div class="ums-testadvice__icon"><ums-icon id="icon-logo" modifier="md"></ums-icon></div><div class="ums-testadvice__textbox" ng-show="$ctrl.indication.status === 1 || $ctrl.indication.status === 5"><h3>This test should run <span ng-bind-template="{{$ctrl.indication.estimatedRuntimeInDays | number}} {{$ctrl.indication.estimatedRuntimeInDays === 1 ? \'day\': \'days\'}}"></span></h3><p>You have set the MDE value to <span ng-bind="$ctrl.indication.mDE | percentage:2"></span> which leads to an expected conversion {{$ctrl.indication.isInvertedGoal ? \'decrease\' : \'increase\'}} from <span ng-bind="$ctrl.indication.benchmarkConversionRate | percentage:2"></span> to <span ng-bind="$ctrl.indication.targetConversionRate | percentage:2"></span>. For this result to become reliable each variant will need <span ng-bind="$ctrl.indication.requiredVisitorsPerVariant | number"></span> unique visitors.</p><p>With <span ng-bind-template="{{$ctrl.indication.variantCount}} {{$ctrl.indication.variantCount === 1 ? \'variant\' : \'variants\'}}"></span> this test needs <span ng-bind="$ctrl.indication.requiredVisitorsTotal | number"></span> unique {{$ctrl.indication.requiredVisitorsTotal === 1 ? \'visitor\' : \'visitors\'}} in total. Based on the current statistics of <span ng-bind-template="{{$ctrl.indication.expectedDailyVisitors}} daily unique {{$ctrl.indication.expectedDailyVisitors === 1 ? \'visitor\' : \'visitors\' }}"></span> your test should run for approximately <span ng-bind-template="{{$ctrl.indication.estimatedRuntimeInDays | number}} {{$ctrl.indication.estimatedRuntimeInDays === 1 ? \'day\' : \'days\'}}"></span>.</p></div><div class="ums-testadvice__image" ng-show="$ctrl.indication.status === 1"><img src="/App_Plugins/Umbraco.Engage/assets/advice-01.svg" alt></div><div class="ums-testadvice__textbox" ng-show="$ctrl.indication.status === 2 && $ctrl.indication.variantStatus[$ctrl.indication.winningVariant.abTestVariant.id] !== \'Reliable\'"><h3>Your test should run for <span ng-if="$ctrl.indication.estimatedRuntimeInDays <= 365" ng-bind-template="another {{$ctrl.indication.estimatedRuntimeInDays | number}} {{$ctrl.indication.estimatedRuntimeInDays === 1 ? \'day\': \'days\'}}"></span> <span ng-if="$ctrl.indication.estimatedRuntimeInDays > 365">more than a year</span></h3><p ng-show="$ctrl.indication.originalVariantIsWinning">It seems like no variant can outperform the original variant! With a conversion {{$ctrl.indication.bestNonWinningVariantConversionChange < 0 ? \'decrease\' : \'increase\'}} of <span>{{$ctrl.indication.bestNonWinningVariantConversionChange | percentage:2}}</span> variant <span>{{$ctrl.indication.bestNonBenchmarkVariant.abTestVariant.name}}</span> seems to be the best losing variant.</p><p ng-show="!$ctrl.indication.originalVariantIsWinning">With a conversion {{$ctrl.indication.winningVariantConversionChange < 0 ? \'decrease\' : \'increase\'}} of <span>{{$ctrl.indication.winningVariantConversionChange | percentage:2}}</span> variant <span>{{$ctrl.indication.winningVariant.abTestVariant.name}}</span> seems to be in the lead.</p><p>For this result to become reliable variant <span>{{$ctrl.indication.earliestReliableVariant.abTestVariant.name}}</span> needs a total of <span>{{$ctrl.indication.bestPrognosis.requiredVisitorsTotal | number}}</span> unique {{$ctrl.indication.bestPrognosis.requiredVisitorsTotal === 1 ? \'visitor\' : \'visitors\'}} which results in an additional <span>{{$ctrl.indication.bestPrognosis.remainingVisitors | number}}</span> {{$ctrl.indication.bestPrognosis.remainingVisitors === 1 ? \'visitor\' : \'visitors\'}}. Based upon the current statistics of <span>{{$ctrl.indication.expectedDailyVisitors | number}}</span> daily unique {{$ctrl.indication.expectedDailyVisitors === 1 ? \'visitor\' : \'visitors\'}} this test should run for another approximately <span>{{$ctrl.indication.estimatedRuntimeInDays | number}}</span> {{$ctrl.indication.estimatedRuntimeInDays === 1 ? \'day\' : \'days\' }}.</p></div><div class="ums-testadvice__image" ng-show="$ctrl.indication.status === 2 && $ctrl.indication.reliableVariants === 0"><img src="/App_Plugins/Umbraco.Engage/assets/advice-01.svg" alt></div><div class="ums-testadvice__textbox" ng-show="$ctrl.indication.status === 2 && $ctrl.indication.variantStatus[$ctrl.indication.winningVariant.abTestVariant.id] === \'Reliable\'"><h3>Variant <span>{{$ctrl.indication.winningVariant.abTestVariant.name}}</span> seems to be a reliable winner!</h3><p>After <span ng-bind="$ctrl.indication.currentRuntimeInDays | number"></span> {{$ctrl.indication.currentRuntimeInDays === 1 ? \'day\' : \'days\'}} of testing the minimum amount of <span ng-bind="$ctrl.indication.winningVariant.currentVisitors | number"></span> unique {{$ctrl.indication.winningVariant.currentVisitors === 1 ? \'visitor\' : \'visitors\'}} was reached which made the conversion <span>{{$ctrl.indication.winningVariantConversionChange < 0 ? \'decrease\' : \'increase\'}}</span> of <span>{{$ctrl.indication.winningVariantConversionChange | percentage:1}}</span> a reliable result.</p><p>You may continue this test so other variants may become reliable but most likely (given the same conditions) they will never outscore the current winner.</p></div><div class="ums-testadvice__image" ng-show="$ctrl.indication.status === 2 && $ctrl.indication.reliableVariants >= 1"><img src="/App_Plugins/Umbraco.Engage/assets/advice-04.svg" alt></div><div class="ums-testadvice__textbox" ng-show="$ctrl.indication.status === 3 && $ctrl.indication.stoppedOn != null"><h3>This test is stopped</h3><p>This test was stopped on <span ng-bind="$ctrl.indication.stoppedOn | umsDate"></span>.</p><p>This test contains <span ng-bind="$ctrl.indication.reliableVariants"></span> reliable {{$ctrl.indication.reliableVariants === 1 ? \'variant\' : \'variants\'}}.</p><p>Please complete the test after analyzing the results (the results will always remain visible). Did your test result in a winner? Then please pick this winner before completing the test.</p></div><div class="ums-testadvice__image" ng-show="$ctrl.indication.status === 3 && $ctrl.indication.stoppedOn != null"><img src="/App_Plugins/Umbraco.Engage/assets/advice-03.svg" alt></div><div class="ums-testadvice__textbox" ng-show="$ctrl.indication.status === 4"><h3>This test is completed</h3><p ng-if="$ctrl.indication.winner">Variant <span ng-bind="$ctrl.indication.winner.abTestVariant.name"></span> was picked as the winner of this test! It outperformed all other variants.</p><p ng-if="!$ctrl.indication.winner">No winner has been picked for this test.</p><p>User <span ng-bind="$ctrl.indication.completedByUsername"></span> completed the test on <span ng-bind="$ctrl.indication.completedOn | umsDate"></span>.</p><p>This test has run for {{$ctrl.indication.currentRuntimeInDays | number}} {{$ctrl.indication.currentRuntimeInDays === 1 ? \'day\' : \'days\'}} and started on <span ng-bind="$ctrl.indication.startTime | umsDate"></span>.</p></div><div class="ums-testadvice__image" ng-show="$ctrl.indication.status === 4"><img src="/App_Plugins/Umbraco.Engage/assets/advice-04.svg" alt></div></div></div>'}),angular.module("engage").component("umsAbTestingTestInformation",{template:'<h2>{{$ctrl.test.name}} <span class="umsColor-light">#{{$ctrl.test.id}}</span></h2><p class="umsDescription" ng-bind="$ctrl.test.description"></p><br><ums-accordion-item name="Information"><div class="ums-testinformation__container"><div class="ums-testinformation__row ums-testinformation__row--minwidth"><strong>Created:</strong> {{$ctrl.test.created | umsDate}}</div><div class="ums-testinformation__row ums-testinformation__row--minwidth"><strong>Created by:</strong> {{$ctrl.test.createdByUmbracoUsername}}</div><div class="ums-testinformation__row ums-testinformation__row--minwidth" ng-if="$ctrl.test.startTime != null"><strong>Start time:</strong> {{$ctrl.test.startTime | umsDate}}</div><div class="ums-testinformation__row ums-testinformation__row--minwidth" ng-if="$ctrl.test.endTime != null"><strong>End time:</strong> {{$ctrl.test.endTime | umsDate}}</div></div></ums-accordion-item><ums-accordion-item name="Settings"><div class="ums-testinformation__container"><div class="ums-testinformation__row"><strong>Goal:</strong> {{$ctrl.test.goal.name}}</div><div class="ums-testinformation__row" ng-switch="$ctrl.test.testType" ng-if="$ctrl.test.testType === 0"><strong>Type:</strong> Single Page<br><ul><li ng-repeat="page in $ctrl.state.pages track by $index" ng-bind-template="{{page.name}} ({{page.culture}})"></li></ul></div><div class="ums-testinformation__row" ng-switch="$ctrl.test.testType" ng-if="$ctrl.test.testType === 1"><strong>Type:</strong> Multiple Pages<br><ul><li ng-repeat="page in $ctrl.state.pages track by $index" ng-bind-template="{{page.name}} ({{page.culture}})"></li></ul></div><div class="ums-testinformation__row" ng-switch="$ctrl.test.testType" ng-if="$ctrl.test.testType === 2"><strong>Type:</strong> Document Type<br><ul><li ng-repeat="contentType in $ctrl.state.contentTypes track by $index" ng-bind-template="{{contentType.name}} ({{contentType.culture}})"></li></ul></div><div class="ums-testinformation__row" ng-switch="$ctrl.test.testType" ng-if="$ctrl.test.testType === 3"><strong>Type:</strong> Split Url<br><ul><li ng-repeat="page in $ctrl.state.pages track by $index" ng-bind-template="{{page.name}} ({{page.culture}})"></li></ul></div><div class="ums-testinformation__row"><strong>Audience percentage:</strong> {{$ctrl.test.participationPercentage | percentage}}</div><div class="ums-testinformation__row"><strong>MDE:</strong> {{$ctrl.test.minimumDetectableEffect | percentage}}</div></div></ums-accordion-item>',bindings:{test:"<"},controller:["umsUtilService","umsContentTypeService","umsGoalApi",function(umsUtilService,contentTypeResource,umsGoalApi){var ctrl=this,state=ctrl.state={pages:[],contentTypes:[]};this.$onInit=function(){null!=this.test&&(this.test.umbracoPageVariants.length>0?this.test.umbracoPageVariants.forEach(function(page){umsUtilService.getPageName(page.nodeId,page.culture).then(function(name){state.pages.push({name:name,culture:page.culture})})}):this.test.contentTypes.length>0&&contentTypeResource.getAll().then(function(contentTypes){for(var contentTypeNames={},i=0;i<contentTypes.length;i++){var contentType=contentTypes[i];contentTypeNames[contentType.id]=contentType.name}state.contentTypes=ctrl.test.contentTypes.map(function(ct){return{name:contentTypeNames[ct.contentTypeId],culture:ct.culture}})}),null!=this.test.goal&&null!=this.test.goal.name||null==this.test.goal||null==this.test.goal.id||umsGoalApi.getDetails(this.test.goal.id).then(function(response){var goal=response.data;null!=goal&&(ctrl.test.goal=goal)}))}}]}),angular.module("engage").component("umsAbTestingTestList",{template:'<div ng-show="$ctrl.tests.length > 0"><ums-divider ng-if="$ctrl.header" icon="{{$ctrl.icon}}" title="{{$ctrl.header}}"></ums-divider><a class="ums-testdetail__container is-animated" ng-repeat="test in $ctrl.tests track by test.abTestId" ng-class="{ \'ums-testdetail__container--gray\': test.status == 1 || test.status == 3 || test.status == 5, \'ums-testdetail__container--blue\': test.status == 2 && !test.warning, \'ums-testdetail__container--green\': test.status == 4, \'ums-testdetail__container--orange\': test.warning }" ng-click="$ctrl.onClick ? $ctrl.onClick({test: test}) : null" ng-href="{{$ctrl.onClick ? \'\' : \'#/engage/ab-testing/\'+ (test.status === 5 ? \'create-test\' : \'test-detail\') + \'?id=\' + test.abTestId}}"><div class="ums-testdetail__sum__background"><svg x="0px" y="0px" viewBox="0 0 400 400" style="enable-background:new 0 0 400 400;" xml:space="preserve"><path d="M274.6,0H125.4c-5.3,0-10.4,2.1-14.1,5.9L5.9,111.3c-3.8,3.8-5.9,8.8-5.9,14.1v149.1c0,5.3,2.1,10.4,5.9,14.1 l105.4,105.4c3.8,3.8,8.8,5.9,14.1,5.9h149.1c5.3,0,10.4-2.1,14.1-5.9l105.4-105.4c3.8-3.8,5.9-8.8,5.9-14.1V125.4 c0-5.3-2.1-10.4-5.9-14.1L288.7,5.9C284.9,2.1,279.9,0,274.6,0z"></path></svg></div><div class="ums-testdetail__sum__container" ng-switch="test.status"><div class="ums-testdetail__sum__title" ng-switch-when="1"><ums-icon class="ums-testdetail__sum__icon" id="icon-status-schedule"></ums-icon><span class="h2">Scheduled</span></div><div class="ums-testdetail__sum__title" ng-switch-when="2"><ums-icon class="ums-testdetail__sum__icon" id="icon-status-running"></ums-icon><span class="h2">Running</span></div><div class="ums-testdetail__sum__title" ng-switch-when="3"><ums-icon class="ums-testdetail__sum__icon" id="icon-status-stopped"></ums-icon><span class="h2">Stopped</span></div><div class="ums-testdetail__sum__title" ng-switch-when="4"><ums-icon class="ums-testdetail__sum__icon" id="icon-status-done"></ums-icon><span class="h2">Completed</span></div><div class="ums-testdetail__sum__title" ng-switch-when="5"><ums-icon class="ums-testdetail__sum__icon" id="icon-status-draft"></ums-icon><span class="h2">Draft</span></div><div class="ums-testdetail__sum__info" ng-if="test.warning"><div class="umsLabel">Variant info</div><div class="h3">Affecting macro conversions!</div></div><div class="ums-testdetail__sum__info" ng-if="test.status == 1 || test.status == 2"><div class="umsLabel">Started on</div><div class="h3" ng-bind="test.startTime | umsDate"></div></div><div class="ums-testdetail__sum__info" ng-if="test.status == 3 && test.endTime != null"><div class="umsLabel">Stopped on</div><div class="h3" ng-bind="test.endTime | umsDate"></div></div><div class="ums-testdetail__sum__info" ng-if="test.status == 4 && test.endTime != null"><div class="umsLabel">Stopped on</div><div class="h3" ng-bind="test.endTime | umsDate"></div></div><div class="ums-testdetail__sum__info" ng-if="test.status == 5 && !test.name"><div class="umsLabel">Created on</div><div class="h3" ng-bind="test.created | umsDate"></div></div></div><div class="ums-testdetail__badge__container" ng-if="test.status == 4 && !test.winner"><div class="ums-testdetail__badge__popup-holder ums-popup__enter"><ums-icon class="ums-testdetail__badge__icon" modifier="md" id="icon-cup"></ums-icon><div class="ums-testdetail__badge__title">No winner</div><svg class="ums-testdetail__badge__background" x="0px" y="0px" viewBox="0 0 132.599 127.747" style="enable-background:new 0 0 400 400;" xml:space="preserve"><path d="M69.5,0A12,12,0,0,1,79.9,6.02L98.485,38.353a12,12,0,0,1,0,11.96L79.9,82.644a12,12,0,0,1-10.4,6.02H32.424a12,12,0,0,1-10.4-6.02L3.437,50.312a12,12,0,0,1,0-11.96L22.02,6.02A12,12,0,0,1,32.424,0Z" transform="translate(44.332) rotate(30)"></path></svg></div></div><div class="ums-testdetail__badge__container ums-testdetail__badge__container--winner" ng-if="test.status == 4 && test.winner"><div class="ums-testdetail__badge__popup-holder ums-popup__enter"><ums-icon class="ums-testdetail__badge__icon" modifier="md" id="icon-cup"></ums-icon><span class="ums-testdetail__badge__winner" ng-bind="test.winner"></span><div class="ums-testdetail__badge__title">Winner</div><svg class="ums-testdetail__badge__background" x="0px" y="0px" viewBox="0 0 132.599 127.747" style="enable-background:new 0 0 400 400;" xml:space="preserve"><path d="M69.5,0A12,12,0,0,1,79.9,6.02L98.485,38.353a12,12,0,0,1,0,11.96L79.9,82.644a12,12,0,0,1-10.4,6.02H32.424a12,12,0,0,1-10.4-6.02L3.437,50.312a12,12,0,0,1,0-11.96L22.02,6.02A12,12,0,0,1,32.424,0Z" transform="translate(44.332) rotate(30)"></path></svg><div class="ums-popup__holder" ng-if="test.winnerDescription" ng-bind="test.winnerDescription"></div></div></div><div class="ums-testdetail__info__container"><div class="ums-testdetail__info__title" ng-bind="test.name || \'Unnamed draft\'"></div><div><p class="umsDescription" ng-bind="test.description" style="white-space: pre-line;"></p></div><ul class="ums-infoicons__list"><li class="ums-infoicons__item ums-popup__enter" ng-switch="test.testType"><ums-icon id="icon-status-document"></ums-icon><span ng-switch-when="0">Single page</span> <span ng-switch-when="1">Multiple pages</span> <span ng-switch-when="2">Document Type</span> <span ng-switch-when="3">Split Url</span></li><li class="ums-infoicons__item ums-popup__enter" ng-if="test.status === 2 || test.status === 3 || test.status === 4"><ums-icon id="icon-test-number"></ums-icon><span><b ng-bind="test.totalVariants || 0"></b> variants</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Number of variations in this A/B test</div></li><li class="ums-infoicons__item ums-popup__enter" ng-if="test.status === 2 && test.runtimeInDays != null"><ums-icon id="icon-date-select"></ums-icon><span>Running for <b ng-bind="test.runtimeInDays | number"></b> {{test.runtimeInDays === 1 ? \'day\' : \'days\'}}</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Test started on {{test.startTime | umsDate}} (running for {{test.runtimeInDays | number}} {{test.runtimeInDays === 1 ? \'day\' : \'days\'}})</div></li><li class="ums-infoicons__item ums-popup__enter" ng-if="test.status === 2 || test.status === 3 || test.status === 4"><ums-icon id="icon-test-user"></ums-icon><span><b ng-bind="test.totalVisitors || 0"></b> {{test.totalVisitors === 1 ? \' Visitor\' : \' Visitors\'}}</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">The total visitor count of this A/B test</div></li><li class="ums-infoicons__item ums-popup__enter"><ums-icon id="icon-status-draft"></ums-icon><span ng-bind-template="{{test.createdByUmbracoUserName}}"></span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Creator of this A/B test</div></li></ul><span class="ums-gotoarrow ums-gotoarrow"><ums-icon id="icon-arrow"></ums-icon></span></div></a></div>',bindings:{header:"@?",tests:"=*",icon:"@?",onClick:"&?"}}),angular.module("engage").component("umsAbTestingTestVariants",{template:'<div class="is-animated" style="width:1100px"><table class="ums-table__table ums-table__table--boxed" style="table-layout: fixed;"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" ng-attr-colspan="{{ $ctrl.state.hasMainGoals ? \'8\' : \'7\' }}"><h4 class="h3 umsHeading">Scoring overview</h4></td></tr><tr class="ums-table__tr ums-table__tr--labels" colspan="6"><th class="ums-table__th" style="padding-right: 60px"><div class="umsLabel">Variant</div></th><th class="ums-table__th"><li class="ums-infoicons__item ums-infoicons__item--25 ums-popup__enter"><ums-icon id="icon-info" modifier="xs"></ums-icon><div class="umsLabel">Visitors</div><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Total number of (unique) visitors assigned to the variant, that have also visited it across 1 or multiple sessions.</div></li></th><th class="ums-table__th"><li class="ums-infoicons__item ums-infoicons__item--25 ums-popup__enter"><ums-icon id="icon-info" modifier="xs"></ums-icon><div class="umsLabel">Pageviews</div><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace">Total number of pageviews per variant.</div></li></th><th class="ums-table__th"><div class="umsLabel">Goal completions</div></th><th class="ums-table__th"><div class="umsLabel">Conversion rate</div></th><th ng-show="$ctrl.state.hasMainGoals" class="ums-table__th"><div class="umsLabel">Macro conversion</div></th><th class="ums-table__th"><div class="umsLabel">Status</div></th><th class="ums-table__th"></th></tr></thead><tbody ng-repeat="variant in $ctrl.variants track by $index"><tr class="ums-table__tr ums-table__tr--lg" ng-class="{ \'s-open\': variant.open, \'ums-table__tr--winner s-winner\': variant.isWinner, \'ums-table__tr--leading\': variant.isLeading, \'ums-table__tr--disabled\': variant.isDisabled, \'ums-table__tr--warning\': variant.mainGoalWarning, \'ums-table__tr--toggle\': variant.mainGoalComparisons.length &gt; 0 }" ng-click="variant.open = !variant.open"><td class="ums-table__td"><span class="ums-table__one-in-row"><strong ng-bind="$ctrl.fn.getVariantLabel($index)"></strong>&nbsp;&nbsp; <span>{{variant.name}}</span> <span class="ums-form__info__bullet" style="position: relative; margin-left: 5px;" ng-if="variant.description"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text ums-form__info__text--left" style="min-width: 200px;" ng-bind="variant.description"></span></span></span> <span class="leading-sticker" style="display: none">Leading</span><br>&nbsp;</td><td class="ums-table__td"><strong>{{variant.totalVisitorsForVariant | number}}<br><small class="umsOpacity50">{{ variant.visitorsPortion | percentage:2 }}</small>&nbsp;<br></strong></td><td class="ums-table__td" style="vertical-align: top"><strong>{{variant.totalPageviewsForVariant | number}}</strong><br></td><td class="ums-table__td"><strong>{{variant.goalCompletions | number}}</strong><br>&nbsp;</td><td class="ums-table__td"><strong ng-if="variant.conversionRate === \'NaN\'">&ndash;</strong> <strong ng-if="variant.conversionRate !== \'NaN\'" ng-bind="variant.conversionRate | percentage:2"></strong><br><strong><small ng-if="$index > 0" ng-bind="variant.conversionRateImprovementRelative | percentage:1" ng-class="{ \'umsColor-success\': variant.conversionRateImprovementRelative > 0, \'umsColor-warning\': variant.conversionRateImprovementRelative < 0 }"></small>&nbsp;</strong></td><td class="ums-table__td" ng-show="$ctrl.state.hasMainGoals"><strong><span class="umsOpacity50" ng-if="!variant.mainGoalWarning">Ok</span> <span class="umsColor-warning" ng-if="variant.mainGoalWarning">Warning!</span></strong><br>&nbsp;</td><td class="ums-table__td" ng-switch="variant.status"><span class="ums-tags ums-tags--running" ng-switch-when="0">Running</span> <span class="ums-tags ums-tags--warning" ng-switch-when="1">Warning</span> <span class="ums-tags ums-tags--disabled" ng-switch-when="2">Disabled</span> <span class="ums-tags ums-tags--reliable" ng-switch-when="3">Reliable</span> <span class="ums-tags ums-tags--stopped" ng-switch-when="4">Stopped</span> <span class="ums-tags ums-tags--waiting" ng-switch-when="5">Scheduled</span> <span class="ums-tags ums-tags--reliable" ng-switch-when="6">Completed</span> <span class="ums-tags ums-tags--stopped" ng-switch-when="7">Draft</span> <span class="ums-tags" ng-class="{\'ums-tags--leading\': variant.isWinner}" title="Variant is leading"><ums-icon id="icon-cup" modifier="sm"></ums-icon></span></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap"><span class="ums-popup__enter"><button ng-if="$index > 0 && variant.status !== 2 && variant.status !== 4 && variant.status !== 6 && variant.status !== 7" class="ums-button ums-button--table" ng-class="{\'ums-button--disabled\': variant.status === 5 || variant.status === 7}" type="button" ng-click="$ctrl.fn.toggleDisableTestVariantOverlay($event, variant)"><ums-icon id="icon-remove" modifier="sm"></ums-icon></button><div class="ums-popup__holder ums-popup__holder--auto-whitespace" ng-if="variant.status !== 5 || variant.status !== 7">Disable this variant</div><div class="ums-popup__holder ums-popup__holder--auto-whitespace" ng-if="variant.status === 5 || variant.status === 7">You cannot disable a variant at this moment. Only when a test is running a variant can be disabled.</div></span> <button type="button" class="ums-button ums-button--table ums-popup__enter" ng-show="variant.css || variant.javascript" ng-click="$ctrl.codeVariant = variant;$event.stopPropagation();"><ums-icon id="icon-code" modifier="sm"></ums-icon><div class="ums-popup__holder ums-popup__holder--auto-whitespace">Show CSS / JavaScript</div></button> <a class="ums-button ums-button--table ums-popup__enter" target="_blank" style="vertical-align: middle;" ng-click="$event.stopPropagation()" href="{{ variant.previewUrl }}" ng-if="variant.previewUrl && (variant.status === 0 || variant.status === 1 || variant.status === 3 || variant.status === 5 || variant.status === 7)"><ums-icon id="icon-fullscreen" modifier="sm"></ums-icon><div class="ums-popup__holder ums-popup__holder--auto-whitespace">Preview this variant</div></a> <button type="button" class="ums-table__toggle" ng-show="variant.mainGoalComparisons.length > 0"><ums-icon id="icon-toggle" modifier="sm"></ums-icon></button></td></tr><tr class="ums-table__tr ums-table__tr--sm" ng-show="variant.open" ng-class="{\'ums-table__tr--warning\': mainGoalComparison.isHurting}" ng-repeat="mainGoalComparison in variant.mainGoalComparisons track by mainGoalComparison.mainGoalId"><td class="ums-table__td" colspan="2"><strong ng-bind="$ctrl.state.mainGoals[mainGoalComparison.mainGoalId].name"></strong></td><td class="ums-table__td"><strong>{{mainGoalComparison.mainGoalCompletions}}x <span class="umsOpacity50">| {{mainGoalComparison.mainGoalCompletionsTotalValue | number}}</span></strong></td><td class="ums-table__td"><strong ng-bind="mainGoalComparison.mainGoalRatio | percentage"></strong></td><td class="ums-table__td" ng-attr-colspan="{{ $ctrl.state.hasMainGoals ? \'4\' : \'3\' }}"><strong><span class="umsOpacity50" ng-if="!mainGoalComparison.isHurting">Ok</span> <span class="umsColor-warning" ng-if="mainGoalComparison.isHurting">Warning!</span></strong></td></tr></tbody></table></div><ums-overlay ng-if="$ctrl.codeVariant" close="$ctrl.codeVariant = null"><ums-overlay-header><h4 class="h2 umsHeading">Code variant: {{$ctrl.codeVariant.name}}</h4></ums-overlay-header><ums-overlay-body><p>This code has been added by user <strong class="umsColorMain" ng-bind="$ctrl.test.createdByUmbracoUsername"></strong> and cannot be edited/deleted while the test is running, completed or stopped.</p><br><ums-accordion-item name="CSS" ng-if="$ctrl.codeVariant.css.length > 0"><div class="ums-overlay__code"><ums-codemirror readonly="true" mode="css" value="$ctrl.codeVariant.css"></ums-codemirror></div></ums-accordion-item><ums-accordion-item name="Javascript" ng-if="$ctrl.codeVariant.javascript.length > 0"><div class="ums-overlay__code"><ums-codemirror readonly="true" mode="javascript" value="$ctrl.codeVariant.javascript"></ums-codemirror></div></ums-accordion-item></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button ng-click="$ctrl.codeVariant = null" class="btn ums-button ums-button--light ums-button--icon" type="button">Back to variant overview</button></ums-overlay-footer></ums-overlay><ums-ab-testing-disable-test-variant ng-if="$ctrl.overlay.disableTestVariant" test="$ctrl.test" test-variant="$ctrl.state.variantToDisable" on-cancel="$ctrl.overlay.disableTestVariant = false" on-disable="$ctrl.fn.onDisableTestVariant(testVariant)"></ums-ab-testing-disable-test-variant>',bindings:{test:"<",variants:"<",onVariantChanged:"&?"},controller:["umsAbTestingHelper","umsAbTestingService","umsGoalsService",function(helper,service,goalsService){var ctrl=this;this.$onInit=function(){fn.loadMainGoals().then(function(mainGoals){state.mainGoals=mainGoals.reduce(function(map,goal){return map[goal.id]=goal,map},{}),state.hasMainGoals=mainGoals.length>0})};var fn=this.fn={getVariantLabel:function(idx){return helper.getVariantLabel(idx)},toggleDisableTestVariantOverlay:function(evt,variant){return state.variantToDisable=variant,overlay.disableTestVariant=!0,evt.stopPropagation(),!1},onDisableTestVariant:function(testVariant){service.disableVariant(testVariant.id).then(function(){overlay.disableTestVariant=!1,"function"==typeof ctrl.onVariantChanged&&ctrl.onVariantChanged()},function(error){console.error(error)})},loadMainGoals:function(){return goalsService.getMainGoals().then(function(response){return response.data})}},overlay=this.overlay={},state=this.state={mainGoals:{},hasMainGoals:!1,variantToDisable:null}}]}),angular.module("engage").component("umsAbTestingVariantEditor",{template:'<div class="u-marketing-suite"><ums-overlay dark="true" large="true" close="$ctrl.close()" ng-if="$ctrl.variant"><ums-overlay-header><h2>Edit variant</h2><p class="umsDescription" ng-if="$ctrl.variant.isBenchmark">This is your original variant which will be used for your control group. You may change the name but you can not add any custom CSS or JavaScript.</p><p class="umsDescription" ng-if="!$ctrl.variant.isBenchmark">Change the original variant using CSS and JavaScript. It is important to double check your coding as incorrect use may cause your website to malfunction.</p></ums-overlay-header><ums-overlay-body><div class="ums-form__row"><label class="ums-form__label" for="abve-variant-name">Variant name *</label><div class="ums-form__input-iconwrap ums-form__input-iconwrap--auto"><span class="ums-form__input-icon ums-form__input-icon--auto ums-form__input-icon--color-dark" ng-bind="$ctrl.fn.getVariantLabel($ctrl.index)"></span> <input id="abve-variant-name" type="text" no-dirty-check ng-model="$ctrl.variant.name" class="ums-form__input" placeholder="Name of variant.." required></div></div><div class="ums-form__row"><label class="ums-form__label" for="abve-description">Description</label> <textarea id="abve-description" no-dirty-check ng-model="$ctrl.variant.description" class="ums-form__input" maxlength="255" rows="4"></textarea></div><div class="ums-form__row"><label class="ums-form__label" for="abve-customcode">Add custom code</label><div ng-if="$ctrl.variant.isBenchmark" style="width: 100%;"><ums-accordion-item name="CSS"><div class="ums-overlay__code ums-overlay__code--unable">No changes can be made because this is the original variant.</div></ums-accordion-item><ums-accordion-item name="JavaScript"><div class="ums-overlay__code ums-overlay__code--unable">No changes can be made because this is the original variant.</div></ums-accordion-item></div><div ng-if="!$ctrl.variant.isBenchmark" style="width: 100%;"><ums-css-js-editor css="$ctrl.state.css" js="$ctrl.state.js"></ums-css-js-editor></div></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button class="btn ums-button ums-button--line ums-button--icon" type="button" ng-click="$ctrl.close()"><span>Cancel</span></button> <button class="btn ums-button ums-button--link-error ums-button--icon" type="button" ng-if="!$ctrl.variant.isBenchmark && $ctrl.removeVariant != null" ng-click="$ctrl.removeVariant(); $ctrl.close();"><span>Remove variant</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button></span> <span><button class="btn ums-button ums-button--main ums-button--icon" type="button" ng-if="$ctrl.previewVariant" ng-click="$ctrl.fn.saveAndPreview($ctrl.variant)"><span>Save & preview</span><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--success ums-button--icon" type="button" ng-click="$ctrl.fn.saveAndClose()"><span>Save and close</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay></div>',bindings:{index:"<",variant:"=",close:"&?",save:"&?",removeVariant:"&?",previewVariant:"&?"},controller:["umsAbTestingHelper","$q",umsAbTestingVariantEditorController]}),angular.module("engage").component("umsAnalyticsBots",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Bots</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'bots\'" drilldown="$ctrl.chartFilter"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><div ng-show="$ctrl.botId == null && $ctrl.botVersionId == null"><ums-prefab-table alias="\'bots\'" on-click="$ctrl.onClickBot(row)" hide-columns="[0]" can-click="true"></ums-prefab-table></div><div ng-if="$ctrl.botId != null && $ctrl.botVersionId == null"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.clearBotId()" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All bots</span></button><ums-prefab-table title="$ctrl.botName" alias="\'botversion\'" drilldown="\'botId==\\\'\' + $ctrl.botId + \'\\\'\'" on-click="$ctrl.onClickBotVersion(row)" hide-columns="[0]" can-click="true"></ums-prefab-table></div><div ng-if="$ctrl.botVersionId != null"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.clearBotVersionId()" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span ng-bind="$ctrl.botName"></span></button><ums-prefab-table title="$ctrl.botVersionName" alias="\'bot\'" drilldown="\'botVersionId==\\\'\' + $ctrl.botVersionId + \'\\\'\'" hide-columns="[0]"></ums-prefab-table></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:[umsAnalyticsBotsController]}),angular.module("engage").component("umsAnalyticsBrowsers",{template:'<div class="umsPaddingTop umsPaddingBottom" ng-if="$ctrl.isReportingEnabled != null"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Browsers</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="$ctrl.chartAlias()" drilldown="$ctrl.browserId != null && \'browserId==\\\'\' + $ctrl.browserId + \'\\\'\'"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table ng-if="$ctrl.browserId == null" alias="$ctrl.tableAlias()" hide-columns="[0]" on-click="$ctrl.browserId = row.dimensions[0];$ctrl.browserName = row.dimensions[1]" can-click="true"></ums-prefab-table><div ng-if="$ctrl.browserId != null"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.browserId = null" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All browsers</span></button><ums-prefab-table alias="$ctrl.tableAlias()" title="$ctrl.browserName" drilldown="\'browserId==\\\'\' + $ctrl.browserId + \'\\\'\'"></ums-prefab-table></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService",umsAnalyticsBrowsersController]}),angular.module("engage").component("umsAnalyticsCampaigns",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Campaigns</h2><div class="ums-headerbar__options-wrapper"><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="$ctrl.chartAlias()"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table ng-if="$ctrl.selectedCampaign == null" alias="$ctrl.tableAlias()" on-click="$ctrl.selectedCampaign = row.dimensions[0];" can-click="true"></ums-prefab-table><div ng-if="$ctrl.selectedCampaign"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.selectedCampaign = null" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All campaigns</span></button><ums-prefab-table alias="$ctrl.tableAlias()" title="$ctrl.selectedCampaign" drilldown="\'campaign==\\\'\' + $ctrl.selectedCampaign + \'\\\'\'"></ums-prefab-table></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService",umsAnalyticsCampaignController]}),angular.module("engage").component("umsAnalyticsDeviceTypes",{template:'<div class="umsPaddingTop umsPaddingBottom" ng-if="$ctrl.isReportingEnabled != null"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Devices</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="$ctrl.prefabAlias()"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table alias="$ctrl.prefabAlias()"></ums-prefab-table></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService",umsAnalyticsDeviceTypesController]}),angular.module("engage").component("umsAnalyticsEvents",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Events</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'events\'" drilldown="$ctrl.drilldown"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table ng-if="$ctrl.category == null" alias="\'events\'" on-click="$ctrl.category = row.dimensions[0]" can-click="true"></ums-prefab-table><div ng-if="$ctrl.category != null && $ctrl.action == null"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.category = null" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All categories</span></button><ums-prefab-table alias="\'eventcategory\'" title="$ctrl.category" on-click="$ctrl.action = row.dimensions[0]" can-click="true" drilldown="\'eventCategory==\\\'\' + $ctrl.category + \'\\\'\'"></ums-prefab-table></div><div ng-if="$ctrl.category != null && $ctrl.action != null"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.action = null" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All actions</span></button><ums-prefab-table alias="\'eventaction\'" title="$ctrl.category + \' > \' + $ctrl.action" drilldown="\'eventCategory==\\\'\' + $ctrl.category + \'\\\';eventAction==\\\'\' + $ctrl.action + \'\\\'\'"></ums-prefab-table></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:[umsAnalyticsEventsController]}),angular.module("engage").component("umsAnalyticsGoals",{template:'<div class="umsPaddingTop umsPaddingBottom"><div ng-show="!$ctrl.isLoading && $ctrl.goalCount === 0"><div class="ums-content ums-datepicker__container umsPaddingTop"><h2 class="umsHeading">Goals</h2></div><div class="ums-content is-animated"><div class="ums-fakegraph__container"><span class="ums-fakegraph__line"></span> <span class="ums-fakegraph__line"></span> <span class="ums-fakegraph__line"></span><div class="ums-fakegraph__number-holder"><span class="ums-fakegraph__number-item">1</span> <span class="ums-fakegraph__number-item">2</span> <span class="ums-fakegraph__number-item">3</span> <span class="ums-fakegraph__number-item">4</span> <span class="ums-fakegraph__number-item">5</span> <span class="ums-fakegraph__number-item">6</span> <span class="ums-fakegraph__number-item">7</span></div></div><div class="ums-fakegraph__content"><img class="ums-fakegraph__image" src="/App_Plugins/Umbraco.Engage/assets/ums-empty-left.png" alt><div class="ums-fakegraph__message"><h2>There are no goals yet</h2><a href="#/engage/settings/goals" class="ums-button ums-button--success ums-button--icon"><span>Create new goal</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></a></div><img class="ums-fakegraph__image" src="/App_Plugins/Umbraco.Engage/assets/ums-empty-right.png" alt></div></div></div><div ng-show="!$ctrl.isLoading && $ctrl.goalCount > 0"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Goals</h2><div class="ums-headerbar__options-wrapper"><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'goals\'" drilldown="$ctrl.goalId != null && \'goalId==\\\'\' + $ctrl.goalId + \'\\\'\'"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><button ng-if="$ctrl.goalId" type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.goalId = null" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All goals</span></button><ums-prefab-table alias="\'goals\'" hide-columns="[0]" on-click="$ctrl.goalId == null ? $ctrl.goalId = row.dimensions[0] : null" can-click="!$ctrl.goalId" drilldown="$ctrl.goalId != null && \'goalId==\\\'\' + $ctrl.goalId + \'\\\'\'"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div></div>',controller:["umsGoalsService",function umsAnalyticsGoalsController(goalsService){var $ctrl=this;$ctrl.isLoading=!0,$ctrl.goalCount=null,$ctrl.goalId=null,this.$onInit=function(){goalsService.getAll().then(function(response){$ctrl.goalCount=response.data.length}).finally(function(){$ctrl.isLoading=!1})}}]}),angular.module("engage").service("umsHeatmapService",["$http",function($http){var BASE_URL="/umbraco/backoffice/engage/heatmap/";this.getScrollHeatmap=function(settings){return $http.post(BASE_URL+"GenerateScrollHeatmap",settings).then(function(response){for(var data=response.data,vppp=data.visitorPercentagesPerPixel,vpp=[],px=0,i=0;i<vppp.length;i++)for(var ppp=vppp[i],j=0;j<ppp.pixelCount;px++,j++)vpp[px]=ppp.visitorPercentage;return data.visitorPercentagesPerPixel=vpp,data})},this.getVariants=function(contentId,culture){return $http.get(BASE_URL+"GetVariants?contentId="+contentId+"&culture="+culture).then(function(response){return response.data||[]})}}]),angular.module("engage").component("umsHeatmap",{template:'<div class="umsPaddingTop"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Heatmap</h2><div class="ums-headerbar__options-wrapper"><div class="ums-filter__item" style="margin-right: 10px; top: -9px; position: relative;"><div class="ums-form__label ums-filter__label ums-form__label--light">Device type</div><div class="ums-form__switch ums-form__switch--autosize"><input type="radio" name="subFilter" id="referral-scoring-filter-0" ng-model="$ctrl.state.filters.deviceType" ng-change="$ctrl.reloadHeatmap()" ng-value="1" class="ums-form__switch__input" required> <label for="referral-scoring-filter-0" class="ums-form__switch__label ums-form__switch__label--lg ums-form__switch__label--thin"><div style="display: flex; align-items: center; justify-content: center;"><span>Desktop</span></div></label> <input type="radio" name="subFilter" id="referral-scoring-filter-1" ng-model="$ctrl.state.filters.deviceType" ng-change="$ctrl.reloadHeatmap()" ng-value="2" class="ums-form__switch__input" required> <label for="referral-scoring-filter-1" class="ums-form__switch__label ums-form__switch__label--lg ums-form__switch__label--thin"><div style="display: flex; align-items: center; justify-content: center;"><span>Tablet</span></div></label> <input type="radio" name="subFilter" id="referral-scoring-filter-2" ng-model="$ctrl.state.filters.deviceType" ng-change="$ctrl.reloadHeatmap()" ng-value="3" class="ums-form__switch__input" required> <label for="referral-scoring-filter-2" class="ums-form__switch__label ums-form__switch__label--lg ums-form__switch__label--thin"><div style="display: flex; align-items: center; justify-content: center;"><span>Mobile</span></div></label></div></div><div class="ums-filter__item" style="margin-right: 10px; top: -9px; position: relative;"><div for="input-filter--01" class="ums-form__label ums-filter__label ums-form__label--light">Page variant</div><select class="ums-form__select" name="input-filter--07" ng-model="$ctrl.state.queryString" ng-change="$ctrl.reloadIframe()" ng-options="entry.queryString as entry.name for entry in $ctrl.state.variants" style="min-width: 200px;"></select></div><div class="ums-filter__item"><ums-daterangepicker></ums-daterangepicker></div></div></div></div><div class="ums-content"><ums-loader ng-if="$ctrl.state.loaded === false"></ums-loader><div ng-show="$ctrl.state.loaded"><div class="ums-flexgrid__container ums-flexgrid__container--lg" ng-if="$ctrl.state.heatmapType === \'scroll\'"><div class="ums-flexgrid__item ums-flexgrid__item--1-1 umsPaddingBottom"><span ng-show="$ctrl.state.url == null" style="color:#cc0000;font-weight:bold;">This page has no valid URL. The heatmap cannot be rendered.</span><div class="iframe-holder" ng-show="$ctrl.state.url != null"><span ng-show="!$ctrl.hasData" style="min-height: 500px;display: flex;align-items: center;justify-content: center;">There is no heatmap data available for the current settings. Please make sure you\'ve&nbsp;<a href="https://docs.umbraco.com/umbraco-engage/developers/analytics/client-side-events-and-additional-javascript-files/additional-measurements-with-the-analytics-scripts" style="text-decoration:underline;color:#3444b2" target="_blank">setup the clientside Analytics script of Umbraco Engage</a>.</span><div class="iframe-box" ng-show="$ctrl.hasData"><div class="scrollmap"></div><div class="scrollmap blend"></div><div class="ums-hmap__lines"><div class="ums-hmap__line ums-hmap__line--avg-fold" ng-style="{\'--top-pos\': $ctrl.getAverageFold() + \'px\'}"><span class="ums-hmap__line-header">Average fold</span></div><div class="ums-hmap__line" style="--top-pos: var(--n75)"><span class="ums-hmap__line-header">75%</span></div><div class="ums-hmap__line" style="--top-pos: var(--n50)"><span class="ums-hmap__line-header">50%</span></div><div class="ums-hmap__line" style="--top-pos: var(--n25)"><span class="ums-hmap__line-header">25%</span></div></div><div class="indicator"><div class="indicator-box" style="display: none;"></div></div></div><div class="ums-hmap__legend" ng-show="$ctrl.hasData"><span class="ums-hmap__legend-text">Hot</span><div class="ums-hmap__legend-gradient"></div><span class="ums-hmap__legend-text">Cold</span></div></div></div></div></div></div>',controller:["umsUtilService","umsHeatmapService","$element","umsDaterangepickerService",function umsHeatmapAppController(utils,service,$element,daterangePickerService){var $ctrl=this,destroyFns=[],unloadHeatmapFns=[],state=$ctrl.state={loaded:null,heatmapType:"scroll",url:null,queryString:"",hasData:!1,variants:[],iframe:null,filters:{nodeId:null,culture:null,segment:null,deviceType:1,borderLines:[.8,.75,.6,.5,.4,.25,.2],from:null,to:null}};this.$onInit=function(){state.loaded=!1,state.filters.nodeId=utils.getCurrentContentId(),state.filters.culture=utils.getCurrentCulture(),state.url=utils.getCurrentUrl(),this.initDateRange(),this.initVariants().then(function(){this.loadHeatmap().then(function(){state.loaded=!0})}.bind(this))},this.initDateRange=function(){var range=daterangePickerService.getRange();this.setDateRange(range),destroyFns.push(daterangePickerService.onChange(function(_,range){this.setDateRange(range),this.reloadHeatmap()}.bind(this)))},this.initVariants=function(){return service.getVariants(state.filters.nodeId,state.filters.culture).then(function(variants){state.variants=variants,state.variants.length>0&&(state.queryString=state.variants[0].queryString)})},this.setDateRange=function(range){state.filters.from=range.primary.from,state.filters.to=range.primary.to},this.$onDestroy=function(){destroyFns.forEach(function(fn){fn()})},this.loadHeatmap=function(){switch(state.heatmapType){case"scroll":return this.loadScrollHeatmap();case"click":return this.loadClickHeatmap();default:throw new Error('Unknown heatmap type: "'+state.heatmapType+'"')}},this.reloadHeatmap=function(){this.unloadHeatmap(),this.loadHeatmap()},this.unloadHeatmap=function(){unloadHeatmapFns.forEach(function(fn){fn()}),unloadHeatmapFns.length=0},this.loadScrollHeatmap=function(){return service.getScrollHeatmap($ctrl.state.filters).then(function(heatmap){return $ctrl.hasData=heatmap.visitorPercentagesPerPixel.length>0,$ctrl.hasData&&$ctrl.renderScrollHeatmap(heatmap),heatmap})},this.loadClickHeatmap=function(){},this.setDeviceType=function(deviceType){state.filters.deviceType=deviceType,$ctrl.reloadHeatmap()},this.handleDeviceTypeChange=function(){$ctrl.reloadHeatmap()},this.reloadIframe=function(){if(null!=state.iframe){var url=$ctrl.getUrl();url!==state.iframe.src&&(state.iframe.src=url)}},this.getUrl=function(){return null==state.url?null:null!=state.queryString&&state.queryString.length>0?state.url+state.queryString:state.url},this.getPageWidth=function(){switch(state.filters.deviceType){case 1:return 1280;case 2:return 1024;case 3:return 640}},this.getAverageFold=function(){switch(state.filters.deviceType){case 1:return 1080;case 2:return 1024;case 3:return 896}},this.renderScrollHeatmap=function(scrollHeatmap){var url=$ctrl.getUrl();if(null!=url&&0!==url.length){var iframe=document.createElement("iframe");iframe.sandbox="allow-scripts allow-same-origin";var iframeBox=$element[0].querySelector(".iframe-box"),pageHeight=scrollHeatmap.visitorPercentagesPerPixel.length,pageWidth=$ctrl.getPageWidth();iframeBox.style.setProperty("--height",pageHeight+"px"),iframeBox.style.setProperty("--width",pageWidth+"px");var n80=getBorderPixels(.8);null!=n80&&setScrollmapProps("--n80",getBorderCssProp(n80));var n75=getBorderPixels(.75);null!=n75&&setScrollmapProps("--n75",getBorderCssProp(n75));var n60=getBorderPixels(.6);null!=n60&&setScrollmapProps("--n60",getBorderCssProp(n60));var n50=getBorderPixels(.5);null!=n50&&setScrollmapProps("--n50",getBorderCssProp(n50));var n40=getBorderPixels(.4);null!=n40&&setScrollmapProps("--n40",getBorderCssProp(n40));var n25=getBorderPixels(.25);null!=n25&&setScrollmapProps("--n25",getBorderCssProp(n25));var n20=getBorderPixels(.2);null!=n20&&setScrollmapProps("--n20",getBorderCssProp(n20)),iframeBox.appendChild(iframe),iframe.src=url,state.iframe=iframe;var indicatorBox=$element[0].querySelector(".indicator-box"),throttledMouseMove=_.throttle(function positionScroller(e){var rect=e.target.getBoundingClientRect(),y=parseInt(e.clientY-rect.top);iframeBox.style.setProperty("--mouse-y",y+"px");var percentage=scrollHeatmap.visitorPercentagesPerPixel[y]||0;indicatorBox.innerText=(100*percentage).toFixed(1)+"% of users reached this point",indicatorBox.style.display="block"},10);iframeBox.addEventListener("mousemove",throttledMouseMove),unloadHeatmapFns.push(function(){iframeBox.removeEventListener("mousemove",throttledMouseMove),iframeBox.removeChild(iframe),indicatorBox.style.display="none",state.iframe=null})}function getBorderPixels(percentage){var borderLine=_.find(scrollHeatmap.borderLines,function(line){return line.seenByVisitorPercentage==percentage});return null==borderLine?pageHeight:borderLine.pixels}function getBorderCssProp(pixels){return(pixels/pageHeight*100).toFixed(2)+"%"}function setScrollmapProps(key,value){iframeBox.style.setProperty(key,value)}}}]}),angular.module("engage").component("umsAnalyticsLocations",{template:'<div class="umsPaddingTop umsPaddingBottom" ng-if="$ctrl.isReportingEnabled != null"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Locations</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="$ctrl.chartAlias()" drilldown="$ctrl.countryDrilldown"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><div ng-if="$ctrl.countryDrilldown" style="margin-bottom: 10px;"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.countryDrilldown = null"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All countries</span></button></div><div class="umb-alert umb-alert--warning" ng-if="!$ctrl.hasData">Unable to generate localization report: Could not load localization data. For complete integration, please refer to:<br><a target="_blank" href="https://docs.umbraco.com/umbraco-engage/developers/analytics/location">https://docs.umbraco.com/umbraco-engage/developers/analytics/location</a></div><ums-prefab-table alias="$ctrl.tableAlias()" ng-if="!$ctrl.countryDrilldown" ng-hide="!$ctrl.hasData" has-data="$ctrl.hasData" can-click="true" on-click="$ctrl.onClickRow(row)"></ums-prefab-table><ums-prefab-table alias="$ctrl.tableAlias()" ng-if="$ctrl.countryDrilldown" can-click="false" drilldown="$ctrl.countryDrilldown"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService",umsAnalyticsLocationsController]}),angular.module("engage").component("umsAnalyticsPageviews",{template:'<div class="umsPaddingTop umsPaddingBottom" ng-if="$ctrl.isReportingEnabled != null"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Pageviews</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="$ctrl.chartAlias()" drilldown="$ctrl.pageviewDrilldown"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0"><div ng-if="$ctrl.pageviewDrilldown" style="margin-bottom: 10px"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.resetPageviewDrilldown()"><ums-icon id="icon-arrow" modifier="btn" style="transform: scaleX(-1)"></ums-icon><span>All pageviews</span></button></div><ums-prefab-table ng-if="!$ctrl.pageviewDrilldown" alias="$ctrl.tableAlias()" on-click="$ctrl.pageviewOnClick(row)" can-click="true"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService","$scope",umsAnalyticsPageviewsController]}),angular.module("engage").component("umsAnalyticsReferrals",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Referrals</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'referrals\'" drilldown="$ctrl.domain != null && \'referralHostname==\\\'\' + $ctrl.domain + \'\\\'\'"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table ng-if="$ctrl.domain == null" alias="\'referraldomains\'" on-click="$ctrl.domain = row.dimensions[0]" can-click="true"></ums-prefab-table><div ng-if="$ctrl.domain"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.domain = null" style="margin-bottom: 10px;"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All referrers</span></button><ums-prefab-table alias="\'referralpathsandqueries\'" title="$ctrl.domain" drilldown="\'referralHostname==\\\'\' + $ctrl.domain + \'\\\'\'"></ums-prefab-table></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:[umsAnalyticsReferralsController]}),angular.module("engage").component("umsAnalyticsSearchTerms",{template:'<div class="umsPaddingTop umsPaddingBottom" ng-if="$ctrl.isReportingEnabled != null"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Search terms</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="$ctrl.chartAlias()"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table alias="$ctrl.tableAlias()"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService",umsAnalyticsSearchTermsController]}),angular.module("engage").component("umsAnalyticsSessions",{template:'<div class="umsPaddingTop umsPaddingBottom" ng-if="$ctrl.isReportingEnabled != null"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Sessions</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><h1>{{ $ctrl.metric }}</h1><ums-prefab-chart alias="$ctrl.prefabAlias()"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0"><ums-prefab-table alias="$ctrl.prefabAlias()"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService",umsAnalyticsSessionsController]}),angular.module("engage").component("umsAnalyticsSettings",{template:'<div ng-if="$ctrl.fn.isVisible()" style="margin-right: 15px;" class="ums-group-by-controls ums-filter-by-controls"><label class="ums-form__checkbox__label" for="include-sescendants"><input class="ums-form__checkbox__input" id="include-sescendants" type="checkbox" ng-model="$ctrl.state.descendantsVisible" ng-change="$ctrl.fn.toggleIncludeNodeDescendants()">Include data of subpages</label></div>',controller:function(umsAnalyticsSettingsService,umsUtilService,umsEventEmitter){var ctrl=this;ctrl.state={descendantsVisible:!1,get includeNodeDescendants(){return umsAnalyticsSettingsService.includeNodeDescendants}},ctrl.fn={toggleIncludeNodeDescendants:function(){ctrl.state.descendantsVisible?umsAnalyticsSettingsService.includeNodeDescendants=!0:umsAnalyticsSettingsService.includeNodeDescendants=!1,umsEventEmitter.emit("changed.analytics.settings.includeNodeDescendants",{includeNodeDescendants:umsAnalyticsSettingsService.includeNodeDescendants})},isVisible:function(){return!!umsUtilService.getCurrentContentId()}},this.$onInit=function(){ctrl.state.descendantsVisible=umsAnalyticsSettingsService.includeNodeDescendants}}}),angular.module("engage").service("umsAnalyticsSettingsService",["umsLocalStorageService","umsUtilService",umsAnalyticsSettingsService]),angular.module("engage").component("umsAnalyticsTimeOnPage",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Time on page</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'timeonpage\'"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table alias="\'timeonpage\'" hide-columns="[0]"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"}}),angular.module("engage").component("umsAnalyticsUmbracoForms",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Umbraco Forms</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'umbracoformssubmissions\'" drilldown="$ctrl.state.form != null && \'umbracoFormsId==\\\'\' + $ctrl.state.form + \'\\\'\'"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><div ng-if="$ctrl.umbracoFormsDrilldown" style="margin-bottom: 10px;"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.onClickUp()"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All {{ $ctrl.state.field ? "Fields" : "Forms" }}</span></button></div><ums-prefab-table ng-if="!$ctrl.umbracoFormsDrilldown" alias="\'umbracoforms\'" hide-columns="[0]" on-click="$ctrl.onClickUmbracoFormsForm(row)" can-click="true"></ums-prefab-table><ums-prefab-table ng-if="$ctrl.umbracoFormsDrilldown && $ctrl.state.form && !$ctrl.state.field" alias="\'umbracoformsform\'" hide-columns="[0]" on-click="$ctrl.onClickUmbracoFormsFormField(row)" drilldown="$ctrl.umbracoFormsDrilldown" can-click="true"></ums-prefab-table><ums-prefab-table ng-if="$ctrl.umbracoFormsDrilldown && $ctrl.state.form && $ctrl.state.field" alias="\'umbracoformsformfield\'" drilldown="$ctrl.umbracoFormsDrilldown"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:[umsAnalyticsUmbracoFormsController]}),angular.module("engage").component("umsAnalyticsVideo",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">Videos</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'videos\'" drilldown="$ctrl.videoDrilldown"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><div ng-if="$ctrl.videoDrilldown" style="margin-bottom: 10px;"><button type="button" class="btn ums-button ums-button--icon ums-button--light" ng-click="$ctrl.videoDrilldown = null"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>All videos</span></button></div><ums-prefab-table ng-if="!$ctrl.videoDrilldown" alias="\'videos\'" on-click="$ctrl.onClickVideo(row)" can-click="true"></ums-prefab-table><ums-prefab-table ng-if="$ctrl.videoDrilldown" alias="\'videoEvents\'" hide-columns="[0]" title="$ctrl.name" drilldown="$ctrl.videoDrilldown"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:[umsAnalyticsVideoController]}),angular.module("engage").component("umsAnalyticsVisitors",{template:'<div class="umsPaddingTop umsPaddingBottom" ng-if="$ctrl.isReportingEnabled != null"><div class="ums-content ums-datepicker__container umsPaddingTop ums-headerbar__bar"><h2 class="umsHeading ums-headerbar__title">New and returning visitors</h2><div class="ums-headerbar__options-wrapper"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="$ctrl.prefabAlias()"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0"><ums-prefab-table alias="$ctrl.prefabAlias()"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',bindings:{contentId:"<?",culture:"<?"},controller:["umsUtilService","umsAnalyticsSettingsService","umsConfigurationService",umsAnalyticsVisitorsController]}),angular.module("engage").component("umsDivider",{bindings:{title:"@?",icon:"@?",iconSize:"@?"},template:'<div class="ums-divider__container"><div class="ums-divider__title"><ums-icon ng-if="$ctrl.icon" id="{{$ctrl.icon}}" modifier="{{$ctrl.iconSize}}"></ums-icon><span ng-bind="$ctrl.title"></span></div><div class="ums-divider__line"></div></div>',controller:[umsDividerController]}),angular.module("engage").component("umsPortal",{bindings:{to:"@",prepend:"<?"},transclude:!0,template:"<ng-transclude></ng-transclude>",controller:["$element",umsPortalController]}),angular.module("engage").component("umsSectionTopbar",{bindings:{title:"@?",icon:"@?"},template:'<div class="ums-topbar__container"><div class="ums-content ums-topbar__content"><div class="ums-topbar__icon" ng-if="$ctrl.icon"><ums-icon id="{{$ctrl.icon}}" modifier="lg"></ums-icon></div><div class="ums-topbar__title" ng-bind="$ctrl.title"></div><ums-package-status></ums-package-status><ng-transclude class="ums-topbar__options"></ng-transclude></div></div>',transclude:!0}),angular.module("engage").component("umsCjEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2 ng-if="$ctrl.state.isNew">Create new journey step</h2><h2 ng-if="!$ctrl.state.isNew">Edit journey step "{{$ctrl.state.journey.title}}" <span class="umsColor-light">#{{$ctrl.state.journey.id}}</span></h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-journey-step-editor-form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" name="$ctrl.form" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row"><label for="form0123" class="ums-form__label">Title/name *</label> <input id="form0123" class="ums-form__input" type="text" required ng-model="$ctrl.state.journey.title"></div><div class="ums-form__row"><label for="form0234" class="ums-form__label">Description *</label> <textarea id="form0234" class="ums-form__input" rows="3" required ng-model="$ctrl.state.journey.description"></textarea></div><br><br><div class="ums-form__row"><div class="ums-form__subrow"><label for="form0234" class="ums-form__label">Select a color *</label><div class="ums-colorswatch__wrapper"><ums-render-property key="\'19aedd1b-3e4b-4e1d-b3dc-c34d6ab90753\'" ng-model="$ctrl.state.journey.color" name="journeycolor" ums-not-null></ums-render-property><span class="ums-errorText" ng-show="$ctrl.form.$submitted && $ctrl.form.journeycolor.$invalid">Please select a color</span></div></div><div class="ums-form__subrow"><label for="form0234" class="ums-form__label">Select an image</label><ums-render-property key="\'29aedd2b-4e4c-4e1d-b3dc-d34d6ab90754\'" ng-model="$ctrl.state.journey.iconPicker" name="journeyicon"></ums-render-property><span class="ums-errorText" ng-show="$ctrl.form.$submitted && $ctrl.form.journeyicon.$invalid">Please select an image</span></div></div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button> <button ng-click="$ctrl.remove()" ng-if="!$ctrl.state.isNew" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error" type="button"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-journey-step-editor-form" ng-click="$ctrl.state.formWasSaved = true" type="submit"><span ng-if="$ctrl.state.isNew">Add journey step</span> <span ng-if="!$ctrl.state.isNew">Update journey step</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{journey:"=",close:"&",remove:"&",onSave:"&?"},controller:["umsCustomerJourneyApi","umsUtilService","mediaResource",umsAnalyticsCustomerJourneyEditorController]}),angular.module("engage").component("umsCjGroupEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2 ng-if="$ctrl.state.isNew">Create journey</h2><h2 ng-if="!$ctrl.state.isNew">Edit journey "{{$ctrl.state.journeyGroup.title}}"</h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-journey-group-editor-form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" name="$ctrl.form"><div class="ums-form__row"><label for="form0123" class="ums-form__label">Title *</label> <input id="form0123" class="ums-form__input" type="text" required ng-model="$ctrl.state.journeyGroup.title"></div><div class="ums-form__row"><label for="form0234" class="ums-form__label">Description *</label> <textarea id="form0234" class="ums-form__input" rows="8" required ng-model="$ctrl.state.journeyGroup.description"></textarea></div><div class="ums-form__row"><ums-accordion-item name="Advanced settings" style="width: 100%"><div class="ums-form__row"><label for="form0323" class="ums-form__label">Threshold value: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">This treshold value needs to be reached before a customer journey can become active.</span></span></label> <input id="form0323" class="ums-form__input" type="number" min="0" placeholder="25" ng-model="$ctrl.state.journeyGroup.minimumParticipationScoreThreshold"></div><div class="ums-form__row"><label for="form0423" class="ums-form__label">Minimal deviation: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">This settings specifies the minimal deviation between the customer journey with the highest score and the second highest score. This can be specified in an absolute value or in a percentage.</span></span></label><div class="ums-form__switch"><input type="radio" name="MinimumDeviationType-1" id="MinimumDeviationType-2-2" ng-model="$ctrl.state.journeyGroup.minimumDeviationType" ng-value="0" class="ums-form__switch__input" checked> <label for="MinimumDeviationType-2-2" class="ums-form__switch__label">Absolute value</label> <input type="radio" name="MinimumDeviationType-1" id="MinimumDeviationType-2-1" ng-model="$ctrl.state.journeyGroup.minimumDeviationType" ng-value="1" class="ums-form__switch__input"> <label for="MinimumDeviationType-2-1" class="ums-form__switch__label">Percentage</label></div></div><div class="ums-form__row" ng-if="$ctrl.state.journeyGroup.minimumDeviationType === 0"><label for="form0423" class="ums-form__label">Minimal deviation value: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">The absolute value that specifies the minimum difference between the highest score and the second highest score before a customer journey becomes active.</span></span></label> <input id="form0423" class="ums-form__input" type="number" min="0" ng-model="$ctrl.state.journeyGroup.minimumDeviation"></div><div class="ums-form__row" ng-if="$ctrl.state.journeyGroup.minimumDeviationType === 1"><label for="form0823" class="ums-form__label">Minimal deviation percentage: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">The percentage that specifies the minimum difference between the highest score and the second highest score before a customer journey becomes active.</span></span></label> <input id="form0823" class="ums-form__input" type="number" min="0" max="100" ng-model="$ctrl.state.journeyGroup.minimumDeviation"></div><div class="ums-form__row"><label for="form0523" class="ums-form__label">Expiration type: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify whether the implicit customer journey scoring expires. This can be set to \'never\' when it does not expire, or can be set to a number of days or a number of sessions.</span></span></label><div class="ums-form__switch"><input type="radio" name="ExpirationType-1" id="ExpirationType-2-2" ng-model="$ctrl.state.journeyGroup.expirationType" ng-value="null" class="ums-form__switch__input" checked> <label for="ExpirationType-2-2" class="ums-form__switch__label">Never</label> <input type="radio" name="ExpirationType-1" id="ExpirationType-2-1" ng-model="$ctrl.state.journeyGroup.expirationType" ng-value="0" class="ums-form__switch__input"> <label for="ExpirationType-2-1" class="ums-form__switch__label">Days</label> <input type="radio" name="ExpirationType-1" id="ExpirationType-3-1" ng-model="$ctrl.state.journeyGroup.expirationType" ng-value="1" class="ums-form__switch__input"> <label for="ExpirationType-3-1" class="ums-form__switch__label">Sessions</label></div></div><div class="ums-form__row" ng-if="$ctrl.state.journeyGroup.expirationType !== null"><label for="form0523" class="ums-form__label" ng-if="$ctrl.state.journeyGroup.expirationType === 0">Expire after x days: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify the number of days that need to be included for the customer journey scoring.</span></span></label> <label for="form0523" class="ums-form__label" ng-if="$ctrl.state.journeyGroup.expirationType === 1">Expire after x sessions: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify the number of sessions that need to be included for the customer journey scoring.</span></span></label> <input id="form0523" class="ums-form__input" type="number" min="0" ng-model="$ctrl.state.journeyGroup.expiration"></div><div class="ums-form__row"><label for="form0623" class="ums-form__label">Maximum points to score: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify the maximum number of points that can be scored per customer journey per item.</span></span></label> <input id="form0623" class="ums-form__input" type="number" min="0" placeholder="10" ng-model="$ctrl.state.journeyGroup.upperScoreLimit"></div></ums-accordion-item></div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button><div class="ums-popup__enter ums-button__placeholder"><button ng-click="$ctrl.remove()" ng-if="!$ctrl.state.isNew" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error ums-popup__enter" type="button"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button><div class="ums-popup__holder" ng-if="$ctrl.state.journeyGroup.steps.length > 0">Deleting this group will also delete {{$ctrl.state.journeyGroup.steps.length}} connected step{{$ctrl.state.journeyGroup.steps.length !== 1 ? \'s\': \'\'}}.</div></div></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-journey-group-editor-form" ng-click="$ctrl.state.formWasSaved = true" type="submit"><span ng-if="$ctrl.state.isNew">Create journey</span> <span ng-if="!$ctrl.state.isNew">Update journey</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{journeyGroup:"=",close:"&",remove:"&",onSave:"&?"},controller:["umsCustomerJourneyApi","umsUtilService",umsAnalyticsCustomerJourneyGroupEditorController]});var umsAnalyticsCustomerJourneyComponent={template:'<div class="ums-content"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--sidebar-left ums-flexgrid__item--1-4 umsPaddingTop umsPaddingBottom"><div class="umsPaddingTop"><div class="ums-pagemenu__title"><ums-icon id="icon-journey" modifier="md"></ums-icon><strong>Journeys</strong></div><ul class="ums-pagemenu__list"><li class="ums-pagemenu__item" ng-if="$ctrl.state.isLoading"><span>Loading journeys...</span></li><li class="ums-pagemenu__item is-animated" ng-if="!$ctrl.state.isLoading" ng-repeat="journeyGroup in $ctrl.state.journeys" ng-click="$ctrl.state.selectedJourneyGroup = journeyGroup"><strong class="h4" ng-bind="journeyGroup.title"></strong><div class="ums-pagemenu__description"><span ng-if="journeyGroup.steps && journeyGroup.steps.length !== 1">{{journeyGroup.steps.length}} steps</span> <span ng-if="journeyGroup.steps && journeyGroup.steps.length === 1">{{journeyGroup.steps.length}} step</span> <span ng-bind="journeyGroup.description" style="white-space: pre-line;"></span></div><ums-icon id="icon-arrow" modifier="xs"></ums-icon></li></ul><br><button type="button" ng-if="!$ctrl.state.isLoading" class="btn ums-button ums-button--icon ums-button--main is-animated" ng-click="$ctrl.fn.addJourneyGroup()"><span>Add new journey</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated umsPaddingTop umsPaddingBottom" ng-if="!$ctrl.state.isLoading && $ctrl.state.selectedJourneyGroup"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-3"><h2 class="h2" ng-bind="$ctrl.state.selectedJourneyGroup.title"></h2><ul class="ums-infoicons__list"><li class="ums-infoicons__item ums-popup__enter" ng-if="$ctrl.state.selectedJourneyGroup.createdByUmbracoUsername && !$ctrl.state.selectedJourneyGroup.updatedByUmbracoUsername"><div class="ums-popup__enter"><ums-icon id="icon-status-draft" modifier="sm"></ums-icon><div class="ums-popup__holder">Created by: {{$ctrl.state.selectedJourneyGroup.createdByUmbracoUsername}}</div></div><span ng-bind="$ctrl.state.selectedJourneyGroup.createdByUmbracoUsername"></span></li><li class="ums-infoicons__item ums-popup__enter" ng-if="$ctrl.state.selectedJourneyGroup.updatedByUmbracoUsername"><div class="ums-popup__enter"><ums-icon id="icon-status-draft" modifier="sm"></ums-icon><div class="ums-popup__holder">Updated by: {{$ctrl.state.selectedJourneyGroup.updatedByUmbracoUsername}}</div></div><span ng-bind="$ctrl.state.selectedJourneyGroup.updatedByUmbracoUsername"></span></li></ul><br><div class="umsDescription" ng-bind="$ctrl.state.selectedJourneyGroup.description" style="white-space: pre-line;"></div><div class="ums-groupbox__container ums-groupbox__container--empty ums-groupbox__container--pending" ng-if="$ctrl.state.selectedJourneyGroup.isModified">Pending changes, don\'t forget to save your work</div><div class="ums-button__wrapper ums-button__wrapper--left"><button type="button" class="btn ums-button ums-button--icon ums-button--line" ng-click="$ctrl.fn.editJourneyGroup($ctrl.state.selectedJourneyGroup)"><span>Edit</span><ums-icon id="icon-edit" modifier="btn"></ums-icon></button> <button type="button" class="ums-button ums-button--success" ng-if="$ctrl.state.selectedJourneyGroup.isModified" ng-click="$ctrl.fn.save($ctrl.state.selectedJourneyGroup)"><span>Save</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button></div></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3"><div data-as-sortable="$ctrl.dragControlListeners" data-ng-model="$ctrl.state.selectedJourneyGroup.steps" ng-if="$ctrl.state.selectedJourneyGroup.steps.length > 0"><div ng-repeat="journeyStep in $ctrl.state.selectedJourneyGroup.steps"><div class="ums-groupbox__container is-animated" data-as-sortable-item><div class="ums-groupbox__colorbar" ng-style="{\'background-color\': journeyStep.color}"></div><div class="ums-groupbox__image"><img ng-if="journeyStep.iconUrl" ng-src="{{ journeyStep.iconUrl }}" alt></div><div class="ums-groupbox__text"><h3 class="umsHeading" ng-bind="journeyStep.title"></h3><p ng-bind="journeyStep.description" style="white-space: pre-line;"></p></div><div class="ums-groupbox__dragicon" data-as-sortable-item-handle><span></span></div><div class="ums-groupbox__editicon ums-popup__enter" ng-click="$ctrl.fn.edit(journeyStep, $ctrl.state.selectedJourneyGroup.steps, $index)"><ums-icon id="icon-editbox" modifier="sm"></ums-icon><div class="ums-popup__holder">Edit journey step</div></div></div><div class="ums-skeleton__hoverbox is-animated" ng-show="!$ctrl.state.isDragging" ng-if="!$last"><button class="ums-skeleton__button" type="button" ng-click="$ctrl.fn.addJourneyItem($ctrl.state.selectedJourneyGroup.steps, $index)"><span>Add journey step</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div><button class="ums-groupbox__container ums-groupbox__container--empty" type="button" ng-if="$ctrl.state.selectedJourneyGroup.steps.length < 1" ng-click="$ctrl.fn.addJourneyItem($ctrl.state.selectedJourneyGroup.steps, $ctrl.state.selectedJourneyGroup.steps.length)"><h2>It\'s empty here. Start by adding some steps</h2><img src="/App_Plugins/Umbraco.Engage/assets/illustration-empty.svg" alt></button> <button class="ums-skeleton__button is-animated" type="button" ng-click="$ctrl.fn.addJourneyItem($ctrl.state.selectedJourneyGroup.steps, $ctrl.state.selectedJourneyGroup.steps.length)"><span>Add journey step</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated umsPaddingTop umsPaddingBottom" ng-if="!$ctrl.state.isLoading && !$ctrl.state.selectedJourneyGroup || $ctrl.state.selectedJourneyGroup.length === 0"><div class="ums-testdetail__empty__container"><img src="/App_Plugins/Umbraco.Engage/assets/a-b-testing.svg" alt><br><h2>There are no journeys. Start creating journeys:</h2><button type="button" class="btn ums-button ums-button--icon ums-button--main" ng-click="$ctrl.fn.addJourneyGroup()"><span>Add new journey</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div></div><ums-cj-group-editor ng-if="$ctrl.state.edit.journeyGroup" journey-group="$ctrl.state.edit.journeyGroup" close="$ctrl.fn.closeAddJourneyGroup()" remove="$ctrl.fn.removeGroup($ctrl.state.edit.journeyGroup)" on-save="$ctrl.fn.applySaveJourneyGroup()"></ums-cj-group-editor><ums-cj-editor ng-if="$ctrl.state.edit.journey.step" journey="$ctrl.state.edit.journey.step" close="$ctrl.fn.closeAddJourney()" remove="$ctrl.fn.removeItem()" on-save="$ctrl.fn.applyModifiedState()"></ums-cj-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" text="$ctrl.state.confirm.text" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay>',controller:["$timeout","umsCustomerJourneyApi","notificationsService",umsAnalyticsCustomerJourneyController],controllerAs:"$ctrl"};function umsCustomerJourneyResources($http){var BASE_URL="/umbraco/backoffice/engage/customerjourney/";return{delete:function deleteCustomerJourneyGroup(customerJourneyGroupId){return $http({method:"GET",url:BASE_URL+"delete?customerJourneyGroupId="+customerJourneyGroupId})},getAll:function getAll(){return $http({method:"GET",url:BASE_URL+"getAll"}).then(function(response){return response.data})},getDetails:function getDetails(customerJourneyGroupId){return $http({method:"GET",url:BASE_URL+"getDetails?customerJourneyGroupId="+customerJourneyGroupId})},save:function save(item){return $http({method:"POST",url:BASE_URL+"save",data:item})}}}angular.module("engage").component("umsCjMain",umsAnalyticsCustomerJourneyComponent);var umsCustomerJourneyApi=["$http",umsCustomerJourneyResources];function umsAnalyticsGoalEditorController($compile,$scope,api){var self=this;function getGoal(){return self.__goal}function renderGoalTypeEditor(){if(self.goal.goalTypeId){var container=document.getElementById("goal-type-config-editor");if(container){var gt=self.data.goalTypes.find(function(x){return x.id===self.goal.goalTypeId});if(gt){for(var goal=getGoal(),goalId=null!=goal&&goal.id||0,template="<"+gt.configurationEditorAlias+' config="$ctrl.GoalTypeConfig" goal-id="'+goalId+'"></'+gt.configurationEditorAlias+">",compiledTemplate=$compile(template)($scope);container.firstChild;)container.removeChild(container.firstChild);angular.element(container).append(compiledTemplate)}}}}function reload(){if(self.goal.id)try{self.GoalTypeConfig=JSON.parse(self.goal.goalTypeConfig),renderGoalTypeEditor()}catch(ex){console.log(ex),self.GoalTypeConfig={}}else self.GoalTypeConfig={},self.goal.isMain=!1,self.goal.isInverted=!1,self.goal.isActive=!0,self.goal.isInvalid=!1}Object.defineProperty(self,"goal",{get:getGoal,set:function setGoal(value){self.__goal=value,self.state.initialized&&reload()}}),self.data={goalTypes:null},self.state={initialized:!1,isLoading:!1,isSaving:!1},self.loading={goalTypes:!1},self.save=function(){self.goal.goalTypeConfig=JSON.stringify(self.GoalTypeConfig),self.state.isSaving||(self.state.isSaving=!0,api.save(self.goal).then(function onSaveResponse(response){response.data&&(self.goal.id=response.data),self.onSaveGoal({})}).finally(function onSaveCompleted(){self.state.isSaving=!1}))},self.close=function(){self.onCancel({})},self.selectGoalType=function(){self.GoalTypeConfig={},renderGoalTypeEditor()},this.$onInit=function(){self.state.isLoading=!0,function getAllGoalTypes(){self.loading.goalTypes=!0;var promise=api.getAllTypes();return promise.then(function onGetAllGoalTypesResponse(response){self.data.goalTypes=response.data||[]}).finally(function onGetAllGoalTypesCompleted(){self.loading.goalTypes=!1}),promise}().then(function onGetAllGoalTypesResponse(){self.state.initialized=!0,reload()}).finally(function onGetAllGoalTypesCompleted(){self.state.isLoading=!1})}}angular.module("umbraco.resources").factory("umsCustomerJourneyApi",umsCustomerJourneyApi);var umsAnalyticsGoalEditorComponent={controller:["$compile","$scope","umsGoalApi",umsAnalyticsGoalEditorController],template:'<ums-overlay close="$ctrl.onCancel()" small="true"><ums-overlay-header><h2 ng-if="!$ctrl.goal.id">Create new goal</h2><h2 ng-if="$ctrl.goal.id">Edit goal "{{$ctrl.goal.name}}" <span class="umsColor-light">#{{$ctrl.goal.id}}</span></h2></ums-overlay-header><ums-overlay-body><form id="edit-goal" ng-submit="$ctrl.save()" ng-class="{\'s-checkform\': $ctrl.state.formWasSubmitted}" class="ums__form"><div class="ums-form__row"><label class="ums-form__label" for="Name">Name *</label> <input class="ums-form__input" type="text" id="Name" name="Name" no-dirty-check ng-model="$ctrl.goal.name" required></div><div class="ums-form__row"><label class="ums-form__label" for="Value">Value <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Here you can assign a (monetary) value to the conversion of this goal. If 10% of your contact form submissions result in customers who each spend 1,000 euros then - in theory - it is fair to state that each form submission is worth 100 euro. Working with a conversion value makes it easier to be able to analyze the return on investment of campaigns.</span></span></label> <input class="ums-form__input" type="number" id="Value" name="Value" no-dirty-check ng-model="$ctrl.goal.value" step="0.01" required></div><div class="ums-form__row"><div class="ums-form__label" name="GoalIsActive">Conversion type</div><div class="ums-form__switch"><input type="radio" name="GoalIsActive-1" id="GoalIsActive-2-2" no-dirty-check ng-model="$ctrl.goal.isMain" ng-value="false" class="ums-form__switch__input" required> <label for="GoalIsActive-2-2" class="ums-form__switch__label">micro</label> <input type="radio" name="GoalIsActive-1" id="GoalIsActive-2-1" no-dirty-check ng-model="$ctrl.goal.isMain" ng-value="true" class="ums-form__switch__input" required> <label for="GoalIsActive-2-1" class="ums-form__switch__label">macro</label></div></div><div class="ums-form__row"><div class="ums-form__label" name="GoalIsSubscription">You want your goal to</div><div class="ums-form__switch"><input type="radio" name="GoalIsSubscription-1" id="GoalIsSubscription-2-2" no-dirty-check ng-model="$ctrl.goal.isInverted" ng-value="false" class="ums-form__switch__input"> <label for="GoalIsSubscription-2-2" class="ums-form__switch__label">increase</label> <input type="radio" name="GoalIsSubscription-1" id="GoalIsSubscription-2-1" no-dirty-check ng-model="$ctrl.goal.isInverted" ng-value="true" class="ums-form__switch__input" checked> <label for="GoalIsSubscription-2-1" class="ums-form__switch__label">decrease</label></div></div><div class="ums-form__row"><label for="GoalType" class="ums-form__label">Your goal is triggered by a *</label><select id="GoalType" class="ums-form__select" name="GoalType" no-dirty-check ng-model="$ctrl.goal.goalTypeId" ng-options="gt.id as gt.name for gt in $ctrl.data.goalTypes | orderBy:\'-name\'" ng-change="$ctrl.selectGoalType(gt)" required><option value>Select a goal type...</option></select></div><div id="goal-type-config-editor"></div></form></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span class="ums-table__buttonholder ums-table__buttonholder--center ums-table__buttonholder--m-large"><button type="button" class="ums-button ums-button--light" ng-click="$ctrl.close()">Cancel</button><div class="ums-popup__enter"><div class="ums-form__toggle" ng-click="$ctrl.goal.isActive = !$ctrl.goal.isActive"><label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular" style="margin-bottom: 0;">&nbsp;</label> <input type="checkbox" name="toggle-2" id="toggle-2-1" class="ums-form__toggle__input s-toggleByAngular" style="margin-bottom: 0;"> <label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular" ng-class="{\'ums-form__toggle__label--archived\': !$ctrl.goal.isActive}" style="margin-bottom: 0;"><span ng-show="$ctrl.goal.isActive">Active goal</span> <span ng-show="!$ctrl.goal.isActive">Inactive goal</span></label></div></div></span> <span class="ums-table__buttonholder ums-table__buttonholder--center ums-table__buttonholder--m-large"><button type="submit" form="edit-goal" class="ums-button ums-button--success ums-button--icon" ng-click="$ctrl.state.formWasSubmitted = true"><span>Save</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{goal:"=",onSaveGoal:"&",onCancel:"&"}};function umsAnalyticsGoalOverviewController($timeout,api,umsChartsApi){var self=this;self.state={isSavingGoal:!1,isLoadingGoal:!1,isLoadingGoals:!1,filter:{page:1,pageSize:20,filterBy:"",includeInvalid:!1},pageSizes:[10,20,50,100]},self.data={goalTypes:null,goals:null},self.form={goal:null},self.createNew=function(){self.form.goal={isActive:!0,isInverted:!1,isMain:!1,isInvalid:!1,value:0}},self.editGoal=function(goal){goal&&!self.state.isLoadingGoal&&(self.state.isLoadingGoal=!0,api.getDetails(goal.id).then(function onGoalLoadedResponse(response){self.form.goal=response.data}).finally(function onGoalLoaded(){self.state.isLoadingGoal=!1}))},self.closeGoal=function(){self.form.goal=null},self.onGoalSaved=function(){self.form.goal=null,getAllGoals()},self.search=function(){self.data.goals=null,self.state.filter.page=1,getAllGoals()},self.previousPage=function(){self.state.filter.page--,getAllGoals()},self.nextPage=function(){self.state.filter.page++,getAllGoals()};var loaderTimeout=null;function getAllGoals(){self.state.isLoadingGoals||loaderTimeout||(loaderTimeout=setTimeout(function(){self.state.isLoadingGoals=!0}),api.getAll(self.state.filter).then(function onGetAllGoalsResponse(response){self.data.goals=response.data||[]}).finally(function onGetAllGoalsCompleted(){loaderTimeout&&clearTimeout(loaderTimeout),loaderTimeout=null,self.state.isLoadingGoals=!1}))}this.$onInit=function(){getAllGoals()}}angular.module("engage").component("umsGoalEditor",umsAnalyticsGoalEditorComponent);var umsAnalyticsGoalOverviewComponent={template:'<div class="ums-content"><div class="u-marketing-suite__goals"><ums-goal-editor ng-if="$ctrl.form.goal" goal="$ctrl.form.goal" on-cancel="$ctrl.closeGoal()" on-save-goal="$ctrl.onGoalSaved()"></ums-goal-editor></div><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container"><h2>Setup your goals</h2><div class="umsDescription"><p>Within this section you are able to set your global goals. These goals will become available throughout Umbraco Engage and will become visible within Analytics.</p><div class="ums-testadvice__small__container"><div class="ums-testadvice__icon ums-testadvice__small__icon"><ums-icon id="icon-logo" modifier="md"></ums-icon></div><div class="ums-testadvice__small__textbox"><span>Tip:</span> do you have a clear purpose with your website like gathering newsletter subscriptions? Then set it as a <span>macro</span> goal and Umbraco Engage will keep an extra eye on that specific goal for you!</div></div></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3 is-animated"><table class="ums-table__table ums-table__table--no-minwidth"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="4"><strong class="umsFzLg">All goals</strong></td><td class="ums-table__td" style="text-align: right;" colspan="2"><button class="ums-button ums-button--success" type="button" ng-click="$ctrl.createNew()">Create new goal</button></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Goal</div></th><th class="ums-table__th"><div class="umsLabel">Trigger</div></th><th class="ums-table__th"><div class="umsLabel">Type</div></th><th class="ums-table__th"><div class="umsLabel">Completions (last 30 days)</div></th><th class="ums-table__th" colspan="2"><div class="umsLabel">Active</div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="!$ctrl.data.goals"><td class="ums-table__td" colspan="6"><img src="/umbraco/lib/tinymce/skins/lightgray/img/loader.gif" alt="Loading"> <span style="margin-left: 10px;">Loading goals...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.data.goals && (!$ctrl.data.goals.rows || $ctrl.data.goals.rows.length === 0)"><td class="ums-table__td" colspan="6">No goals have been created yet!</td></tr><tr class="ums-table__tr" ng-if="$ctrl.data.goals && $ctrl.data.goals.rows && $ctrl.data.goals.rows.length > 0" ng-repeat="goal in $ctrl.data.goals.rows track by goal.id" ng-class="{ \'s-current\': $ctrl.form.goal === goal, \'s-inactive\': !goal.isActive }"><td class="ums-table__td" ng-class="{ \'s-main\': goal.isMain }" ng-bind="goal.name"></td><td class="ums-table__td" ng-bind="goal.typeText"></td><td class="ums-table__td" ng-bind="goal.isMain ? \'Macro\' : \'Micro\'"></td><td class="ums-table__td" ng-bind="goal.completionCount"></td><td class="ums-table__td" ng-bind="goal.isActive ? \'Yes\' : \'No\'"></td><td class="ums-table__td ums-table__td--right"><div class="ums-table__buttonholder ums-table__buttonholder--center ums-table__buttonholder--m-large"><span class="ums-popup__enter"><ums-icon id="icon-info" class="ums-popup__infoicon" modifier="sm"></ums-icon><div class="ums-popup__holder">{{goal.statusText}}</div></span><ums-ui-table-action-buttons on-edit-click="$ctrl.editGoal(goal)"></ums-ui-table-action-buttons></div></td></tr></tbody></table><div class="ums-pagination__container"><div class="ums-pagination__col"><label for="GoalPageSize" class="ums-pagination__label">Show rows:</label><select class="ums-pagination__select" name="GoalPageSize" id="GoalPageSize" ng-model="$ctrl.state.filter.pageSize" ng-options="o for o in $ctrl.state.pageSizes" ng-change="$ctrl.search()"></select></div><div class="ums-pagination__col"><label class="ums-pagination__label">{{ $ctrl.data.goals.fromRow }}-{{ $ctrl.data.goals.toRow }} of {{ $ctrl.data.goals.totalRowCount }}</label> <button type="button" class="ums-pagination__button" ng-if="$ctrl.state.filter.page > 1" ng-click="$ctrl.previousPage()"><ums-icon id="icon-arrow" modifier="xs ums-icon--rotate-180"></ums-icon></button> <button type="button" class="ums-pagination__button" ng-if="$ctrl.state.filter.page < $ctrl.data.goals.totalPages" ng-click="$ctrl.nextPage()"><ums-icon id="icon-arrow" modifier="xs"></ums-icon></button></div></div></div></div></div>',controller:["$timeout","umsGoalApi","umsChartsApi",umsAnalyticsGoalOverviewController]};function umsGoalResources($http){var BASE_URL="/umbraco/backoffice/engage/goal/";return{getAll:function getAll(filter){return $http({method:"POST",url:BASE_URL+"getAll",data:filter})},getAllTypes:function getAllTypes(){return $http({method:"GET",url:BASE_URL+"getAllTypes"})},getDetails:function getDetails(id){return $http({method:"GET",url:BASE_URL+"getDetails?id="+id})},save:function save(item){return $http({method:"POST",url:BASE_URL+"save",data:item})}}}angular.module("engage").component("umsGoalsMain",umsAnalyticsGoalOverviewComponent);var umsGoalApi=["$http",umsGoalResources];function umsDocumentTypePermissionsService($http){var endpoint="/umbraco/backoffice/engage/DocumentTypePermission/";this.getAll=function getAll(){return $http.get(endpoint+"getAll").then(function(response){return response.data})},this.getPermission=function getPermission(contentTypeId){return $http.get(endpoint+"getPermission?contentTypeId="+contentTypeId).then(function(response){return response.data})},this.save=function save(documentTypePermissions){return $http.post(endpoint+"Save",documentTypePermissions).then(function(response){return response.data})}}function umsUserGroupPermissionsService($http){var endpoint="/umbraco/backoffice/engage/UserGroupPermission/";this.getAll=function getAll(){return $http.get(endpoint+"getAll").then(function(response){return response.data})},this.getPermission=function getPermission(userGroupId){return $http.get(endpoint+"getPermission?userGroupId="+userGroupId).then(function(response){return response.data})},this.save=function save(userGroupPermission){return $http.post(endpoint+"Save",userGroupPermission).then(function(response){return response.data})}}function umsAnalyticsPersonaEditorController(service,utils,mediaResource){var ctrl=this;this.$onInit=function(){this.state.persona=angular.copy(this.persona),void 0===this.state.persona.iconUrl||void 0===this.state.persona.icon?this.state.isNew=!0:mediaResource.getById(this.state.persona.icon).then(function(media){ctrl.state.persona.iconPicker=[{mediaKey:media.key}]})},this.state={persona:null,currentPersonaColor:null,isNew:!1},this.fn={save:function(){if(null!==ctrl.state.persona)if(utils.merge(ctrl.persona,ctrl.state.persona),ctrl.persona.color&&null!==ctrl.persona.color.value&&(ctrl.persona.color=ctrl.persona.color.value),ctrl.persona.iconUrl=null,null!=ctrl.persona.iconPicker&&null!=ctrl.persona.iconPicker[0]&&""!==ctrl.persona.iconPicker[0].mediaKey){var mediaKeyId=ctrl.persona.iconPicker[0].mediaKey;mediaResource.getById(mediaKeyId).then(function(media){media&&"string"==typeof media.mediaLink&&media.mediaLink.length>0&&(ctrl.persona.iconUrl=media.mediaLink,ctrl.persona.icon=media.id),"function"==typeof ctrl.onSave&&ctrl.onSave()})}else ctrl.persona.iconUrl=null,ctrl.persona.icon=null,"function"==typeof ctrl.onSave&&ctrl.onSave()}}}function umsAnalyticsPersonaGroupEditorController(service,utils){var ctrl=this;this.$onInit=function(){this.state.personaGroup=angular.copy(this.personaGroup),void 0===this.state.personaGroup.createdByUmbracoUsername&&(this.state.isNew=!0)},this.state={personaGroup:null,isNew:!1},this.fn={save:function(){null!==ctrl.state.personaGroup&&(utils.merge(ctrl.personaGroup,ctrl.state.personaGroup),"function"==typeof ctrl.onSave&&ctrl.onSave())}}}function umsAnalyticsPersonaMainController($timeout,api,notificationsService){var self=this;self.state={isLoading:!1,isDraggable:!1,isDragging:!1,selectedPersonaGroup:null,draggableModel:null,personas:[],isNew:{personaGroup:!1,persona:{group:null,index:null}},edit:{personaGroup:null,persona:{item:null,belongsToGroup:null}},confirm:null},self.fn={addPersonaItem:function(personaItemsList,index){self.state.edit.persona.item={title:"",description:"",icon:null},self.state.isNew.persona.group=personaItemsList,self.state.isNew.persona.index=index},addPersonaGroup:function(){self.state.edit.personaGroup={title:"",description:"",personas:[],minimumParticipationScoreThreshold:25,minimumDeviationType:0,minimumDeviation:0,expirationType:null,expiration:0,upperScoreLimit:10},self.state.isNew.personaGroup=!0},getAll:function(openGroupId){self.state.isLoading=!0,api.getAll().then(function(response){self.state.personas=response}).finally(function(){openGroupId&&"number"==typeof openGroupId?self.fn.openSpecificItem(openGroupId):self.fn.showFirstGroup(),self.state.isLoading=!1})},applyModifiedState:function(){if(self.state.isNew.persona.group){var index=self.state.isNew.persona.index+1;self.state.isNew.persona.group.splice(index,0,self.state.edit.persona.item),self.state.isNew.persona.group=null,self.state.isNew.persona.index=null}self.state.edit.persona.item=null,self.state.edit.persona.belongsToGroup=null,self.fn.save(self.state.selectedPersonaGroup)},applySavePersonaGroup:function(){self.state.isNew.personaGroup&&(self.state.personas.push(self.state.edit.personaGroup),self.state.isNew.personaGroup=!1),self.fn.save(self.state.edit.personaGroup,!0),self.state.edit.personaGroup=null},edit:function(personaItem,personaGroup){self.state.edit.persona.item=personaItem,self.state.edit.persona.belongsToGroup=personaGroup},editPersonaGroup:function(personaGroup){self.state.edit.personaGroup=personaGroup},closeAddPersonaGroup:function(){self.state.isNew.personaGroup=!1,self.state.edit.personaGroup=null},closeAddPersona:function(){self.state.isNew.persona.group=null,self.state.isNew.persona.index=null,self.state.edit.persona.item=null},removeItem:function(){self.state.confirm={header:'Remove persona "'+self.state.edit.persona.item.title+'"',fn:function confirmFn(){var idx=self.state.edit.persona.belongsToGroup.indexOf(self.state.edit.persona.item);idx>-1&&(self.state.edit.persona.belongsToGroup.splice(idx,1),self.fn.save(self.state.selectedPersonaGroup,!1,!1).then(function(){notificationsService.success('Persona "'+self.state.edit.persona.item.title+'" was removed'),self.state.edit.persona.item=null,self.state.edit.persona.belongsToGroup=null}))}}},removeGroup:function(personaGroup){var oneOrMultiplePersonas=1!==personaGroup.personas.length?"personas":"persona";self.state.confirm={header:'Remove persona group "'+personaGroup.title+'"',text:"Are you sure? Deleting this group will also delete "+personaGroup.personas.length+" connected "+oneOrMultiplePersonas+".",fn:function confirmFn(){api.delete(personaGroup.id).then(function(){self.state.edit.personaGroup=null,self.state.selectedPersonaGroup=null,self.fn.getAll(),notificationsService.success('Persona group "'+personaGroup.title+'" was removed')})}}},save:function(personaGroup,doGetAll,notify){return api.save(personaGroup).then(function(response){doGetAll&&1==doGetAll&&(self.state.selectedPersonaGroup=null,self.fn.getAll(response.data.id)),0!=notify&&notificationsService.success("Saved successfully")})},showFirstGroup:function(){null===self.state.selectedPersonaGroup&&(self.state.selectedPersonaGroup=self.state.personas[0])},openSpecificItem:function(openGroupId){self.state.selectedPersonaGroup=self.state.personas.filter(function filter(value){return value.id==openGroupId})[0]}},self.dragControlListeners={orderChanged:function(){self.fn.save(self.state.selectedPersonaGroup)},dragStart:function(){self.state.isDragging=!0},dragEnd:function(){self.state.isDragging=!1}},this.$onInit=function(){self.fn.getAll()}}angular.module("engage").factory("umsGoalApi",umsGoalApi),angular.module("engage").component("umsDocumentTypePermissions",{template:'<div class="is-animated"><table class="ums-table__table ums-table__table--no-minwidth"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td ums-table__thead__content" colspan="6"><h3 class="umsFzLg">Document type permissions</h3><p>In this section you can specify per doctype which content apps are allowed on each document type. These permission can only be applied to non-element types.<br>Please be aware that these document type permissions are combined with the user group permissions. So if you for some reason do not see the content app, please check your user group permission as well.</p></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels" colspan="6"><th class="ums-table__th ums-table__th--fixed-xxxs"></th><th class="ums-table__th"><div class="umsLabel">Document types</div></th><th class="ums-table__th"><div class="ums-table__inner-flex"><input class="ums-form__checkbox__input" style="margin-top:0; margin-right:0.5rem;" type="checkbox" no-dirty-check ng-model="$ctrl.selectedAll.column.showAnalytics" ng-init="$ctrl.updateSelectRowAndCol(null, \'showAnalytics\', null)" ng-change="$ctrl.selectColumn(\'showAnalytics\')"><div class="umsLabel umsLabel-auto">Show analytics</div><span class="ums-form__info__bullet" style="position: relative;"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text" style="min-width: 200px;">Show the Analytics data on the specific node</span></span></div></th><th class="ums-table__th"><div class="ums-table__inner-flex"><input class="ums-form__checkbox__input" style="margin-top:0; margin-right:0.5rem;" type="checkbox" no-dirty-check ng-model="$ctrl.selectedAll.column.allowAbTesting" ng-change="$ctrl.selectColumn(\'allowAbTesting\')"><div class="umsLabel umsLabel-auto">Allow A/B testing</div><span class="ums-form__info__bullet" style="position: relative;"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text ums-form__info__text--wide">Allows this document type to be A/B Tested. Please make sure that you also check "Allow segmentation" on the document type</span></span></div></th><th class="ums-table__th"><div class="ums-table__inner-flex"><input class="ums-form__checkbox__input" style="margin-top:0; margin-right:0.5rem;" type="checkbox" no-dirty-check ng-model="$ctrl.selectedAll.column.allowScorePersonalization" ng-change="$ctrl.selectColumn(\'allowScorePersonalization\')"><div class="umsLabel umsLabel-auto">Score personalization</div><span class="ums-form__info__bullet" style="position: relative;"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text" style="min-width: 200px;">Allows the content to be scored for implicit personalization</span></span></div></th><th class="ums-table__th"><div class="ums-table__inner-flex"><input class="ums-form__checkbox__input" style="margin-top:0; margin-right:0.5rem;" type="checkbox" no-dirty-check ng-model="$ctrl.selectedAll.column.allowApplyPersonalization" ng-change="$ctrl.selectColumn(\'allowApplyPersonalization\')"><div class="umsLabel umsLabel-auto">Apply personalization</div><span class="ums-form__info__bullet" style="position: relative;"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text ums-form__info__text--wide">"Allows the document type to be personalized. Please make sure that you also check "Allow segmentation" on the document type</span></span></div></th></tr></thead><tbody><tr class="ums-table__tr" ng-if="$ctrl.loading && $ctrl.documentTypePermissions.length <= 0"><td class="ums-table__td" colspan="5"><img src="/umbraco/lib/tinymce/skins/lightgray/img/loader.gif" alt="Loading"> <span style="margin-left: 10px;">Loading document types ...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.documentTypePermissions.length > 0" ng-repeat="permission in $ctrl.documentTypePermissions"><td class="ums-table__td ums-table__td--check-before"><input class="ums-form__checkbox__input" type="checkbox" style="margin-top:0;" no-dirty-check ng-model="$ctrl.selectedAll.row[$index]" ng-init="$ctrl.updateSelectRowAndCol(permission, null, $index)" ng-change="$ctrl.selectAllRows(permission, $index)"></td><td class="ums-table__td"><strong ng-bind="permission.contentTypeName"></strong></td><td class="ums-table__td"><input class="ums-form__checkbox__input" type="checkbox" no-dirty-check ng-model="permission.showAnalytics" ng-change="$ctrl.updateSelectRowAndCol(permission, \'showAnalytics\', $index)"></td><td class="ums-table__td"><input class="ums-form__checkbox__input" type="checkbox" no-dirty-check ng-model="permission.allowAbTesting" ng-change="$ctrl.updateSelectRowAndCol(permission, \'allowAbTesting\', $index)"></td><td class="ums-table__td"><input class="ums-form__checkbox__input" type="checkbox" no-dirty-check ng-model="permission.allowScorePersonalization" ng-change="$ctrl.updateSelectRowAndCol(permission, \'allowScorePersonalization\', $index)"></td><td class="ums-table__td"><input class="ums-form__checkbox__input" type="checkbox" no-dirty-check ng-model="permission.allowApplyPersonalization" ng-change="$ctrl.updateSelectRowAndCol(permission, \'allowApplyPersonalization\', $index)"></td></tr></tbody></table><div class="ums-button__wrapper ums-button__wrapper--right"><button class="btn ums-button ums-button--success ums-button--icon" type="button" ng-click="$ctrl.save()" ng-disabled="$ctrl.saving"><span>Save document type permissions</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button></div></div>',controller:["umsDocumentTypePermissionsService","notificationsService","umsErrorHandler",function umsDocumentTypePermissionsCtrl(service,notificationsService,errorHandler){var $ctrl=this,permissionKeys=["showAnalytics","allowAbTesting","allowScorePersonalization","allowApplyPersonalization"];this.loading=!1,this.saving=!1,this.documentTypePermissions=[],this.selectedAll={column:{showAnalytics:!1,allowAbTesting:!1,allowScorePersonalization:!1,allowApplyPersonalization:!1}},this.$onInit=function(){this.refresh()},this.refresh=function(){this.loading=!0,service.getAll().then(function(dtps){$ctrl.documentTypePermissions=dtps,$ctrl.loading=!1,Object.keys($ctrl.selectedAll.column).forEach(function(columnKey){$ctrl.updateSelectRowAndCol(null,columnKey,null)})},errorHandler.handle)},this.save=function(){this.saving=!0,service.save(this.documentTypePermissions).then(function(){$ctrl.refresh(),notificationsService.success("Document type permissions saved successfully")},function(){notificationsService.error("Document type permissions failed to save")}).finally(function(){$ctrl.saving=!1})},this.selectColumn=function(key){$ctrl.documentTypePermissions.forEach(function(item){item[key]=$ctrl.selectedAll.column[key]})},this.selectAllRows=function(row,rowIndex){permissionKeys.forEach(function(key){row[key]=$ctrl.selectedAll.row[rowIndex]})},this.updateSelectRowAndCol=function(rowObj,columnKey,rowIndex){null!==columnKey&&function updateColumn(){var totalCheckboxes=$ctrl.documentTypePermissions.length,checkedCount=0;$ctrl.documentTypePermissions.forEach(function(item){item[columnKey]&&checkedCount++}),$ctrl.selectedAll.column[columnKey]=totalCheckboxes===checkedCount}(),null!==rowIndex&&null!==rowObj&&function updateRow(){var arr=[];for(var property in rowObj)-1!==permissionKeys.indexOf(property)&&arr.push(rowObj[property]);var arrResult=arr.every(function(item){return!0===item});$ctrl.selectedAll.row=$ctrl.selectedAll.row||{},1!=arrResult&&0!=arrResult||($ctrl.selectedAll.row[rowIndex]=arrResult)}()}}]}),angular.module("engage").service("umsDocumentTypePermissionsService",["$http",umsDocumentTypePermissionsService]),angular.module("engage").component("umsUserGroupPermissionsEditor",{template:'<ums-overlay close="$ctrl.close()" small="true" ng-if="$ctrl.item != null"><ums-overlay-header><h3>Edit user group permissions</h3></ums-overlay-header><ums-overlay-body><form id="user-group-permissions-editor-form" ng-submit="$ctrl.save({ item: $ctrl.item })"><div class="ums-form__row"><label class="ums-form__label" for="user-group-name">User group:</label> <span class="ums-form__input ums-form__input--disabled" ng-bind="$ctrl.item.userGroupName">Administrators</span></div><div class="ums-form__row"><label class="ums-form__label" for="user-group-access-to">Access to:</label> <label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" no-dirty-check ng-model="$ctrl.item.accessToAnalytics"> Analytics</span></label> <label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" no-dirty-check ng-model="$ctrl.item.accessToAbTesting"> A/B testing</span></label> <label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" no-dirty-check ng-model="$ctrl.item.accessToPersonalization"> Personalization</span></label> <label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" no-dirty-check ng-model="$ctrl.item.accessToProfiles"> Profiles</span></label> <label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" no-dirty-check ng-model="$ctrl.item.accessToReporting"> Reporting</span></label> <label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" no-dirty-check ng-model="$ctrl.item.accessToSettings"> Settings</span></label></div></form></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><button type="button" class="ums-button ums-button--light" ng-click="$ctrl.close()">Close</button> <button type="submit" form="user-group-permissions-editor-form" class="ums-button ums-button--success ums-button--icon"><span>Save user group permissions</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button></ums-overlay-footer></ums-overlay>',bindings:{input:"<",save:"&",close:"&"},controller:[function umsUserGroupPermissionsEditorCtrl(){this.item=null,this.$onChanges=function(changes){changes.input&&(this.item=angular.copy(this.input))}}]}),angular.module("engage").component("umsUserGroupPermissions",{template:'<div class="is-animated"><table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td ums-table__thead__content" colspan="5"><h3 class="umsFzLg">User group permissions</h3><p>In this section you can specify which Umbraco user groups have access to which Umbraco Engage features.</p></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"></th><th class="ums-table__th"><div class="umsLabel">User group</div></th><th class="ums-table__th"><div class="umsLabel">Permissions</div></th><th class="ums-table__th"></th></tr></thead><tbody><tr class="ums-table__tr" ng-repeat="permission in $ctrl.userGroupPermissions"><td class="ums-table__td ums-table__td--toggle"><i ng-if="permission.userGroupIconUrl" class="umb-table-body__icon" ng-class="permission.userGroupIconUrl"></i></td><td class="ums-table__td" ng-bind="permission.userGroupName"></td><td class="ums-table__td" ng-bind="$ctrl.getPermissionDisplay(permission)">Analytics, A/B testing, Settings</td><td class="ums-table__td"><ums-ui-table-action-buttons on-edit-click="$ctrl.permissionToEdit = permission"></ums-ui-table-action-buttons></td></tr></tbody></table><ums-user-group-permissions-editor ng-if="$ctrl.permissionToEdit" input="$ctrl.permissionToEdit" save="$ctrl.save(item)" close="$ctrl.closeEditor()"></ums-user-group-permissions-editor></div>',controller:["umsUserGroupPermissionsService","notificationsService","umsErrorHandler",function umsUserGroupPermissionsCtrl(service,notificationsService,errorHandler){var $ctrl=this;this.userGroupPermissions=[],this.permissionToEdit=null,this.loading=!1,this.$onInit=function(){this.reload()},this.save=function(userGroupPermission){service.save(userGroupPermission).then(function(){notificationsService.success('Permissions for user group "'+userGroupPermission.userGroupName+'" saved successfully'),$ctrl.closeEditor(),$ctrl.reload()},errorHandler.handle)},this.getPermissionDisplay=function(permission){var access=[];return permission.accessToAnalytics&&access.push("Analytics"),permission.accessToAbTesting&&access.push("A/B Testing"),permission.accessToPersonalization&&access.push("Personalization"),permission.accessToProfiles&&access.push("Profiles"),permission.accessToReporting&&access.push("Reporting"),permission.accessToSettings&&access.push("Settings"),access.join(", ")},this.closeEditor=function(){$ctrl.permissionToEdit=null},this.reload=function(){return this.loading=!0,service.getAll().then(function(permissions){$ctrl.userGroupPermissions=permissions},errorHandler.handle).finally(function(){$ctrl.loading=!1})}}]}),angular.module("engage").service("umsUserGroupPermissionsService",["$http",umsUserGroupPermissionsService]),angular.module("engage").component("umsPersonaEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2 ng-if="$ctrl.state.isNew">Create new persona</h2><h2 ng-if="!$ctrl.state.isNew">Edit persona "{{$ctrl.state.persona.title}}" <span class="umsColor-light">#{{$ctrl.state.persona.id}}</span></h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-persona-editor-form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" name="$ctrl.form" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row"><label for="form0123" class="ums-form__label">Title/name *</label> <input id="form0123" class="ums-form__input" type="text" required ng-model="$ctrl.state.persona.title"></div><div class="ums-form__row"><label for="form0234" class="ums-form__label">Description *</label> <textarea id="form0234" class="ums-form__input" rows="3" required ng-model="$ctrl.state.persona.description"></textarea></div><br><br><div class="ums-form__row"><div class="ums-form__subrow"><label for="form0234" class="ums-form__label">Select a color *</label><div class="ums-colorswatch__wrapper"><ums-render-property key="\'19aedd1b-3e4b-4e1d-b3dc-c34d6ab90753\'" ng-model="$ctrl.state.persona.color" name="personacolor" ums-not-null></ums-render-property><span class="ums-errorText" ng-show="$ctrl.form.$submitted && $ctrl.form.personacolor.$invalid">Please select a color</span></div></div><div class="ums-form__subrow"><label for="form0234" class="ums-form__label">Select an image</label><ums-render-property key="\'49addd1b-4e3c-4e2d-b3dc-d24d6ab90756\'" ng-model="$ctrl.state.persona.iconPicker" name="personaicon"></ums-render-property><span class="ums-errorText" ng-show="$ctrl.form.$submitted && $ctrl.form.personaicon.$invalid">Please select an image</span></div></div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button> <button ng-click="$ctrl.remove()" ng-if="!$ctrl.state.isNew" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error" type="button"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-persona-editor-form" ng-click="$ctrl.state.formWasSaved = true" type="submit"><span ng-if="$ctrl.state.isNew">Add persona</span> <span ng-if="!$ctrl.state.isNew">Update persona</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{persona:"=",close:"&",remove:"&",onSave:"&?"},controller:["umsPersonaApi","umsUtilService","mediaResource",umsAnalyticsPersonaEditorController]}),angular.module("engage").component("umsPersonaGroupEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2 ng-if="$ctrl.state.isNew">Create persona group</h2><h2 ng-if="!$ctrl.state.isNew">Edit persona group "{{$ctrl.state.personaGroup.title}}"</h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-persona-group-editor-form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" name="$ctrl.form"><div class="ums-form__row"><label for="form0123" class="ums-form__label">Title *</label> <input id="form0123" class="ums-form__input" type="text" required ng-model="$ctrl.state.personaGroup.title"></div><div class="ums-form__row"><label for="form0234" class="ums-form__label">Description *</label> <textarea id="form0234" class="ums-form__input" rows="8" required ng-model="$ctrl.state.personaGroup.description"></textarea></div><div class="ums-form__row"><ums-accordion-item name="Advanced settings" style="width: 100%"><div class="ums-form__row"><label for="form0323" class="ums-form__label">Threshold value: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">This treshold value needs to be reached before a persona can become active.</span></span></label> <input id="form0323" class="ums-form__input" type="number" min="0" placeholder="25" ng-model="$ctrl.state.personaGroup.minimumParticipationScoreThreshold"></div><div class="ums-form__row" style="margin-top: 40px;"><label for="form0423" class="ums-form__label">Minimal deviation: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">This settings specifies the minimal deviation between the persona with the highest score and the second highest score. This can be specified in an absolute value or in a percentage.</span></span></label><div class="ums-form__switch"><input type="radio" name="MinimumDeviationType-1" id="MinimumDeviationType-2-2" ng-model="$ctrl.state.personaGroup.minimumDeviationType" ng-value="0" class="ums-form__switch__input" checked> <label for="MinimumDeviationType-2-2" class="ums-form__switch__label">Absolute value</label> <input type="radio" name="MinimumDeviationType-1" id="MinimumDeviationType-2-1" ng-model="$ctrl.state.personaGroup.minimumDeviationType" ng-value="1" class="ums-form__switch__input"> <label for="MinimumDeviationType-2-1" class="ums-form__switch__label">Percentage</label></div></div><div class="ums-form__row" ng-if="$ctrl.state.personaGroup.minimumDeviationType === 0"><label for="form0423" class="ums-form__label">Minimal deviation value: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">The absolute value that specifies the minimum difference between the highest score and the second highest score before a persona becomes active.</span></span></label> <input id="form0423" class="ums-form__input" type="number" min="0" ng-model="$ctrl.state.personaGroup.minimumDeviation"></div><div class="ums-form__row" ng-if="$ctrl.state.personaGroup.minimumDeviationType === 1"><label for="form0823" class="ums-form__label">Minimal deviation percentage: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">The percentage that specifies the minimum difference between the highest score and the second highest score before a persona becomes active.</span></span></label> <input id="form0823" class="ums-form__input" type="number" min="0" max="100" ng-model="$ctrl.state.personaGroup.minimumDeviation"></div><div class="ums-form__row" style="margin-top: 40px;"><label for="form0523" class="ums-form__label">Expiration type: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify whether the implicit persona scoring expires. This can be set to \'never\' when it does not expire, or can be set to a number of days or a number of sessions.</span></span></label><div class="ums-form__switch"><input type="radio" name="ExpirationType-1" id="ExpirationType-2-2" ng-model="$ctrl.state.personaGroup.expirationType" ng-value="null" class="ums-form__switch__input" checked> <label for="ExpirationType-2-2" class="ums-form__switch__label">Never</label> <input type="radio" name="ExpirationType-1" id="ExpirationType-3-1" ng-model="$ctrl.state.personaGroup.expirationType" ng-value="0" class="ums-form__switch__input"> <label for="ExpirationType-3-1" class="ums-form__switch__label">Days</label> <input type="radio" name="ExpirationType-1" id="ExpirationType-2-1" ng-model="$ctrl.state.personaGroup.expirationType" ng-value="1" class="ums-form__switch__input"> <label for="ExpirationType-2-1" class="ums-form__switch__label">Sessions</label></div></div><div class="ums-form__row" ng-if="$ctrl.state.personaGroup.expirationType !== null"><label for="form0523" class="ums-form__label" ng-if="$ctrl.state.personaGroup.expirationType === 0">Expire after x days: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify the number of days that need to be included for the persona scoring.</span></span></label> <label for="form0523" class="ums-form__label" ng-if="$ctrl.state.personaGroup.expirationType === 1">Expire after x sessions: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify the number of sessions that need to be included for the persona scoring.</span></span></label> <input id="form0523" class="ums-form__input" type="number" min="0" ng-model="$ctrl.state.personaGroup.expiration"></div><div class="ums-form__row" style="margin-top: 40px;"><label for="form0623" class="ums-form__label">Maximum points to score: <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text">Specify the maximum number of points that can be scored per persona per item.</span></span></label> <input id="form0623" class="ums-form__input" type="number" min="0" placeholder="10" ng-model="$ctrl.state.personaGroup.upperScoreLimit"></div></ums-accordion-item></div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button><div class="ums-popup__enter ums-button__placeholder"><button ng-click="$ctrl.remove()" ng-if="!$ctrl.state.isNew" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error ums-popup__enter" type="button"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button><div class="ums-popup__holder" ng-if="$ctrl.state.personaGroup.personas.length > 0">Deleting this group will also delete {{$ctrl.state.personaGroup.personas.length}} connected persona{{$ctrl.state.personaGroup.personas.length !== 1 ? \'s\': \'\'}}.</div></div></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-persona-group-editor-form" ng-click="$ctrl.state.formWasSaved = true" type="submit"><span ng-if="$ctrl.state.isNew">Create persona group</span> <span ng-if="!$ctrl.state.isNew">Update persona group</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{personaGroup:"=",close:"&",remove:"&",onSave:"&?"},controller:["umsPersonaApi","umsUtilService",umsAnalyticsPersonaGroupEditorController]});var umsAnalyticsPersonaMainComponent={template:'<div class="u-marketing-suite__persona"><div class="ums-content"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--sidebar-left ums-flexgrid__item--1-4 umsPaddingTop umsPaddingBottom"><div class="umsPaddingTop"><div class="ums-pagemenu__title"><ums-icon id="icon-persona" modifier="md"></ums-icon><strong>Persona groups</strong></div><ul class="ums-pagemenu__list"><li class="ums-pagemenu__item" ng-if="$ctrl.state.isLoading"><span>Loading personas...</span></li><li class="ums-pagemenu__item is-animated" ng-if="!$ctrl.state.isLoading" ng-repeat="personaGroup in $ctrl.state.personas" ng-click="$ctrl.state.selectedPersonaGroup = personaGroup" ng-class="{\'s-active\': $ctrl.state.selectedPersonaGroup == personaGroup}"><strong class="h4" ng-bind="personaGroup.title">Default persona group</strong><div class="ums-pagemenu__description"><span ng-if="personaGroup.personas && personaGroup.personas.length !== 1">{{personaGroup.personas.length}} personas</span> <span ng-if="personaGroup.personas && personaGroup.personas.length === 1">{{personaGroup.personas.length}} persona</span> <span ng-bind="personaGroup.description" style="white-space: pre-line;"></span></div><ums-icon id="icon-arrow" modifier="xs"></ums-icon></li></ul><br><button type="button" ng-click="$ctrl.fn.addPersonaGroup()" ng-if="!$ctrl.state.isLoading" class="btn ums-button ums-button--icon ums-button--main is-animated"><span>Add new persona group</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 umsPaddingTop umsPaddingBottom is-animated" ng-if="!$ctrl.state.isLoading && $ctrl.state.selectedPersonaGroup"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-3"><h2 class="h2" ng-bind="$ctrl.state.selectedPersonaGroup.title"></h2><ul class="ums-infoicons__list"><li class="ums-infoicons__item" ng-if="$ctrl.state.selectedPersonaGroup.createdByUmbracoUsername && !$ctrl.state.selectedPersonaGroup.updatedByUmbracoUsername"><div class="ums-popup__enter"><ums-icon id="icon-status-draft" modifier="sm"></ums-icon><div class="ums-popup__holder">Created by: {{$ctrl.state.selectedPersonaGroup.createdByUmbracoUsername}}</div></div><span ng-bind="$ctrl.state.selectedPersonaGroup.createdByUmbracoUsername"></span></li><li class="ums-infoicons__item" ng-if="$ctrl.state.selectedPersonaGroup.updatedByUmbracoUsername"><div class="ums-popup__enter"><ums-icon id="icon-status-draft" modifier="sm"></ums-icon><div class="ums-popup__holder">Updated by: {{$ctrl.state.selectedPersonaGroup.updatedByUmbracoUsername}}</div></div><span ng-bind="$ctrl.state.selectedPersonaGroup.updatedByUmbracoUsername"></span></li></ul><br><div class="umsDescription" style="white-space: pre-line;" ng-bind="$ctrl.state.selectedPersonaGroup.description"></div><div class="ums-button__wrapper ums-button__wrapper--left"><button type="button" class="btn ums-button ums-button--icon ums-button--line" ng-click="$ctrl.fn.editPersonaGroup($ctrl.state.selectedPersonaGroup)"><span>Edit</span><ums-icon id="icon-edit" modifier="btn"></ums-icon></button></div></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3"><div data-as-sortable="$ctrl.dragControlListeners" data-ng-model="$ctrl.state.selectedPersonaGroup.personas" ng-if="$ctrl.state.selectedPersonaGroup.personas.length > 0"><div ng-repeat="personaItem in $ctrl.state.selectedPersonaGroup.personas | orderBy:\'title\'"><div class="ums-groupbox__container is-animated" data-as-sortable-item><div class="ums-groupbox__colorbar" ng-style="{\'background-color\': personaItem.color }"></div><div class="ums-groupbox__image"><img ng-if="personaItem.iconUrl" ng-src="{{ personaItem.iconUrl }}" alt></div><div class="ums-groupbox__text"><h3 class="umsHeading" ng-bind="personaItem.title"></h3><p ng-bind="personaItem.description" style="white-space: pre-line;"></p></div><div class="ums-groupbox__dragicon" ng-if="$ctrl.state.isDraggable" data-as-sortable-item-handle><span></span></div><div class="ums-groupbox__editicon ums-popup__enter" ng-click="$ctrl.fn.edit(personaItem, $ctrl.state.selectedPersonaGroup.personas)"><ums-icon id="icon-editbox" modifier="sm"></ums-icon><div class="ums-popup__holder">Edit persona</div></div></div></div></div><button class="ums-groupbox__container ums-groupbox__container--empty" type="button" ng-if="$ctrl.state.selectedPersonaGroup.personas.length < 1" ng-click="$ctrl.fn.addPersonaItem($ctrl.state.selectedPersonaGroup.personas, $ctrl.state.selectedPersonaGroup.personas.length)"><h2>It\'s empty here. Start by adding some persona\'s</h2><img src="/App_Plugins/Umbraco.Engage/assets/illustration-empty.svg" alt></button> <button class="ums-skeleton__button is-animated" type="button" ng-click="$ctrl.fn.addPersonaItem($ctrl.state.selectedPersonaGroup.personas, $ctrl.state.selectedPersonaGroup.personas.length)"><span>Add persona</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated umsPaddingTop umsPaddingBottom" ng-if="!$ctrl.state.isLoading && !$ctrl.state.selectedPersonaGroup || $ctrl.state.selectedPersonaGroup.length === 0"><div class="ums-testdetail__empty__container"><img src="/App_Plugins/Umbraco.Engage/assets/a-b-testing.svg" alt><br><h2>There are no persona groups. Start creating persona groups:</h2><button type="button" ng-click="$ctrl.fn.addPersonaGroup()" class="btn ums-button ums-button--icon ums-button--main"><span>Add new persona group</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div></div></div><ums-persona-group-editor ng-if="$ctrl.state.edit.personaGroup" persona-group="$ctrl.state.edit.personaGroup" close="$ctrl.fn.closeAddPersonaGroup()" remove="$ctrl.fn.removeGroup($ctrl.state.edit.personaGroup)" on-save="$ctrl.fn.applySavePersonaGroup()"></ums-persona-group-editor><ums-persona-editor ng-if="$ctrl.state.edit.persona.item" persona="$ctrl.state.edit.persona.item" close="$ctrl.fn.closeAddPersona()" remove="$ctrl.fn.removeItem()" on-save="$ctrl.fn.applyModifiedState()"></ums-persona-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" text="$ctrl.state.confirm.text" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay>',controller:["$timeout","umsPersonaApi","notificationsService",umsAnalyticsPersonaMainController],controllerAs:"$ctrl"};function umsPersonaResources($http){var BASE_URL="/umbraco/backoffice/engage/persona/";return{delete:function deletePersonaGroup(personaGroupId){return $http({method:"GET",url:BASE_URL+"delete?personaGroupId="+personaGroupId})},getAll:function getAll(){return $http({method:"GET",url:BASE_URL+"getAll"}).then(function(response){return response.data})},getDetails:function getDetails(personaGroupId){return $http({method:"GET",url:BASE_URL+"getDetails?personaGroupId="+personaGroupId})},save:function save(item){return $http({method:"POST",url:BASE_URL+"save",data:item})}}}angular.module("engage").component("umsPersonaMain",umsAnalyticsPersonaMainComponent);var umsPersonaApi=["$http",umsPersonaResources];function umsAppliedPersonalizationOverviewController(service,segmentService,notificationsService,contentTypeService,$q,$location,ruleRepo){var ctrl=this;this.$onInit=function(){var getAllPersonalizations=ctrl.fn.getAll.personalizations(),getAllSegments=ctrl.fn.getAll.segments(),getAllContentTypes=ctrl.fn.getAll.contentTypes(),getAllSegmentRules=ctrl.fn.getAll.segmentRules();$q.all([getAllPersonalizations,getAllSegments,getAllContentTypes,getAllSegmentRules]).then(function(){ctrl.state.loading=!1})},this.state={loading:!0,personalizations:[],segments:null,personalizationTypes:{0:{name:"Single Page"},1:{name:"Multiple Pages"},2:{name:"Document Type"}},pagePicker:{config:{multiPicker:!0},pages:null,culture:null},contentTypePicker:{contentTypes:[],culture:null},datepicker:{options:{enableTime:!0,dateFormat:"Y-m-d H:i"},date:null},anyPersonalizationWithoutSegment:!1,confirm:null,rulesByType:{}},this.fn={getAll:{personalizations:function(){return service.getAll().then(function(personalizations){return ctrl.state.personalizations=personalizations||[],ctrl.state.anyPersonalizationWithoutSegment=ctrl.fn.checkIfAnyPersonalizationWithoutSegment(personalizations),personalizations})},segments:function(){return segmentService.getAll().then(function(response){return ctrl.state.segments=response,response})},contentTypes:function(){contentTypeService.getAll().then(function(contentTypes){if(null!=contentTypes){ctrl.state.contentTypePicker.contentTypes=contentTypes.map(function(contentType){return{contentTypeId:contentType.id,name:contentType.name}}),ctrl.state.contentTypeNames={};for(var i=0;i<ctrl.state.contentTypePicker.contentTypes.length;i++){var contentType=ctrl.state.contentTypePicker.contentTypes[i];ctrl.state.contentTypeNames[contentType.contentTypeId]=contentType.name}}})},segmentRules:function(){var rules=ruleRepo.getRules();if(Array.isArray(rules))return ctrl.rulesByType={},$q.all(rules.map(function(rule){return ctrl.state.rulesByType[rule.type]=rule,rule.init()}))}},checkIfAnyPersonalizationWithoutSegment:function(personalizations){return personalizations.some(function(pers){return null===pers.segment})},getContentTypeName:function(id){return ctrl.state.contentTypePicker.contentTypes.find(function(type){return type.contentTypeId===id})},edit:function(personalization){if(0===personalization.type){var page=personalization.pages[0];if(null==page)return;var params={};page.culture&&(params.cculture=page.culture),params.csegment=personalization.umbracoSegmentAlias,$location.path("/content/content/edit/"+page.nodeId).search(params)}else $location.path("/engage/personalization/applied-personalization/create").search({id:personalization.id})},remove:function(personalization){ctrl.state.confirm={header:'Remove personalization "'+personalization.name+'"',fn:function confirmFn(){service.delete(personalization.id).then(function(){ctrl.fn.getAll.personalizations(),notificationsService.success('Personalization "'+personalization.name+'" deleted')})}}},onSetupPicker:function(picker,time){ctrl.state.timepicker.date=picker,ctrl.state.timepicker.date.setDate(time,!1)},onDatePickerChange:function(picker){var newDateToInsert=null;picker.selectedDates.length>0&&(newDateToInsert=picker.selectedDates[0]),ctrl.state.personalization.started=newDateToInsert},getPersonalizationsOfSegment:function(segmentId){return ctrl.state.personalizations.filter(function(personalization){return personalization.segmentId===segmentId})}}}function umsCampaignScoringEditorController(utils){var ctrl=this;this.$onInit=function(){ctrl.state.campaign=angular.copy(ctrl.campaign),ctrl.state.groups=ctrl.groups,ctrl.fn.checkSelectedCheckboxes(),ctrl.state.campaign.campaignGroupId&&(ctrl.state.prevGroupId=ctrl.state.campaign.campaignGroupId,ctrl.state.selectedGroup=ctrl.groupsObj[ctrl.state.campaign.campaignGroupId])},this.state={utmParams:[{key:"utmSource",display:"utm_source"},{key:"utmMedium",display:"utm_medium"},{key:"utmCampaign",display:"utm_campaign"},{key:"utmTerm",display:"utm_term"},{key:"utmContent",display:"utm_content"},{key:"utmSourcePlatform",display:"utm_source_platform"},{key:"utmCreativeFormat",display:"utm_creative_format"},{key:"utmMarketingTactic",display:"utm_marketing_tactic"}],amountOfCheckboxesFilled:0,campaign:null,selectedParams:{},groups:null,selectedGroup:null},this.fn={toggleParameter:function(parameterValue){!0!==ctrl.state.selectedParams[parameterValue.key]&&delete ctrl.state.selectedParams[parameterValue.key],ctrl.state.amountOfCheckboxesFilled=Object.keys(ctrl.state.selectedParams).length},checkSelectedCheckboxes:function(){Object.keys(ctrl.state.campaign).forEach(function(parameter){0===parameter.indexOf("utm")&&ctrl.state.campaign[parameter]&&(ctrl.state.selectedParams[parameter]=!0,ctrl.state.amountOfCheckboxesFilled++)})},setUncheckedParametersToNull:function(){Object.keys(ctrl.state.campaign).forEach(function(parameter){0===parameter.indexOf("utm")&&(ctrl.state.selectedParams[parameter]||(ctrl.state.campaign[parameter]=null))})},save:function(){ctrl.fn.setUncheckedParametersToNull(),ctrl.state.campaign.campaignGroupId=ctrl.state.selectedGroup.id,utils.merge(ctrl.campaign,ctrl.state.campaign),ctrl.onSave()}}}function umsCampaignScoringController(service){var ctrl=this;this.$onInit=function(){ctrl.fn.updateNumbers()},this.state={loading:!1,subFilter:0,groups:null,groupCount:0,scoredCount:0,unscoredCount:0,childComponent:null},this.fn={getAllGroups:function(){return service.getAll().then(function(response){return ctrl.state.groups=response,response})},getScoredCount:function(groups){var campaigns=[];return groups.forEach(function(group){group.campaigns&&group.campaigns.forEach(function(campaign){campaigns.push(campaign)})}),campaigns.length},getUnscoredCount:function(){return service.getUnscored().then(function(response){return ctrl.state.unscoredCount=response.length,response})},bindChildComponent:function(childComponent){ctrl.state.childComponent=childComponent},updateNumbers:function(){ctrl.fn.getAllGroups().then(function(response){ctrl.state.groupCount=response.length,ctrl.state.scoredCount=ctrl.fn.getScoredCount(response)}),ctrl.fn.getUnscoredCount()},groupsLoaded:function(groups){ctrl.state.groupCount=groups.length}}}function umsCampaignScoringServiceController($http){var endpoint="/umbraco/backoffice/engage/campaigngroup/";this.getAll=function getAll(){return $http.get(endpoint+"getAll").then(function(response){return response.data})},this.getVisitors=function getVisitors(amountOfDays){return $http.get(endpoint+"getcampaignvisitors?amountOfDays="+amountOfDays).then(function(response){return response.data})},this.getUnscored=function getUnscored(){return $http.get(endpoint+"getunscoredcampaigns").then(function(response){return response.data})},this.save=function saveGroup(group){return $http.post(endpoint+"save",group)},this.delete=function deleteGroup(groupId){return $http.post(endpoint+"delete?groupId="+groupId)}}function umsPersonalizationAppliedSegmentsInsightsController(){}function umsPersonalizationSegmentInsightsController(){}function umsReferralScoringController(scoredService,unscoredService){var ctrl=this;this.$onInit=function(){ctrl.fn.updateNumbers()},this.state={loading:!1,subFilter:0,referralGroupsLength:0,scoredReferralsLength:0,unscoredReferralsLength:0,childComponent:null,filter:{page:1,pageSize:20,totalPages:null,filteredReferralGroups:[]},pageSizes:[10,20,50,100]},this.fn={query:{page:1,pageSize:1,amountOfDays:30},getScoredReferralsLength:function(){scoredService.getAll(ctrl.fn.query).then(function(response){ctrl.state.scoredReferralsLength=response.totalRowCount})},getUnscoredReferralsLength:function(){unscoredService.getAll(ctrl.fn.query).then(function(response){ctrl.state.unscoredReferralsLength=response.totalRowCount})},bindChildComponent:function(childComponent){ctrl.state.childComponent=childComponent},updateNumbers:function(){ctrl.fn.getScoredReferralsLength(),ctrl.fn.getUnscoredReferralsLength()},referralGroupsLoaded:function(groups){ctrl.state.referralGroupsLength=groups.length}}}function umsPersonalizationScoring(utils,service,$q,notificationsService){var $ctrl=this;this.state={isLoading:!0,personaGroupScorings:[],customerJourneyScorings:[]};this.$onInit=function(){this.refresh()},this.refresh=function refresh(){this.state.isLoading=!0,service.getViewModel(utils.getCurrentContentId(),utils.getCurrentCulture()).then(function(data){$ctrl.state.personaGroupScorings=data.personaGroups,$ctrl.state.customerJourneyScorings=data.customerJourneys}).finally(function(){$ctrl.state.isLoading=!1})},this.save=function save(){var contentId=utils.getCurrentContentId();if(contentId){var culture=utils.getCurrentCulture(),personaScorings=function getAllPersonaScorings(){var scorings=[];return $ctrl.state.personaGroupScorings.forEach(function(group){Array.isArray(group.personas)&&group.personas.forEach(function(persona){scorings.push(persona.scoring)})}),scorings}(),customerJourneyScorings=function getAllCustomerJourneyStepScorings(){var scorings=[];return $ctrl.state.customerJourneyScorings.forEach(function(journey){Array.isArray(journey.steps)&&journey.steps.forEach(function(step){scorings.push(step.scoring)})}),scorings}();personaScorings.forEach(function(ps){ps.nodeId=ps.nodeId||contentId,ps.culture=ps.culture||culture}),customerJourneyScorings.forEach(function(cjs){cjs.nodeId=cjs.nodeId||contentId,cjs.culture=cjs.culture||culture});var savePersonas=service.savePersonaScorings(personaScorings).then(function(savedPersonaScorings){Array.isArray(savedPersonaScorings)&&Array.isArray($ctrl.state.personaGroupScorings)&&$ctrl.state.personaGroupScorings.forEach(function(personaGroup){Array.isArray(personaGroup.personas)&&personaGroup.personas.forEach(function(persona){var personaScoring=savedPersonaScorings.find(function(p){return p&&p.personaId===persona.id});personaScoring&&(persona.scoring=personaScoring)})})}),saveJourneys=service.saveCustomerJourneyStepScorings(customerJourneyScorings).then(function(savedCustomerJourneyScorings){Array.isArray(savedCustomerJourneyScorings)&&Array.isArray($ctrl.state.customerJourneyScorings)&&$ctrl.state.customerJourneyScorings.forEach(function(customerJourneyGroup){Array.isArray(customerJourneyGroup.steps)&&customerJourneyGroup.steps.forEach(function(customerJourneyStep){var customerJourneyScoring=savedCustomerJourneyScorings.find(function(cjs){return cjs&&cjs.customerJourneyStepId===customerJourneyStep.id});customerJourneyScoring&&(customerJourneyStep.scoring=customerJourneyScoring)})})});$q.all([savePersonas,saveJourneys]).then(function(){notificationsService.success("Scoring is saved")})}else notificationsService.error("Save your Umbraco content before saving your content score settings!")},this.saveCustomerJourneyStepScoring=function saveCustomerJourneyStepScoring(cjss){service.saveCustomerJourneyStepScoring(cjss)},this.savePersonaScoring=function savePersonaScoring(ps){service.savePersonaScoring(ps)}}function umsPersonalizationScoringService($http,$q,personaApi,customerJourneyApi){var endpoint="/umbraco/backoffice/engage/contentscoring/";function getAll(nodeId,culture){var deferred=$q.defer();return!nodeId||isNaN(nodeId)||nodeId<1e3?deferred.resolve([]):$http.get(endpoint+"getAll?nodeId="+nodeId+"&culture="+culture).then(function(response){deferred.resolve(response.data||[])}),deferred.promise}this.getAll=getAll,this.getViewModel=function getViewModel(nodeId,culture){var getPersonaGroups=personaApi.getAll(),getCustomerJourneys=customerJourneyApi.getAll(),getScorings=getAll(nodeId,culture);return $q.all([getPersonaGroups,getCustomerJourneys,getScorings]).then(function(results){var personaGroups=results[0],customerJourneys=results[1],scorings=results[2],personaScoringsById=_.reduce(scorings.persona,function(map,score){return map[score.personaId]=score,map},{}),customerJourneyStepScoringsById=_.reduce(scorings.customerJourneyStep,function(map,score){return map[score.customerJourneyStepId]=score,map},{}),personaGroupScorings=[];personaGroups.forEach(function(personaGroup){if(Array.isArray(personaGroup.personas))for(var i=0;i<personaGroup.personas.length;i++){var persona=personaGroup.personas[i];persona.scoring=personaScoringsById[persona.id]||{id:0,score:0,personaId:persona.id,culture:culture,nodeId:nodeId,created:new Date,updated:null}}personaGroupScorings.push(personaGroup)});var customerJourneyScorings=[];return customerJourneys.forEach(function(customerJourney){if(Array.isArray(customerJourney.steps))for(var i=0;i<customerJourney.steps.length;i++){var step=customerJourney.steps[i];step.scoring=customerJourneyStepScoringsById[step.id]||{id:0,score:0,customerJourneyStepId:step.id,culture:culture,nodeId:nodeId,created:new Date,updated:null}}customerJourneyScorings.push(customerJourney)}),{personaGroups:personaGroupScorings,customerJourneys:customerJourneyScorings}})},this.savePersonaScorings=function savePersonaScorings(ps){return $http.post(endpoint+"savePersonaScorings",ps).then(function(response){return response.data})},this.saveCustomerJourneyStepScorings=function saveCustomerJourneyStepScorings(cjss){return $http.post(endpoint+"saveCustomerJourneyStepScorings",cjss).then(function(response){return response.data})}}function umsProfileActivityController(service,$q){var ctrl=this;this.$onInit=function(){ctrl.fn.refresh()},ctrl.state={loading:!0,visitorId:null,sessions:[],profileInfo:null,pageviewsById:{},deviceTypeList:["","Desktop","Tablet","Mobile"],filter:{pageIndex:0,visitorId:0}},ctrl.fn={getData:{sessions:function(filter){return service.getSessionsOfVisitor(filter).then(function(response){return ctrl.state.sessions.length>0?ctrl.state.sessions=ctrl.state.sessions.concat(response.results):ctrl.state.sessions=response.results,response})},pageviewsById:function(id){return service.getPageviewsOfSession(id).then(function(response){return ctrl.state.pageviewsById[id]=response,response})}},refresh:function(){var filter={pageIndex:0,visitorId:null};if(ctrl.state.sessions=[],ctrl.state.loading=!0,ctrl.visitorId&&!ctrl.visitorIds)filter.visitorId=ctrl.visitorId,ctrl.fn.getData.sessions(filter).then(function(){ctrl.state.loading=!1});else if(!ctrl.visitorId&&ctrl.visitorIds){var getDataRequests=[];ctrl.visitorIds.forEach(function(id){filter.visitorId=id,getDataRequests.push(ctrl.fn.getData.sessions(filter))}),$q.all(getDataRequests).then(function(){ctrl.state.loading=!1})}else ctrl.state.loading=!1,ctrl.state.error="No visitor ID specified"},openPageviewRow:function(session){session.pageviewInfoVisible=!session.pageviewInfoVisible,ctrl.state.pageviewsById[session.id]||(ctrl.fn.getData.pageviewsById(session.id).then(function(response){response.length>0&&(session.ipAddress=response[0].ipAddress)}),this.refreshSessionLocation(session))},refreshSessionLocation:function(session){let location="";session.country&&(location+=session.country),session.province&&(location&&(location+=", "),location+=session.province),session.county&&(location&&(location+=", "),location+=session.county),session.city&&(location&&(location+=", "),location+=session.city),session.location=location},toDateTime:function(secs){var t=new Date(1970,0,1);return t.setSeconds(secs),t},slicedUrl:function(url){return url.split("/").slice(3).join("/")}}}function umsSegmentBuilderController(){var ctrl=this;this.$onInit=function(){ctrl.state.segment=angular.copy(ctrl.segment),(null==ctrl.state.segment.controlGroupSize||ctrl.state.segment.controlGroupSize<0)&&(ctrl.state.segment.controlGroupSize=.2),null!==ctrl.state.segment&&ctrl.state.segment.id&&(ctrl.state.controlGroupSliderOptions.readonly=!0,ctrl.state.controlGroupSliderOptions.disabled=!0)},this.state={segment:null,sliderOptions:{floor:0,ceil:10,translate:function(value){return isNaN(value)&&(value=0),value}},controlGroupSliderOptions:{floor:0,ceil:1,step:.01,precision:2,showSelectionBar:!0,translate:function(value){return isNaN(value)&&(value=0),Math.round(100*value)+"%"}},segmentTypeOptions:["Core","Temporary"],timepicker:{options:{altInput:!0,allowInput:!0,enableTime:!0,dateFormat:"YYYY-MM-DDTHH:mm:ss[Z]",altformat:"M d, Y h:mm a",time_24hr:!0},endTime:null}},this.fn={save:function(){ctrl.onSave&&ctrl.onSave({segment:ctrl.state.segment})},convertDate:function(date){return new Date(date)},onSetupPicker:function(picker,initDate){picker.element.placeholder="Select date...",ctrl.state.timepicker.endTime=picker,initDate&&ctrl.state.timepicker.endTime.setDate(ctrl.fn.convertDate(initDate),!1)},onTimePickerChange:function(picker){picker.selectedDates.length>0?ctrl.state.segment.endTime=picker.selectedDates[0]:(ctrl.state.segment.endTime=null,ctrl.state.segment.isTemporary=!1)}}}function umsSegementService($http){var endpoint="/umbraco/backoffice/engage/segment/";this.getAll=function getAll(amountOfDays){var url=endpoint+"getAll";return amountOfDays>0&&(url+="?amountOfDays="+amountOfDays),$http.get(url).then(function(response){return response.data})},this.getById=function getById(segmentId){return $http.get(endpoint+"getById?segmentId="+segmentId).then(function(response){return response.data})},this.save=function saveSegment(segment){return $http.post(endpoint+"save",segment)},this.delete=function deleteSegment(segmentId){return $http.post(endpoint+"delete?segmentId="+segmentId)}}function umsLicenseViewerController(umsPackageService,configurationService,$location){var self=this,state=this.state={isInitialized:!1,package:null,host:$location.host(),noLicenseForDomain:!1,almostExpired:!1,licenseState:null,configuration:null};this.$onInit=function(){umsPackageService.getStatus().then(function(packageStatus){state.package=packageStatus,self.packageInfo=packageStatus,self.setDomainLicenseStatus(),self.setLicenseState(),state.isInitialized=!0}),function getConfiguration(){return configurationService.getConfiguration().then(function(configuration){return state.configuration=configuration,configuration})}()},this.setLicenseState=function(){if(1===state.package.packageStatus&&state.package.isNearLimit)state.licenseState="warning";else switch(state.package.packageStatus){case 0:case 3:case 4:state.licenseState="corrupt";break;case 2:state.licenseState="expired";break;case 1:var expirationInDays=moment(state.package.expirationDate).diff(moment(),"days",!0);state.almostExpired=expirationInDays<=4,state.almostExpired?state.licenseState="warning":state.licenseState="active";break;case 5:state.licenseState="warning"}},this.setDomainLicenseStatus=function(){var domainIsExplicitlyListed=state.package.domains.some(function(domain){return domain===state.host}),domainIsWhitelistedByDefault=state.package.whitelistedDomainRegexes.some(function(regexStr){return new RegExp(regexStr).test(state.host)});state.noLicenseForDomain=!domainIsExplicitlyListed&&!domainIsWhitelistedByDefault}}function umsUiConfirmOverlayController(){var ctrl=this;this.$onInit=function(){ctrl.state.close=ctrl.close,ctrl.state.confirmYesAction=ctrl.confirmYesAction,ctrl.state.title=ctrl.title?ctrl.title:"Delete",ctrl.state.text=ctrl.text?ctrl.text:"Are you sure you want to delete?",ctrl.state.confirmYesText=ctrl.confirmYesText?ctrl.confirmYesText:"Yes, delete",ctrl.state.confirmNoText=ctrl.confirmNoText?ctrl.confirmNoText:"Cancel",ctrl.state.confirmNoAction=ctrl.confirmNoAction?ctrl.confirmNoAction:ctrl.close},this.state={close:null,title:null,text:null,confirmYesText:null,confirmYesAction:null,confirmNoText:null,confirmNoAction:null}}function umsAnalyticsGoalTypeEditorPageEventController(){var self=this;this.$onInit=function(){void 0===self.allRequired&&(self.allRequired=!0)}}angular.module("umbraco.resources").factory("umsPersonaApi",umsPersonaApi),angular.module("engage").component("umsAppliedPersonalizationOverview",{template:'<div class="ums-content umsPaddingBottom"><ums-screens no-nav="true"><ums-screen name="overview"><ums-loader ng-if="$ctrl.state.loading"></ums-loader><div class="ums-flexgrid__container ums-flexgrid__container--lg umsPaddingTop" ng-if="!$ctrl.state.edit"><div class="ums-flexgrid__item ums-flexgrid__item--1-4 is-animated"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/illustration-segment-builder.png" alt><br><h2>Applied Personalization</h2><p>In this section you have an overview of the personalization that is being used in your website. You have a quick overview of all the rules that personalizes your website experience and you have the option to setup a new personalization.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated" ng-if="!$ctrl.state.loading"><div class="ums-filter__container"><div class="ums-filter__row ums-filter__row--auto" style="margin-bottom: 0;"><div class="ums-filter__item" style="height: 40px;justify-content: flex-end;"><select class="ums-form__select" style="padding-top: 14px; padding-bottom: 14px;" disabled><option>Last 30 days</option></select></div></div><div class="ums-filter__row ums-filter__row--auto"><div class="ums-filter__item"><a href="#/engage/personalization/applied-personalization/create" class="btn ums-button ums-button--icon ums-button--main"><span>Apply new personalization</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></a></div></div></div><br><div class="is-animated"><table class="ums-table__table" ng-repeat="segment in $ctrl.state.segments | orderBy: [\'!isTemporary\', \'sortOrder\', \'name\']"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="3"><h3 class="umsFzLg"><span ng-bind="segment.name"></span> <span ng-if="segment.isTemporary">- Temporary segment</span> <span ng-if="!segment.isTemporary">- Core segment</span></h3><div class="ums-segmentinfo__parameter__container ums-segmentinfo__parameter__container--tight"><div ng-repeat="rule in segment.rules track by rule.type"><ums-segment-rule-display rule="$ctrl.state.rulesByType[rule.type]" negation="rule.isNegation" config="rule.config"></ums-segment-rule-display></div></div></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th" style="min-width: 400px;"><div class="umsLabel">Name and description</div></th><th class="ums-table__th"><div class="umsLabel">Type</div></th><th class="ums-table__th"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.fn.getPersonalizationsOfSegment(segment.id).length === 0"><td class="ums-table__td" colspan="3" style="text-align: center;"><span style="display: flex; flex-direction: column; align-items: center;"><span>No personalizations applied.</span></span></td></tr><tr class="ums-table__tr" ng-repeat="personalization in $ctrl.fn.getPersonalizationsOfSegment(segment.id) | orderBy: [\'isActive\', \'type\']" ng-class="{\'s-inactive\': !personalization.isActive}"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="personalization.name"></strong> <span ng-bind="personalization.description"></span> <span ng-if="personalization.started" style="margin-top: 10px;"><ums-icon id="icon-status-running" modifier="xs"></ums-icon><span style="margin-left: 5px; font-style: italic;">Scheduled date: {{personalization.started | date:\'longDate\'}}</span></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="$ctrl.state.personalizationTypes[personalization.type].name"></strong> <a ng-if="personalization.previewUrl" ng-href="{{personalization.previewUrl}}" target="_blank" class="ums-button ums-button--link ums-button--icon"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon><span style="margin-left: 5px" ng-if="personalization.type === 0 || personalization.type === 1"><span ng-bind="personalization.pages.length"></span> <span>page<span ng-if="personalization.pages.length !== 1">s</span></span></span> <span style="margin-left: 5px" ng-if="personalization.type === 2 && $ctrl.state.contentTypePicker.contentTypes.length > 0" ng-bind="$ctrl.fn.getContentTypeName(personalization.contentTypes[0].contentTypeId).name"></span></a></span></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(personalization)" on-delete-click="$ctrl.fn.remove(personalization)"></ums-ui-table-action-buttons></td></tr></tbody></table><table class="ums-table__table" ng-if="$ctrl.state.anyPersonalizationWithoutSegment"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="3"><h3 class="umsFzLg">Personalizations without segment</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Name and description</div></th><th class="ums-table__th"><div class="umsLabel">Type</div></th><th class="ums-table__th"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-repeat="personalization in $ctrl.state.personalizations | orderBy: [\'-isActive\', \'type\', \'created\'] | filter: {segment: null}" ng-class="{\'s-inactive\': !personalization.isActive}"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="personalization.name"></strong> <span ng-bind="personalization.description"></span> <span ng-if="personalization.started" style="margin-top: 10px;"><ums-icon id="icon-status-running" modifier="xs"></ums-icon><span style="margin-left: 5px; font-style: italic;">Scheduled date: {{personalization.started | date:\'longDate\'}}</span></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="$ctrl.state.personalizationTypes[personalization.type].name"></strong> <a ng-if="personalization.type === 1 || personalization.type === 2" ng-href="{{personalization.previewUrl}}" target="_blank" class="ums-button ums-button--link ums-button--icon"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon><span style="margin-left: 5px" ng-if="personalization.type === 1"><span ng-bind="personalization.pages.length"></span> <span>page<span ng-if="personalization.pages.length !== 1">s</span></span></span> <span style="margin-left: 5px" ng-if="personalization.type === 2 && $ctrl.state.contentTypePicker.contentTypes.length > 0" ng-bind="$ctrl.fn.getContentTypeName(personalization.contentTypes[0].contentTypeId).name"></span></a></span></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(personalization)" on-delete-click="$ctrl.fn.remove(personalization)"></ums-ui-table-action-buttons></td></tr></tbody></table></div><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay></div></div></ums-screen><ums-screen name="create"><ums-applied-personalization-create></ums-applied-personalization-create></ums-screen></ums-screens></div>',controller:["umsAppliedPersonalizationService","umsSegmentService","notificationsService","umsContentTypeService","$q","$location","umsSegmentRuleRepository",umsAppliedPersonalizationOverviewController]}),angular.module("engage").component("umsCampaignScoringEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2 ng-if="!$ctrl.campaign.id">Assign this campaign</h2><h2 ng-if="$ctrl.campaign.id">Edit this campaign</h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-score-unscored-editor-form" name="$ctrl.form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Assigns campaigns matching the following rules to a specific campaign group:</div></div><div class="ums-form__row ums-form__row--small" ng-repeat="param in $ctrl.state.utmParams"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox"><input ng-model="$ctrl.state.selectedParams[param.key]" type="checkbox" class="ums-form__radio__input" ng-change="$ctrl.fn.toggleParameter(param)" ng-disabled="!$ctrl.state.campaign[param.key]" ng-required="$ctrl.state.amountOfCheckboxesFilled === 0"> <span ng-bind="param.display" style="white-space: nowrap; min-width: 120px; display: inline-block"></span> <input ng-model="$ctrl.state.campaign[param.key]" ng-show="$ctrl.state.selectedParams[param.key]" ng-required="$ctrl.state.selectedParams[param.key]" class="ums-form__input" style="width: 200px; transition: opacity 0.2s ease;" disabled> <span style="margin-left: 10px;"></span></label></div><div class="ums-form__row" style="margin-top: 20px;"><label for="form-score-editor-group" class="ums-form__label">Assign to group *</label><select id="form-score-editor-group" class="ums-form__select" required ng-model="$ctrl.state.selectedGroup" ng-options="group as group.name for group in $ctrl.state.groups track by group.id"><option value>Select a group...</option></select></div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-score-unscored-editor-form" ng-click="$ctrl.state.formWasSaved = true" ng-disabled="$ctrl.isSaving" type="submit"><span ng-if="!$ctrl.campaign.id">Assign to group</span> <span ng-if="$ctrl.campaign.id">Update</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{campaign:"=",groups:"<",groupsObj:"<",close:"&",onSave:"&",isSaving:"<"},controller:["umsUtilService",umsCampaignScoringEditorController]}),angular.module("engage").component("umsCampaignScoring",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--1-4 is-animated"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/illustration-scoring.png" alt><br><h2>Campaign scoring</h2><p>In this section you can score campaigns, based on utm-parameters. You can group several campagains in a campaign group. The groups can be scored against your customer journeys and personas.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated"><div class="ums-filter__container"><div class="ums-filter__row ums-filter__row--auto" style="margin-bottom: 0;"><div class="ums-filter__item"><div class="ums-form__label ums-filter__label">Types</div><div class="ums-form__switch ums-form__switch--autosize"><input type="radio" name="subFilter" id="campaign-scoring-filter-0" no-dirty-check ng-model="$ctrl.state.subFilter" ng-value="0" class="ums-form__switch__input" required> <label for="campaign-scoring-filter-0" class="ums-form__switch__label ums-form__switch__label--lg">Campaign groups (<span ng-bind="$ctrl.state.groupCount"></span>)</label> <input type="radio" name="subFilter" id="campaign-scoring-filter-1" no-dirty-check ng-model="$ctrl.state.subFilter" ng-value="1" class="ums-form__switch__input" required> <label for="campaign-scoring-filter-1" class="ums-form__switch__label ums-form__switch__label--lg">Scored campaigns (<span ng-bind="$ctrl.state.scoredCount"></span>)</label> <input type="radio" name="subFilter" id="campaign-scoring-filter-2" no-dirty-check ng-model="$ctrl.state.subFilter" ng-value="2" class="ums-form__switch__input" required> <label for="campaign-scoring-filter-2" class="ums-form__switch__label ums-form__switch__label--lg">Unscored campaigns (<span ng-bind="$ctrl.state.unscoredCount"></span>)</label></div></div><div class="ums-filter__item" style="height: 40px;justify-content: flex-end;margin-left: 30px;"><select class="ums-form__select" style="padding-top: 14px; padding-bottom: 14px;" disabled><option>Last 30 days</option></select></div></div><div class="ums-filter__row ums-filter__row--auto"><div class="ums-filter__item"><button type="button" class="btn ums-button ums-button--icon ums-button--main" ng-if="$ctrl.state.subFilter === 0 && !$ctrl.state.loading" ng-click="$ctrl.state.childComponent.fn.addNewGroup()"><span>Add new group</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div><br><br><div><ums-campaign-groups-table ng-if="$ctrl.state.subFilter === 0 && !$ctrl.state.loading" bind-child="$ctrl.fn.bindChildComponent(ctrl)" is-loaded="$ctrl.fn.groupsLoaded" update="$ctrl.fn.updateNumbers"></ums-campaign-groups-table><ums-scored-campaigns-table ng-if="$ctrl.state.subFilter === 1 && !$ctrl.state.loading" update="$ctrl.fn.updateNumbers"></ums-scored-campaigns-table><ums-unscored-campaigns-table ng-if="$ctrl.state.subFilter === 2 && !$ctrl.state.loading" update="$ctrl.fn.updateNumbers"></ums-unscored-campaigns-table></div></div></div></div>',controller:["umsCampaignScoringService",umsCampaignScoringController]}),angular.module("engage").service("umsCampaignScoringService",["$http",umsCampaignScoringServiceController]),angular.module("engage").component("umsPersonalizationAppliedSegmentsInsights",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop"><h2 class="umsHeading">Render segment</h2><div style="display: flex;"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'appliedsegmentinsights\'"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table alias="\'appliedsegmentinsights\'" hide-columns="[0]"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',controller:["umsAppliedPersonalizationService",umsPersonalizationAppliedSegmentsInsightsController]}),angular.module("engage").component("umsPersonalizationInsight",{template:'<ums-screens class="as-third-nav"><ums-screen name="Segments"><ums-personalization-segment-insights></ums-personalization-segment-insights></ums-screen><ums-screen name="Applied segments"><ums-personalization-applied-segments-insights></ums-personalization-applied-segments-insights></ums-screen></ums-screens>'}),angular.module("engage").component("umsPersonalizationSegmentInsights",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content ums-datepicker__container umsPaddingTop"><h2 class="umsHeading">Segment insights</h2><div style="display: flex;"><ums-analytics-settings></ums-analytics-settings><ums-group-by-controls></ums-group-by-controls><ums-daterangepicker show-compare="true"></ums-daterangepicker></div></div><div class="ums-content is-animated"><ums-prefab-chart alias="\'segmentinsights\'"></ums-prefab-chart></div><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--3-4" style="margin-top: 0;"><ums-prefab-table alias="\'segmentinsights\'" hide-columns="[0]"></ums-prefab-table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4"></div></div></div></div>',controller:["umsSegmentService",umsPersonalizationSegmentInsightsController]}),angular.module("engage").component("umsReferralScoring",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container ums-flexgrid__container--lg"><div class="ums-flexgrid__item ums-flexgrid__item--1-4 is-animated"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/illustration-scoring.png" alt><br><h2>Referral scoring</h2><p>In this section you can score visitors that come to your website. You can group them in referral groups. The groups can be score against your customer journeys and personas.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated"><div class="ums-filter__container"><div class="ums-filter__row ums-filter__row--auto" style="margin-bottom: 0;"><div class="ums-filter__item"><div class="ums-form__label ums-filter__label">Referral types</div><div class="ums-form__switch ums-form__switch--autosize"><input type="radio" name="subFilter" id="referral-scoring-filter-0" ng-model="$ctrl.state.subFilter" ng-value="0" class="ums-form__switch__input" required> <label for="referral-scoring-filter-0" class="ums-form__switch__label ums-form__switch__label--lg">Referral groups (<span ng-bind="$ctrl.state.referralGroupsLength"></span>)</label> <input type="radio" name="subFilter" id="referral-scoring-filter-1" ng-model="$ctrl.state.subFilter" ng-value="1" class="ums-form__switch__input" required> <label for="referral-scoring-filter-1" class="ums-form__switch__label ums-form__switch__label--lg">Scored referrals (<span ng-bind="$ctrl.state.scoredReferralsLength"></span>)</label> <input type="radio" name="subFilter" id="referral-scoring-filter-2" ng-model="$ctrl.state.subFilter" ng-value="2" class="ums-form__switch__input" required> <label for="referral-scoring-filter-2" class="ums-form__switch__label ums-form__switch__label--lg">Unscored referrals (<span ng-bind="$ctrl.state.unscoredReferralsLength"></span>)</label></div></div><div class="ums-filter__item" style="height: 40px;justify-content: flex-end;margin-left: 30px;"><select class="ums-form__select" style="padding-top: 14px; padding-bottom: 14px;" disabled><option>Last 30 days</option></select></div></div><div class="ums-filter__row ums-filter__row--auto"><div class="ums-filter__item"><button type="button" class="btn ums-button ums-button--icon ums-button--main" ng-if="$ctrl.state.subFilter === 0 && !$ctrl.state.loading" ng-click="$ctrl.state.childComponent.fn.addNewGroup()"><span>Add new group</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></div></div></div><br><br><div><ums-referral-groups-table ng-if="$ctrl.state.subFilter === 0 && !$ctrl.state.loading" bind-child="$ctrl.fn.bindChildComponent(ctrl)" is-loaded="$ctrl.fn.referralGroupsLoaded" update="$ctrl.fn.updateNumbers"></ums-referral-groups-table><ums-scored-referrals-table ng-if="$ctrl.state.subFilter === 1 && !$ctrl.state.loading" update="$ctrl.fn.updateNumbers"></ums-scored-referrals-table><ums-unscored-referrals-table ng-if="$ctrl.state.subFilter === 2 && !$ctrl.state.loading" update="$ctrl.fn.updateNumbers"></ums-unscored-referrals-table></div></div></div></div>',controller:["umsScoredReferralsService","umsUnscoredReferralsService",umsReferralScoringController]}),angular.module("engage").component("umsPersonalizationScoring",{template:'<div class="umsPaddingTop umsPaddingBottom"><div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container ums-flexgrid__container--lg is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-flexgrid__item--lg-1-4"><img style="max-width: 100%;" src="/App_Plugins/Umbraco.Engage/assets/infotext-illustration-scoring.svg" alt><br><h2>How to score your content</h2><p>Here you can score this page against your persona groups and customer journey phases. Per persona and per customer step you can specify how relevant this page is. When a visitor visits this page these scores are added to the implicit scoring of this visitor.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3 ums-flexgrid__item--lg-3-4" ng-if="$ctrl.state.isLoading">Loading ...</div><div class="ums-flexgrid__item ums-flexgrid__item--2-3 ums-flexgrid__item--lg-3-4" ng-if="!$ctrl.state.isLoading"><form id="ums-score-personalization-editor-form" ng-submit="$ctrl.form.$valid && $ctrl.save()" name="$ctrl.form" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-divider__container is-animated" style="margin-top: 0;"><div class="ums-divider__title"><ums-icon id="icon-persona" modifier="md"></ums-icon><span>Available persona groups</span></div><div class="ums-divider__line"></div></div><br><div ng-if="!$ctrl.state.isLoading && !$ctrl.state.personaGroupScorings || !$ctrl.state.isLoading && $ctrl.state.personaGroupScorings.length < 1" class="rte"><span>There are no personas configured. Please <a href="/umbraco/#/engage/personalization/personas">configure these first</a>, before scoring this page.</span></div><div ng-if="!$ctrl.state.isLoading && $ctrl.state.personaGroupScorings.length > 0 && $ctrl.state.personaGroupScorings[0].personas.length < 1" class="rte"><span>You have no personas configured. You should <a href="/umbraco/#/engage/personalization/personas">add these personas first</a>, before you can score this page.</span></div><div ng-repeat="personalizationScoringTable in $ctrl.state.personaGroupScorings track by personalizationScoringTable.id" ng-if="personalizationScoringTable.personas.length > 0"><ums-personalization-scoring-table table-data="personalizationScoringTable.personas" limit="personalizationScoringTable.upperScoreLimit" name="personalizationScoringTable.title" label="Persona"></ums-personalization-scoring-table><br></div><div class="ums-divider__container"><div class="ums-divider__title"><ums-icon id="icon-journey" modifier="md"></ums-icon><span>Available journeys</span></div><div class="ums-divider__line"></div></div><br><div ng-if="!$ctrl.state.isLoading && !$ctrl.state.customerJourneyScorings || !$ctrl.state.isLoading && $ctrl.state.customerJourneyScorings.length < 1" class="rte"><span>There are no journeys configured. Please <a href="/umbraco/#/engage/personalization/journeys">configure these first</a>, before scoring this page.</span></div><div ng-if="!$ctrl.state.isLoading && $ctrl.state.customerJourneyScorings.length > 0 && $ctrl.state.customerJourneyScorings[0].steps.length < 1" class="rte"><span>You have no customer journey steps configured. You should <a href="/umbraco/#/engage/personalization/journeys">add these journey steps first</a>, before you can score this page.</span></div><div ng-repeat="personalizationScoringTable in $ctrl.state.customerJourneyScorings" ng-if="personalizationScoringTable.steps.length > 0"><ums-personalization-scoring-table table-data="personalizationScoringTable.steps" limit="personalizationScoringTable.upperScoreLimit" name="personalizationScoringTable.title" label="Journey"></ums-personalization-scoring-table><br></div></form></div></div><div class="ums-savebar__container"><button class="ums-button ums-button--success" form="ums-score-personalization-editor-form" ng-click="$ctrl.state.formWasSaved = true" type="submit"><span>Save scoring</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button></div></div></div>',controller:["umsUtilService","umsPersonalizationScoringService","$q","notificationsService",umsPersonalizationScoring]}),angular.module("engage").service("umsPersonalizationScoringService",["$http","$q","umsPersonaApi","umsCustomerJourneyApi",umsPersonalizationScoringService]),angular.module("engage").service("umsProfileIdentificationHelper",["$interpolate","umsConfigurationService",function umsProfileIdentificationHelper($interpolate,configService){var configPromise=configService.getConfiguration();this.getMemberIdentification=function getIdentification(memberObject){return configPromise.then(function(config){var name,abbreviation;if(null!=memberObject&&memberObject._userCanAccessMember){var nameTemplate=config.profiles.identification.name,abbreviationTemplate=config.profiles.identification.abbreviation;name=$interpolate(nameTemplate)(memberObject),abbreviation=$interpolate(abbreviationTemplate)(memberObject)}else name="Identified",abbreviation="I";return{name:name,abbreviation:abbreviation}})}}]),angular.module("engage").service("umsProfileInfoService",["$http","$httpParamSerializer","$q","umsProfileIdentificationHelper",function umsProfileInfoServiceController($http,$httpParamSerializer,$q,memberIdentificationHelper){var endpoint="/umbraco/backoffice/engage/profile/";this.getProfiles=function getProfiles(filter){return $http.get(endpoint+"find?"+$httpParamSerializer(filter)).then(function(response){var identificationPromises=(response.data.results||[]).map(function(profile){var members=profile.members||[];return $q.all(members.map(function(member){return memberIdentificationHelper.getMemberIdentification(member).then(function(identification){return angular.extend(member,identification)})})).then(function(identifiedMembers){return profile.members=identifiedMembers,profile.name=identifiedMembers.length>0?identifiedMembers[identifiedMembers.length-1].name:"Identified",profile})});return $q.all(identificationPromises).then(function(identifiedProfiles){return response.data.results=identifiedProfiles,response.data})})},this.getBotNames=function getBotNames(filter){return $http.get(endpoint+"botvisitors?"+$httpParamSerializer(filter)).then(function(response){return response.data})},this.getSessionsOfVisitor=function getSessionsOfVisitor(filter){return $http.get(endpoint+"sessions?"+$httpParamSerializer(filter)).then(function(response){return response.data})},this.getGoalCompletionsOfVisitor=function getGoalCompletionsOfVisitor(visitorId){return $http.get(endpoint+"goalcompletions?visitorid="+visitorId).then(function(response){return response.data})},this.getPageviewsOfSession=function getPageviewsOfSession(sessionId){return $http.get(endpoint+"pageviews?sessionId="+sessionId).then(function(response){return response.data})},this.getEventsOfPageview=function getEventsOfPageview(pageviewId){return $http.get(endpoint+"pageEvents?pageviewid="+pageviewId).then(function(response){return response.data})},this.getPersonaScoreOfVisitor=function getPersonaScoreOfVisitor(visitorId){return $http.get(endpoint+"personascores?visitorId="+visitorId).then(function(response){return response.data})},this.getCustomerJourneyScoreOfVisitor=function getCustomerJourneyScoreOfVisitor(visitorId){return $http.get(endpoint+"customerJourneyStepScores?visitorId="+visitorId).then(function(response){return response.data})},this.getProfileTotals=function getProfileTotals(){return $http.get(endpoint+"totalStatistics").then(function(response){return response.data})},this.getProfileIdentificationStatistics=function getProfileIdentificationStatistics(filter){return $http.get(endpoint+"identificationStatistics?"+$httpParamSerializer(filter)).then(function(response){return response.data})},this.getProfileGrowth=function getProfileGrowth(months){return $http.get(endpoint+"growthStatistics?numberOfMonths="+months).then(function(response){return response.data})},this.getProfilePotential=function getProfilePotential(visitorId){return $http.get(endpoint+"potential?visitorId="+visitorId).then(function(response){return response.data})},this.getLastActiveProfileSegments=function getLastActiveProfileSegments(visitorId){return $http.get(endpoint+"lastactivesegments?visitorId="+visitorId).then(function(response){return response.data})},this.getRelatedProfiles=function getRelatedProfiles(memberId){return $http.get(endpoint+"relatedprofiles?memberId="+memberId).then(function(response){return response.data})},this.generateExcelExportUrl=function generateExcelExportUrl(filter){return endpoint+"excelexport?"+$httpParamSerializer(filter)}}]),angular.module("engage").component("umsProfileActivity",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><ums-loader ng-if="$ctrl.state.loading"></ums-loader><div class="ums-flexgrid__container" ng-if="!$ctrl.state.loading"><div class="ums-flexgrid__item ums-flexgrid__item--1-2 ums-flexgrid__item--lg-1-4 is-animated"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-1" style="margin-top: 0;"><ums-profile-member ng-if="$ctrl.visitorId" visitor-type="$ctrl.visitorType" show-members="$ctrl.showMembers" show-related-profiles="$ctrl.showRelatedProfiles" visitor-id="$ctrl.visitorId"></ums-profile-member><ums-profile-member ng-if="$ctrl.visitorIds" visitor-type="$ctrl.visitorType" show-members="$ctrl.showMembers" show-related-profiles="$ctrl.showRelatedProfiles" visitor-ids="$ctrl.visitorIds"></ums-profile-member></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 ums-flexgrid__item--lg-3-4 is-animated"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item" style="margin-top: 0;"><table class="ums-table__table ums-table__table--boxed ums-table__table--no-minwidth ums-table__table--profile-activity"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="13"><h4 class="h3 umsHeading">Activity Tracker</h4></td></tr><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th ums-profile__table-type-holder ums-profile__table-type-holder--full"><div class="umsLabel">Session</div></th><th class="ums-table__th"><div class="umsLabel">Date</div></th><th class="ums-table__th"><div class="umsLabel">Time</div></th><th class="ums-table__th"><div class="umsLabel">Device type</div></th><th class="ums-table__th"><div class="umsLabel">Pages</div></th><th class="ums-table__th"><div class="umsLabel">Session Duration</div></th><th class="ums-table__th"><div class="umsLabel">Engaged Time</div></th><th class="ums-table__th"><div class="umsLabel">Goals</div></th><th class="ums-table__th"><div class="umsLabel">Events</div></th><th class="ums-table__th"><div class="umsLabel">Inbound URL</div></th><th class="ums-table__th"><div class="umsLabel">Source</div></th><th class="ums-table__th"></th></tr></thead><tbody class="is-animated" ng-if="$ctrl.state.loading"><tr class="ums-table__tr ums-table__tr--wide"><td class="ums-table__td" colspan="12">Loading ...</td></tr></tbody><tbody class="is-animated" ng-if="!$ctrl.state.loading && $ctrl.state.sessions.length === 0"><tr class="ums-table__tr ums-table__tr--wide"><td class="ums-table__td" colspan="12">There is no activity tracked for this member.</td></tr></tbody><tbody class="is-animated" ng-if="!$ctrl.state.loading && $ctrl.state.sessions.length > 0" ng-repeat="session in $ctrl.state.sessions | orderBy: [\'-startDate\']"><tr class="ums-table__tr ums-table__tr--wide ums-table__tr--toggle" ng-class="{\'s-open\': session.pageviewInfoVisible}" ng-click="$ctrl.fn.openPageviewRow(session)"><td class="ums-table__td ums-profile__table-type-holder ums-profile__table-type-holder--full ums-profile__line-parent ums-profile__line-parent--bottom"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': session.wasAbTested || session.wasPersonalized}"></span> <span class="ums-profile__type-holder"><span class="ums-profile__type-indicator s-large" ng-class="{\'s-active-light\': session.wasAbTested && !session.pageviewInfoVisible || session.wasPersonalized && !session.pageviewInfoVisible, \'s-active\': session.wasAbTested && session.pageviewInfoVisible || session.wasPersonalized && session.pageviewInfoVisible}"><ums-icon id="icon-logo" modifier="btn"></ums-icon></span></span></td><td class="ums-table__td ums-table__td--nowrap">{{session.startDate | date: \'dd-MM-yyyy\'}}</td><td class="ums-table__td">{{session.startDate | date: \'HH:mm\'}}</td><td class="ums-table__td"><span ng-if="!session.deviceType">-</span> <span ng-if="session.deviceType" ng-bind="$ctrl.state.deviceTypeList[session.deviceType]"></span></td><td class="ums-table__td" ng-bind="session.pageviewCount"></td><td class="ums-table__td"><span ng-if="!session.sessionDurationInSeconds">-</span> <span ng-if="session.sessionDurationInSeconds">{{$ctrl.fn.toDateTime(session.sessionDurationInSeconds) | date:"HH:mm:ss"}}</span></td><td class="ums-table__td"><span ng-if="!session.engagedTimeInSeconds">-</span> <span ng-if="session.engagedTimeInSeconds">{{$ctrl.fn.toDateTime(session.engagedTimeInSeconds) | date:"HH:mm:ss"}}</span></td><td class="ums-table__td" ng-bind="session.goalCompletionCount">0</td><td class="ums-table__td" ng-bind="session.eventCount">4</td><td class="ums-table__td"><span class="ums-popup__enter" style="display: flex; align-items: center;"><span>/{{ $ctrl.fn.slicedUrl(session.inboundUrl) | limitTo:35 }}</span> <span ng-show="$ctrl.fn.slicedUrl(session.inboundUrl).length > 35">...</span><div class="ums-popup__holder ums-popup__holder--break ums-popup__holder--offset is-animated"><span>Inbound URL: {{session.inboundUrl}}</span></div><a ng-href="{{session.inboundUrl}}" target="_blank" title="Go to \'{{session.inboundUrl}}\'" class="ums-button ums-button--table ums-button--transparent"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></span></td><td class="ums-table__td"><span ng-if="!session.referrerUrl">Direct</span> <span ng-if="session.referrerUrl" class="ums-popup__enter" style="display: flex; align-items: center;"><span>{{ session.referrerUrl | limitTo:15 }}</span> <span ng-show="session.referrerUrl.length > 15">...</span><div class="ums-popup__holder ums-popup__holder--break ums-popup__holder--offset is-animated"><span>Source: {{session.referrerUrl}}</span></div><a ng-href="{{session.referrerUrl}}" target="_blank" title="Go to \'{{session.referrerUrl}}\'" class="ums-button ums-button--table ums-button--transparent"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></span></td><td class="ums-table__td ums-table__td--nowrap ums-table__td--right"><button class="ums-button ums-button--link-lighter ums-button--icon" type="button"><span ng-show="!session.pageviewInfoVisible">More info</span><ums-icon ng-show="!session.pageviewInfoVisible" id="icon-toggle" modifier="sm"></ums-icon><span ng-show="session.pageviewInfoVisible">Less info</span><ums-icon ng-show="session.pageviewInfoVisible" id="icon-toggle" modifier="sm" css-class="ums-icon--flip-y"></ums-icon></button></td></tr><tr ng-show="session.pageviewInfoVisible"><td colspan="12" class="ums-table__table--nested__parent"><ums-profile-activity-table-pageviews session="session" pageviews-by-id="$ctrl.state.pageviewsById"></ums-profile-activity-table-pageviews></td></tr></tbody></table></div></div></div></div></div>',bindings:{visitorId:"<?",visitorIds:"<?",visitorType:"<",showMembers:"<?",showRelatedProfiles:"<?"},controller:["umsProfileInfoService","$q",umsProfileActivityController]}),angular.module("engage").component("umsProfileCommerce",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><ums-loader ng-if="$ctrl.state.loading"></ums-loader><div class="ums-flexgrid__container" ng-if="!$ctrl.state.loading"><div class="ums-flexgrid__item ums-flexgrid__item--1-4 is-animated"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-1" style="margin-top: 0;"><ums-profile-member ng-if="$ctrl.state.visitorId" visitor-id="$ctrl.state.visitorId" visitor-type="$ctrl.visitorType" show-members="$ctrl.showMembers"></ums-profile-member></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-2" ng-if="!$ctrl.visitorType" style="margin-top: 0;"><ums-profile-commerce-orders visitor-id="$ctrl.state.visitorId"></ums-profile-commerce-orders></div></div></div></div></div>',bindings:{visitorId:"<",visitorType:"<",showMembers:"<?"},controller:[function umsProfileCommerceController(){var ctrl=this;this.$onInit=function(){ctrl.state.visitorId=ctrl.visitorId},ctrl.state={loading:!1,visitorId:null}}]}),angular.module("engage").component("umsProfileExternalData",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated" data-custom-component-container></div></div></div>',bindings:{visitorId:"<",customComponent:"<"},controller:["$scope","$compile","$element",function umsProfileExternalDataController($scope,$compile,$element){var $ctrl=this;this.$customComponentContainer=null,this.$onInit=function(){$ctrl.$customComponentContainer=$element.find("[data-custom-component-container]"),function renderCustomComponent(){if(null==$ctrl.customComponent)return;var template="<"+$ctrl.customComponent+' visitor-id="$ctrl.visitorId"></'+$ctrl.customComponent+">",compiled=$compile(template)($scope);$ctrl.$customComponentContainer.append(compiled)}()}}]}),angular.module("engage").component("umsProfileInsights",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><ums-loader ng-if="$ctrl.state.loading"></ums-loader><div class="ums-flexgrid__container" ng-if="!$ctrl.state.loading"><div class="ums-flexgrid__item ums-flexgrid__item--1-4 is-animated"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-1" style="margin-top: 0;"><ums-profile-member ng-if="$ctrl.state.visitorId" visitor-id="$ctrl.state.visitorId" visitor-type="$ctrl.visitorType" show-members="$ctrl.showMembers"></ums-profile-member></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1" ng-if="!$ctrl.visitorType"><table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td"><h3 class="umsFzLg">Profile potential</h3></td></tr></thead><tbody class="ums-table__tbody ums-table__tbody--split"><tr><td class="ums-table__td" style="border-top: 0; overflow: hidden;"><ums-graph-profile-potential visitor-id="$ctrl.state.visitorId"></ums-graph-profile-potential></td></tr></tbody></table></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--3-4 is-animated"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-2" ng-if="!$ctrl.visitorType" style="margin-top: 0;"><ums-profile-goal-completions visitor-id="$ctrl.state.visitorId"></ums-profile-goal-completions></div><div class="ums-flexgrid__item ums-flexgrid__item--1-2" ng-if="!$ctrl.visitorType" style="margin-top: 0;"><ums-profile-campaigns visitor-id="$ctrl.state.visitorId"></ums-profile-campaigns></div><div class="ums-flexgrid__item ums-flexgrid__item--1-2" ng-if="!$ctrl.visitorType"><ums-umbraco-forms-submissions visitor-id="$ctrl.state.visitorId"></ums-umbraco-forms-submissions></div><div class="ums-flexgrid__item ums-flexgrid__item--1-2" ng-if="!$ctrl.visitorType"><ums-profile-search-terms visitor-id="$ctrl.state.visitorId"></ums-profile-search-terms></div><div class="ums-flexgrid__item ums-flexgrid__item--1-2" ng-if="$ctrl.state.featurePersonalizationEnabled && !$ctrl.visitorType"><ums-profile-active-segments visitor-id="$ctrl.visitorId"></ums-profile-active-segments></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1" ng-if="$ctrl.state.featurePersonalizationEnabled && !$ctrl.visitorType"><ums-profile-personas visitor-id="$ctrl.visitorId"></ums-profile-personas></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1" ng-if="$ctrl.state.featurePersonalizationEnabled && !$ctrl.visitorType"><ums-profile-journeys visitor-id="$ctrl.visitorId"></ums-profile-journeys></div></div></div></div></div>',bindings:{visitorId:"<",visitorType:"<",showMembers:"<?"},controller:["umsProfileInfoService","$q","umsPackageState",function umsProfileInsightsController(service,$q,packageState){var ctrl=this;this.$onInit=function(){ctrl.state.visitorId=ctrl.visitorId,packageState.loadState.then(function(state){ctrl.state.featurePersonalizationEnabled=state.featurePersonalizationEnabled}),ctrl.state.loading=!1},ctrl.state={loading:!0,visitorId:null,featurePersonalizationEnabled:!0}}]}),angular.module("engage").component("umsProfileOverview",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div class="ums-flexgrid__container is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--1-3"><table class="ums-table__table ums-table__table--fullheight"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td"><h3 class="umsFzLg">Total profiles</h3></td></tr></thead><tbody class="ums-table__tbody"><tr><td><ums-graph-profile-donut ng-if="!$ctrl.state.loading.totalStatistics && $ctrl.state.graphData.totalStatistics.length > 0" chart-data="$ctrl.state.graphData.totalStatistics"></ums-graph-profile-donut></td></tr></tbody></table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3"><table class="ums-table__table ums-table__table--fullheight"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td"><h3 class="umsFzLg">New profiles</h3></td><td class="ums-table__td"><div class="ums-table__flap-label-holder"><div class="ums-table__flap-label-item"><select class="ums-form__select ums-table__flap-label-text ums-table__flap-label-select" disabled><option selected>Last 30 days</option></select></div></div></td></tr></thead><tbody class="ums-table__tbody"><tr><td colspan="2"><ums-graph-profile-donut ng-if="!$ctrl.state.loading.identificationStatistics && $ctrl.state.graphData.identificationStatistics.length > 0" chart-data="$ctrl.state.graphData.identificationStatistics"></ums-graph-profile-donut></td></tr></tbody></table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3"><table class="ums-table__table ums-table__table--fullheight"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td"><h3 class="umsFzLg">Profile growth</h3></td><td class="ums-table__td"><div class="ums-table__flap-label-holder"><div class="ums-table__flap-label-item"><select class="ums-form__select ums-table__flap-label-text ums-table__flap-label-select" disabled><option selected>Last year</option></select></div></div></td></tr></thead><tbody class="ums-table__tbody"><tr><td colspan="2"><ums-graph-profile-growth ng-if="!$ctrl.state.loading.profileGrowth && $ctrl.state.graphData.profileGrowth" chart-data="$ctrl.state.graphData.profileGrowth"></ums-graph-profile-growth></td></tr></tbody></table></div><div class="ums-flexgrid__item ums-flexgrid__item--lg-3-4"><table class="ums-table__table ums-table__table--no-minwidth ums-table__table--boxed"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="7"><h4 class="h3 umsHeading">Profiles</h4></td><td class="ums-table__td"><div class="ums-table__flap-label-holder"><div class="ums-table__flap-label-item"><a class="ums-table__flap-label-text ums-table__flap-label-button s-active" ng-href="{{$ctrl.excelExportUrl}}" target="_blank" download="profile-export.ods"><span>Export</span><ums-icon id="icon-export" modifier="sm"></ums-icon></a> <button class="ums-table__flap-label-text ums-table__flap-label-button" ng-class="{\'s-active\': $ctrl.state.activeFilters && !$ctrl.state.filtersVisible}" ng-click="$ctrl.state.filtersVisible = !$ctrl.state.filtersVisible"><span ng-if="!$ctrl.state.filtersVisible">Filter</span><ums-icon ng-if="!$ctrl.state.filtersVisible" id="icon-filter" modifier="sm"></ums-icon><span ng-if="$ctrl.state.filtersVisible">Close filter</span><ums-icon ng-if="$ctrl.state.filtersVisible" id="icon-close" modifier="sm"></ums-icon></button><div class="ums-table__flap-label-badge" ng-if="$ctrl.state.activeFilters && !$ctrl.state.filtersVisible"><span ng-bind="$ctrl.state.activeFilters"></span></div></div></div></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.filtersVisible"><td class="ums-table__td" colspan="8" style="border-top: 0;"><div class="ums-filter__container"><div class="ums-filter__row ums-profile-filter__checkbox-row"><div class="ums-form__label ums-filter__label ums-profile-filter__label">Include profiles</div><label class="ums-form__checkbox__label" for="input-filter--01"><input id="input-filter--01" class="ums-form__checkbox__input" type="checkbox" ng-model="$ctrl.state.filter.isAnonymous">Anonymous</label> <label class="ums-form__checkbox__label" for="input-filter--02"><input id="input-filter--02" class="ums-form__checkbox__input" type="checkbox" ng-model="$ctrl.state.filter.isIdentified">Identified</label> <label class="ums-form__checkbox__label" for="input-filter--03"><input id="input-filter--03" class="ums-form__checkbox__input" type="checkbox" ng-model="$ctrl.state.filter.isHighPotential">High potential</label></div><div class="ums-filter__row ums-profile-filter__tiny-input-holder"><div class="ums-form__label ums-filter__label ums-profile-filter__label">Number of goals</div><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker" style="max-height: 40px;"><span class="ums-form__input-icon">More than</span> <input type="number" class="ums-form__input" ng-model="$ctrl.state.filter.completedGoals" placeholder="0" style="flex: 1; border-left: 0 !important;"></div></div><div class="ums-filter__row ums-profile-filter__tiny-input-holder"><div class="ums-form__label ums-filter__label ums-profile-filter__label">Total value</div><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker" style="max-height: 40px;"><span class="ums-form__input-icon">More than</span> <input type="number" class="ums-form__input" ng-model="$ctrl.state.filter.goalValue" placeholder="0" style="flex: 1; border-left: 0 !important;"></div></div></div><div class="ums-filter__container" style="margin-top: 6px;"><div class="ums-filter__row" style="flex:0"><div class="ums-form__label ums-filter__label ums-profile-filter__label">Profiles that visited the website during this timeframe</div><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker ums-profile-filter__datepicker" style="max-height: 40px;"><ums-daterangepicker service="$ctrl.dateRangePickerService" no-shadow="true" align-left="true"></ums-daterangepicker></div></div><div class="ums-filter__row" style="margin-right:auto"><div class="ums-form__label ums-filter__label ums-profile-filter__label">Filter by segment</div><select name="scoringPageSize" id="scoringPageSize" style="width:100%;height:39px;font-size:13px;" ng-model="$ctrl.state.filter.segmentId" ng-options="s.id as s.name for s in $ctrl.state.segments"><option value>None</option></select></div><div class="ums-filter__row ums-profile-filter__tiny-input-holder"><div class="ums-form__label ums-filter__label ums-profile-filter__label">Filter by Member Name</div><div class="ums-segmentparameter__input" style="max-height: 40px;"><input type="text" class="ums-form__input" ng-model="$ctrl.state.filter.identifiedName" placeholder="Name"></div></div><div class="ums-filter__row" style="flex: 0; align-content: flex-end;padding-bottom:10px"><button class="btn ums-button ums-button--main ums-button--icon" type="button" ng-click="$ctrl.fn.getData.profiles($ctrl.state.filter)"><span>Filter</span><ums-icon id="icon-filter" modifier="btn"></ums-icon></button></div></div></td></tr><tr class="ums-table__tr ums-table__tr--labels" colspan="8"><th class="ums-table__th"><div class="umsLabel">Type</div></th><th class="ums-table__th ums-table__th--xxs"><div class="umsLabel">Sessions</div></th><th class="ums-table__th ums-table__th--xxs"><div class="umsLabel">Pageviews</div></th><th class="ums-table__th"><div class="umsLabel">First session</div></th><th class="ums-table__th s-sorting"><div class="umsLabel ums-table__sort-indicator" style="cursor: not-allowed"><span>Last session</span><ums-icon id="icon-chevron" modifier="xxs" css-class="ums-icon--rotate-180"></ums-icon></div></th><th class="ums-table__th ums-table__th--xxs"><div class="umsLabel">Goals</div></th><th class="ums-table__th" colspan="2"><div class="umsLabel">Total value</div></th></tr></thead><tbody ng-if="$ctrl.state.loading.profileOverview"><tr class="ums-table__tr ums-table__tr--wide"><td class="ums-table__td" colspan="8"><img src="/umbraco/lib/tinymce/skins/lightgray/img/loader.gif" alt="Loading"> <span style="margin-left: 10px;">Loading profiles...</span></td></tr></tbody><tbody ng-if="!$ctrl.state.loading.profileOverview && $ctrl.state.profiles.length === 0"><tr class="ums-table__tr ums-table__tr--wide"><td class="ums-table__td" colspan="8">No profiles found.</td></tr></tbody><tbody ng-if="!$ctrl.state.loading.profileOverview && $ctrl.state.profiles.length > 0" ng-repeat="profile in $ctrl.state.profiles"><tr class="ums-table__tr ums-table__tr--wide"><td class="ums-table__td"><span class="ums-profile__type-holder"><div class="ums-profile__type-indicator ums-profile__type-indicator--left s-large ums-popup__enter" ng-class="{\'s-active-light\': profile.hasParticipatedInAbTest || profile.hasViewedPersonalizedPage }"><ums-icon ng-if="profile.isIdentified" id="icon-user-identified" modifier="btn"></ums-icon><ums-icon ng-if="!profile.isIdentified" id="icon-user-unidentified" modifier="btn"></ums-icon><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace ums-popup__holder--large is-animated" ng-if="profile.hasParticipatedInAbTest || profile.hasViewedPersonalizedPage"><span ng-if="profile.hasParticipatedInAbTest">Participated in A/B test<br></span><br ng-if="profile.hasParticipatedInAbTest && profile.hasViewedPersonalizedPage"><span ng-if="profile.hasViewedPersonalizedPage">Viewed personalized page</span></div></div><span ng-show="profile.isIdentified" style="white-space: nowrap;"><span ng-bind="profile.name | limitTo:15"></span> <span ng-show="profile.name.length > 15">...</span></span> <span ng-show="!profile.isIdentified">Anonymous</span></span></td><td class="ums-table__td" ng-bind="profile.sessionCount"></td><td class="ums-table__td" ng-bind="profile.pageviewCount"></td><td class="ums-table__td" ng-bind="profile.firstSessionDate | date: \'MMM d, yyyy HH:mm\'"></td><td class="ums-table__td" ng-bind="profile.lastSessionDate | date: \'MMM d, yyyy HH:mm\'"></td><td class="ums-table__td" ng-bind="profile.totalGoalCompletions"></td><td class="ums-table__td" ng-bind="profile.totalGoalValue"></td><td class="ums-table__td ums-table__td--right"><a ng-click="$ctrl.sharedId = profile.visitorId" ng-href="{{\'#/engage/profiles/profiles/insights?id=\' + profile.visitorId}}" class="ums-button ums-button--link-lighter ums-button--icon"><span>Show profile</span><ums-icon id="icon-toggle" modifier="sm" css-class="ums-icon--rotate-270"></ums-icon></a></td></tr></tbody></table><div class="ums-pagination__container"><div class="ums-pagination__col"><label for="scoringPageSize" class="ums-pagination__label">Show rows:</label><select class="ums-pagination__select" name="scoringPageSize" id="scoringPageSize" ng-model="$ctrl.state.filter.pageSize" ng-options="o for o in $ctrl.state.pageSizes" ng-change="$ctrl.fn.refresh()"></select></div><div class="ums-pagination__col"><label class="ums-pagination__label"><span ng-bind="$ctrl.state.filter.pageIndex * $ctrl.state.filter.pageSize + 1"></span> - <span ng-bind="$ctrl.state.filter.pageIndex * $ctrl.state.filter.pageSize + $ctrl.state.profiles.length"></span> of {{ $ctrl.state.filter.totalResults }}</label> <button type="button" class="ums-pagination__button" ng-if="$ctrl.state.filter.pageIndex > 0" ng-click="$ctrl.fn.filter.prevPage()"><ums-icon id="icon-arrow" modifier="xs ums-icon--rotate-180"></ums-icon></button> <button type="button" class="ums-pagination__button" ng-if="$ctrl.state.filter.pageIndex + 1 < $ctrl.state.filter.totalPages" ng-click="$ctrl.fn.filter.nextPage()"><ums-icon id="icon-arrow" modifier="xs"></ums-icon></button></div></div></div></div></div>',bindings:{visitorId:"="},controller:["umsProfileInfoService","UmsDateRangePicker","UMS_DATERANGEPICKER_MODES","umsLocalStorageService","umsSegmentService",function umsProfileOverviewController(service,UmsDateRangePicker,MODE,localStorageService,umsSegmentService){var $ctrl=this,destroyFns=[],STORAGE_KEY="Umbraco.Engage.Profiles.Overview.Filters",state=$ctrl.state={profiles:[],loading:{profileOverview:!1,totalStatistics:!1,profileGrowth:!1,identificationStatistics:!1},filter:{pageIndex:0,pageSize:100,totalPages:0,totalResults:0,ascending:!1,visitorType:0,goalValue:null,completedGoals:null,isAnonymous:null,isIdentified:null,isHighPotential:null,activeFrom:null,activeTo:null,identifiedName:null,datePickerConfig:{primary:{mode:MODE.LAST_30_DAYS}},segmentId:null},activeFilters:0,graphData:{totalStatistics:null,identificationStatistics:null,profileGrowth:null},pageSizes:[10,20,100,250,1e3]};function checkSegmentSelectionState(){state.filter.segmentId&&Array.isArray(state.segments)&&(state.segments.some(function(s){return s&&s.id===state.filter.segmentId})||(state.filter.segmentId=null))}function setDates(range){$ctrl.state.filter.activeFrom=range.primary.from,$ctrl.state.filter.activeTo=range.primary.to}$ctrl.excelExportUrl=null,this.$onInit=function(){this.visitorId=null,function loadFilters(){var filters=localStorageService.get(STORAGE_KEY);null!=filters&&(Object.assign(state.filter,filters),checkSegmentSelectionState())}(),function initDatePicker(){$ctrl.dateRangePickerService=new UmsDateRangePicker(function(){return state.filter.datePickerConfig})}(),setDates(this.dateRangePickerService.getRange()),umsSegmentService.getAll().then(function(response){state.segments=response||[],checkSegmentSelectionState()}),$ctrl.fn.refresh(),destroyFns.push(this.dateRangePickerService.onChange(function(_,range){setDates(range)}))},this.$onDestroy=function(){destroyFns.forEach(function(fn){fn()})},$ctrl.fn={getData:{profileTotals:function(){return $ctrl.state.loading.totalStatistics=!0,service.getProfileTotals().then(function(response){$ctrl.state.graphData.totalStatistics=$ctrl.fn.buildProfileTotals(response),$ctrl.state.loading.totalStatistics=!1})},newProfiles:function(){return $ctrl.state.loading.identificationStatistics=!0,service.getProfileIdentificationStatistics({numberOfDays:30}).then(function(response){$ctrl.state.graphData.identificationStatistics=$ctrl.fn.buildProfileTotals(response),$ctrl.state.loading.identificationStatistics=!1})},profileGrowth:function(){return $ctrl.state.loading.profileGrowth=!0,service.getProfileGrowth(12).then(function(response){$ctrl.state.graphData.profileGrowth=response,$ctrl.state.loading.profileGrowth=!1})},profiles:function(filter){!function saveFilters(){localStorageService.save(STORAGE_KEY,state.filter)}(),$ctrl.state.activeFilters=function setActiveFilters(){return[$ctrl.state.filter.isAnonymous,$ctrl.state.filter.isIdentified,$ctrl.state.filter.isHighPotential,$ctrl.state.filter.goalValue,$ctrl.state.filter.completedGoals].filter(function(option){return!!option}).length}(),$ctrl.state.loading.profileOverview=!0;var filterObj=Object.assign({},filter);return delete filterObj.datePickerConfig,service.getProfiles(filterObj).then(function(response){$ctrl.state.profiles=response.results,$ctrl.state.filter.totalResults=response.totalResults,$ctrl.state.filter.totalPages=$ctrl.fn.filter.calculateTotalPages($ctrl.state.filter.pageSize,response.totalResults),$ctrl.state.loading.profileOverview=!1})}},refresh:function(){$ctrl.fn.getData.profiles($ctrl.state.filter),$ctrl.fn.getData.profileTotals(),$ctrl.fn.getData.newProfiles(),$ctrl.fn.getData.profileGrowth(),function refreshExportUrl(){var filterObj=Object.assign({},$ctrl.state.filter);delete filterObj.datePickerConfig,delete filterObj.pageIndex,delete filterObj.pageSize,delete filterObj.totalResults,delete filterObj.totalPages,$ctrl.excelExportUrl=service.generateExcelExportUrl(filterObj)}()},filter:{prevPage:function(){$ctrl.state.filter.pageIndex--,$ctrl.fn.refresh()},nextPage:function(){$ctrl.state.filter.pageIndex++,$ctrl.fn.refresh()},calculateTotalPages:function(pageSize,totalResults){return Math.ceil(totalResults/pageSize)}},revertCamelCase:function(input){var result=input.replace(/([A-Z])/g," $1");return result.charAt(0).toUpperCase()+result.slice(1)},buildProfileTotals:function(data){var arr=[];for(var item in data){var obj={label:$ctrl.fn.revertCamelCase(item),data:data[item]};arr.push(obj)}return arr}}}]}),angular.module("engage").component("umsReportingSegmentPersonalizationGoalPerformance",{template:'<table class="table reporting-table" style="width:100%"><thead><tr><th>Goal</th><th>Type</th><th colspan="{{ $ctrl.hasValues ? \'3\' : \'2\' }}">Control group</th><th colspan="{{ $ctrl.hasValues ? \'3\' : \'2\' }}">Personalized group</th><th colspan="{{ $ctrl.hasValues ? \'2\' : \'1\' }}">Difference vs control group</th><th colspan="{{ $ctrl.hasValues ? \'2\' : \'1\' }}">Difference / profile</th></tr><tr class="reporting-table__sub-head"><th></th><th></th><th>PROFILES</th><th>COMPLETIONS</th><th ng-if="$ctrl.hasValues">VALUE</th><th>PROFILES</th><th>COMPLETIONS</th><th ng-if="$ctrl.hasValues">VALUE</th><th>COMPLETIONS</th><th ng-if="$ctrl.hasValues">VALUE</th><th>COMPLETIONS</th><th ng-if="$ctrl.hasValues">VALUE</th></tr></thead><tbody><tr ng-repeat="d in $ctrl.data"><td ng-bind="d.goalName"></td><td ng-bind="d.goalType"></td><td ng-bind="$ctrl.addDotsToNumber(d.controlGroupProfiles)"></td><td ng-bind="$ctrl.addDotsToNumber(d.controlGroupGoalCompletions)"></td><td ng-if="$ctrl.hasValues" ng-bind="$ctrl.addDotsToNumber(d.controlGroupGoalValue) || \'-\'"></td><td ng-bind="$ctrl.addDotsToNumber(d.personalizedGroupProfiles)"></td><td ng-bind="$ctrl.addDotsToNumber(d.personalizedGroupGoalCompletions)"></td><td ng-if="$ctrl.hasValues" ng-bind="$ctrl.addDotsToNumber(d.personalizedGroupGoalValue) || \'-\'"></td><td ng-bind="d.personalizedGroupGoalCompletions - d.controlGroupGoalCompletions"></td><td ng-if="$ctrl.hasValues" ng-bind="!d.personalizedGroupGoalValue && !d.controlGroupGoalValue ? \'-\' : d.personalizedGroupGoalValue - d.controlGroupGoalValue"></td><td>{{ d.absoluteCompletionGainPerProfile > 0 ? \'+\' : \'\'}}{{ d.absoluteCompletionGainPerProfile | number : 2 }} <span ng-show="d.relativeCompletionGainPerProfile > 0 || d.relativeCompletionGainPerProfile < 0" style="margin-left: 5px;" ng-class="{\'color-red\' : d.relativeCompletionGainPerProfile < 0, \'color-green\' : d.relativeCompletionGainPerProfile > 0 }">({{ d.absoluteCompletionGainPerProfile > 0 ? \'+\' : \'\'}}{{ d.relativeCompletionGainPerProfile | percentage: 2}})</span></td><td ng-if="$ctrl.hasValues && (d.personalizedGroupGoalValue || d.controlGroupGoalValue)">{{ d.relativeValueGainPerProfile > 0 ? \'+\' : \'\'}}{{ d.absoluteValueGainPerProfile | number : 2 }} <span ng-show="d.relativeValueGainPerProfile > 0 || d.relativeValueGainPerProfile < 0" style="margin-left: 5px;" ng-class="{\'color-red\' : d.relativeValueGainPerProfile < 0, \'color-green\' : d.relativeValueGainPerProfile > 0 }">({{ d.relativeValueGainPerProfile > 0 ? \'+\' : \'\'}}{{ d.relativeValueGainPerProfile | percentage: 2}})</span></td><td ng-if="$ctrl.hasValues && !d.personalizedGroupGoalValue && !d.controlGroupGoalValue">-</td></tr></tbody></table>',bindings:{segmentId:"<"},controller:["$http",function umsReportingSegmentPersonalizationSessionsNeededController($http){var $ctrl=this;this.isLoading=!1,this.data={},this.$onChanges=function(changes){changes.segmentId&&this.getData(changes.segmentId.currentValue)},this.getData=function getData(segmentId){null!=segmentId?(this.isLoading=!0,$http.get("/umbraco/backoffice/engage/reporting/goalpersonalizationperformance?segmentId="+segmentId).then(function(response){$ctrl.data=response&&response.data||[],$ctrl.hasValues=$ctrl.data.some(function(d){return d.controlGroupGoalValue||d.personalizedGroupGoalValue});for(const row of $ctrl.data)row.absoluteCompletionGainPerProfile=row.personalizedGroupGoalCompletions/row.personalizedGroupProfiles-row.controlGroupGoalCompletions/row.controlGroupProfiles,row.relativeCompletionGainPerProfile=row.personalizedGroupGoalCompletions/row.personalizedGroupProfiles/(row.controlGroupGoalCompletions/row.controlGroupProfiles)-1,row.absoluteValueGainPerProfile=row.personalizedGroupGoalValue/row.personalizedGroupProfiles-row.controlGroupGoalValue/row.controlGroupProfiles,row.relativeValueGainPerProfile=row.personalizedGroupGoalValue/row.personalizedGroupProfiles/(row.controlGroupGoalValue/row.controlGroupProfiles)-1}).finally(function(){$ctrl.isLoading=!1})):$ctrl.data={}},this.addDotsToNumber=function(number){return"number"!=typeof number?"-":number.toLocaleString("en-US").replace(/,/g,".")}}]}),angular.module("engage").component("umsReportingSegmentPersonalizationSessionsNeeded",{template:'<div class="ums-reporting__graph ums-linkbox"><div class="ums-reporting__graph-label"><h3>{{$ctrl.name}} <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text ums-reporting__info-text">{{$ctrl.tooltip}}</span></span></h3></div><hr><div class="ums-reporting__graph-canvas"><ums-donut-chart ng-if="!$ctrl.isLoading && $ctrl.chartData.length > 0" chart-data="$ctrl.chartData"></ums-donut-chart></div></div>',bindings:{name:"@",tooltip:"@",segmentId:"<"},controller:["$http",function umsReportingSegmentPersonalizationSessionsNeededController($http){var $ctrl=this,chartLabels=["1x","2x","3x","4x","More than 4"];this.isLoading=!1,this.chartData=[],this.$onChanges=function(changes){changes.segmentId&&this.getData(changes.segmentId.currentValue)},this.getData=function getData(segmentId){null!=segmentId?(this.isLoading=!0,$http.get("/umbraco/backoffice/engage/reporting/segmentpersonalizationsessionsneeded?segmentId="+segmentId).then(function(response){var potential=response&&response.data;null!=potential&&($ctrl.chartData=Object.entries(potential).filter(function(entry){return"segmentId"!==entry[0]}).map(function(entry,i){return{label:i<chartLabels.length?chartLabels[i]:entry[0],data:entry[1]}}))}).finally(function(){$ctrl.isLoading=!1})):$ctrl.data={}}}]}),angular.module("engage").component("umsReportingSegmentPotentialSessionsNeeded",{template:'<div class="ums-reporting__graph ums-linkbox"><div class="ums-reporting__graph-label"><h3>{{$ctrl.name}} <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="btn"></ums-icon><span class="ums-form__info__text ums-reporting__info-text">{{$ctrl.tooltip}}</span></span></h3></div><hr><div class="ums-reporting__graph-canvas"><ums-donut-chart ng-if="!$ctrl.isLoading && $ctrl.chartData.length > 0" chart-data="$ctrl.chartData"></ums-donut-chart></div></div>',bindings:{name:"@",tooltip:"@",segmentId:"<"},controller:["$http",function umsReportingSegmentPotentialSessionsNeededController($http){var $ctrl=this,chartLabels=["1x","2x","3x","4x","More than 4"];this.isLoading=!1,this.chartData={},this.$onChanges=function(changes){changes.segmentId&&this.getSegmentPotential(changes.segmentId.currentValue)},this.getSegmentPotential=function getSegmentPotential(segmentId){null!=segmentId?(this.isLoading=!0,$http.get("/umbraco/backoffice/engage/reporting/segmentpotentialsessionsneeded?segmentId="+segmentId).then(function(response){var potential=response&&response.data;null!=potential&&($ctrl.chartData=Object.entries(potential).filter(function(entry){return"segmentId"!==entry[0]}).map(function(entry,i){return{label:i<chartLabels.length?chartLabels[i]:entry[0],data:entry[1]}}))}).finally(function(){$ctrl.isLoading=!1})):$ctrl.data={}}}]}),angular.module("engage").component("umsSegmentBuilder",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" large="true"><ums-overlay-header><h2 ng-if="$ctrl.state.segment.id === 0">Add new segment</h2><h2 ng-if="$ctrl.state.segment.id !== 0">Edit segment "{{$ctrl.state.segment.name}}" <span class="umsColor-light">#{{$ctrl.state.segment.id}}</span></h2></ums-overlay-header><ums-overlay-body><div class="ums-flexgrid__container ums-flexgrid__container--lg ums-overlay__content__grid"><div class="ums-flexgrid__item ums-flexgrid__item--2-5 ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><strong class="ums-overlay__content__item__title">Segment</strong><p>Create a segment that can be used to personalize the website. First give the segment a name and description. Then select one or more parameters that control which visitors will be added to the segment.</p><br><form id="ums-segment-builder-form" name="$ctrl.form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row"><label for="ums-segment-builder-title" class="ums-form__label">Title/name *</label> <input id="ums-segment-builder-title" class="ums-form__input" type="text" no-dirty-check ng-model="$ctrl.state.segment.name" required></div><div class="ums-form__row"><label for="ums-segment-builder-desc" class="ums-form__label">Description *</label> <textarea id="ums-segment-builder-desc" class="ums-form__input" no-dirty-check ng-model="$ctrl.state.segment.description" required>\n                        </textarea></div><div class="ums-form__row"><div class="ums-form__label" name="form-score-scored-editor-domain-only">Segment type * <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="xs"></ums-icon><span class="ums-form__info__text">Use core segments for long-term marketing strategy. The personalization of website content based upon the customer journey, for example.<br><br>Setup temporary segments for short-term strategy to be able to, for example, personalize the \'About us\' page for visitors who have read that vacancy page with that key job opening which is hard to fill."</span></span></div><div class="ums-form__switch" style="max-width: none"><input type="radio" name="ums-segment-builder-type" id="ums-segment-builder-type-1" no-dirty-check ng-model="$ctrl.state.segment.isTemporary" ng-value="false" class="ums-form__switch__input" required> <label for="ums-segment-builder-type-1" class="ums-form__switch__label">Core</label> <input type="radio" name="ums-segment-builder-type" id="ums-segment-builder-type-2" no-dirty-check ng-model="$ctrl.state.segment.isTemporary" ng-value="true" class="ums-form__switch__input" required> <label for="ums-segment-builder-type-2" class="ums-form__switch__label">Temporary</label></div></div><div class="ums-form__row" ng-if="$ctrl.state.segment.isTemporary"><label class="ums-form__label">End time</label><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker datepicker-umbraco datepicker-umbraco-flatpickr" style="max-height: 40px;"><umb-flatpickr options="$ctrl.state.timepicker.options" on-setup="$ctrl.fn.onSetupPicker(fpItem, $ctrl.state.segment.endTime)" on-change="$ctrl.fn.onTimePickerChange($ctrl.state.timepicker.endTime)" class="ums-segmentparameter__datepicker-input" required></umb-flatpickr><span class="ums-form__input-icon"><ums-icon id="icon-date-select" modifier="sm"></ums-icon></span> <button class="ums-segmentparameter__datepicker-btn" ng-if="$ctrl.state.timepicker.endTime" ng-click="$ctrl.state.timepicker.endTime.clear()" type="button"><i class="icon-delete"></i></button></div><div class="ums-errorText" ng-show="($ctrl.form.$submitted || $ctrl.form.ums_time_picker.$dirty ) && $ctrl.form.ums_time_picker.$error.umsNotNull || ( $ctrl.form.$submitted && !$ctrl.state.segment.endTime && $ctrl.state.segment.isTemporary)">This field is required</div></div><div class="ums-form__row"><p class="umsDescription">The advanced settings below can be changed if you want to overrule the default values. Please note that changing them may have serious impact on the effectiveness of your segment.</p><ums-accordion-item name="Advanced settings" style="width: 100%; background: #fff;"><div class="ums-form__row"><label for="formControlGroupSize" class="ums-form__label">Control group size <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="sm"></ums-icon><span class="ums-form__info__text">Within this segment this percentage of visitors will be used as a control group. The control group will be appointed to the segment but will not be exposed to segment related personalized content.<br><br>The activity of the control group will be compared against the visitors exposed to the personalized content. This will give insight in the effectiveness of your personalization efforts.</span></span></label><rzslider rz-slider-model="$ctrl.state.segment.controlGroupSize" rz-slider-options="$ctrl.state.controlGroupSliderOptions"></rzslider><span class="umsSmall umsOpacity50" style="margin-top: 1rem;">You can only change the control group size when creating a segment.</span></div></ums-accordion-item></div></form></div><div class="ums-flexgrid__item ums-flexgrid__item--3-5 ums-segmentbuilder__container"><ums-segment-rule-editors segment="$ctrl.state.segment" active-rule="$ctrl.state.editedRule" class="ums-segmentbuilder__inner-container"></ums-segment-rule-editors></div></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button class="btn ums-button ums-button--light ums-button--icon" type="button" ng-click="$ctrl.close()">Cancel</button> <button ng-click="$ctrl.remove()" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error" type="button" ng-disabled="$ctrl.segment.id === 0"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button></span> <span><div class="ums-popup__enter"><button class="btn ums-button ums-button--success ums-button--icon" type="submit" form="ums-segment-builder-form" ng-disabled="$ctrl.isSaving || $ctrl.state.editedRule || (!$ctrl.state.segment.endTime && $ctrl.state.segment.isTemporary)" ng-click="$ctrl.state.formWasSaved = true"><span ng-if="$ctrl.state.segment.id === 0">Add segment</span> <span ng-if="$ctrl.state.segment.id !== 0">Update segment</span><ums-icon id="icon-arrow" modifier="sm"></ums-icon></button><div ng-if="$ctrl.state.editedRule" class="ums-popup__holder ums-popup__holder--small ums-popup__holder--offset ums-popup__holder--no-pointer is-animated">Save the edited parameter first</div><div ng-if="!$ctrl.state.segment.endTime && $ctrl.state.segment.isTemporary" class="ums-popup__holder ums-popup__holder--small ums-popup__holder--offset ums-popup__holder--no-pointer is-animated">End date is required for temporary segments</div></div></span></ums-overlay-footer></ums-overlay>',bindings:{segment:"<",close:"&",onSave:"&?",remove:"&"},controller:[umsSegmentBuilderController]}),angular.module("engage").component("umsSegmentSortButtons",{template:'<div class="ums-table__buttonholder"><div class="ums-popup__enter"><button class="ums-button ums-button--table" type="button" ng-click="$ctrl.update({isUpOrDown: \'decrement\'})" ng-class="{\'ums-button--disabled\': $ctrl.segment.sortOrder === 0}" ng-disabled="$ctrl.segment.sortOrder === 0"><ums-icon id="icon-arrow" css-class="ums-icon--rotate-270" modifier="xs"></ums-icon><span class="vh">Increase priority</span></button><div class="ums-popup__holder ums-popup__holder--small ums-popup__holder--offset ums-popup__holder--no-pointer is-animated" ng-if="$ctrl.segment.sortOrder > 0">Increase priority</div></div><div class="ums-popup__enter"><button class="ums-button ums-button--table" type="button" ng-click="$ctrl.update({isUpOrDown: \'increment\'})" ng-class="{\'ums-button--disabled\': $ctrl.segment.sortOrder >= $ctrl.segmentArray.length -1}" ng-disabled="$ctrl.segment.sortOrder >= $ctrl.segmentArray.length -1"><ums-icon id="icon-arrow" css-class="ums-icon--rotate-90" modifier="xs"></ums-icon><span class="vh">Decrease priority</span></button><div class="ums-popup__holder ums-popup__holder--small ums-popup__holder--offset ums-popup__holder--no-pointer is-animated" ng-if="$ctrl.segment.sortOrder < $ctrl.segmentArray.length -1">Decrease priority</div></div></div>',bindings:{segment:"<",segmentArray:"<",update:"&"}}),angular.module("engage").service("umsSegmentService",["$http",umsSegementService]),angular.module("engage").component("umsLicenseViewer",{template:'<div ng-if="$ctrl.state.isInitialized"><div class="ums-linkbox ums-linkbox--license is-animated" data-has-link="true" data-license-state="{{$ctrl.state.licenseState}}"><h2 ng-show="{{!$ctrl.state.package.isTrialMode}}" class="ums-linkbox__title ums-linkbox__title--big ums-linkbox__title--margin-bottom-0" ng-bind-template="{{$ctrl.state.package.tierName}} License"></h2><h2 ng-show="{{$ctrl.state.package.isTrialMode}}" class="ums-linkbox__title ums-linkbox__title--big ums-linkbox__title--margin-bottom-0" ng-bind-template="Trial Mode"></h2><span class="ums-linkbox__state" ng-if="!($ctrl.state.package.licenseStatus === 1 && $ctrl.state.package.isNearLimit)" ng-switch="$ctrl.state.package.licenseStatus"><span class="ums-linkbox__state__indicator"></span> <span class="ums-linkbox__state__text" ng-switch-when="0">Failed</span> <span class="ums-linkbox__state__text" ng-switch-when="1">Active</span> <span class="ums-linkbox__state__text" ng-switch-when="2">Expired</span> <span class="ums-linkbox__state__text" ng-switch-when="3">Invalid</span> <span class="ums-linkbox__state__text" ng-switch-when="4">Limits reached</span></span> <span class="ums-linkbox__state" ng-if="$ctrl.state.package.isNearLimit && $ctrl.state.package.licenseStatus === 1"><span class="ums-linkbox__state__indicator"></span> <span class="ums-linkbox__state__text">Near limit</span></span><div ng-switch="$ctrl.state.package.licenseStatus"><table class="ums-linkbox__table" ng-switch-when="1"><tbody class="ums-linkbox__tbody" ng-if="$ctrl.state.package.expirationDate != null"><tr><th>Valid until:</th></tr><tr><td ng-bind="$ctrl.state.package.expirationDate | date:\'longDate\'"></td></tr></tbody><tbody class="ums-linkbox__tbody" ng-if="!$ctrl.state.package.isTrialMode"><tr><th>Monthly pageviews:</th></tr><tr><td>{{$ctrl.state.package.currentPageviewsThisMonth | umsDotSeparator }} ({{ ($ctrl.state.package.currentPageviewsThisMonth / $ctrl.state.package.monthlyPageviewLimit) * 100 | number:0 }}% of monthly limit of {{$ctrl.state.package.monthlyPageviewLimit | umsDotSeparator}})</td></tr></tbody><tbody class="ums-linkbox__tbody" ng-if="$ctrl.state.package.domains.length > 0"><tr><th colspan="2">Domains:</th></tr><tr><td colspan="2"><ul class="ums-linkbox__domainlist"><li ng-repeat="domain in $ctrl.state.package.domains track by $index" ng-bind="domain"></li></ul></td></tr></tbody></table><div ng-switch-when="0" class="ums-linkbox__packagestatus-inner-message">Could not load license. Umbraco Engage has been disabled or something went wrong during the installation.</div><div ng-switch-when="2" class="ums-linkbox__packagestatus-inner-message">Your license is expired. Please login to your account to obtain a new license.</div><div ng-switch-when="3" class="ums-linkbox__packagestatus-inner-message">License is invalid. Please login to your account to obtain a new license.</div></div><div class="ums-linkbox__fingerprint"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1200 1200"><defs><style>\n                        .cls-1 {\n                            fill: #000;\n                            stroke-width: 0px;\n                        }\n                    </style></defs><g><path class="cls-1" d="M863.9,500.8l260.3-56c18.4-4,29-23.2,22.7-41-72.1-203-254.1-353.9-474.4-381.3-18.7-2.3-35.3,12.1-35.2,31l1.2,266.1c0,14.2,9.8,26.6,23.6,30,73.6,18.2,134.6,68.4,167.6,134.9,6.3,12.6,20.4,19.3,34.2,16.3Z"></path><path class="cls-1" d="M574.1,852.4c-123.1-12.3-220.3-112.6-229-235.9-9-127.3,75.3-236.6,191.4-266.3,13.7-3.5,23.1-16,23.1-30.2l-1.2-266.2c0-18.9-16.8-33.1-35.5-30.6C241.7,60.6,24.1,299.8,20.5,590.5c-4.1,328.5,261.9,593,590.3,587.1,148.5-2.6,283.4-61.1,384.5-155.3,13.8-12.8,13.1-34.8-1.3-46.8l-205.1-169.8c-10.9-9-26.6-9.6-38-1.3-48.7,35.6-110.5,54.4-176.9,47.8Z"></path><path class="cls-1" d="M855.5,615.6c-2.3,32.9-10.8,64.2-24.3,92.5-6.1,12.8-2.6,28.1,8.3,37.1l205,169.7c14.5,12,36.1,8.4,46.2-7.5,56.7-89.6,89.5-195.8,89.5-309.6s-.7-32.3-2-48.1c-1.6-18.7-19.2-31.8-37.5-27.9l-260.3,56c-14.1,3-24.2,15.4-24.5,29.8,0,3.5-.2,6.4-.3,8Z"></path></g><path class="cls-1" d="M772.8,593.4c-.5-13.9-2.6-27.2-6.1-40-5.8-21-30.3-29.6-48.2-17.2-10.5,7.3-23.6,11-37.6,9.6-26.2-2.7-47.4-24.1-49.8-50.4-.8-9.1.5-17.9,3.6-25.7,7.9-19.9-5.4-41.9-26.8-42.8-9.1-.4-18.3,0-27.7,1-86.7,10.1-152.9,84.6-152.4,171.9.5,102.4,88.7,181.2,189.9,171.1,87.1-8.7,158.2-90,155.1-177.5Z"></path></svg></div></div><div class="ums-linkbox ums-linkbox--license-error-message is-animated" aria-hidden="{{!($ctrl.state.package.isTrialMode)}}" data-has-link="true"><p><strong>Umbraco Engage</strong> has found no license and is running in trial mode. All of its features are enabled, but will only work on <strong>localhost</strong>, <strong>*.local</strong> & <strong>*.test</strong> domains.<br>Please consider <strong><a href="https://umbraco.com/products/add-ons/engage/" target="_blank" class="ums-linkbox__button--link-on-parent">purchasing a license</a>.</strong></p></div><div class="ums-linkbox ums-linkbox--license-error-message is-animated" aria-hidden="{{!($ctrl.state.package.licenseStatus === 5 || $ctrl.state.package.isNearLimit)}}" data-has-link="true"><p>Your license contains <strong ng-bind-template="{{$ctrl.state.package.monthlyPageviewLimit | number}} pageviews."></strong><br>This month you\'ve had <strong ng-bind-template="{{$ctrl.state.package.currentPageviewsThisMonth | number}} pageviews."></strong><br>Please consider reaching out to <strong><a href="mailto:support@umbraco.com" class="ums-linkbox__button--link-on-parent">support@umbraco.com</a></strong> to upgrade your license.</p></div><div class="ums-linkbox ums-linkbox--license-error-message is-animated" aria-hidden="{{!($ctrl.state.package.licenseStatus === 1 && $ctrl.state.noLicenseForDomain)}}" data-has-link="true"><p>This domain ({{$ctrl.state.host}}) is not listed in your license file<br>Please consider reaching out to <strong><a href="mailto:support@umbraco.com" class="ums-linkbox__button--link-on-parent">support@umbraco.com</a></strong> to upgrade your license.</p></div><div class="ums-linkbox ums-linkbox--license-error-message is-animated" aria-hidden="{{!($ctrl.state.configuration && !$ctrl.state.configuration.settings.enabled)}}" data-has-link="true"><p>Umbraco Engage is disabled and not collecting data.<br><a href="/umbraco/#/engage/settings/configuration">Enable Engage</a></p></div></div>',bindings:{packageInfo:"="},controller:["umsPackageService","umsConfigurationService","$location",umsLicenseViewerController]}),angular.module("engage").component("umsUiConfirmOverlay",{template:'<ums-overlay small="true" fluid="true" close="$ctrl.state.close()"><ums-overlay-header><h2 ng-bind="$ctrl.state.title" style="margin: 0;"></h2></ums-overlay-header><ums-overlay-body><p ng-bind="$ctrl.state.text" style="margin: 0;"></p></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span></span> <span><button type="button" class="ums-button ums-button--line" ng-click="$ctrl.state.confirmNoAction()" ng-bind="$ctrl.state.confirmNoText" title ng-attr-aria-label="{{$ctrl.state.confirmNoText}}"></button> <button type="button" class="ums-button ums-button--error" ng-click="$ctrl.state.confirmYesAction()" ng-bind="$ctrl.state.confirmYesText" title ng-attr-aria-label="{{$ctrl.state.confirmYesText}}"></button></span></ums-overlay-footer></ums-overlay>',bindings:{close:"&",title:"<?",text:"<?",confirmYesAction:"&",confirmYesText:"<?",confirmNoAction:"&?",confirmNoText:"<?"},controller:[umsUiConfirmOverlayController]}),angular.module("engage").component("umsUiTableActionButtons",{template:'<div class="ums-table__buttonholder"><div class="ums-popup__enter" ng-if="$ctrl.onEditClick"><button class="ums-button ums-button--table" type="button" ng-click="$ctrl.onEditClick()"><ums-icon id="icon-edit" modifier="xs"></ums-icon><span class="vh">Edit</span></button><div class="ums-popup__holder ums-popup__holder--small ums-popup__holder--offset ums-popup__holder--no-pointer is-animated">Edit</div></div><div class="ums-popup__enter" ng-if="$ctrl.onDeleteClick"><button class="ums-button ums-button--table" type="button" ng-click="$ctrl.onDeleteClick()"><ums-icon id="icon-delete" modifier="xs"></ums-icon><span class="vh">Delete</span></button><div class="ums-popup__holder ums-popup__holder--small ums-popup__holder--offset ums-popup__holder--no-pointer is-animated">Delete</div></div></div>',bindings:{onEditClick:"&?",onDeleteClick:"&?"}}),angular.module("engage").component("umsGoalTypeEditorCustom",{template:'<hr><h3>Custom Goal</h3><div><p>You can trigger this goal by executing this C# code. <span ng-show="$ctrl.goalId == 0"><br>Save this Goal to replace GOAL_ID in the code below with the actual id of this goal.</span></p><pre style="font-family: Consolas, monospace; font-size: 12px;">\nusing Umbraco.Engage.Infrastructure.Analytics.Goals;\n\npublic class YourService\n{\n    private IGoalService _goalService;\n\n    public YourService(IGoalService goalService) => _goalService = goalService;\n\n    public void TriggerGoal()\n    {\n        // value (int) is optional, default is 0.\n        <strong>_goalService.TriggerGoal(goalId: {{$ctrl.goalId > 0 ? $ctrl.goalId : \'GOAL_ID\'}}, value: ...);</strong>\n    }\n}</pre></div>',bindings:{config:"<",goalId:"@"}});var umsAnalyticsGoalTypeEditorPageEventComponent={controller:umsAnalyticsGoalTypeEditorPageEventController,template:'<hr><h3>Page event settings</h3><div class="ums-form__row"><label for="PageEventCategory" class="ums-form__label">Category {{!!ctrl.allRequired ? \'*\' : \'\'}}</label> <input type="text" class="ums-form__input" name="PageEventCategory" id="PageEventCategory" ng-model="ctrl.config.Category" ng-required="!!ctrl.allRequired"></div><div class="ums-form__row"><label for="PageEventAction" class="ums-form__label">Action</label> <input type="text" class="ums-form__input" name="PageEventAction" id="PageEventAction" ng-model="ctrl.config.Action"></div><div class="ums-form__row"><label for="PageEventLabel" class="ums-form__label">Label</label> <input type="text" class="ums-form__input" name="PageEventLabel" id="PageEventLabel" ng-model="ctrl.config.Label"></div>',controllerAs:"ctrl",bindings:{config:"=",allRequired:"<?"}};function umsAnalyticsGoalTypeEditorPageviewController(languageResource){var self=this;self.mode="picker",self.languages=[],self.nodePickerConfig={multiPicker:!0},self.getPickedNodes=function(){return self.config.Nodes},self.onPickNodes=function(value){self.config.Nodes=value,value&&value.length>0&&(self.config.UrlRegexPattern=null)},self.toggleMode=function(){self.mode?self.config.Nodes=null:self.config.UrlRegexPattern=null},self.validateRegexInput=function(inputElement){if(inputElement&&"function"==typeof inputElement.setCustomValidity&&(inputElement.setCustomValidity(""),self.config&&self.config.UrlRegexPattern))try{new RegExp(self.config.UrlRegexPattern)}catch(ex){inputElement.setCustomValidity("Provided input is not a valid regular expression!")}},this.$onInit=function(){self.config.UrlRegexPattern&&self.config.UrlRegexPattern.length>0&&(self.mode="regex"),languageResource.getAll().then(function(languages){if(null!=languages&&(self.languages=languages.map(function(lang){return{culture:lang.culture,name:lang.name}}).sort(function(langA,langB){return langA.name>langB.name?1:langA.name<langB.name?-1:0}),1===self.languages.length)){var language=self.languages[0];self.config.Culture=language.culture}}),"regex"==self.mode&&setTimeout(function validateRegex(){var inputElement=document.getElementById("UrlRegex");self.validateRegexInput(inputElement)},200)}}angular.module("engage").component("umsGoalTypeEditorPageEvent",umsAnalyticsGoalTypeEditorPageEventComponent);var umsAnalyticsGoalTypeEditorPageviewComponent={controller:["languageResource",umsAnalyticsGoalTypeEditorPageviewController],template:'<hr><h3>Page view settings</h3><div class="ums-form__row"><div class="ums-form__label" name="GoalPageviewType">Input type</div><div class="ums-form__switch"><input class="ums-form__switch__input" ng-change="ctrl.toggleMode()" ng-model="ctrl.mode" id="GoalPageviewTypePicker" name="GoalPageviewTypePicker" type="radio" value="picker"> <label class="ums-form__switch__label" for="GoalPageviewTypePicker">picker</label> <input class="ums-form__switch__input" ng-change="ctrl.toggleMode()" ng-model="ctrl.mode" id="GoalPageviewTypeRegex" name="GoalPageviewTypeRegex" type="radio" value="regex"> <label class="ums-form__switch__label" for="GoalPageviewTypeRegex">regex</label></div></div><div class="ums-form__row" ng-if="ctrl.mode === \'picker\' && ctrl.languages.length > 1"><div class="ums-form__label" for="goal-type-pageview-culture">Select a culture *</div><select class="ums-form__select" id="goal-type-pageview-culture" required ng-model="ctrl.config.Culture" ng-options="lang.culture as lang.name for lang in ctrl.languages"><option value>Select a culture...</option></select></div><div class="ums-form__row" ng-if="ctrl.mode === \'picker\'"><div class="ums-form__label" for="UrlRegex">Pick a page *</div><ums-render-property alias="\'Umbraco.MultiNodeTreePicker\'" name="\'Engage - Node Picker\'" config="ctrl.nodePickerConfig" get-value="ctrl.getPickedNodes()" set-value="ctrl.onPickNodes(value)"></ums-render-property></div><div class="ums-form__row" ng-if="ctrl.mode === \'regex\'"><div class="ums-form__label" for="UrlRegex">Or match url by regex</div><input class="ums-form__input" type="text" name="UrlRegex" id="UrlRegex" ng-blur="ctrl.validateRegexInput($event.target)" ng-model="ctrl.config.UrlRegexPattern" placeholder="Input is an absolute url https://example.com/page?id=1" required></div>',controllerAs:"ctrl",bindings:{config:"="}};function umsAppliedPersonalizationCreateController(service,segmentService,languageResource,contentResource,documentTypePermissionService,$location,notificationsService){var ctrl=this;this.$onInit=function(){$location.search().id?ctrl.fn.getExistingPersonalization($location.search().id):ctrl.fn.createEmptyPersonalization(),ctrl.fn.getAll.segments(),ctrl.fn.getAll.languages(),ctrl.fn.getAll.contentTypes()},this.state={loading:!0,existing:!1,running:!1,personalization:null,segments:null,personalizationTypes:[{id:1,name:"Multiple Pages"},{id:2,name:"Document Type"}],overlay:{codeOverlay:{isOpen:!1,variant:null}},pagePicker:{config:{multiPicker:!0},pages:null,culture:null},contentTypePicker:{contentTypes:[],culture:null},languages:[],contentTypeNames:{},pageNames:{},publish:null,scheduleVisible:!1,confirm:null,timepicker:{options:{altInput:!0,enableTime:!0,dateFormat:"YYYY-MM-DDTHH:mm:ss[Z]",altformat:"M d, Y h:mm a",time_24hr:!0},timestamp:null}},this.fn={getAll:{segments:function(){return segmentService.getAll().then(function(response){return ctrl.state.segments=response,response})},languages:function(){languageResource.getAll().then(function(languages){if(null!=languages&&(ctrl.state.languages=languages.map(function(lang){return{culture:lang.culture,name:lang.name}}).sort(function(langA,langB){return langA.name>langB.name?1:langA.name<langB.name?-1:0}),1===ctrl.state.languages.length)){var language=ctrl.state.languages[0];ctrl.state.pagePicker.culture=language.culture,ctrl.state.contentTypePicker.culture=language.culture}})},contentTypes:function(){documentTypePermissionService.getAll().then(function(contentTypePermissions){if(null!=contentTypePermissions){ctrl.state.contentTypePicker.contentTypes=contentTypePermissions.filter(function(permission){return permission.allowApplyPersonalization}).map(function(permission){return{contentTypeId:permission.contentTypeId,name:permission.contentTypeName}}),ctrl.state.contentTypeNames={};for(var i=0;i<ctrl.state.contentTypePicker.contentTypes.length;i++){var contentType=ctrl.state.contentTypePicker.contentTypes[i];ctrl.state.contentTypeNames[contentType.contentTypeId]=contentType.name}}})}},getExistingPersonalization:function(id){return service.getById(id).then(function(personalization){ctrl.state.personalization=personalization,ctrl.state.loading=!1,ctrl.state.existing=!0,ctrl.state.personalization.isActive&&(ctrl.state.running=!0),ctrl.state.personalization.pages.length>0&&(ctrl.state.pagePicker.pages=ctrl.state.personalization.pages.map(function(x){return x.nodeId}).join(","),ctrl.state.pagePicker.culture=ctrl.state.personalization.pages[0].culture),ctrl.state.personalization.contentTypes.length>0&&(ctrl.state.contentTypePicker.culture=ctrl.state.personalization.contentTypes[0].culture)}).catch(function(){notificationsService.error("Error getting existing personalization. Please create a new personalization."),$location.search({}),ctrl.fn.createEmptyPersonalization()})},createEmptyPersonalization:function(){ctrl.state.personalization={id:0,name:"",description:"",contentTypes:[],pages:[]},ctrl.state.loading=!1},showPreview:function(){var previewUrl=ctrl.state.personalization.previewUrl;previewUrl&&window.open(previewUrl,"_blank")},save:function(){ctrl.state.formWasSubmitted=!0,null!==ctrl.state.publish&&(ctrl.state.personalization.isActive=ctrl.state.publish),service.save(ctrl.state.personalization).then(function(load){ctrl.state.personalization=load.data,notificationsService.success("Saved personalization"),ctrl.fn.back()})},remove:function(){var personalization=ctrl.state.personalization;ctrl.state.confirm={header:'Remove personalization "'+personalization.name+'"',fn:function confirmFn(){service.delete(personalization.id).then(function(){ctrl.fn.back(),notificationsService.success('Personalization "'+personalization.name+'" deleted')})}}},schedule:function(){ctrl.state.scheduleVisible=!ctrl.state.scheduleVisible,ctrl.state.personalization.started&&ctrl.state.scheduleVisible&&(ctrl.state.personalization.started=null)},back:function(){$location.path("/engage/personalization/applied-personalization")},pagePicker:{setPages:function(){var inputPages=ctrl.state.pagePicker.pages;if(ctrl.state.personalization.pages=ctrl.state.personalization.pages||[],null!=inputPages&&null!=ctrl.state.personalization){for(var arrNodeId=inputPages.split(",").map(function(nodeId){return parseInt(nodeId)}).filter(function(nodeId){return null!=nodeId&&!isNaN(nodeId)}),i=ctrl.state.personalization.pages.length-1;i>=0;i--){var upv=ctrl.state.personalization.pages[i];-1===arrNodeId.indexOf(upv.nodeId)&&ctrl.state.personalization.pages.splice(i,1)}arrNodeId.forEach(function(nodeId){var pageIndex=ctrl.state.personalization.pages.findIndex(function(upv){return upv.nodeId===nodeId});pageIndex>-1?ctrl.state.personalization.pages[pageIndex].culture=ctrl.state.pagePicker.culture:ctrl.state.personalization.pages.push({nodeId:nodeId,culture:ctrl.state.pagePicker.culture})});for(i=0;i<ctrl.state.personalization.pages.length;i++){var page=ctrl.state.personalization.pages[i];null==ctrl.state.pageNames[page.nodeId]&&(ctrl.state.pageNames[page.nodeId]={}),null==ctrl.state.pageNames[page.nodeId][page.culture]&&getPageName(page)}}function getPageName(page){contentResource.getById(page.nodeId).then(function(content){if(null!=content){var variant=1===content.variants.length?content.variants[0]:_.find(content.variants,function(v){return page.culture?null!=v.language&&v.language.culture===page.culture:v.isDefault});null!=variant&&(ctrl.state.pageNames[page.nodeId][page.culture]=variant.name)}})}}},contentTypePicker:{toggle:function(contentTypeId){var idx=_.findIndex(ctrl.state.personalization.contentTypes,function(contentType){return contentType.contentTypeId===contentTypeId});ctrl.state.personalization.contentTypes=ctrl.state.personalization.contentTypes||[],idx>-1?ctrl.state.personalization.contentTypes.splice(idx,1):ctrl.state.personalization.contentTypes.push({contentTypeId:contentTypeId,culture:ctrl.state.contentTypePicker.culture})},updateCulture:function(){var contentTypes=ctrl.state.personalization.contentTypes;null!=contentTypes&&contentTypes.length>0&&contentTypes.forEach(function(contentType){contentType.culture=ctrl.state.contentTypePicker.culture})},isChecked:function(contentTypeId){return-1<_.findIndex(ctrl.state.personalization.contentTypes,function(contentType){return contentType.contentTypeId===contentTypeId})}},overlay:{openCode:function(){ctrl.state.overlay.codeOverlay.isOpen=!0},closeCode:function(){ctrl.state.overlay.codeOverlay.isOpen=!1}},preview:function(variant,forceSave){function openPreview(){ctrl.state.personalization.previewUrl&&window.open(ctrl.state.personalization.previewUrl,"_blank")}!forceSave&&ctrl.state.form.$pristine&&variant.id>0?openPreview():service.save(ctrl.state.personalization).then(function(response){null!=response.data&&(ctrl.state.personalization=response.data,ctrl.state.form.$setPristine(),openPreview())})},convertDate:function(date){return new Date(date)},onSetupPicker:function(picker,initDate){picker.element.placeholder="Select date...",ctrl.state.timepicker.timestamp=picker,initDate&&ctrl.state.timepicker.timestamp.setDate(ctrl.fn.convertDate(initDate),!1)},onTimePickerChange:function(picker){picker.selectedDates.length>0?ctrl.state.personalization.started=picker.selectedDates[0]:ctrl.state.personalization.started=null}}}function umsAppliedPersonalizationVariantEditor($q){var ctrl=this;this.state={css:null,js:null},this.fn={save:function(){ctrl.variant.css=ctrl.state.css,ctrl.variant.javascript=ctrl.state.js;var promises=[];return"function"==typeof ctrl.save&&promises.push(ctrl.save({variant:ctrl.variant})),$q.all(promises)},saveAndPreview:function(variant){ctrl.fn.save().then(function(){null!=ctrl.previewVariant&&ctrl.previewVariant({variant:variant})})},saveAndClose:function(){ctrl.fn.save(),null!=ctrl.close&&ctrl.close()}},this.$onInit=function(){this.state.css=this.variant.css,this.state.js=this.variant.javascript}}function umsAppliedPersonalizationService($http){var endpoint="/umbraco/backoffice/engage/AppliedPersonalization/";function getAll(){return $http.get(endpoint+"getAll").then(function(response){return response.data})}this.getAll=getAll,this.getAllForPage=function getAllForPage(nodeId,contentTypeId,culture){return getAll().then(function(items){return items.filter(function(item){return function matchNodeId(item,nodeId,culture){return item.pages.some(function(page){return page.nodeId===nodeId&&(null==page.culture||null==culture||culture===page.culture)})}(item,nodeId,culture)||function matchContentType(item,contentTypeId,culture){return item.contentTypes.some(function(page){return page.contentTypeId===contentTypeId&&(null==page.culture||null==culture||culture===page.culture)})}(item,contentTypeId,culture)})})},this.getById=function getById(id){return $http.get(endpoint+"get?id="+id).then(function(response){return response.data})},this.getBySegment=function getBySegment(segment){return $http.get(endpoint+"getbysegment?segment="+segment).then(function(response){return response.data})},this.save=function savePersonalization(personalization){return $http.post(endpoint+"save",personalization)},this.delete=function deletePersonalization(id){return $http.get(endpoint+"delete?id="+id)},this.createSegment=function createSegment(nodeId,culture,segment){return $http.post(endpoint+"createSegment?contentId="+nodeId+"&culture="+culture+"&segment="+segment)}}function umsAppliedPersonalizationSinglePageEditorController(utils,segmentService,personalizationService){var ctrl=this;this.item={},this.contentId=utils.getCurrentContentId(),this.contentTypeId=utils.getCurrentContentTypeId(),this.culture=utils.getCurrentCulture(),this.hasSegmentedProperty=!1,this.segments=[],this.segmentsInUse={},this.$onInit=function(){null!=this.onInit&&this.onInit({ctrl:this}),this.loadSegments(),utils.hasSegmentedProperty(this.contentTypeId).then(function(hasSegmentedProperty){ctrl.hasSegmentedProperty=hasSegmentedProperty})},this.$onChanges=function(changes){changes.input&&(this.item=null==this.input?this.createNew():angular.merge({},this.input)),changes.active&&changes.active.currentValue&&ctrl.loadSegmentsInUse()},this.loadSegments=function(){segmentService.getAll().then(function(segments){this.segments=segments.map(function(segment){return segment.isTemporary?segment.name+=" - Temporary segment":segment.name+=" - Core segment",segment})}.bind(this))},this.loadSegmentsInUse=function(){personalizationService.getAll().then(function(personalizations){Array.isArray(personalizations)&&(ctrl.segmentsInUse={},personalizations.filter(function(personalization){return 0===personalization.type&&personalization.pages.some(function(page){return page.nodeId===ctrl.contentId&&(null==page.culture||ctrl.culture===page.culture)})}).forEach(function(personalization){null!=personalization.segmentId&&(ctrl.segmentsInUse[personalization.segmentId]=personalization.name)}))})},this.createNew=function(){return{id:0,type:0,started:null,isActive:!0,segmentId:null,name:null,description:null,pages:[{id:0,nodeId:this.contentId,culture:this.culture}]}}}function umsAppliedPersonalizationSinglePageController(service,utils,$element,eventEmitter,umsState){var ctrl=this,destroyFns=[];function editInSplitview(culture,segment){_.any(ctrl.variantsCtrl.content.variants,function(v){return(null==v.culture||v.culture===culture)&&v.segment==segment})?openSplitview(culture,segment):service.createSegment(ctrl.contentId,culture,segment).then(function(){utils.reloadNode(function(){setTimeout(function(){openSplitview(culture,segment)})})})}function openSplitview(culture,segment){eventEmitter.emit("open-splitview",{culture:culture,segment:segment})}this.showAddButton=!1,this.contentId=null,this.culture=null,this.segmentSupport=umsState.segmentSupport,this.$onInit=function(){this.contentId=utils.getCurrentContentId(),this.culture=utils.getCurrentCulture(),this.segmentSupport&&destroyFns.push(utils.contentAppOnActivate($element,function(isActive){ctrl.showAddButton=isActive},!0))},this.$onDestroy=function(){destroyFns.forEach(function(fn){fn()})},this.overviewCtrl=null,this.editorCtrl=null,this.save=function(appliedPersonalization){return service.save(appliedPersonalization).then(function(response){return response.data}).then(function(personalization){editInSplitview(ctrl.culture,personalization.umbracoSegmentAlias)}).finally(function(){ctrl.cancelEdit()})},this.cancelEdit=function(){ctrl.add=!1,ctrl.edit=null},this.editPersonalizationInSplitview=editInSplitview,this.openSplitview=openSplitview}function umsAppliedPersonalizationSplitviewEditorController(segmentService,personalizationService,$element){var $ctrl=this;this.form=null,this.personalization={},this.segments=[],this.segmentsInUse={},this.$onInit=function(){null!=this.onInit&&this.onInit({ctrl:this}),this.loadSegments()},this.$onChanges=function(changes){changes.input&&(this.personalization=null==this.input?null:angular.merge({},this.input),this.segmentsInUse=this.loadSegmentsInUse())},this.initForm=function initForm(){var form=$element.find("#applied-personalisation-splitview-editor");null!=form&&($ctrl.form=form.controller("form"))},this.savePreview=function(personalization){null!=$ctrl.form&&$ctrl.form.$valid&&this.saveAndPreview({personalization:personalization}).catch(angular.noop)},this.submit=function(){this.save({personalization:this.personalization}).catch(angular.noop),this.close()},this.loadSegments=function(){segmentService.getAll().then(function(segments){this.segments=_.sortBy(_.sortBy(segments,function(segment){return segment.isTemporary?1:0}),function(segment){return segment.name}).map(function(segment){return segment.isTemporary?segment.name+=" - Temporary segment":segment.name+=" - Core segment",segment})}.bind(this))},this.loadSegmentsInUse=function(){personalizationService.getAll().then(function(personalizations){if(Array.isArray(personalizations)){if($ctrl.segmentsInUse={},null==$ctrl.input)return;personalizations.filter(function(personalization){return personalization.id!==$ctrl.input.id&&0===personalization.type&&personalization.pages.some(function(page){return $ctrl.input.pages.some(function(p){return p.nodeId===page.nodeId&&p.culture===page.culture})})}).forEach(function(personalization){null!=personalization.segmentId&&($ctrl.segmentsInUse[personalization.segmentId]=personalization.name)})}})}}function umsCampaignGroupsEditorController(personaService,customerJourneyService,$q,utils){var ctrl=this;this.$onInit=function(){this.state.group=angular.copy(this.group),this.fn.getAll(),this.state.group.id>0&&(this.state.isNew=!1)},this.state={loadingGroupData:!0,personaGroups:[],journeyGroups:[],group:null,isNew:!0},this.fn={removeCampaign:function(index){ctrl.state.group.campaigns.splice(index,1)},save:function(){ctrl.state.group.personaScoring=ctrl.fn.getAllPersonaScorings(),ctrl.state.group.customerJourneyScoring=ctrl.fn.getAllCustomerJourneyStepScorings(),utils.merge(ctrl.group,ctrl.state.group),ctrl.onSave()},getAllPersonaGroups:function(){return personaService.getAll().then(function(response){ctrl.state.personaGroups=response})},getAllJourneys:function(){return customerJourneyService.getAll().then(function(response){ctrl.state.journeyGroups=response})},getAll:function(){var getPersonaGroups=ctrl.fn.getAllPersonaGroups(),getJourneyGroups=ctrl.fn.getAllJourneys();return $q.all([getPersonaGroups,getJourneyGroups]).then(function(){ctrl.state.loadingGroupData=!1,ctrl.fn.setAllPersonaScorings(),ctrl.fn.setAllCustomerJourneyStepScorings()})},setAllPersonaScorings:function(){ctrl.state.group.personaScoring&&ctrl.state.group.personaScoring.forEach(function(scoringGroup){ctrl.state.personaGroups.forEach(function(group){Array.isArray(group.personas)&&group.personas.forEach(function(persona){persona.id===scoringGroup.personaId&&(persona.scoring=scoringGroup)})})})},setAllCustomerJourneyStepScorings:function(){ctrl.state.group.customerJourneyScoring&&ctrl.state.group.customerJourneyScoring.forEach(function(scoringGroup){ctrl.state.journeyGroups.forEach(function(journey){Array.isArray(journey.steps)&&journey.steps.forEach(function(step){step.id===scoringGroup.customerJourneyStepId&&(step.scoring=scoringGroup)})})})},getAllPersonaScorings:function(){var scorings=[];return ctrl.state.personaGroups.forEach(function(group){Array.isArray(group.personas)&&group.personas.forEach(function(persona){persona.scoring&&!isNaN(persona.scoring.score)&&(persona.scoring=persona.scoring||{},persona.scoring.campaignGroupId=ctrl.state.group.id||0,persona.scoring.personaId=persona.id,persona.scoring.score=isNaN(persona.scoring.score)?0:persona.scoring.score,(persona.scoring.score>0&&!persona.scoring.id||persona.scoring.id)&&scorings.push(persona.scoring))})}),scorings},getAllCustomerJourneyStepScorings:function(){var scorings=[];return ctrl.state.journeyGroups.forEach(function(journey){Array.isArray(journey.steps)&&journey.steps.forEach(function(step){step.scoring&&!isNaN(step.scoring.score)&&(step.scoring=step.scoring||{},step.scoring.campaignGroupId=ctrl.state.group.id||0,step.scoring.customerJourneyStepId=step.id,step.scoring.score=isNaN(step.scoring.score)?0:step.scoring.score,(step.scoring.score>0&&!step.scoring.id||step.scoring.id)&&scorings.push(step.scoring))})}),scorings},filterdCampaign:function(campaign){var filteredObj={};return Object.keys(campaign).forEach(function(parameter){0===parameter.indexOf("utm")&&campaign[parameter]&&(filteredObj[parameter]=campaign[parameter])}),filteredObj},convertToSnakeCase:str=>str.split(/(?=[A-Z])/).join("_").toLowerCase()}}function umsCampaignGroupsTableController(service,notificationsService){var ctrl=this;this.$onInit=function(){ctrl.fn.getAll().then(ctrl.isLoaded()),ctrl.fn.getAllVisitors(),this.bindChild({ctrl:ctrl})},this.state={loading:!0,saving:!1,groups:[],visitorsPerGroup:{},edit:null,sorted:null,filter:{page:1,pageSize:20,totalPages:1,amountOfDays:30,filteredGroups:[]},pageSizes:[10,20,50,100]},this.fn={addNewGroup:function(){ctrl.state.edit={}},closeEditor:function(){ctrl.state.edit=null},sortGroups:function(input){return ctrl.state.visitorsPerGroup[input.id]||0},save:function(groupObj){return ctrl.state.saving=!0,service.save(groupObj).then(function(response){groupObj.id||ctrl.state.groups.push(response.data),ctrl.fn.filter.apply(),ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAllVisitors(),ctrl.fn.getAll().then(ctrl.isLoaded()).then(ctrl.update()).then(function(){notificationsService.success('Campaign group "'+response.data.name+'" saved')})})},query:{page:1,pageSize:99999,amountOfDays:30},remove:function(group){ctrl.state.confirm={header:'Remove campaign group "'+group.name+'"',fn:function confirmFn(){var indexInArray=ctrl.state.groups.indexOf(group);return service.delete(group.id).then(function(response){ctrl.fn.closeEditor(),ctrl.state.groups.splice(indexInArray,1),ctrl.fn.filter.apply(),ctrl.fn.getAllVisitors(),ctrl.fn.getAll().then(ctrl.isLoaded()).then(ctrl.update()).then(function(){notificationsService.success('Campaign group "'+group.name+'" was removed')})})}}},edit:function(group){ctrl.state.edit=group},getAll:function(){return ctrl.state.loading=!0,service.getAll().then(function(response){return ctrl.state.groups=response,ctrl.fn.filter.apply(),response}).finally(function(response){return ctrl.state.loading=!1,response})},getAllVisitors:function(){return service.getVisitors(ctrl.state.filter.amountOfDays).then(function(response){ctrl.state.visitorsPerGroup=response})},filter:{apply:function(){ctrl.fn.filter.calculateTotalPages(),ctrl.fn.filter.updateRows(),ctrl.fn.filter.createNewFilterArray()},resetAndApply:function(){ctrl.state.filter.page=1,ctrl.fn.filter.apply()},updateRows:function(){var currentPage=ctrl.state.filter.page,pageSize=ctrl.state.filter.pageSize;ctrl.state.filter.fromRow=(currentPage-1)*pageSize,ctrl.state.filter.toRow=currentPage*pageSize>ctrl.state.groups.length?ctrl.state.groups.length:currentPage*pageSize},calculateTotalPages:function(){return ctrl.state.filter.totalPages=Math.ceil(ctrl.state.groups.length/ctrl.state.filter.pageSize),ctrl.state.filter.totalPages<1&&(ctrl.state.filter.totalPages=1),ctrl.state.filter.totalPages},createNewFilterArray:function(){return ctrl.state.filter.filteredGroups=ctrl.state.groups.slice(ctrl.state.filter.fromRow,ctrl.state.filter.toRow),ctrl.state.filter.filteredGroups},previousPage:function(){ctrl.state.filter.page--,ctrl.fn.filter.apply()},nextPage:function(){ctrl.state.filter.page++,ctrl.fn.filter.apply()}}}}function umsScoredCampaignsTableController(service,$q,notificationsService){var ctrl=this;this.$onInit=function(){ctrl.fn.getAllGroups().then(ctrl.update()),ctrl.fn.getCampaignVisitors()},this.state={loading:!0,saving:!1,groups:null,groupsObj:{},campaignVisitorsByCampaignId:{},scoredCampaigns:[],edit:null,confirm:null},this.filter={currentPage:1,fromRow:1,toRow:0,totalRowCount:0,itemsPerPage:0,totalPages:0,pageSize:20,amountOfDays:30,pageSizes:[10,20,50,100]},this.fn={getAllGroups:function(){return service.getAll().then(function(response){return ctrl.state.groups=response,ctrl.state.groupsObj=ctrl.fn.buildGroupsObject(response),ctrl.state.scoredCampaigns=ctrl.fn.buildCampaigns(response),ctrl.state.loading=!1,response})},getCampaignVisitors:function(){return service.getVisitors(ctrl.filter.amountOfDays).then(function(response){return ctrl.state.campaignVisitorsByCampaignId=response,response})},buildCampaigns:function(groups){var campaigns=[];return groups.forEach(function(group){group.campaigns.length>0&&group.campaigns.forEach(function(campaign){campaigns.push(campaign)})}),campaigns},buildGroupsObject:function(groups){var obj={};return groups.forEach(function(group){obj[group.id]=group}),obj},edit:function(campaign){ctrl.state.edit=campaign},closeEditor:function(){ctrl.state.edit=null},save:function(campaign){var prevGroupId=campaign.prevGroupId;delete campaign.prevGroupId,delete campaign.visitorCount;var group=ctrl.state.groupsObj[campaign.campaignGroupId];if(campaign.created=new Date,ctrl.state.saving=!0,campaign.campaignGroupId!==prevGroupId){var prevGroupArray=ctrl.state.groupsObj[prevGroupId];if(prevGroupArray){var pageIndexInPrevGroup=prevGroupArray.campaigns.findIndex(function(x){return x.id==campaign.id});prevGroupArray.campaigns.splice(pageIndexInPrevGroup,1);var saveGroupWithRemovedPage=service.save(prevGroupArray)}group.campaigns.push(campaign);var saveNewGroup=service.save(group);prevGroupArray?$q.all([saveGroupWithRemovedPage,saveNewGroup]).then(function(){ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAllGroups().then(ctrl.update()),notificationsService.success('Successfully updated the campaign to the group:"'+group.name+'"')}):saveNewGroup.then(function(){ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAllGroups().then(ctrl.update()),notificationsService.success('Successfully updated the campaign to the group:"'+group.name+'"')})}else{var existingCampaignIndex=group.campaigns.findIndex(function(x){return x.id==campaign.id});group.campaigns[existingCampaignIndex]=campaign,service.save(group).then(function(){ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAllGroups().then(ctrl.update()),notificationsService.success("Successfully updated the campaign")})}},remove:function(campaign){ctrl.state.confirm={header:"Remove scored campaign",fn:function confirmFn(){ctrl.fn.removePage(campaign).then(function(){ctrl.fn.closeEditor(),ctrl.fn.getAllGroups().then(ctrl.update()),notificationsService.success("Successfully removed the campaign")})}}},removePage:function(campaign){var prevGroupArray=ctrl.state.groupsObj[campaign.campaignGroupId],prevIdx=prevGroupArray.campaigns.findIndex(function(x){return x.id==campaign.id});return prevGroupArray.campaigns.splice(prevIdx,1),service.save(prevGroupArray)},filter:{apply:function(){ctrl.fn.getAllGroups()},resetAndApply:function(){ctrl.filter.currentPage=1,ctrl.fn.filter.apply()},query:function(){return{page:ctrl.filter.currentPage,pageSize:ctrl.filter.pageSize,amountOfDays:ctrl.filter.amountOfDays}},previousPage:function(){ctrl.filter.currentPage--,ctrl.fn.filter.apply()},nextPage:function(){ctrl.filter.currentPage++,ctrl.fn.filter.apply()}}}}function umsUnscoredCampaignsTableController(service,notificationsService){var ctrl=this;this.$onInit=function(){ctrl.fn.getAll().then(ctrl.update()),ctrl.fn.getAllGroups()},this.state={loading:!0,saving:!1,unscored:[],groups:[],groupsObj:{},edit:null},this.filter={currentPage:1,fromRow:1,toRow:0,totalRowCount:0,itemsPerPage:0,totalPages:0,pageSize:20,amountOfDays:30,pageSizes:[10,20,50,100]},this.fn={getAll:function(){return ctrl.state.loading=!0,service.getUnscored(ctrl.fn.filter.query()).then(function(response){return ctrl.state.unscored=response,ctrl.state.loading=!1,response})},getAllGroups:function(){return service.getAll().then(function(response){return ctrl.state.groups=response,ctrl.fn.buildGroupsObject(response),response})},buildGroupsObject:function(groups){groups.forEach(function(group){ctrl.state.groupsObj[group.id]=group})},buildFilter:function(filterData){ctrl.filter.currentPage=filterData.currentPage,ctrl.filter.fromRow=filterData.fromRow,ctrl.filter.toRow=filterData.toRow,ctrl.filter.totalRowCount=filterData.totalRowCount,ctrl.filter.itemsPerPage=filterData.itemsPerPage,ctrl.filter.totalPages=filterData.totalPages},edit:function(item){ctrl.state.edit=item},closeEditor:function(){ctrl.state.edit=null},save:function(campaign){var group=ctrl.state.groupsObj[campaign.campaignGroupId];delete campaign.visitorCount,campaign.created=new Date,group.campaigns.push(campaign),ctrl.state.saving=!0,service.save(group).then(function(){ctrl.state.saving=!1,ctrl.fn.closeEditor(),ctrl.fn.getAll().then(ctrl.update()),notificationsService.success('Successfully assigned the campaign to the group:"'+group.name+'"')})},filter:{apply:function(){ctrl.fn.getAll()},resetAndApply:function(){ctrl.filter.currentPage=1,ctrl.fn.filter.apply()},query:function(){return{page:ctrl.filter.currentPage,pageSize:ctrl.filter.pageSize,amountOfDays:ctrl.filter.amountOfDays}},previousPage:function(){ctrl.filter.currentPage--,ctrl.fn.filter.apply()},nextPage:function(){ctrl.filter.currentPage++,ctrl.fn.filter.apply()}}}}function umsPersonalizationScoreGroupEditor(personaService,customerJourneyService,$q,utils){var ctrl=this;this.$onInit=function(){this.state.group=angular.copy(this.group),this.fn.getAll(),this.state.group.id>0&&(this.state.isNew=!1)},this.state={loadingGroupData:!0,personaGroups:[],journeyGroups:[],group:null,isNew:!0},this.fn={addUrl:function(){var emptyObj={id:null,pageId:null,referralGroupId:ctrl.state.group.id,domainOnly:!1,pageUrl:""};null==ctrl.state.group.pages&&(ctrl.state.group.pages=[]),ctrl.state.group.pages.push(emptyObj)},removeUrl:function(index){ctrl.state.group.pages.splice(index,1)},save:function(){ctrl.state.group.personaScoring=ctrl.fn.getAllPersonaScorings(),ctrl.state.group.customerJourneyScoring=ctrl.fn.getAllCustomerJourneyStepScorings(),utils.merge(ctrl.group,ctrl.state.group),ctrl.onSave()},getAllPersonaGroups:function(){return personaService.getAll().then(function(response){ctrl.state.personaGroups=response})},getAllJourneys:function(){return customerJourneyService.getAll().then(function(response){ctrl.state.journeyGroups=response})},getAll:function(){var getPersonaGroups=ctrl.fn.getAllPersonaGroups(),getJourneyGroups=ctrl.fn.getAllJourneys();return $q.all([getPersonaGroups,getJourneyGroups]).then(function(){ctrl.state.loadingGroupData=!1,ctrl.fn.setAllPersonaScorings(),ctrl.fn.setAllCustomerJourneyStepScorings()})},setAllPersonaScorings:function(){ctrl.state.group.personaScoring&&ctrl.state.group.personaScoring.forEach(function(scoringGroup){ctrl.state.personaGroups.forEach(function(group){Array.isArray(group.personas)&&group.personas.forEach(function(persona){persona.id===scoringGroup.personaId&&(persona.scoring=scoringGroup)})})})},setAllCustomerJourneyStepScorings:function(){ctrl.state.group.customerJourneyScoring&&ctrl.state.group.customerJourneyScoring.forEach(function(scoringGroup){ctrl.state.journeyGroups.forEach(function(journey){Array.isArray(journey.steps)&&journey.steps.forEach(function(step){step.id===scoringGroup.customerJourneyStepId&&(step.scoring=scoringGroup)})})})},getAllPersonaScorings:function(){var scorings=[];return ctrl.state.personaGroups.forEach(function(group){Array.isArray(group.personas)&&group.personas.forEach(function(persona){persona.scoring&&!isNaN(persona.scoring.score)&&(persona.scoring=persona.scoring||{},persona.scoring.referralGroupId=ctrl.state.group.id||0,persona.scoring.personaId=persona.id,persona.scoring.score=isNaN(persona.scoring.score)?0:persona.scoring.score,(persona.scoring.score>0&&!persona.scoring.id||persona.scoring.id)&&scorings.push(persona.scoring))})}),scorings},getAllCustomerJourneyStepScorings:function(){var scorings=[];return ctrl.state.journeyGroups.forEach(function(journey){Array.isArray(journey.steps)&&journey.steps.forEach(function(step){step.scoring&&!isNaN(step.scoring.score)&&(step.scoring=step.scoring||{},step.scoring.referralGroupId=ctrl.state.group.id||0,step.scoring.customerJourneyStepId=step.id,step.scoring.score=isNaN(step.scoring.score)?0:step.scoring.score,(step.scoring.score>0&&!step.scoring.id||step.scoring.id)&&scorings.push(step.scoring))})}),scorings}}}function umsPersonalizationScoreScoredEditor(utils){var ctrl=this;this.$onInit=function(){ctrl.state.scoredReferral=angular.copy(ctrl.scoredReferral),ctrl.state.referralGroups=ctrl.referralGroups,ctrl.state.selectedGroup=ctrl.state.referralGroups[ctrl.state.scoredReferral.referralGroupId],ctrl.state.scoredReferral.prevGroup=ctrl.state.scoredReferral.referralGroupId,ctrl.state.scoredReferral.domainOnly=ctrl.domainOnlyStatus},this.state={scoredReferral:null,referralGroups:null,selectedGroup:null},this.fn={save:function(){ctrl.state.scoredReferral.referralGroupId=ctrl.state.selectedGroup.id,utils.merge(ctrl.scoredReferral,ctrl.state.scoredReferral),ctrl.onSave()}}}function umsPersonalizationScoreUnscoredEditor(utils){var ctrl=this;this.$onInit=function(){ctrl.state.unscoredReferral=angular.copy(ctrl.unscoredReferral),ctrl.state.referralGroups=this.referralGroups,ctrl.state.unscoredReferral.domainOnly=!1},this.state={unscoredReferral:null,referralGroups:null,selectedGroup:null},this.fn={save:function(){ctrl.state.unscoredReferral.referralGroupId=ctrl.state.selectedGroup.id,utils.merge(ctrl.unscoredReferral,ctrl.state.unscoredReferral),ctrl.onSave()}}}function umsReferralGroupsTable(service,notificationsService){var ctrl=this;this.$onInit=function(){ctrl.fn.getAll().then(ctrl.isLoaded()),ctrl.fn.getAllReferredVisitors(),this.bindChild({ctrl:ctrl})},this.state={loading:!0,saving:!1,referralGroups:[],referredVisitorsPerGroup:{},edit:null,sorted:null,filter:{page:1,pageSize:20,totalPages:1,amountOfDays:30,filteredReferralGroups:[]},pageSizes:[10,20,50,100]},this.fn={addNewGroup:function(){ctrl.state.edit={}},closeEditor:function(){ctrl.state.edit=null},sortGroups:function(input){return ctrl.state.referredVisitorsPerGroup[input.id]||0},save:function(groupObj){return ctrl.state.saving=!0,service.save(groupObj).then(function(response){groupObj.id||ctrl.state.referralGroups.push(response.data),ctrl.fn.filter.apply(),ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAllReferredVisitors(),ctrl.fn.getAll().then(ctrl.isLoaded()).then(ctrl.update()).then(function(){notificationsService.success('Referral group "'+response.data.name+'" saved')})})},query:{page:1,pageSize:99999,amountOfDays:30},remove:function(group){ctrl.state.confirm={header:'Remove referral group "'+group.name+'"',fn:function confirmFn(){var indexInArray=ctrl.state.referralGroups.indexOf(group);return service.delete(group.id).then(function(response){ctrl.fn.closeEditor(),ctrl.state.referralGroups.splice(indexInArray,1),ctrl.fn.filter.apply(),ctrl.fn.getAllReferredVisitors(),ctrl.fn.getAll().then(ctrl.isLoaded()).then(ctrl.update()).then(function(){notificationsService.success('Referral group "'+group.name+'" was removed')})})}}},edit:function(referralGroup){ctrl.state.edit=referralGroup},getAll:function(){return ctrl.state.loading=!0,service.getAll().then(function(response){return ctrl.state.referralGroups=response,ctrl.fn.filter.apply(),response}).finally(function(response){return ctrl.state.loading=!1,response})},getAllReferredVisitors:function(){return service.getReferredVisitors(ctrl.state.filter.amountOfDays).then(function(response){ctrl.state.referredVisitorsPerGroup=response})},filter:{apply:function(){ctrl.fn.filter.calculateTotalPages(),ctrl.fn.filter.updateRows(),ctrl.fn.filter.createNewFilterArray()},resetAndApply:function(){ctrl.state.filter.page=1,ctrl.fn.filter.apply()},updateRows:function(){var currentPage=ctrl.state.filter.page,pageSize=ctrl.state.filter.pageSize;ctrl.state.filter.fromRow=(currentPage-1)*pageSize,ctrl.state.filter.toRow=currentPage*pageSize>ctrl.state.referralGroups.length?ctrl.state.referralGroups.length:currentPage*pageSize},calculateTotalPages:function(){return ctrl.state.filter.totalPages=Math.ceil(ctrl.state.referralGroups.length/ctrl.state.filter.pageSize),ctrl.state.filter.totalPages<1&&(ctrl.state.filter.totalPages=1),ctrl.state.filter.totalPages},createNewFilterArray:function(){return ctrl.state.filter.filteredReferralGroups=ctrl.state.referralGroups.slice(ctrl.state.filter.fromRow,ctrl.state.filter.toRow),ctrl.state.filter.filteredReferralGroups},previousPage:function(){ctrl.state.filter.page--,ctrl.fn.filter.apply()},nextPage:function(){ctrl.state.filter.page++,ctrl.fn.filter.apply()}}}}function umsReferralGroupsService($http){var endpoint="/umbraco/backoffice/engage/referralgroup/";this.getAll=function getAll(){return $http.get(endpoint+"getAll").then(function(response){return response.data})},this.getReferredVisitors=function getReferredVisitors(amountOfDays){return $http.get(endpoint+"getReferredVisitors?amountOfDays="+amountOfDays).then(function(response){return response.data})},this.getGroup=function getGroup(id){return $http.get(endpoint+"get?groupId="+id).then(function(response){return response.data})},this.save=function saveGroup(group){return $http.post(endpoint+"save",group)},this.delete=function deleteGroup(groupId){return $http.post(endpoint+"delete?groupId="+groupId)}}function umsScoredReferralsTable(service,referralGroupsService,$q,notificationsService){var ctrl=this;this.$onInit=function(){ctrl.fn.getAll().then(ctrl.update()),ctrl.fn.getAllGroups()},this.state={loading:!0,saving:!1,scoredReferrals:[],referralGroups:[],referralGroupsObj:{},domainOnlyStatus:{},edit:null,confirm:null},this.filter={currentPage:1,fromRow:1,toRow:0,totalRowCount:0,itemsPerPage:0,totalPages:0,pageSize:20,amountOfDays:30,pageSizes:[10,20,50,100]},this.fn={getAll:function(){return ctrl.state.loading=!0,service.getAll(ctrl.fn.filter.query()).then(function(response){return ctrl.state.scoredReferrals=response.rows,ctrl.fn.buildFilter(response),ctrl.state.loading=!1,response})},getAllGroups:function(){return referralGroupsService.getAll().then(function(response){return ctrl.state.referralGroups=response,ctrl.fn.buildGroupsObject(response),ctrl.fn.getPageDomainStatus(response),response})},getPageDomainStatus:function(response){response.forEach(function(group){group.pages.forEach(function(page){ctrl.state.domainOnlyStatus[page.pageId]=page})})},buildGroupsObject:function(groups){groups.forEach(function(group){ctrl.state.referralGroupsObj[group.id]=group})},buildFilter:function(filterData){ctrl.filter.currentPage=filterData.currentPage,ctrl.filter.fromRow=filterData.fromRow,ctrl.filter.toRow=filterData.toRow,ctrl.filter.totalRowCount=filterData.totalRowCount,ctrl.filter.itemsPerPage=filterData.itemsPerPage,ctrl.filter.totalPages=filterData.totalPages},edit:function(referral){ctrl.state.edit=referral},closeEditor:function(){ctrl.state.edit=null},save:function(referral){var prevGroupId=referral.prevGroup;delete referral.prevGroup;var group=ctrl.state.referralGroupsObj[referral.referralGroupId],updatedPage={id:0,pageId:referral.id,referralGroupId:referral.referralGroupId,domainOnly:!!referral.domainOnly&&referral.domainOnly,pageUrl:referral.url};if(ctrl.state.saving=!0,referral.referralGroupId!==prevGroupId){var prevGroupArray=ctrl.state.referralGroupsObj[prevGroupId];if(prevGroupArray){var pageIndexInPrevGroup=prevGroupArray.pages.map(function(x){return x.pageId}).indexOf(referral.id);prevGroupArray.pages.splice(pageIndexInPrevGroup,1);var saveGroupWithRemovedPage=referralGroupsService.save(prevGroupArray)}group.pages.push(updatedPage);var saveNewGroup=referralGroupsService.save(group);prevGroupArray?$q.all([saveGroupWithRemovedPage,saveNewGroup]).then(function(){ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAll().then(ctrl.update()),ctrl.fn.getAllGroups(),notificationsService.success('Successfully updated referral  "'+referral.url+'" to the group:"'+group.name+'"')}):saveNewGroup.then(function(){ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAll().then(ctrl.update()),ctrl.fn.getAllGroups(),notificationsService.success('Successfully updated referral  "'+referral.url+'" to the group:"'+group.name+'"')})}else{var existingPageIndex=group.pages.map(function(x){return x.pageId}).indexOf(referral.id);updatedPage.id=group.pages[existingPageIndex].id,group.pages[existingPageIndex]=updatedPage,referralGroupsService.save(group).then(function(){ctrl.fn.closeEditor(),ctrl.state.saving=!1,ctrl.fn.getAll().then(ctrl.update()),ctrl.fn.getAllGroups(),notificationsService.success('Successfully updated referral  "'+referral.url+'"')})}},remove:function(referral){ctrl.state.confirm={header:'Remove scored referral "'+referral.url+'"',fn:function confirmFn(){ctrl.fn.removePage(referral).then(function(){ctrl.fn.closeEditor(),ctrl.fn.getAll().then(ctrl.update()),ctrl.fn.getAllGroups(),notificationsService.success('Successfully removed referral "'+referral.url+'"')})}}},removePage:function(referral){var prevGroupArray=ctrl.state.referralGroupsObj[referral.referralGroupId],pageIndexInPrevGroup=prevGroupArray.pages.map(function(x){return x.pageId}).indexOf(referral.id);return prevGroupArray.pages.splice(pageIndexInPrevGroup,1),referralGroupsService.save(prevGroupArray)},isUrl:function(input){return/^http(?:s)?:\/\//.test(input)},filter:{apply:function(){ctrl.fn.getAll()},resetAndApply:function(){ctrl.filter.currentPage=1,ctrl.fn.filter.apply()},query:function(){return{page:ctrl.filter.currentPage,pageSize:ctrl.filter.pageSize,amountOfDays:ctrl.filter.amountOfDays}},previousPage:function(){ctrl.filter.currentPage--,ctrl.fn.filter.apply()},nextPage:function(){ctrl.filter.currentPage++,ctrl.fn.filter.apply()}}}}function umsScoredReferralsService($http){var endpoint="/umbraco/backoffice/engage/ReferralScoring/";this.getAll=function getAll(filter){return $http({method:"POST",url:endpoint+"getscoredreferrals",data:filter}).then(function(response){return response.data})}}function umsUnscoredReferralsTable(service,referralGroupsService,notificationsService){var ctrl=this;this.$onInit=function(){ctrl.fn.getAll().then(ctrl.update()),ctrl.fn.getAllGroups()},this.state={loading:!0,saving:!1,unscoredReferrals:[],referralGroups:[],referralGroupsObj:{},edit:null},this.filter={currentPage:1,fromRow:1,toRow:0,totalRowCount:0,itemsPerPage:0,totalPages:0,pageSize:20,amountOfDays:30,pageSizes:[10,20,50,100]},this.fn={getAll:function(){return ctrl.state.loading=!0,service.getAll(ctrl.fn.filter.query()).then(function(response){return ctrl.state.unscoredReferrals=response.rows,ctrl.fn.buildFilter(response),ctrl.state.loading=!1,response})},getAllGroups:function(){return referralGroupsService.getAll().then(function(response){return ctrl.state.referralGroups=response,ctrl.fn.buildGroupsObject(response),response})},buildGroupsObject:function(groups){groups.forEach(function(group){ctrl.state.referralGroupsObj[group.id]=group})},buildFilter:function(filterData){ctrl.filter.currentPage=filterData.currentPage,ctrl.filter.fromRow=filterData.fromRow,ctrl.filter.toRow=filterData.toRow,ctrl.filter.totalRowCount=filterData.totalRowCount,ctrl.filter.itemsPerPage=filterData.itemsPerPage,ctrl.filter.totalPages=filterData.totalPages},edit:function(referral){ctrl.state.edit=referral},closeEditor:function(){ctrl.state.edit=null},save:function(referral){var obj={id:0,pageId:referral.id,referralGroupId:referral.referralGroupId,domainOnly:!!referral.domainOnly&&referral.domainOnly,pageUrl:referral.url},group=ctrl.state.referralGroupsObj[referral.referralGroupId];group.pages.push(obj),ctrl.state.saving=!0,referralGroupsService.save(group).then(function(){ctrl.state.saving=!1,ctrl.fn.closeEditor(),ctrl.fn.getAll().then(ctrl.update()),notificationsService.success('Successfully assigned "'+referral.url+'" to the group:"'+group.name+'"')})},isUrl:function(input){return/^http(?:s)?:\/\//.test(input)},filter:{apply:function(){ctrl.fn.getAll()},resetAndApply:function(){ctrl.filter.currentPage=1,ctrl.fn.filter.apply()},query:function(){return{page:ctrl.filter.currentPage,pageSize:ctrl.filter.pageSize,amountOfDays:ctrl.filter.amountOfDays}},previousPage:function(){ctrl.filter.currentPage--,ctrl.fn.filter.apply()},nextPage:function(){ctrl.filter.currentPage++,ctrl.fn.filter.apply()}}}}function umsUnscoredReferralsService($http){var endpoint="/umbraco/backoffice/engage/ReferralScoring/";this.getAll=function getAll(filter){return $http({method:"POST",url:endpoint+"getunscoredreferrals",data:filter}).then(function(response){return response.data})}}function umsPersonalizationScoringTable(){var ctrl=this;this.$onInit=function(){ctrl.limit>0&&ctrl.limit<10&&(ctrl.state.sliderOptions.ceil=ctrl.limit)},this.state={sliderOptions:{floor:0,ceil:10,showSelectionBar:!0,translate:function(value){return isNaN(value)&&(value=0),value}}}}function umsProfileLocationContainerController($location){var ctrl=this;this.$onInit=function(){var visitorId=$location.search().id;null!=visitorId||null!=this.sharedVisitorId?(null==visitorId&&null!=this.sharedVisitorId&&(visitorId=this.sharedVisitorId,$location.search("id",this.sharedVisitorId)),this.sharedVisitorId=visitorId):ctrl.fn.redirectToUrl()},ctrl.fn={redirectToUrl:function(){$location.path(ctrl.redirectUrl)}}}function umsDonutChartController(){var ctrl=this,umsColors=["#3444B2","#2c7dff","#4BB2FF","#8BE9FF","#CBCFEB"];ctrl.chart=null,ctrl.state={chartLabels:[],chartDataSet:[],chartColors:[],chartTextColors:[],chartTotal:0},this.$onInit=function(){ctrl.chart=null,ctrl.fn.buildChart(ctrl.chartData)},ctrl.fn={buildChart:function(data){data.forEach(function(item,index){ctrl.state.chartLabels.push(item.label),ctrl.state.chartDataSet.push(item.data),ctrl.state.chartTotal+=item.data,ctrl.fn.buildChartColors(item,index)}),ctrl.fn.renderChart()},buildChartColors:function(item,index){var color=umsColors[index%umsColors.length],chartTextColors=color;ctrl.state.chartColors.push(color),ctrl.state.chartTextColors.push(chartTextColors)},renderChart:function(){ctrl.chart={labels:ctrl.state.chartLabels,data:[ctrl.state.chartDataSet],type:"doughnut",colors:ctrl.state.chartColors,datasetOverride:{borderColor:"#fff",hoverBorderColor:"#fff",borderWidth:6,hoverBorderWidth:6},options:{responsive:!0,maintainAspectRatio:!0,cutoutPercentage:75}}}}}function umsGraphPersonaJourneyScoringController(){var ctrl=this;ctrl.identifier=null,ctrl.chartLabels=[],ctrl.chartDataset=[],ctrl.backgroundColor=[],ctrl.chart=null,ctrl.state={chartAnnotations:[],showDifference:!1,differenceValue:null},this.$onInit=function(){ctrl.identifier=Object.keys(ctrl.group).some(function(key){return"personas"==key})?"personas":"steps",ctrl.fn.processRawInput(ctrl.chartData,function(){ctrl.fn.buildChartAnnotations(),ctrl.fn.buildChart()})},ctrl.fn={processRawInput:function(arr,callback){arr.forEach(function(item,index){ctrl.chartLabels.push(item.title),item.isActive?ctrl.backgroundColor.push("rgba(52, 68, 178, 1)"):ctrl.backgroundColor.push("rgba(217, 217, 217, 1)"),item.score?ctrl.chartDataset.push(item.score):ctrl.chartDataset.push(0),index===arr.length-1&&callback&&callback()})},buildChart:function(){ctrl.chart={labels:ctrl.chartLabels,data:[ctrl.chartDataset],type:"horizontalBar",datasetOverride:[{barThickness:10,backgroundColor:ctrl.backgroundColor,borderColor:"rgba(236, 236, 236, 1)",borderWidth:0}],options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{categoryPercentage:.99,barPercentage:1,gridLines:{display:!1,drawBorder:!1},ticks:{min:0}}],yAxes:[{gridLines:{display:!1,drawBorder:!1},scaleShowLabels:!1,ticks:{display:!1}}]},annotation:{annotations:ctrl.state.chartAnnotations},tooltips:{enabled:!1,custom(tooltipModel){var tooltipEl=document.querySelector('div[data-belongs-to-chart-id="'+this._chart.canvas.id+'"]');if(0!==tooltipModel.opacity){if(tooltipEl.classList.remove("above","below","no-transform"),tooltipModel.yAlign?tooltipEl.classList.add(tooltipModel.yAlign):tooltipEl.classList.add("no-transform"),tooltipModel.body){var titleLines=tooltipModel.title||[],bodyLines=tooltipModel.body.map(function getBody(bodyItem){return bodyItem.lines}),innerHtml="<thead>";titleLines.forEach(function(title){innerHtml+="<tr><th>"+title+"</th></tr>"}),innerHtml+="</thead><tbody>",bodyLines.forEach(function(body,i){var colors=tooltipModel.labelColors[i],style="background:"+colors.backgroundColor;style+="; border-color:"+colors.borderColor,innerHtml+="<tr><td>"+('<span class="ums-chart-persona__tooltip-color" style="'+style+'"></span>')+body+"</td></tr>"}),innerHtml+="</tbody>",tooltipEl.querySelector("table").innerHTML=innerHtml}tooltipEl.style.opacity=1,tooltipEl.style.left=tooltipModel.caretX+"px",tooltipEl.style.top=tooltipModel.caretY+"px"}else tooltipEl.style.opacity=0}}}}},buildChartAnnotations:function(){ctrl.state.differenceValue=Math.round(ctrl.fn.getDifferenceValues(ctrl.group,ctrl.identifier)),ctrl.state.chartAnnotations.push(function thresholdLine(val){return{drawTime:"afterDatasetsDraw",id:"hline",type:"line",mode:"vertical",scaleID:"x-axis-0",borderDash:[2,3],value:val,borderColor:"#1A254F",borderWidth:1}}(ctrl.group.minimumParticipationScoreThreshold)),ctrl.state.showDifference&&ctrl.group.minimumDeviation>0&&ctrl.state.chartAnnotations.push(function differenceLine(val){return{drawTime:"afterDatasetsDraw",id:"differenceline",type:"line",mode:"vertical",scaleID:"x-axis-0",borderDash:[2,3],value:val,borderColor:"#FF7F50",borderWidth:1,label:{backgroundColor:"rgba(0,0,0,0.75)",font:{style:"bold",color:"#fff"},xPadding:4,yPadding:4,cornerRadius:2,position:"center",enabled:!0,content:val}}}(ctrl.state.differenceValue))},getDifferenceValues:function(selectedGroup,identifier){var minimumDifference=selectedGroup.minimumDeviation,type=selectedGroup.minimumDeviationType,highestTwoValues=selectedGroup[identifier].slice().sort(function(x,y){return y.score-x.score}).slice(0,2);if(highestTwoValues=highestTwoValues.map(function(x){return x.score}),!selectedGroup[identifier].some(function(item){return item.isActive})&&highestTwoValues[0]>selectedGroup.minimumParticipationScoreThreshold){var differenceBetweenBars=highestTwoValues[0]-highestTwoValues[1];if(ctrl.state.showDifference=!0,0===type)return highestTwoValues[0]+(minimumDifference-differenceBetweenBars);if(1===type){var minimumDifferenceFromPercentage=highestTwoValues[0]*(minimumDifference/100);return highestTwoValues[0]+(minimumDifferenceFromPercentage-differenceBetweenBars)}}}}}function umsGraphProfileDonutController(){var ctrl=this,umsColors=["#3444B2","#2c7dff"];ctrl.chart=null,ctrl.state={chartLabels:[],chartDataSet:[],chartColors:[],chartTextColors:[],chartTotal:0},this.$onInit=function(){ctrl.chart=null,ctrl.fn.buildChart(ctrl.chartData)},ctrl.fn={buildChart:function(data){data.forEach(function(item,index){ctrl.state.chartLabels.push(item.label),ctrl.state.chartDataSet.push(item.data),ctrl.state.chartTotal+=item.data,ctrl.fn.buildChartColors(item,index)}),ctrl.fn.renderChart()},buildChartColors:function(item,index){var color=umsColors[index%umsColors.length],chartTextColors=color;"Unknown"===item.label&&(color="#D9D9D9",chartTextColors="#68676B"),ctrl.state.chartColors.push(color),ctrl.state.chartTextColors.push(chartTextColors)},renderChart:function(){ctrl.chart={labels:ctrl.state.chartLabels,data:[ctrl.state.chartDataSet],type:"doughnut",colors:ctrl.state.chartColors,datasetOverride:{borderColor:"#fff",hoverBorderColor:"#fff",borderWidth:10,hoverBorderWidth:10},options:{responsive:!0,maintainAspectRatio:!0,cutoutPercentage:75}}}}}function umsGraphProfileGrowthController(){var ctrl=this,umsColors=["#3444B2","#2c7dff"];ctrl.chart=null,ctrl.state={chartLabels:[],chartLabelsFull:[],chartDataSets:[],chartDataSetLabels:[],chartDataSetOverrides:[],chartColors:[],chartTextColors:[],monthByName:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},this.$onInit=function(){ctrl.fn.buildChart(ctrl.chartData)},ctrl.fn={buildTrend:function(allDataSets){var arr=[];allDataSets.forEach(function(dataSet){dataSet.forEach(function(score,scoreIndex){arr[scoreIndex]?arr[scoreIndex]=arr[scoreIndex]+score:arr[scoreIndex]=score})}),ctrl.state.chartColors.push("#FFBA00"),ctrl.state.chartTextColors.push("#FFBA00");return ctrl.state.chartDataSetOverrides.push({label:"Trend",borderWidth:2,borderColor:"#FFBA00",pointBorderWidth:0,pointStyle:"line",pointBackgroundColor:"#FFBA00",backgroundColor:"rgba(0, 0, 0, 0)",lineTension:0,type:"line",order:0}),arr},buildChart:function(data){var keyCounter=0;for(var itemKey in data)ctrl.state.chartDataSets.push([]),ctrl.state.chartDataSetLabels.push(ctrl.fn.revertCamelCase(itemKey)),ctrl.fn.buildChartColors(itemKey,keyCounter),data[itemKey].forEach(function(item){0===keyCounter&&(ctrl.state.chartLabelsFull.push(ctrl.state.monthByName[item.month-1]+" - "+item.year),ctrl.state.chartLabels.push(ctrl.state.monthByName[item.month-1])),ctrl.state.chartDataSets[keyCounter].push(item.count)}),keyCounter++;var graphTrend=ctrl.fn.buildTrend(ctrl.state.chartDataSets);ctrl.state.chartDataSets.push(graphTrend),ctrl.fn.renderChart()},buildChartColors:function(label,index){var color=umsColors[index%umsColors.length],chartTextColors=color;"unknown"!==label&&"Unknown"!==label||(color="#D9D9D9",chartTextColors="#68676B"),ctrl.state.chartColors.push(color),ctrl.state.chartTextColors.push(chartTextColors),ctrl.state.chartDataSetOverrides.push(ctrl.fn.buildDataSetOverride(label,color))},buildDataSetOverride:function(label,color){return{label:label=ctrl.fn.revertCamelCase(label),borderWidth:1,type:"bar",backgroundColor:color,borderWidth:0,order:1}},revertCamelCase:function(input){var result=input.replace(/([A-Z])/g," $1");return result.charAt(0).toUpperCase()+result.slice(1)},renderChart:function(){ctrl.chart={labels:ctrl.state.chartLabels,type:"bar",data:ctrl.state.chartDataSets,colors:ctrl.state.chartColors,datasetOverride:ctrl.state.chartDataSetOverrides,options:{tooltips:{callbacks:{title:function(tooltipItems){return ctrl.state.chartLabelsFull[tooltipItems[0].index]}}},scales:{xAxes:[{stacked:!0,gridLines:{drawOnChartArea:!1},ticks:{fontColor:"rgba(104, 103, 107, 0.5)"}}],yAxes:[{stacked:!0,gridLines:{drawOnChartArea:!1},ticks:{fontColor:"rgba(104, 103, 107, 0.5)"}}]}}}}}}function umsGraphProfilePotentialController(service){var ctrl=this;ctrl.chartLabels=[{min:"Non-engaged",max:"Engaged"},{min:"In-active",max:"Active"}],ctrl.chartDataset=[10,40],ctrl.state={pinColor:152,loading:!0},this.$onInit=function(){ctrl.fn.getAll(ctrl.visitorId)},ctrl.fn={getAll:function(id){return service.getProfilePotential(id).then(function(response){return response.active=Math.round(100*response.active),response.engaged=Math.round(100*response.engaged),ctrl.chartDataset=response,ctrl.state.pinColor=ctrl.fn.updatePinColor(response),ctrl.state.loading=!1,response})},updatePinColor:function(dataSet){var pinColor=(dataSet.active+100)/2.6+(dataSet.engaged+100)/2.6;return pinColor>152&&(pinColor=152),pinColor}}}function umsProfileActivityTableEventsController(){this.state={eventTypes:[{name:"",icon:null},{name:"Start visit",icon:null},{name:"End visit",icon:null},{name:"Max reached scroll depth",icon:"icon-event-scroll"},{name:"Goal reached",icon:"icon-event-goal-reached"},{name:"Click",icon:"icon-event-click"},{name:"Event triggered",icon:"icon-event-click"},{name:"Video event",icon:"icon-event-video"},{name:"Umbraco Forms",icon:"icon-event-form"}]}}function umsProfileActivityTablePageviewsController(service){var ctrl=this;ctrl.state={eventsByPageviewId:{}},ctrl.fn={getData:{eventsByPageviewId:function(pageviewId){return service.getEventsOfPageview(pageviewId).then(function(response){return ctrl.state.eventsByPageviewId[pageviewId]=response,response})}},openEventRow:function(pageview){pageview.eventInfoVisible=!pageview.eventInfoVisible,ctrl.state.eventsByPageviewId[pageview.id]||ctrl.fn.getData.eventsByPageviewId(pageview.id)},toDateTime:function(secs){var t=new Date(1970,0,1);return t.setSeconds(secs),t},slicedUrl:function(url){return url.split("/").slice(3).join("/")}}}angular.module("engage").component("umsGoalTypeEditorPageview",umsAnalyticsGoalTypeEditorPageviewComponent),angular.module("engage").component("umsAppliedPersonalizationCreate",{template:'<div><form ng-submit="$ctrl.fn.save()" ng-class="{\'s-checkform\': $ctrl.state.formWasSubmitted}" name="$ctrl.state.form" ng-if="!$ctrl.state.loading"><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container ums-boxed__container--fullheight ums-boxed__container--fresh"><h2>1. Information</h2><p class="umsDescription">Provide some information about this personalization rule so other users also understand the purpose of it.</p><div class="ums-form__row"><label class="ums-form__label">Title *</label> <input type="text" class="ums-form__input" placeholder="Title" required no-dirty-check ng-model="$ctrl.state.personalization.name"></div><div class="ums-form__row"><label class="ums-form__label">Description *</label> <textarea no-dirty-check ng-model="$ctrl.state.personalization.description" required class="ums-form__input" cols="30" rows="10"></textarea></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container ums-boxed__container--fullheight ums-boxed__container--fresh"><div class="ums-boxed__flexlayout"><div class="ums-boxed__flexsection"><h2>2. Setup Personalization</h2><p class="umsDescription">Choose if you want to personalize one specific page or a broader set of pages.</p></div><div class="ums-boxed__flexsection ums-boxed__flexsection--divided ums-boxed__flexsection--grow"><div class="ums-form__row" style="margin-bottom: 20px;"><label class="ums-form__label">Select personalization type *</label><select class="ums-form__select" no-dirty-check ng-model="$ctrl.state.personalization.type" required ng-options="type.id as type.name for type in $ctrl.state.personalizationTypes"><option selected disabled value>Select a personalization type...</option></select></div><div ng-if="$ctrl.state.personalization.type === 1"><label class="ums-form__label">Select multiple pages *</label><p class="umsDescription">The following pages will be personalized.</p><div class="ums-form__row"><select class="ums-form__select" required ng-if="$ctrl.state.languages.length > 1" no-dirty-check ng-model="$ctrl.state.pagePicker.culture" ng-options="lang.culture as lang.name for lang in $ctrl.state.languages" ng-change="$ctrl.fn.pagePicker.setPages()"><option value>Select a culture...</option></select><div class="ums-input--flex"></div><ums-render-property alias="\'Umbraco.MultiNodeTreePicker\'" name="\'Engage - Node Picker\'" style="width: 100%" config="$ctrl.state.pagePicker.config" no-dirty-check ng-model="$ctrl.state.pagePicker.pages" ng-change="$ctrl.fn.pagePicker.setPages()"></ums-render-property></div></div><div ng-if="$ctrl.state.personalization.type === 2"><label class="ums-form__label">Select document types * <span class="ums-form__info__bullet"><ums-icon class="ums-form__info__icon" id="icon-info" modifier="sm"></ums-icon><span class="ums-form__info__text">The following document types will be subjected to this personalization</span></span></label><p class="umsDescription">The following document types will be subjected to this personalization.</p><select class="ums-form__select" required ng-if="$ctrl.state.languages.length > 1" no-dirty-check ng-model="$ctrl.state.contentTypePicker.culture" ng-options="lang.culture as lang.name for lang in $ctrl.state.languages" ng-change="$ctrl.fn.contentTypePicker.updateCulture()"><option selected disabled value>Select a culture...</option></select><div class="ums-form__scroller"><div ng-repeat="contentType in $ctrl.state.contentTypePicker.contentTypes track by contentType.contentTypeId"><label class="ums-form__doctypeLabel"><span class="ums-form__doctypePicker"><input type="checkbox" ng-checked="$ctrl.fn.contentTypePicker.isChecked(contentType.contentTypeId)" ng-click="$ctrl.fn.contentTypePicker.toggle(contentType.contentTypeId)"> {{ contentType.name }}</span></label></div></div></div></div><div class="ums-boxed__flexsection ums-boxed__flexsection--divided"><div class="ums-form__row"><label class="ums-form__label">Add/Edit code *</label><div class="ums-form__innerrow-special"><button class="btn ums-button ums-button--line-success ums-button--icon ums-form__innerrow-special__button ums-form__innerrow-special__button--grow" type="button" ng-click="$ctrl.fn.overlay.openCode()" ng-if="$ctrl.state.personalization.css || $ctrl.state.personalization.javascript"><ums-icon id="icon-checkmark-boxed" modifier="btn"></ums-icon><span>Code included</span></button> <button class="btn ums-button ums-button--main ums-button--gear ums-button--icon ums-form__innerrow-special__button ums-form__innerrow-special__button--grow" type="button" ng-click="$ctrl.fn.overlay.openCode()" ng-if="!$ctrl.state.personalization.css && !$ctrl.state.personalization.javascript"><span>Include CSS/JavaScript</span><ums-icon id="icon-plus" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--icon ums-button--line ums-form__innerrow-special__button" type="button" ng-click="$ctrl.fn.overlay.openCode()" ng-disabled="!$ctrl.state.personalization.css && !$ctrl.state.personalization.javascript" style="margin-left: 10px;"><span>Edit</span><ums-icon id="icon-edit" modifier="btn"></ums-icon></button><div class="ums-popup__enter"><button class="btn ums-button ums-button--icon ums-button--line ums-form__innerrow-special__button" type="button" ng-click="$ctrl.fn.showPreview()" ng-disabled="!$ctrl.state.personalization.previewUrl"><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button><div class="ums-popup__holder ums-popup__holder--auto-whitespace" ng-if="!$ctrl.state.personalization.previewUrl">No preview URL found</div><div class="ums-popup__holder ums-popup__holder--auto-whitespace" ng-if="$ctrl.state.personalization.previewUrl">Preview (in new page)</div></div></div></div></div></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3 is-animated"><div class="ums-boxed__container ums-boxed__container--fullheight ums-boxed__container--fresh"><h2>3. Settings</h2><p class="umsDescription">Select the segment that triggers this personalization rule.</p><div class="ums-form__row"><label for="form0123" class="ums-form__label">Triggered by segment *</label><select id="form0123" class="ums-form__select ums-form__select--flex" no-dirty-check ng-model="$ctrl.state.personalization.segmentId" ng-options="segment.id as segment.name for segment in $ctrl.state.segments" required><option value selected disabled>Select segment...</option></select></div></div></div></div><div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-3 ums-button__wrapper ums-button__wrapper--left"><button ng-click="$ctrl.fn.back()" type="button" class="btn ums-button ums-button--icon ums-button--line"><ums-icon id="icon-arrow" modifier="btn" style="transform:scaleX(-1);"></ums-icon><span>Back</span></button> <button ng-click="$ctrl.fn.remove()" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error" type="button" ng-disabled="$ctrl.state.personalization.id === 0"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button><div class="ums-form__toggle" ng-click="$ctrl.state.personalization.isActive = !$ctrl.state.personalization.isActive"><label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular">&nbsp;</label> <input type="checkbox" name="toggle-2" id="toggle-2-1" class="ums-form__toggle__input s-toggleByAngular"> <label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular" ng-class="{\'ums-form__toggle__label--archived\': !$ctrl.state.personalization.isActive}"><span ng-show="!$ctrl.state.personalization.isActive">Not active</span> <span ng-show="$ctrl.state.personalization.isActive">Active</span></label></div></div><div class="ums-flexgrid__item ums-flexgrid__item--2-3 ums-button__wrapper ums-button__wrapper--right"><div class="ums-boxed__flexlayout ums-boxed__flexlayout--row" ng-if="$ctrl.state.scheduleVisible || $ctrl.state.personalization.started"><div class="ums-boxed__flexsection--nomargin"><div class="ums-form__label">Scheduled on:</div></div><div class="ums-boxed__flexsection--nomargin"><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker datepicker-umbraco datepicker-umbraco-flatpickr" style="max-height: 40px; width: 340px;"><umb-flatpickr options="$ctrl.state.timepicker.options" on-setup="$ctrl.fn.onSetupPicker(fpItem, $ctrl.state.personalization.started)" on-change="$ctrl.fn.onTimePickerChange($ctrl.state.timepicker.timestamp)" class="ums-segmentparameter__datepicker-input"></umb-flatpickr><span class="ums-form__input-icon"><ums-icon id="icon-date-select" modifier="sm"></ums-icon></span> <button class="ums-segmentparameter__datepicker-btn" ng-if="$ctrl.state.personalization.started" ng-click="$ctrl.state.timepicker.timestamp.clear()" type="button"><i class="icon-delete"></i></button></div></div></div><span class="ums-popup__enter"><button class="btn ums-button ums-button--icon ums-button--line" type="button" ng-disabled="$ctrl.state.personalization.started" ng-click="$ctrl.fn.schedule()"><span ng-if="!$ctrl.state.scheduleVisible && !$ctrl.state.personalization.started">Schedule</span> <span ng-if="$ctrl.state.scheduleVisible || $ctrl.state.personalization.started">Close schedule</span><ums-icon id="icon-status-schedule" modifier="btn"></ums-icon></button><div class="ums-popup__holder ums-popup__holder--auto-whitespace" ng-if="$ctrl.state.personalization.started">Clear schedule before closing.</div></span> <button class="btn ums-button ums-button--line ums-button--icon" type="submit" ng-click="$ctrl.state.publish = true" ng-if="$ctrl.state.existing && !$ctrl.state.running"><span>Update & Start</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--line ums-button--icon" type="submit" ng-click="$ctrl.state.publish = false" ng-if="$ctrl.state.existing && $ctrl.state.running"><span>Update & Stop</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button> <span class="ums-popup__enter"><button class="btn ums-button ums-button--gear ums-button--icon" type="submit" ng-class="{\'ums-button--success\': $ctrl.state.existing, \'ums-button--main\': !$ctrl.state.existing }" ng-disabled="$ctrl.state.personalization.started && !$ctrl.state.existing"><span ng-if="!$ctrl.state.existing">Save</span> <span ng-if="$ctrl.state.existing">Update</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button><div class="ums-popup__holder ums-popup__holder--auto-whitespace" ng-if="$ctrl.state.personalization.started && !$ctrl.state.existing">Scheduled personalizations must be started.</div></span> <button class="btn ums-button ums-button--success ums-button--icon" type="submit" ng-click="$ctrl.state.publish = true" ng-if="!$ctrl.state.existing && !$ctrl.state.running"><span>Save & Start</span><ums-icon id="icon-save" modifier="btn"></ums-icon></button></div></div></form><div class="ums-flexgrid__container" ng-if="$ctrl.state.personalization.created"><div class="ums-flexgrid__item"><div class="ums-infoicons__bar ums-infoicons__bar--margin-top"><div class="ums-infoicons__baritem"><div class="ums-popup__enter ums-infoicons__baritem__icon"><ums-icon id="icon-status-draft" modifier="sm"></ums-icon><div class="ums-popup__holder">Created by: {{$ctrl.state.personalization.createdByUmbracoUserName}}</div></div><span class="ums-infoicons__baritem__name" ng-bind="$ctrl.state.personalization.createdByUmbracoUserName"></span> <span class="ums-infoicons__baritem__date" ng-bind="$ctrl.state.personalization.created | umsDate"></span></div><div class="ums-infoicons__baritem" ng-if="$ctrl.state.personalization.updated"><div class="ums-popup__enter ums-infoicons__baritem__icon"><ums-icon id="icon-edit" modifier="sm"></ums-icon><div class="ums-popup__holder">Updated by: {{$ctrl.state.personalization.updatedByUmbracoUserName}}</div></div><span class="ums-infoicons__baritem__name" ng-bind="$ctrl.state.personalization.updatedByUmbracoUserName"></span> <span class="ums-infoicons__baritem__date" ng-bind="$ctrl.state.personalization.updated | umsDate"></span></div></div></div></div><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay><ums-applied-personalization-variant-editor ng-if="$ctrl.state.overlay.codeOverlay.isOpen" title="Include code" close="$ctrl.fn.overlay.closeCode()" variant="$ctrl.state.personalization" preview-variant="$ctrl.fn.preview(variant, true)"></ums-applied-personalization-variant-editor></div>',controller:["umsAppliedPersonalizationService","umsSegmentService","languageResource","contentResource","umsDocumentTypePermissionsService","$location","notificationsService",umsAppliedPersonalizationCreateController]}),angular.module("engage").component("umsAppliedPersonalizationVariantEditor",{template:'<div class="u-marketing-suite"><ums-overlay dark="true" large="true" close="$ctrl.close()" ng-if="$ctrl.variant"><ums-overlay-header><h2 ng-bind="$ctrl.title"></h2><p class="umsDescription" ng-if="$ctrl.text" ng-bind="$ctrl.text"></p></ums-overlay-header><ums-overlay-body><div><ums-css-js-editor css="$ctrl.state.css" js="$ctrl.state.js"></ums-css-js-editor></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span style="display: flex; align-items: center;"><button class="btn ums-button ums-button--line ums-button--icon" type="button" ng-click="$ctrl.close()"><span>Cancel</span></button> <button class="btn ums-button ums-button--link-error ums-button--icon" type="button" ng-if="$ctrl.removeVariant != null" ng-click="$ctrl.removeVariant(); $ctrl.close();"><span>Remove variant</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button></span> <span style="display: flex; align-items: center;"><button class="btn ums-button ums-button--main ums-button--icon" type="button" ng-if="$ctrl.previewVariant" ng-click="$ctrl.fn.saveAndPreview($ctrl.variant)"><span>Save & preview</span><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button> <button class="btn ums-button ums-button--success ums-button--icon" type="button" ng-click="$ctrl.fn.saveAndClose()"><span>Save and close</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay></div>',bindings:{variant:"=",title:"@?",text:"@?",close:"&?",save:"&?",removeVariant:"&?",previewVariant:"&?"},controller:["$q",umsAppliedPersonalizationVariantEditor]}),angular.module("engage").service("umsAppliedPersonalizationService",["$http",umsAppliedPersonalizationService]),angular.module("engage").component("umsAppliedPerzonalizationSingleItem",{template:'<div style="min-height: 180px;" class="ums-boxed__container ums-boxed__container--fullheight ums-boxed__container--clickable" ng-class="{\'ums-boxed__container--archived\': !$ctrl.item.isActive}"><div class="ums-boxed__content"><div class="ums-boxed__clicklayer" ng-click="$ctrl.onEdit({item: $ctrl.item})"></div><h3><span class="ums-boxed__number ums-popup__enter ums-popup__holder--left" ng-if="$ctrl.item.isActive"><span ng-bind="$ctrl.index"></span> <span class="ums-popup__holder">This personalization is the {{$ctrl.index}}{{$ctrl.getNumberSpelling($ctrl.index)}} to render</span></span> <span ng-bind="$ctrl.item.name"></span></h3><p ng-bind="$ctrl.item.description"></p><ul class="ums-infoicons__list" ng-if="$ctrl.item.segment"><li class="ums-infoicons__item ums-infoicons__item--50 ums-popup__enter"><ums-icon id="icon-segment-temporary" ng-if="$ctrl.item.segment.isTemporary"></ums-icon><ums-icon id="icon-segment-core" ng-if="!$ctrl.item.segment.isTemporary"></ums-icon><span>{{$ctrl.item.segment.name}}</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace ums-popup__holder--inline">This personalization is rendered when a visitor is part of <span ng-if="$ctrl.item.segment.isTemporary">temporary</span><span ng-if="!$ctrl.item.segment.isTemporary">core</span> segment: {{$ctrl.item.segment.name}}</div></li><li class="ums-infoicons__item ums-infoicons__item--50 ums-popup__enter"><ums-icon id="icon-personalization"></ums-icon><span ng-if="$ctrl.item.type === 0">Single Page</span> <span ng-if="$ctrl.item.type === 1">Multiple Pages</span> <span ng-if="$ctrl.item.type === 2">Document Type</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace ums-popup__holder--inline">This personalization is triggerd on <span ng-if="$ctrl.item.type === 0">a single page</span> <span ng-if="$ctrl.item.type === 1">multiple pages</span> <span ng-if="$ctrl.item.type === 2">a document type</span></div></li><li class="ums-infoicons__item ums-infoicons__item--100 ums-popup__enter" ng-class="{\'s-expired umsColor-error\': $ctrl.state.hasExpiredDate}"><ums-icon id="icon-stopwatch" ng-class="{\'umsColor-error\': $ctrl.state.hasExpiredDate}"></ums-icon><span ng-if="!$ctrl.item.segment.endTime">No end date</span> <span ng-if="$ctrl.item.segment.endTime">Till {{$ctrl.item.segment.endTime | date:\'longDate\' }}</span><div class="ums-popup__holder ums-popup__holder--left ums-popup__holder--auto-whitespace ums-popup__holder--inline"><span ng-if="!$ctrl.item.segment.endTime">This segment has no end date</span> <span ng-if="$ctrl.item.segment.endTime" style="white-space: normal;">This segment has the end date {{$ctrl.item.segment.endTime | date:\'longDate\' }} {{$ctrl.state.hasExpiredDate ? \'which is expired\' : \'\'}}</span></div></li></ul></div><div class="ums-gotoarrow__list"><a class="ums-gotoarrow" ng-if="$ctrl.item.previewUrl" ng-href="{{$ctrl.item.previewUrl}}" target="_blank"><span>Preview</span><ums-icon id="icon-fullscreen"></ums-icon></a> <button class="ums-gotoarrow" ng-if="$ctrl.item.type === 0" ng-click="$ctrl.onEdit({item: $ctrl.item})" type="button"><span>Edit</span><ums-icon id="icon-edit"></ums-icon></button> <a class="ums-gotoarrow" ng-if="$ctrl.item.type === 1 || $ctrl.item.type === 2" ng-href="/umbraco/#/engage/personalization/applied-personalization/create?id={{$ctrl.item.id}}"><span>Edit</span><ums-icon id="icon-edit"></ums-icon></a></div></div>',bindings:{item:"<",index:"<",onEdit:"<"},controller:function(){var $ctrl=this;this.state={hasExpiredDate:!1},this.$onInit=function(){$ctrl.item.segment.endTime&&(this.state.hasExpiredDate=this.isExpired($ctrl.item.segment.endTime))},this.getNumberSpelling=function(index){return index%10==1&&11!==index?"st":index%10==2&&12!==index?"nd":index%10==3&&13!==index?"rd":"th"},this.isExpired=function(date){if(!date)return!1;var today=moment(),expirationDate=moment(date);return moment(expirationDate).isBefore(today)}}}),angular.module("engage").component("umsAppliedPersonalizationSinglePageEditor",{template:'<ums-overlay close="$ctrl.onClose()" ng-show="$ctrl.active" small="true" dark="true"><ums-overlay-header><h2>Add a new variant</h2><small>Please select a segment for which you want to personalize the experience of this page. Give the personalized variant a descriptive name and a short description.</small></ums-overlay-header><ums-overlay-body><div ng-show="!$ctrl.hasSegmentedProperty">This document type is not setup to be personalized. You should "Allow segmentation" for this document type and at least 1 property.<br><br><a href="#/settings/documentTypes/edit/{{$ctrl.contentTypeId}}" class="ums-button--link">Edit this Document Type</a></div><div ng-show="$ctrl.contentId === 0">The Umbraco node should be saved first before you can add a personalized variant.</div><form ng-submit="form.$valid && $ctrl.onSave({ item: $ctrl.item })" name="form" id="applied-personalisation-single-page-editor" ng-if="$ctrl.active && $ctrl.hasSegmentedProperty && $ctrl.contentId > 0" class="ums-form__grid-layout"><div class="ums-form__row ums-form__grid-layout--col-1"><label class="ums-form__label" for="apspe-segment">Select a segment *</label><select class="ums-form__select" no-dirty-check ng-model="$ctrl.item.segmentId" ng-options="segment.id as segment.name for segment in $ctrl.segments" id="apspe-segment" required><option value>Segment ...</option></select><div ng-if="$ctrl.segmentsInUse[$ctrl.item.segmentId]" style="margin-top: 8px; line-height: 1.2;"><input type="hidden" no-dirty-check ng-model="segmentInUse" required> <span class="ums-errorText" ng-bind-template="This segment is in use by personalization \'{{$ctrl.segmentsInUse[$ctrl.item.segmentId]}}\' and cannot be used again"></span></div></div><div class="ums-form__row ums-form__grid-layout--col-1"><label class="ums-form__label" for="apspe-name">Name *</label> <input class="ums-form__input" id="apspe-name" type="text" no-dirty-check ng-model="$ctrl.item.name" required></div><div class="ums-form__row ums-form__grid-layout--col-2 ums-form__grid-layout--row-span"><label class="ums-form__label" for="apspe-description">Description</label> <textarea class="ums-form__input" id="apspe-description" type="text" no-dirty-check ng-model="$ctrl.item.description" maxlength="255"></textarea></div></form></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-show="!$ctrl.hasSegmentedProperty || $ctrl.contentId === 0" type="button" ng-click="$ctrl.onClose()" class="ums-button ums-button--light">Close</button></span> <span><div class="ums-popup__enter" ng-show="$ctrl.hasSegmentedProperty && $ctrl.contentId > 0"><button class="btn ums-button ums-button--success" type="submit" form="applied-personalisation-single-page-editor" ng-disabled="$ctrl.segmentsInUse[$ctrl.item.segmentId]"><span>Add new variant</span></button><div ng-if="$ctrl.segmentsInUse[$ctrl.item.segmentId]" class="ums-popup__holder ums-popup__holder--offset ums-popup__holder--no-pointer is-animated">This segment is in use by personalization \'{{$ctrl.segmentsInUse[$ctrl.item.segmentId]}}\' and cannot be used again</div></div></span></ums-overlay-footer></ums-overlay>',bindings:{onInit:"&?",onSave:"&",onClose:"&",active:"<",input:"<?"},controller:["umsUtilService","umsSegmentService","umsAppliedPersonalizationService",umsAppliedPersonalizationSinglePageEditorController]}),angular.module("engage").component("umsAppliedPersonalizationSinglePageOverview",{template:'<div class="ums-flexgrid__container"><div class="ums-flexgrid__item ums-flexgrid__item--1-1"><h2 style="margin: 0; color: #000">Personalized Variants</h2><p>The variants will be applied in the order of segments. First the algorithm tries to apply the temporary segments, and then the core segments. If multiple segments apply, the segment with the highest priority is applied. Only one segment will be applied at a time.</p></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1"><div class="ums-flexgrid__container ums-flexgrid__container--flexstart is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--1-3" ng-repeat="item in $ctrl.items | filter: {isActive: true} | orderBy: [\'segment.isTemporary\', \'segment.sortOrder\', \'type\'] track by item.id"><ums-applied-perzonalization-single-item item="item" index="$index + 1" on-edit="$ctrl.onEdit"></ums-applied-perzonalization-single-item></div></div><div class="ums-flexgrid__container ums-flexgrid__container--flexstart is-animated" ng-show="inactiveItems.length > 0"><div class="ums-flexgrid__item ums-flexgrid__item--1-1"><ums-divider title="Inactive variants" icon="icon-project-archived"></ums-divider></div><div class="ums-flexgrid__item ums-flexgrid__item--1-3" ng-repeat="item in $ctrl.items | filter: {isActive: false} | orderBy: [\'segment.isTemporary\', \'segment.sortOrder\', \'type\'] as inactiveItems track by item.id"><ums-applied-perzonalization-single-item item="item" index="$index + 1" on-edit="$ctrl.onEdit"></ums-applied-perzonalization-single-item></div></div></div></div>',bindings:{onEdit:"&?",onInit:"&?"},controller:["umsAppliedPersonalizationService","umsUtilService","$element",function umsAppliedPersonalizationSinglePageOverviewController(service,utils,$element){var $ctrl=this,destroyFns=[];this.items=[],this.$onInit=function(){null!=this.onInit&&this.onInit({ctrl:this}),this.refresh(),this.handleContentAppActivation()},this.$onDestroy=function(){destroyFns.forEach(function(fn){fn()})},this.refresh=function(){var nodeId=utils.getCurrentContentId(),contentTypeId=utils.getCurrentContentTypeId(),culture=utils.getCurrentCulture();return service.getAllForPage(nodeId,contentTypeId,culture).then(function(items){this.items=items}.bind(this))},this.handleContentAppActivation=function(){destroyFns.push(utils.contentAppOnActivate($element,function(isActive){isActive&&$ctrl.refresh()}))}}]}),angular.module("engage").component("umsAppliedPersonalizationSinglePage",{template:'<div class="ums-content umsPaddingTop umsPaddingBottom"><div ng-show="$ctrl.editorCtrl != null && $ctrl.editorCtrl.item.id === 0 && $ctrl.editorCtrl.segments.length === 0" class="ums-flexgrid__item is-animated"><div class="ums-testdetail__empty__container"><img src="/App_Plugins/Umbraco.Engage/assets/a-b-testing.svg" alt><br><h2>No segments configured.</h2><p>Before you can start personalizing your website, you should first add some <a href="#/engage/personalization/segments" class="ums-button--link">segments.</a></p></div></div><div ng-show="$ctrl.editorCtrl != null && $ctrl.editorCtrl.item.id === 0 && $ctrl.editorCtrl.segments.length > 0 && $ctrl.overviewCtrl != null && $ctrl.overviewCtrl.items.length === 0" class="ums-flexgrid__item is-animated"><div class="ums-testdetail__empty__container"><img src="/App_Plugins/Umbraco.Engage/assets/a-b-testing.svg" alt><br><h2>This node has no personalized variants yet.</h2><p ng-show="!$ctrl.segmentSupport">Umbraco 8.7.0 is required to start personalizing Umbraco content of your website.</p><p ng-show="$ctrl.segmentSupport">Start personalizing your website by click "Add personalized variant"</p><button type="button" ng-show="$ctrl.segmentSupport" ng-click="$ctrl.add = true" class="ums-button ums-button--success">Add personalized variant</button></div></div><ums-applied-personalization-single-page-overview ng-show="$ctrl.editorCtrl != null && $ctrl.editorCtrl.segments.length > 0 && $ctrl.overviewCtrl != null && $ctrl.overviewCtrl.items.length > 0" on-init="$ctrl.overviewCtrl = ctrl" on-edit="$ctrl.openSplitview($ctrl.culture, item.umbracoSegmentAlias)"></ums-applied-personalization-single-page-overview><ums-portal to=".umb-editor-footer-content .umb-editor-footer-content__right-side" ng-if="$ctrl.showAddButton"><div class="ums-portal-content"><button type="button" ng-click="$ctrl.add = true" class="ums-button ums-button--success ums-button--as-ums-bar-button">Add personalized variant</button></div></ums-portal><ums-applied-personalization-single-page-editor active="$ctrl.add || $ctrl.edit" input="$ctrl.edit" on-init="$ctrl.editorCtrl = ctrl" on-save="$ctrl.save(item)" on-close="$ctrl.cancelEdit()"></ums-applied-personalization-single-page-editor></div>',require:{variantsCtrl:"^umbVariantContentEditors"},controller:["umsAppliedPersonalizationService","umsUtilService","$element","umsEventEmitter","umsState",umsAppliedPersonalizationSinglePageController]}),angular.module("engage").component("umsAppliedPersonalizationSplitviewEditor",{template:'<div class="u-marketing-suite" style="margin: 0;"><ums-overlay dark="true" close="$ctrl.close()" large="true"><ums-overlay-header><h3>Edit variant</h3></ums-overlay-header><ums-overlay-body><form ng-submit="form.$valid && $ctrl.submit()" ng-init="$ctrl.initForm()" id="applied-personalisation-splitview-editor" class="ums-form__grid-layout" name="form"><div class="ums-form__row ums-form__grid-layout--col-1"><label class="ums-form__label" for="apspe-segment">Select a segment *</label><select class="ums-form__select" ng-model="$ctrl.personalization.segmentId" ng-options="segment.id as segment.name for segment in $ctrl.segments" id="apspe-segment" required><option value>Segment ...</option></select><div ng-if="$ctrl.segmentsInUse[$ctrl.personalization.segmentId]" style="margin-top: 8px; line-height: 1.2;"><input type="hidden" ng-model="segmentInUse" required> <span class="ums-errorText" ng-bind-template="This segment is in use by personalization \'{{$ctrl.segmentsInUse[$ctrl.personalization.segmentId]}}\' and cannot be used again"></span></div></div><div class="ums-form__row ums-form__grid-layout--col-1"><label class="ums-form__label" for="apspe-name">Name *</label> <input class="ums-form__input" id="apspe-name" type="text" ng-model="$ctrl.personalization.name" required></div><div class="ums-form__row ums-form__grid-layout--col-2 ums-form__grid-layout--row-span"><label class="ums-form__label" for="apspe-description">Description</label> <textarea class="ums-form__input" id="apspe-description" type="text" ng-model="$ctrl.personalization.description" maxlength="255"></textarea></div><div class="ums-form__row ums-form__grid-layout--col-span-2"><label class="ums-form__label" for="apspe-customcode">Add custom code</label><ums-css-js-editor style="width: 100%;" css="$ctrl.personalization.css" js="$ctrl.personalization.javascript"></ums-css-js-editor></div></form></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span style="display: flex; align-items: center;"><button class="btn ums-button ums-button--line ums-button--icon" type="button" ng-click="$ctrl.close()"><span>Cancel</span></button> <button class="btn ums-button ums-button--link-error ums-button--icon" type="button" ng-click="$ctrl.delete({ personalization: $ctrl.personalization })"><span>Delete variant</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button><div class="ums-form__toggle" ng-click="$ctrl.personalization.isActive = !$ctrl.personalization.isActive"><label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular">&nbsp;</label> <input type="checkbox" name="toggle-2" id="toggle-2-1" class="ums-form__toggle__input s-toggleByAngular"> <label for="toggle-2-1" class="ums-form__toggle__label ums-form__toggle__label s-toggleByAngular" ng-class="{\'ums-form__toggle__label--archived\': !$ctrl.personalization.isActive}"><span ng-show="!$ctrl.personalization.isActive">Not active</span> <span ng-show="$ctrl.personalization.isActive">Active</span></label></div></span> <span style="display: flex; align-items: center;"><button class="btn ums-button ums-button--main ums-button--icon" type="button" ng-click="$ctrl.savePreview($ctrl.personalization)" ng-disabled="$ctrl.segmentsInUse[$ctrl.personalization.segmentId]"><span>Save & preview</span><ums-icon id="icon-fullscreen" modifier="btn"></ums-icon></button><div class="ums-popup__enter" style="margin-left: 5px;"><button class="btn ums-button ums-button--success ums-button--icon" form="applied-personalisation-splitview-editor" type="submit" ng-disabled="$ctrl.segmentsInUse[$ctrl.personalization.segmentId]"><span>Save and close</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button><div ng-if="$ctrl.segmentsInUse[$ctrl.personalization.segmentId]" class="ums-popup__holder ums-popup__holder--offset ums-popup__holder--no-pointer is-animated">This segment is in use by personalization \'{{$ctrl.segmentsInUse[$ctrl.personalization.segmentId]}}\' and cannot be used again</div></div></span></ums-overlay-footer></ums-overlay></div>',bindings:{onInit:"&?",save:"&",saveAndPreview:"&?",close:"&",delete:"&",input:"<"},controller:["umsSegmentService","umsAppliedPersonalizationService","$element",umsAppliedPersonalizationSplitviewEditorController]}),angular.module("engage").component("umsCampaignGroupsEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2 ng-if="$ctrl.state.isNew">Add new campaign group</h2><h2 ng-if="!$ctrl.state.isNew">Edit campaign group "{{$ctrl.state.group.name}}"</h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-score-group-editor-form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" name="$ctrl.form" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row"><label for="form-score-group-editor-1" class="ums-form__label">Title *</label> <input id="form-score-group-editor-1" class="ums-form__input" type="text" required maxlength="50" placeholder="Title of this group" ng-model="$ctrl.state.group.name"></div><div class="ums-form__row"><label for="form-score-group-editor-2" class="ums-form__label">Description *</label> <textarea id="form-score-group-editor-2" class="ums-form__input" rows="3" required maxlength="255" placeholder="Description of this group" ng-model="$ctrl.state.group.description"></textarea></div><div class="ums-form__row"><div class="ums-form__label">Campaigns</div><div class="rte" ng-if="!$ctrl.state.group.campaigns || $ctrl.state.group.campaigns.length === 0">There are no campaigns assigned to this group. Start assigning campaigns on the tab \'Unscored campaigns\'</div><div ng-repeat="campaign in $ctrl.state.group.campaigns track by $index" ng-if="$ctrl.group.campaigns && $ctrl.group.campaigns.length > 0" class="ums-form__row" style="margin-top: 3px; width: 100%; border-radius: 5px; align-items: center; border: 1px solid #D1D4DC; padding: 10px 15px;"><div style="display: flex; flex-direction: column; flex: 1; margin-right: 10px;"><div class="ums-form__row ums-form__row--small" ng-repeat="(paramKey, paramValue) in $ctrl.fn.filterdCampaign(campaign) track by $index"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox" style="height: 40px; line-height: 40px;"><strong ng-bind="$ctrl.fn.convertToSnakeCase(paramKey)" style="white-space: nowrap; min-width: 120px; display: inline-block"></strong> <input ng-value="paramValue" class="ums-form__input" style="width: 200px;" disabled></label></div></div><button type="button" class="btn ums-button ums-button--light ums-button--square-icon" ng-click="$ctrl.fn.removeCampaign($index)"><ums-icon id="icon-delete" modifier="xs"></ums-icon></button></div><input type="hidden" name="groupsArray" ng-model="$ctrl.state.group.pages"><div class="ums-error" ng-show="$ctrl.form.$submitted && $ctrl.form.$invalid">At least one URL should be entered</div></div><div class="ums-divider__container"><div class="ums-divider__title"><ums-icon id="icon-persona" modifier="md"></ums-icon><span>Persona groups</span></div><div class="ums-divider__line"></div></div><br><div ng-if="!$ctrl.state.loadingGroupData && !$ctrl.state.personaGroups || !$ctrl.state.loadingGroupData && $ctrl.state.personaGroups.length < 1" class="rte"><span>There are no personas configured. Please <a href="/umbraco/#/engage/personalization/personas">configure these first</a>, before scoring your campaigns.</span></div><div ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.personaGroups.length > 0 && $ctrl.state.personaGroups[0].personas.length < 1" class="rte"><span>You have no personas configured. You should <a href="/umbraco/#/engage/personalization/personas">add these personas first</a>, before you can score your campaigns.</span></div><div ng-repeat="personalizationScoringTable in $ctrl.state.personaGroups" ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.personaGroups.length > 0 && personalizationScoringTable.personas.length > 0"><ums-personalization-scoring-table table-data="personalizationScoringTable.personas" limit="personalizationScoringTable.upperScoreLimit" name="personalizationScoringTable.title" label="Persona"></ums-personalization-scoring-table><br></div><div class ng-if="$ctrl.state.loadingGroupData">Loading groups...</div><div class="ums-divider__container" ng-if="!$ctrl.state.loadingJourneys"><div class="ums-divider__title"><ums-icon id="icon-journey" modifier="md"></ums-icon><span>Journey groups</span></div><div class="ums-divider__line"></div></div><br><div ng-if="!$ctrl.state.loadingGroupData && !$ctrl.state.journeyGroups || !$ctrl.state.loadingGroupData && $ctrl.state.journeyGroups.length < 1" class="rte"><span>There are no journeys configured. Please <a href="/umbraco/#/engage/personalization/journeys">configure these first</a>, before scoring your campaigns.</span></div><div ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.journeyGroups.length > 0 && $ctrl.state.journeyGroups[0].steps.length < 1" class="rte"><span>You have no customer journey steps configured. You should <a href="/umbraco/#/engage/personalization/journeys">add these journey steps first</a>, before you can score your campaigns.</span></div><div ng-repeat="personalizationScoringTable in $ctrl.state.journeyGroups" ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.journeyGroups.length > 0 && personalizationScoringTable.steps.length > 0"><ums-personalization-scoring-table table-data="personalizationScoringTable.steps" limit="personalizationScoringTable.upperScoreLimit" name="personalizationScoringTable.title" label="Journey"></ums-personalization-scoring-table><br></div><div class ng-if="$ctrl.state.loadingGroupData">Loading groups...</div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button><div class="ums-popup__enter ums-button__placeholder"><button ng-click="$ctrl.remove()" ng-if="!$ctrl.state.isNew" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error ums-popup__enter" type="button" ng-disabled="$ctrl.state.group.pages.length > 0"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button><div class="ums-popup__holder" ng-if="$ctrl.state.group.pages.length > 0">This group contains {{$ctrl.state.group.pages.length}} campaign{{$ctrl.state.group.pages.length === 1 ? "" : "s"}}.<br>Delete all campaigns before you can delete the group.</div></div></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-score-group-editor-form" ng-click="$ctrl.state.formWasSaved = true" ng-disabled="$ctrl.isSaving" type="submit"><span ng-if="$ctrl.state.isNew">Add group</span> <span ng-if="!$ctrl.state.isNew">Update group</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{group:"=",close:"&",remove:"&",onSave:"&?",isSaving:"="},controller:["umsPersonaApi","umsCustomerJourneyApi","$q","umsUtilService",umsCampaignGroupsEditorController]}),angular.module("engage").component("umsCampaignGroupsTable",{template:'<div class="is-animated"><table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="4"><h3 class="umsFzLg">Campaign groups</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Groups</div></th><th class="ums-table__th"><div class="umsLabel">Description</div></th><th class="ums-table__th"><div class="umsLabel"># of campaigns</div></th><th class="ums-table__th"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="4" style="text-align: center;"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.groups.length === 0 && !$ctrl.state.loading"><td class="ums-table__td" colspan="4" style="text-align: center;"><span style="display: flex; flex-direction: column; align-items: center;"><span>No groups defined.</span> <button type="button" style="margin-top: 15px;" class="btn ums-button ums-button--icon ums-button--main" ng-click="$ctrl.fn.addNewGroup()"><span>Create your first group.</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.filter.filteredGroups.length > 0 && !$ctrl.state.loading" ng-repeat="group in $ctrl.state.filter.filteredGroups | orderBy: $ctrl.fn.sortGroups : true track by group.id"><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top"><strong ng-bind="group.name"></strong></td><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top" ng-bind="group.description"></td><td class="ums-table__td ums-table__td--align-top" ng-bind="group.campaigns.length"></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(group)" on-delete-click="$ctrl.fn.remove(group)"></ums-ui-table-action-buttons></td></tr></tbody></table><ums-campaign-groups-editor ng-if="$ctrl.state.edit" group="$ctrl.state.edit" close="$ctrl.fn.closeEditor()" remove="$ctrl.fn.remove($ctrl.state.edit)" on-save="$ctrl.fn.save($ctrl.state.edit)" is-saving="$ctrl.state.saving"></ums-campaign-groups-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay></div>',bindings:{isLoaded:"&",update:"&",bindChild:"&"},controller:["umsCampaignScoringService","notificationsService",umsCampaignGroupsTableController]}),angular.module("engage").component("umsScoredCampaignsTable",{template:'<div class="is-animated"><table class="ums-table__table ums-table__table--no-minwidth ums-table__table--block"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="11"><h3 class="umsFzLg">Scored campaigns</h3></td></tr></thead><tbody class="ums-table__tbody ums-table__table--block ums-table__table--overflow-scroll"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="8"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.scoredCampaigns.length === 0 && !$ctrl.state.loading"><td class="ums-table__td" colspan="8" style="text-align: center;"><span>No scored campaings found.</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.scoredCampaigns.length > 0 && !$ctrl.state.loading" ng-repeat="item in $ctrl.state.scoredCampaigns | orderBy: \'item.created\'"><td class="ums-table__td"><span ng-if="item.utmSource" ng-bind="item.utmSource"></span> <span ng-if="!item.utmSource" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmMedium" ng-bind="item.utmMedium"></span> <span ng-if="!item.utmMedium" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmCampaign" ng-bind="item.utmCampaign"></span> <span ng-if="!item.utmCampaign" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmTerm" ng-bind="item.utmTerm"></span> <span ng-if="!item.utmTerm" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmContent" ng-bind="item.utmContent"></span> <span ng-if="!item.utmContent" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmSourcePlatform" ng-bind="item.utmSourcePlatform"></span> <span ng-if="!item.utmSourcePlatform" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmCreativeFormat" ng-bind="item.utmCreativeFormat"></span> <span ng-if="!item.utmCreativeFormat" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmMarketingTactic" ng-bind="item.utmMarketingTactic"></span> <span ng-if="!item.utmMarketingTactic" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td ums-table__td--align-top"><span ng-if="item.campaignGroupId === null">-</span> <span ng-if="item.campaignGroupId !== null" ng-bind="$ctrl.state.groupsObj[item.campaignGroupId].name"></span></td><td class="ums-table__td ums-table__td--align-top"><span ng-if="!$ctrl.state.campaignVisitorsByCampaignId[item.id]">0</span> <span ng-if="$ctrl.state.campaignVisitorsByCampaignId[item.id]" ng-bind="$ctrl.state.campaignVisitorsByCampaignId[item.id]"></span></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(item)" on-delete-click="$ctrl.fn.remove(item)"></ums-ui-table-action-buttons></td></tr><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">utm_source</div></th><th class="ums-table__th"><div class="umsLabel">utm_medium</div></th><th class="ums-table__th"><div class="umsLabel">utm_campaign</div></th><th class="ums-table__th"><div class="umsLabel">utm_term</div></th><th class="ums-table__th"><div class="umsLabel">utm_content</div></th><th class="ums-table__th"><div class="umsLabel">utm_source_platform</div></th><th class="ums-table__th"><div class="umsLabel">utm_creative_format</div></th><th class="ums-table__th"><div class="umsLabel">utm_marketing_tactic</div></th><th class="ums-table__th"><div class="umsLabel">Campaign group</div></th><th class="ums-table__th"><div class="umsLabel"># of visitors</div></th><th class="ums-table__th"></th></tr></tbody></table></div><ums-campaign-scoring-editor ng-if="$ctrl.state.edit" campaign="$ctrl.state.edit" groups="$ctrl.state.groups" groups-obj="$ctrl.state.groupsObj" close="$ctrl.fn.closeEditor()" on-save="$ctrl.fn.save($ctrl.state.edit)" is-saving="$ctrl.state.saving"></ums-campaign-scoring-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay>',bindings:{update:"&"},controller:["umsCampaignScoringService","$q","notificationsService",umsScoredCampaignsTableController]}),angular.module("engage").component("umsUnscoredCampaignsTable",{template:'<div class="is-animated"><table class="ums-table__table ums-table__table--no-minwidth ums-table__table--block"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="9"><h3 class="umsFzLg">Unscored campaigns</h3></td></tr></thead><tbody class="ums-table__tbody ums-table__table--block ums-table__table--overflow-scroll"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="8"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.unscored.length === 0 && !$ctrl.state.loading"><td class="ums-table__td" colspan="8" style="text-align: center;"><span>No unscored campaings found.</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.unscored.length > 0 && !$ctrl.state.loading" ng-repeat="item in $ctrl.state.unscored | orderBy: \'item.created\'"><td class="ums-table__td"><span ng-if="item.utmSource" ng-bind="item.utmSource"></span> <span ng-if="!item.utmSource" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmMedium" ng-bind="item.utmMedium"></span> <span ng-if="!item.utmMedium" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmCampaign" ng-bind="item.utmCampaign"></span> <span ng-if="!item.utmCampaign" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmTerm" ng-bind="item.utmTerm"></span> <span ng-if="!item.utmTerm" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmContent" ng-bind="item.utmContent"></span> <span ng-if="!item.utmContent" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmSourcePlatform" ng-bind="item.utmSourcePlatform"></span> <span ng-if="!item.utmSourcePlatform" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmCreativeFormat" ng-bind="item.utmCreativeFormat"></span> <span ng-if="!item.utmCreativeFormat" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td"><span ng-if="item.utmMarketingTactic" ng-bind="item.utmMarketingTactic"></span> <span ng-if="!item.utmMarketingTactic" style="opacity: 0.5">&lt;empty&gt;</span></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--holds-button ums-table__td--align-top"><button class="btn ums-button ums-button--success ums-button--icon" type="button" ng-click="$ctrl.fn.edit(item)"><span>Assign</span><ums-icon id="icon-edit" modifier="xs"></ums-icon></button></td></tr><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">utm_source</div></th><th class="ums-table__th"><div class="umsLabel">utm_medium</div></th><th class="ums-table__th"><div class="umsLabel">utm_campaign</div></th><th class="ums-table__th"><div class="umsLabel">utm_term</div></th><th class="ums-table__th"><div class="umsLabel">utm_content</div></th><th class="ums-table__th"><div class="umsLabel">utm_source_platform</div></th><th class="ums-table__th"><div class="umsLabel">utm_creative_format</div></th><th class="ums-table__th"><div class="umsLabel">utm_marketing_tactic</div></th><th class="ums-table__th"></th></tr></tbody></table></div><ums-campaign-scoring-editor ng-if="$ctrl.state.edit" campaign="$ctrl.state.edit" groups="$ctrl.state.groups" groups-obj="$ctrl.state.groupsObj" close="$ctrl.fn.closeEditor()" on-save="$ctrl.fn.save($ctrl.state.edit)" is-saving="$ctrl.state.saving"></ums-campaign-scoring-editor>',bindings:{update:"&"},controller:["umsCampaignScoringService","notificationsService",umsUnscoredCampaignsTableController]}),angular.module("engage").component("umsPersonalizationScoreGroupEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2 ng-if="$ctrl.state.isNew">Add new referral group</h2><h2 ng-if="!$ctrl.state.isNew">Edit referral group "{{$ctrl.state.group.name}}"</h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-score-group-editor-form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" name="$ctrl.form" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row"><label for="form-score-group-editor-1" class="ums-form__label">Title *</label> <input id="form-score-group-editor-1" class="ums-form__input" type="text" required maxlength="50" placeholder="Title of this group" ng-model="$ctrl.state.group.name"></div><div class="ums-form__row"><label for="form-score-group-editor-2" class="ums-form__label">Description *</label> <textarea id="form-score-group-editor-2" class="ums-form__input" rows="3" required maxlength="255" placeholder="Description of this group" ng-model="$ctrl.state.group.description"></textarea></div><div class="ums-form__row"><div class="ums-form__label">URLs</div><div class="rte" ng-if="!$ctrl.state.group.pages || $ctrl.state.group.pages.length === 0">There are no urls assigned to this group. Start assigning urls on the tab \'Unscored referrals\'</div><div ng-repeat="urlItem in $ctrl.state.group.pages track by $index" ng-if="$ctrl.group.pages && $ctrl.group.pages.length > 0" class="ums-form__row" style="margin-top: 3px; width: 100%;"><input class="ums-form__input ums-form__input--flex" type="text" ng-model="$ctrl.state.group.pages[$index].pageUrl" name="urlList_{{$index}}" placeholder="Please enter you URL" disabled> <a ng-href="{{$ctrl.state.group.pages[$index].pageUrl}}" target="_blank" title="Go to \'{{$ctrl.state.group.pages[$index].pageUrl}}\'" class="btn ums-button ums-button--light ums-button--square-icon" style="margin-left: 5px;"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a> <button type="button" class="btn ums-button ums-button--light ums-button--square-icon" ng-click="$ctrl.fn.removeUrl($index)"><ums-icon id="icon-delete" modifier="xs"></ums-icon></button></div><input type="hidden" name="referralGroupsArray" ng-model="$ctrl.state.group.pages"><div class="ums-error" ng-show="$ctrl.form.$submitted && $ctrl.form.$invalid">At least one URL should be entered</div></div><div class="ums-divider__container"><div class="ums-divider__title"><ums-icon id="icon-persona" modifier="md"></ums-icon><span>Persona groups</span></div><div class="ums-divider__line"></div></div><br><div ng-if="!$ctrl.state.loadingGroupData && !$ctrl.state.personaGroups || !$ctrl.state.loadingGroupData && $ctrl.state.personaGroups.length < 1" class="rte"><span>There are no personas configured. Please <a href="/umbraco/#/engage/personalization/personas">configure these first</a>, before scoring your referral url\'s.</span></div><div ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.personaGroups.length > 0 && $ctrl.state.personaGroups[0].personas.length < 1" class="rte"><span>You have no personas configured. You should <a href="/umbraco/#/engage/personalization/personas">add these personas first</a>, before you can score your referral url\'s.</span></div><div ng-repeat="personalizationScoringTable in $ctrl.state.personaGroups" ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.personaGroups.length > 0 && personalizationScoringTable.personas.length > 0"><ums-personalization-scoring-table table-data="personalizationScoringTable.personas" limit="personalizationScoringTable.upperScoreLimit" name="personalizationScoringTable.title" label="Persona"></ums-personalization-scoring-table><br></div><div class ng-if="$ctrl.state.loadingGroupData">Loading groups...</div><div class="ums-divider__container" ng-if="!$ctrl.state.loadingJourneys"><div class="ums-divider__title"><ums-icon id="icon-journey" modifier="md"></ums-icon><span>Journey groups</span></div><div class="ums-divider__line"></div></div><br><div ng-if="!$ctrl.state.loadingGroupData && !$ctrl.state.journeyGroups || !$ctrl.state.loadingGroupData && $ctrl.state.journeyGroups.length < 1" class="rte"><span>There are no journeys configured. Please <a href="/umbraco/#/engage/personalization/journeys">configure these first</a>, before scoring your referral url\'s.</span></div><div ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.journeyGroups.length > 0 && $ctrl.state.journeyGroups[0].steps.length < 1" class="rte"><span>You have no customer journey steps configured. You should <a href="/umbraco/#/engage/personalization/journeys">add these journey steps first</a>, before you can score your referral url\'s.</span></div><div ng-repeat="personalizationScoringTable in $ctrl.state.journeyGroups" ng-if="!$ctrl.state.loadingGroupData && $ctrl.state.journeyGroups.length > 0 && personalizationScoringTable.steps.length > 0"><ums-personalization-scoring-table table-data="personalizationScoringTable.steps" limit="personalizationScoringTable.upperScoreLimit" name="personalizationScoringTable.title" label="Journey"></ums-personalization-scoring-table><br></div><div class ng-if="$ctrl.state.loadingGroupData">Loading groups...</div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button><div class="ums-popup__enter ums-button__placeholder"><button ng-click="$ctrl.remove()" ng-if="!$ctrl.state.isNew" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error ums-popup__enter" type="button" ng-disabled="$ctrl.state.group.pages.length > 0"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button><div class="ums-popup__holder" ng-if="$ctrl.state.group.pages.length > 0">This group contains {{$ctrl.state.group.pages.length}} referral{{$ctrl.state.group.pages.length === 1 ? "" : "s"}}.<br>Delete all referrals before you can delete the group.</div></div></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-score-group-editor-form" ng-click="$ctrl.state.formWasSaved = true" ng-disabled="$ctrl.isSaving" type="submit"><span ng-if="$ctrl.state.isNew">Add group</span> <span ng-if="!$ctrl.state.isNew">Update group</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{group:"=",close:"&",remove:"&",onSave:"&?",isSaving:"="},controller:["umsPersonaApi","umsCustomerJourneyApi","$q","umsUtilService",umsPersonalizationScoreGroupEditor]}),angular.module("engage").component("umsPersonalizationScoreScoredEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2>Edit scored referral "{{$ctrl.state.scoredReferral.url}}"</h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><label for="form-score-scored-editor-url" class="ums-form__label">URL *</label><form id="ums-score-scored-editor-form" name="$ctrl.form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><div class="ums-form__row" style="margin-top: 3px; width: 100%;"><input class="ums-form__input ums-form__input--flex" id="form-score-scored-editor-url" name="form-score-scored-editor-url" type="text" ng-model="$ctrl.state.scoredReferral.url" placeholder="Please enter you URL" required disabled> <a ng-href="{{$ctrl.state.scoredReferral.url}}" target="_blank" title="Go to \'{{$ctrl.state.scoredReferral.url}}\'" class="btn ums-button ums-button--light ums-button--square-icon" style="margin-left: 5px;"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></div><div class="ums-form__row"><div class="ums-form__label" name="form-score-scored-editor-domain-only">Score *</div><div class="ums-form__switch ums-form__switch--autosize"><input type="radio" name="form-score-scored-editor-domain-only-1" id="form-score-scored-editor-domain-only-1-1" ng-model="$ctrl.state.scoredReferral.domainOnly" ng-value="false" class="ums-form__switch__input" required> <label for="form-score-scored-editor-domain-only-1-1" class="ums-form__switch__label">Score this specific url</label> <input type="radio" name="form-score-scored-editor-domain-only-1" id="form-score-scored-editor-domain-only-1-2" ng-model="$ctrl.state.scoredReferral.domainOnly" ng-value="true" class="ums-form__switch__input" required> <label for="form-score-scored-editor-domain-only-1-2" class="ums-form__switch__label">Score the entire domain</label></div></div><div class="ums-form__row"><label for="form-score-unscored-editor-group" class="ums-form__label">Assign to group *</label><select id="form-score-unscored-editor-group" class="ums-form__select" type="text" required ng-model="$ctrl.state.selectedGroup" ng-options="group as group.name for group in $ctrl.state.referralGroups track by group.id"><option value>Select a group...</option></select></div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button> <button ng-click="$ctrl.remove()" ng-if="!$ctrl.state.isNew" class="btn ums-button ums-button--light ums-button--icon ums-button--link-error" type="button" ng-disabled="!$ctrl.state.referralGroups[$ctrl.state.scoredReferral.referralGroupId]"><span>Delete</span><ums-icon id="icon-delete" modifier="btn"></ums-icon></button></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-score-scored-editor-form" ng-click="$ctrl.state.formWasSaved = true" ng-disabled="$ctrl.isSaving" type="submit"><span>Save referral</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{scoredReferral:"=",referralGroups:"=",domainOnlyStatus:"=",close:"&",remove:"&?",onSave:"&",isSaving:"="},controller:["umsUtilService",umsPersonalizationScoreScoredEditor]}),angular.module("engage").component("umsPersonalizationScoreUnscoredEditor",{template:'<ums-overlay nopadding="true" close="$ctrl.close()" small="true"><ums-overlay-header><h2>Assign: {{$ctrl.state.unscoredReferral.url}}</h2></ums-overlay-header><ums-overlay-body><div class="ums-overlay__content__item ums-overlay__content__item--gray umsPaddingTop umsPaddingBottom"><form id="ums-score-unscored-editor-form" name="$ctrl.form" ng-submit="$ctrl.form.$valid && $ctrl.fn.save()" ng-class="{\'s-checkform\': $ctrl.state.formWasSaved}"><label for="form-score-unscored-editor-url" class="ums-form__label">URL *</label><div class="ums-form__row"><input class="ums-form__input ums-form__input--flex" id="form-score-unscored-editor-url" name="form-score-unscored-editor-url" type="text" ng-model="$ctrl.state.unscoredReferral.url" placeholder="Please enter you URL" required disabled> <a ng-href="{{$ctrl.state.unscoredReferral.url}}" target="_blank" title="Go to \'{{$ctrl.state.unscoredReferral.url}}\'" class="btn ums-button ums-button--light ums-button--square-icon" style="margin-left: 5px;"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></div><div class="ums-form__row"><div class="ums-form__label" name="form-score-unscored-editor-domain-only">Score *</div><div class="ums-form__switch ums-form__switch--autosize"><input type="radio" name="form-score-unscored-editor-domain-only-1" id="form-score-unscored-editor-domain-only-1-1" ng-model="$ctrl.state.unscoredReferral.domainOnly" ng-value="false" class="ums-form__switch__input" required> <label for="form-score-unscored-editor-domain-only-1-1" class="ums-form__switch__label">Score this specific url</label> <input type="radio" name="form-score-unscored-editor-domain-only-1" id="form-score-unscored-editor-domain-only-1-2" ng-model="$ctrl.state.unscoredReferral.domainOnly" ng-value="true" class="ums-form__switch__input" required> <label for="form-score-unscored-editor-domain-only-1-2" class="ums-form__switch__label">Score the entire domain</label></div></div><div class="ums-form__row"><label for="form-score-unscored-editor-group" class="ums-form__label">Assign to group *</label><select id="form-score-unscored-editor-group" class="ums-form__select" type="text" required ng-model="$ctrl.state.selectedGroup" ng-options="group as group.name for group in $ctrl.state.referralGroups track by group.id"><option value>Select a group...</option></select></div></form></div></ums-overlay-body><ums-overlay-footer class="ums-button__wrapper ums-button__wrapper--overlay"><span><button ng-click="$ctrl.close()" class="btn ums-button ums-button--light ums-button--icon" type="button">Cancel</button></span> <span><button class="btn ums-button ums-button--success ums-button--icon" form="ums-score-unscored-editor-form" ng-click="$ctrl.state.formWasSaved = true" ng-disabled="$ctrl.isSaving" type="submit"><span>Assign to group</span><ums-icon id="icon-arrow" modifier="btn"></ums-icon></button></span></ums-overlay-footer></ums-overlay>',bindings:{unscoredReferral:"=",referralGroups:"=",close:"&",remove:"&?",onSave:"&",isSaving:"="},controller:["umsUtilService",umsPersonalizationScoreUnscoredEditor]}),angular.module("engage").component("umsReferralGroupsTable",{template:'<div class="is-animated"><table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="5"><h3 class="umsFzLg">Referral groups</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Groups</div></th><th class="ums-table__th"><div class="umsLabel">Description</div></th><th class="ums-table__th"><div class="umsLabel"># of urls</div></th><th class="ums-table__th"><div class="umsLabel">Referred Visitors</div></th><th class="ums-table__th"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="5" style="text-align: center;"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.referralGroups.length === 0 && !$ctrl.state.loading"><td class="ums-table__td" colspan="5" style="text-align: center;"><span style="display: flex; flex-direction: column; align-items: center;"><span>No referral groups defined.</span> <button type="button" style="margin-top: 15px;" class="btn ums-button ums-button--icon ums-button--main" ng-click="$ctrl.fn.addNewGroup()"><span>Create your first group.</span><ums-icon id="icon-plus" modifier="xs"></ums-icon></button></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.filter.filteredReferralGroups.length > 0 && !$ctrl.state.loading" ng-repeat="referralGroup in $ctrl.state.filter.filteredReferralGroups | orderBy: $ctrl.fn.sortGroups : true track by referralGroup.id"><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top"><strong ng-bind="referralGroup.name"></strong></td><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top" ng-bind="referralGroup.description"></td><td class="ums-table__td ums-table__td--align-top" ng-bind="referralGroup.pages.length"></td><td class="ums-table__td ums-table__td--align-top">{{$ctrl.state.referredVisitorsPerGroup[referralGroup.id] || 0}}</td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(referralGroup)" on-delete-click="$ctrl.fn.remove(referralGroup)"></ums-ui-table-action-buttons></td></tr></tbody></table><div class="ums-pagination__container"><div class="ums-pagination__col"><label for="scoringPageSize" class="ums-pagination__label">Show rows:</label><select class="ums-pagination__select" name="scoringPageSize" id="scoringPageSize" ng-model="$ctrl.state.filter.pageSize" ng-options="o for o in $ctrl.state.pageSizes" ng-change="$ctrl.fn.filter.resetAndApply()"></select></div><div class="ums-pagination__col"><label class="ums-pagination__label">{{ $ctrl.state.filter.fromRow + 1 }}-{{ $ctrl.state.filter.toRow }} of {{ $ctrl.state.referralGroups.length }}</label> <button type="button" class="ums-pagination__button" ng-if="$ctrl.state.filter.page > 1" ng-click="$ctrl.fn.filter.previousPage()"><ums-icon id="icon-arrow" modifier="xs ums-icon--rotate-180"></ums-icon></button> <button type="button" class="ums-pagination__button" ng-if="$ctrl.state.filter.page < $ctrl.state.filter.totalPages" ng-click="$ctrl.fn.filter.nextPage()"><ums-icon id="icon-arrow" modifier="xs"></ums-icon></button></div></div></div><ums-personalization-score-group-editor ng-if="$ctrl.state.edit" group="$ctrl.state.edit" close="$ctrl.fn.closeEditor()" remove="$ctrl.fn.remove($ctrl.state.edit)" on-save="$ctrl.fn.save($ctrl.state.edit)" is-saving="$ctrl.state.saving"></ums-personalization-score-group-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay>',bindings:{isLoaded:"&",update:"&",bindChild:"&"},controller:["umsReferralGroupsService","notificationsService",umsReferralGroupsTable]}),angular.module("engage").service("umsReferralGroupsService",["$http",umsReferralGroupsService]),angular.module("engage").component("umsScoredReferralsTable",{template:'<div class="is-animated"><table class="ums-table__table ums-table__table--no-minwidth"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="5"><h3 class="umsFzLg">Scored referrals</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">URL</div></th><th class="ums-table__th"><div class="umsLabel">Score</div></th><th class="ums-table__th"><div class="umsLabel">Referral Group</div></th><th class="ums-table__th"><div class="umsLabel">Referred Visitors</div></th><th class="ums-table__th"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="5"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.scoredReferrals.length === 0 && !$ctrl.state.loading"><td class="ums-table__td" colspan="5" style="text-align: center;"><span>No scored referrals found.</span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.scoredReferrals.length > 0 && !$ctrl.state.loading" ng-repeat="referralItem in $ctrl.state.scoredReferrals | orderBy: \'referralItem.referrals\'"><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--analytics"><span class="ums-table__item-contents ums-table__item-contents--center"><strong ng-bind="referralItem.url"></strong> <a ng-if="$ctrl.fn.isUrl(referralItem.url)" ng-href="{{referralItem.url}}" target="_blank" title="Go to \'{{referralItem.url}}\'" class="ums-table__fullscreen-button"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></span></td><td class="ums-table__td ums-table__td--align-top"><span ng-if="!$ctrl.state.domainOnlyStatus[referralItem.id].domainOnly">Specific url</span> <span ng-if="$ctrl.state.domainOnlyStatus[referralItem.id].domainOnly">Domain</span></td><td class="ums-table__td ums-table__td--align-top"><span ng-if="$ctrl.state.referralGroups.length < 1" style="opacity: 0.5;">Loading groups...</span> <span ng-if="$ctrl.state.referralGroups.length > 0 && !referralItem.referralGroupId">-</span> <span ng-if="$ctrl.state.referralGroups.length > 0&& referralItem.referralGroupId" ng-bind="$ctrl.state.referralGroupsObj[referralItem.referralGroupId].name"></span></td><td class="ums-table__td ums-table__td--align-top" ng-bind="referralItem.referrals"></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--align-top"><ums-ui-table-action-buttons on-edit-click="$ctrl.fn.edit(referralItem)" on-delete-click="$ctrl.fn.remove(referralItem)"></ums-ui-table-action-buttons></td></tr></tbody></table><div class="ums-pagination__container"><div class="ums-pagination__col"><label for="scoringPageSize" class="ums-pagination__label">Show rows:</label><select class="ums-pagination__select" name="scoringPageSize" id="scoringPageSize" ng-model="$ctrl.filter.pageSize" ng-options="o for o in $ctrl.filter.pageSizes" ng-change="$ctrl.fn.filter.resetAndApply()"></select></div><div class="ums-pagination__col"><label class="ums-pagination__label">{{ $ctrl.filter.fromRow}}-{{ $ctrl.filter.toRow }} of {{ $ctrl.filter.totalPages }}</label> <button type="button" class="ums-pagination__button" ng-if="$ctrl.filter.currentPage && $ctrl.filter.currentPage > 1" ng-click="$ctrl.fn.filter.previousPage()"><ums-icon id="icon-arrow" modifier="xs ums-icon--rotate-180"></ums-icon></button> <button type="button" class="ums-pagination__button" ng-if="$ctrl.filter.currentPage && $ctrl.filter.currentPage < $ctrl.filter.totalPages" ng-click="$ctrl.fn.filter.nextPage()"><ums-icon id="icon-arrow" modifier="xs"></ums-icon></button></div></div></div><ums-personalization-score-scored-editor ng-if="$ctrl.state.edit" scored-referral="$ctrl.state.edit" referral-groups="$ctrl.state.referralGroupsObj" domain-only-status="$ctrl.state.domainOnlyStatus[$ctrl.state.edit.id].domainOnly" close="$ctrl.fn.closeEditor()" remove="$ctrl.fn.remove($ctrl.state.edit)" on-save="$ctrl.fn.save($ctrl.state.edit)" is-saving="$ctrl.state.saving"></ums-personalization-score-scored-editor><ums-ui-confirm-overlay ng-if="$ctrl.state.confirm.fn" title="$ctrl.state.confirm.header" confirm-yes-action="$ctrl.state.confirm.fn(); $ctrl.state.confirm = null" close="$ctrl.state.confirm = null"></ums-ui-confirm-overlay>',bindings:{update:"&"},controller:["umsScoredReferralsService","umsReferralGroupsService","$q","notificationsService",umsScoredReferralsTable]}),angular.module("engage").service("umsScoredReferralsService",["$http",umsScoredReferralsService]),angular.module("engage").component("umsUnscoredReferralsTable",{template:'<div class="is-animated"><table class="ums-table__table ums-table__table--no-minwidth"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="4"><h3 class="umsFzLg">Unscored referrals</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">URL</div></th><th class="ums-table__th"><div class="umsLabel">Referred Visitors</div></th><th class="ums-table__th"></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.loading"><td class="ums-table__td" colspan="4" style="text-align: center;"><span>Loading...</span></td></tr><tr class="ums-table__tr" ng-if="!$ctrl.state.loading && $ctrl.state.unscoredReferrals.length === 0"><td class="ums-table__td" colspan="4" style="text-align: center;"><span>No unscored referrals found.</span></td></tr><tr class="ums-table__tr" ng-if="!ctrl.state.loading && $ctrl.state.unscoredReferrals.length > 0" ng-repeat="referralItem in $ctrl.state.unscoredReferrals | orderBy: \'referralItem.referrals\' track by referralItem.id"><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--analytics"><span class="ums-table__item-contents ums-table__item-contents--center"><strong ng-bind="referralItem.url"></strong> <a ng-if="$ctrl.fn.isUrl(referralItem.url)" ng-href="{{referralItem.url}}" target="_blank" title="Go to \'{{referralItem.url}}\'" class="ums-table__fullscreen-button"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></span></td><td class="ums-table__td ums-table__td--align-top" ng-bind="referralItem.referrals"></td><td class="ums-table__td ums-table__td--right ums-table__td--nowrap ums-table__td--holds-button ums-table__td--align-top"><button class="btn ums-button ums-button--success ums-button--icon" type="button" ng-click="$ctrl.fn.edit(referralItem)"><span>Assign</span><ums-icon id="icon-edit" modifier="xs"></ums-icon></button></td></tr></tbody></table><div class="ums-pagination__container"><div class="ums-pagination__col"><label for="scoringPageSize" class="ums-pagination__label">Show rows:</label><select class="ums-pagination__select" name="scoringPageSize" id="scoringPageSize" ng-model="$ctrl.filter.pageSize" ng-options="o for o in $ctrl.filter.pageSizes" ng-change="$ctrl.fn.filter.resetAndApply()"></select></div><div class="ums-pagination__col"><label class="ums-pagination__label">{{ $ctrl.filter.fromRow}}-{{ $ctrl.filter.toRow }} of {{ $ctrl.filter.totalRowCount }}</label> <button type="button" class="ums-pagination__button" ng-if="$ctrl.filter.currentPage && $ctrl.filter.currentPage > 1" ng-click="$ctrl.fn.filter.previousPage()"><ums-icon id="icon-arrow" modifier="xs ums-icon--rotate-180"></ums-icon></button> <button type="button" class="ums-pagination__button" ng-if="$ctrl.filter.currentPage && $ctrl.filter.currentPage < $ctrl.filter.totalPages" ng-click="$ctrl.fn.filter.nextPage()"><ums-icon id="icon-arrow" modifier="xs"></ums-icon></button></div></div></div><ums-personalization-score-unscored-editor ng-if="$ctrl.state.edit" unscored-referral="$ctrl.state.edit" referral-groups="$ctrl.state.referralGroups" close="$ctrl.fn.closeEditor()" remove="$ctrl.fn.remove($ctrl.state.edit)" on-save="$ctrl.fn.save($ctrl.state.edit)" is-saving="$ctrl.state.saving"></ums-personalization-score-unscored-editor>',bindings:{update:"&"},controller:["umsUnscoredReferralsService","umsReferralGroupsService","notificationsService",umsUnscoredReferralsTable]}),angular.module("engage").service("umsUnscoredReferralsService",["$http",umsUnscoredReferralsService]),angular.module("engage").component("umsPersonalizationScoringTable",{template:'<ums-accordion-item name="{{$ctrl.name}}" class="is-animated" is-personalisation="true" is-open-default="true"><table class="ums-table__table s-toggle"><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel" ng-bind="$ctrl.label"></div></th><th class="ums-table__th"><div class="umsLabel ums-grouptable__scorelabel" ng-if="$ctrl.limit <= 10"><span ng-repeat="x in [].constructor($ctrl.state.sliderOptions.ceil + 1) track by $index">{{$index}}</span></div><span class="umsLabel ums-grouptable__scorelabel" ng-if="$ctrl.limit >= 10">Score from 0 - {{$ctrl.limit}}</span></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-repeat="tableItem in $ctrl.tableData track by tableItem.id"><td class="ums-table__td" width="33%" style="padding-right: 0;"><div class="ums-grouptable__wrapper"><div class="ums-grouptable__colorbar" style="background: {{tableItem.color}}"></div><div class="ums-grouptable__image"><img ng-src="{{tableItem.iconUrl}}" alt></div><div class="ums-grouptable__title"><span ng-bind="tableItem.title"></span> <span class="ums-popup__enter"><ums-icon id="icon-info" modifier="xs" ng-if="tableItem.description"></ums-icon><div class="ums-popup__holder ums-popup__holder--left" ng-if="tableItem.description" ng-bind="tableItem.description"></div></span></div></div></td><td class="ums-table__td"><div class="ums-grouptable__slider" ng-if="$ctrl.limit <= 10"><rzslider rz-slider-model="tableItem.scoring.score" rz-slider-options="$ctrl.state.sliderOptions"></rzslider></div><div class="ums-grouptable__slider" ng-if="$ctrl.limit > 10"><input class="ums-form__input" type="number" min="0" max="{{$ctrl.limit}}" placeholder="{{$ctrl.limit}}" ng-model="tableItem.scoring.score"></div></td></tr></tbody></table></ums-accordion-item>',bindings:{tableData:"=",name:"<",label:"<",limit:"<"},controller:[umsPersonalizationScoringTable]}),angular.module("engage").component("umsProfileActiveSegments",{transclude:!0,template:'<table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td"><h3 class="umsFzLg">Active segments</h3></td></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-repeat="segment in $ctrl.activeSegments | orderBy: [\'!isTemporary\', \'sortOrder\', \'name\']"><td class="ums-table__td"><h3 class="umsFzLg" ng-bind="segment.name"></h3><div ng-repeat="rule in segment.rules track by rule.type"><ums-segment-rule-display rule="$ctrl.rulesByType[rule.type]" negation="rule.isNegation" config="rule.config"></ums-segment-rule-display></div></td></tr></tbody></table>',bindings:{visitorId:"<"},controller:["umsProfileInfoService","umsSegmentRuleRepository","umsSegmentService","$q",function umsProfileActiveSegmentsController(profileInfoService,ruleRepo,segmentService,$q){var $ctrl=this;$ctrl.isLoading=!0,$ctrl.segmentsById={},$ctrl.rulesByType={},$ctrl.activeSegments=[],$ctrl.$onInit=function $onInit(){var getAllSegments=segmentService.getAll(),getAllRules=ruleRepo.getRules(),getActiveSegmentIds=profileInfoService.getLastActiveProfileSegments($ctrl.visitorId);$q.all([getAllSegments,getAllRules,getActiveSegmentIds]).then(function(responses){var allSegments=responses[0],allRules=responses[1],activeSegmentIds=responses[2];if(Array.isArray(allSegments)){$ctrl.segmentsById={};for(var i=0;i<allSegments.length;i++){var segment=allSegments[i];$ctrl.segmentsById[segment.id]=segment}}if(Array.isArray(allRules)){$ctrl.rulesByType={};for(i=0;i<allRules.length;i++){var rule=allRules[i];$ctrl.rulesByType[rule.type]=rule,rule.init()}}Array.isArray(activeSegmentIds)&&($ctrl.activeSegments=activeSegmentIds.map(function(sid){return $ctrl.segmentsById[sid]}).filter(function(segment){return null!=segment}))}).finally(function(){$ctrl.isLoading=!1}).then(function(activeSegmentIds){Array.isArray(activeSegmentIds)&&($ctrl.activeSegmentIds=activeSegmentIds)})}}]}),angular.module("engage").component("umsProfileCampaigns",{template:'<table class="ums-table__table ums-table__table--no-minwidth ums-table__table--faketable" style="height: 380px;"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="2"><h3 class="umsFzLg">Campaigns</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Date</div></th><th class="ums-table__th"><div class="umsLabel">Campaign</div></th><th class="ums-table__th"><div class="umsLabel">Source</div></th><th class="ums-table__th"><div class="umsLabel">Medium</div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.campaigns.length === 0"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" colspan="2"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-show="$ctrl.state.loading">Loading ...</span> <span ng-show="!$ctrl.state.loading">No campaigns found</span></span></td></tr><tr class="ums-table__tr" ng-repeat="campaign in $ctrl.state.campaigns | orderBy: \'-timestamp\'"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="campaign.Timestamp | date"></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="campaign.UtmCampaign"></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="campaign.UtmSource"></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="campaign.UtmMedium"></span></span></td></tr></tbody></table>',bindings:{visitorId:"<?"},controller:["$http",function($http){this.state={campaigns:[],loading:!1},this.$onInit=function(){this.getCampaigns().then(function(campaigns){this.state.campaigns=campaigns}.bind(this))},this.getCampaigns=function(){return this.state.loading=!0,$http.get("/umbraco/backoffice/engage/campaigns/getCampaignsByVisitor?visitorId="+this.visitorId).then(function(response){return response.data||[]}).finally(function(){this.state.loading=!1}.bind(this))}}]}),angular.module("engage").component("umsProfileCommerceOrders",{template:'<ums-overlay close="$ctrl.clearSelectedOrder()" ng-if="$ctrl.state.selectedOrderId"><ums-overlay-header ng-if="!$ctrl.state.selectedOrderExists"><h2>Order no longer exists in Umbraco Commerce.</h2></ums-overlay-header><ums-overlay-header ng-if="$ctrl.state.selectedOrderExists"><h3 ng-if="$ctrl.state.selectedOrderDetails.OrderNumber != null" class="h2 umsHeading">#{{$ctrl.state.selectedOrderDetails.OrderNumber}}</h3><h3 ng-if="$ctrl.state.selectedOrderDetails.OrderNumber == null" class="h2 umsHeading">#{{$ctrl.state.selectedOrderDetails.CartNumber}}</h3></ums-overlay-header><ums-overlay-body ng-if="$ctrl.state.selectedOrderExists"><ums-loader ng-if="$ctrl.state.selectedOrderDetails == null"></ums-loader><div ng-if="$ctrl.state.selectedOrderDetails != null"><h2>Customer Info</h2><h3>Name</h3><p>{{$ctrl.state.selectedOrderDetails.CustomerName }}</p><h3>Email</h3><p>{{$ctrl.state.selectedOrderDetails.CustomerEmail}}</p><hr><h2>Order Details</h2><h3>Create Date</h3><p>{{$ctrl.state.selectedOrderDetails.CreateDate | umsDate}}</p><h3>Finalized Date</h3><p ng-if="$ctrl.state.selectedOrderDetails.FinalizedDate != null">{{$ctrl.state.selectedOrderDetails.FinalizedDate | umsDate}}</p><p ng-if="$ctrl.state.selectedOrderDetails.FinalizedDate == null"><i>Order Not Yet Finalized</i></p><h3>Order Lines</h3><table class="ums-table__table ums-table__table--no-minwidth ums-table__table--faketable"><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Name</div></th><th class="ums-table__th"><div class="umsLabel">SKU</div></th><th class="ums-table__th"><div class="umsLabel">Quantity</div></th><th class="ums-table__th"><div class="umsLabel">Total Price Without Tax</div></th><th class="ums-table__th"><div class="umsLabel">Total Price With Tax</div></th></tr></thead><tbody><tr class="ums-table__tr" ng-repeat="orderline in $ctrl.state.selectedOrderDetails.OrderLines"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" style="padding-right: 0"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="orderline.Name"></strong></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" style="padding-right: 0"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="orderline.Sku"></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" style="padding-right: 0"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="orderline.Quantity"></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" style="padding-right: 0"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="orderline.PriceWithoutTax"></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" style="padding-right: 0"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="orderline.PriceWithTax"></span></span></td></tr></tbody></table><h3>Discount Codes</h3><ul><li ng-repeat="discountCode in $ctrl.state.selectedOrderDetails.DiscountCodes"><p>{{discountCode}}</p></li></ul><h3>Total Price Without Tax</h3><p>{{$ctrl.state.selectedOrderDetails.TotalPriceWithoutTax}} {{$ctrl.state.selectedOrderDetails.CurrencyCode}}</p><h3>Total Price With Tax</h3><p>{{$ctrl.state.selectedOrderDetails.TotalPriceWithTax}} {{$ctrl.state.selectedOrderDetails.CurrencyCode}}</p></div></ums-overlay-body></ums-overlay><table class="ums-table__table ums-table__table--no-minwidth ums-table__table--faketable" style="height: 380px;"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="2"><h3 class="umsFzLg">Order overview</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Order ID</div></th><th class="ums-table__th"><div class="umsLabel">Create Date</div></th><th class="ums-table__th"><div class="umsLabel">Finalized Date</div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="!$ctrl.state.commerceEnabled"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" colspan="3"><span class="ums-table__td--column ums-table__td--column-padding"><span>Umbraco Commerce & Umbraco Engage\'s Commerce Integration is not activated. More information can be found here:<br><a href="https://umbraco.com/products/add-ons/commerce/" target="_blank">https://umbraco.com/products/add-ons/commerce/</a></span></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.commerceEnabled && !$ctrl.state.hasAccessToCommerce"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" colspan="3"><span class="ums-table__td--column ums-table__td--column-padding"><span>You do not have access to Umbraco Commerce. Please contact your administrator.</span></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.commerceEnabled && $ctrl.state.hasAccessToCommerce && $ctrl.state.orders.length === 0"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" colspan="3"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-show="$ctrl.state.loading">Loading ...</span> <span ng-show="!$ctrl.state.loading">No orders found</span></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.commerceEnabled && $ctrl.state.hasAccessToCommerce && $ctrl.state.orders.length > 0" ng-repeat="order in $ctrl.state.orders | orderBy: \'-CreateDate\'" ng-click="$ctrl.onClick && $ctrl.onClick({selectedOrderId: order.OrderId})" style="cursor: pointer"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span style="mask-image: linear-gradient(to right, white 75%, transparent);"><span class="ums-table__td--column ums-table__td--column-padding"><strong>{{order.OrderId.substr(1,15)}}...</strong></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-if="order.CreateDate != null" ng-bind="order.CreateDate | umsDate"></span></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-if="order.FinalizedDate != null" ng-bind="order.FinalizedDate | umsDate"></span></span></td></tr></tbody></table>',bindings:{visitorId:"<?"},controller:["$http",function umsDefaultUmbracoFormsSubmissions($http){var rootUrl="/umbraco/backoffice/engage/commerce/";this.state={orders:[],commerceEnabled:!1,loading:!0,hasAccessToCommerce:!0,selectedOrderExists:!0,selectedOrderId:null,selectedOrderDetails:null},this.$onInit=function(){this.getAddons().then(addons=>{!0===addons.UmbracoCommerce?this.state.commerceEnabled=!0:this.state.loading=!1}).then(()=>{this.state.commerceEnabled&&this.getOrders().then(function(orders){!1===orders.hasAccessToCommerce?this.state.hasAccessToCommerce=!1:this.state.orders=orders}.bind(this))})},this.clearSelectedOrder=function(){this.state.selectedOrderId=null,this.state.selectedOrderDetails=null,this.state.selectedOrderExists=!0},this.onClick=function(orderId){this.state.selectedOrderId=orderId.selectedOrderId,this.getOrderDetails(orderId.selectedOrderId).then(function(orderDetails){!0===orderDetails.orderNotFound?this.state.selectedOrderExists=!1:this.state.selectedOrderExists=!0,this.state.selectedOrderDetails=orderDetails}.bind(this))},this.getOrderDetails=function(orderId){return $http.get(rootUrl+"getOrderDetails?orderId="+orderId).then(function(response){return response.data||[]}.bind(this))},this.getOrders=function(){return this.state.loading=!0,$http.get(rootUrl+"getOrdersByVisitor?visitorId="+this.visitorId).then(function(response){return response.data||[]}).finally(function(){this.state.loading=!1}.bind(this))},this.getAddons=function(){return $http({method:"GET",url:"/umbraco/backoffice/engage/addons/GetEnabledAddons"}).then(function(response){return response.data})}}]}),angular.module("engage").component("umsProfileGoalCompletions",{template:'<table class="ums-table__table ums-table__table--no-minwidth ums-table__table--faketable" style="height: 380px;"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="3"><h3 class="umsFzLg">Goals</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Goal info</div></th><th class="ums-table__th ums-table__th--fixed-xs"><div class="umsLabel">Conversions</div></th><th class="ums-table__th ums-table__th--fixed-xs"><div class="umsLabel">Value</div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.goalCompletions.length <= 0"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" colspan="3"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-if="!$ctrl.visitorType">No goals triggered by this visitor</span> <span ng-if="$ctrl.visitorType">No goals triggered by this bot</span></span></td></tr><tr class="ums-table__tr" ng-if="$ctrl.state.goalCompletions.length > 0" ng-repeat="goal in $ctrl.state.goalCompletions | orderBy: [\'completionCount\']"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="$ctrl.state.goalsById[goal.goalId].name"></strong> <span ng-bind="$ctrl.state.goalsById[goal.goalId].isMain ? \'Macro\' : \'Micro\'"></span></span></td><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top ums-table__th--fixed-xs"><strong ng-bind="goal.completionCount"></strong></td><td class="ums-table__td ums-table__td--hide-overflow ums-table__td--align-top ums-table__th--fixed-xs"><strong ng-bind="goal.totalValue"></strong></td></tr></tbody><tfoot ng-show="$ctrl.state.total.goalValue > 0"><tr class="ums-table__tr"><td class="ums-table__td ums-table__td--hide-overflow"></td><td class="ums-table__td ums-table__td--hide-overflow" colspan="2"><span class="ums-table__td--column"><span class="umsLabel umsTaR umsJustifyEnd">Total value</span> <strong class="umsFzXl umsColor-main umsTaR" style="margin: 0;" ng-bind="$ctrl.state.total.goalValue"></strong></span></td></tr></tfoot></table>',bindings:{visitorId:"<?"},controller:["$http","umsProfileInfoService","umsGoalsService",function($http,service,goalsService){var ctrl=this;this.state={goalCompletions:[],loading:!1,total:{goalValue:0},goalsById:{}},this.$onInit=function(){this.getGoals().then(function(goals){this.state.goalsById=goals}.bind(this)),this.getGoalCompletions(this.visitorId).then(function(goalCompletions){this.state.goalCompletions=goalCompletions}.bind(this))},this.getGoals=function(){return goalsService.getAll().then(function(response){let goalsById={};return response.data.forEach(function(goal){goalsById[goal.id]=goal}),goalsById})},this.getGoalCompletions=function(visitorId){return this.state.loading=!0,service.getGoalCompletionsOfVisitor(visitorId).then(function(response){return ctrl.getGoalCompletionsTotal(response,["totalValue"]),response}).finally(function(){this.state.loading=!1}.bind(this))},this.getGoalCompletionsTotal=function(arr,columns){var total=ctrl.getTotals(arr,columns);this.state.total.goalValue=total.totalValue},this.getTotals=function(arr,columns){var total={};return arr&&arr.length>0&&columns&&arr.forEach(function(item){columns.forEach(function(column){total[column]||(total[column]=0),total[column]+=item[column]})}),total}}]}),angular.module("engage").component("umsProfileJourneys",{template:'<table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td"><h3 class="umsFzLg">Journeys</h3></td><td class="ums-table__td"><div class="ums-table__flap-label-holder"><div class="ums-table__flap-label-item"><div class="ums-table__flap-label-text">Last registered values</div></div></div></td></tr></thead><tbody class="ums-table__tbody"><tr><td colspan="2"><div class="ums-flexgrid__container ums-flexgrid__container--lg ums-flexgrid__container--flexstart ums-flexgrid__container--fullwidth" ng-if="$ctrl.state.journeys.length > 0"><div class="ums-flexgrid__item ums-flexgrid__item--1-3" ng-repeat="group in $ctrl.state.journeys track by group.id" ng-if="group.steps.length > 0"><header style="display: flex; flex-direction: column; margin-bottom: 20px"><strong ng-bind="group.title" class="umsFzLg"></strong> <span class="umsDescription ums-chart-persona__description" style="margin-top: 10px"><span ng-if="!group.expiration">Never expires</span> <span ng-if="group.expiration && group.expirationType === 0">Expires after {{group.expiration}} day{{group.expiration === 1 ? \'\': \'s\'}}</span> <span ng-if="group.expiration && group.expirationType === 1">Expires after {{group.expiration}} session{{group.expiration === 1 ? \'\': \'s\'}}</span></span></header><ums-graph-persona-journey-scoring ng-if="!$ctrl.state.loading" group="group" chart-data="group.steps"></ums-graph-persona-journey-scoring></div></div></td></tr></tbody></table>',bindings:{visitorId:"<?"},controller:["$http","umsProfileInfoService","umsCustomerJourneyApi",function($http,service,journeyApi){var ctrl=this;this.state={journeys:null,journeyScoresById:{},loading:!1},this.$onInit=function(){return this.state.loading=!0,journeyApi.getAll().then(function(response){return ctrl.state.journeys=response,response}).then(function(){return ctrl.journeyScore(ctrl.visitorId).then(function(journeyScores){journeyScores.forEach(function(score){ctrl.state.journeyScoresById[score.customerJourneyStepId]={isActive:score.isActive,score:score.score}}),ctrl.state.journeys.forEach(function(journeyGroup){journeyGroup.steps.forEach(function(journeyStep){ctrl.state.journeyScoresById[journeyStep.id]&&(journeyStep.score=ctrl.state.journeyScoresById[journeyStep.id].score,journeyStep.isActive=ctrl.state.journeyScoresById[journeyStep.id].isActive)})})})}).finally(function(){this.state.loading=!1}.bind(this))},this.journeyScore=function(visitorId){return service.getCustomerJourneyScoreOfVisitor(visitorId).then(function(response){return response})}}]}),angular.module("engage").component("umsProfileLocationContainer",{transclude:!0,template:"<ng-transclude></ng-transclude>",bindings:{sharedVisitorId:"=",redirectUrl:"@?"},controller:["$location",umsProfileLocationContainerController]}),angular.module("engage").component("umsProfileMember",{template:'<table class="ums-table__table ums-profile__target-table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="2"><h3 class="umsFzLg" ng-if="!$ctrl.visitorType">Member & Profile</h3><h3 class="umsFzLg" ng-if="$ctrl.visitorType && $ctrl.visitorId">Bot: <span ng-bind="$ctrl.state.botNamesById[$ctrl.visitorId]"></span></h3><h3 class="umsFzLg" ng-if="$ctrl.visitorType && $ctrl.visitorIds"><span ng-repeat="visitorId in $ctrl.visitorIds">{{$index > 0 ? ", " : ""}} Bot: <span ng-bind="$ctrl.state.botNamesById[visitorId]"></span></span></h3></td></tr></thead><tbody ng-if="$ctrl.state.loading" class="ums-table__tbody ums-table__tbody--split ums-table__tbody--transparent-all"><tr class="ums-table__tr"><td class="ums-table__td ums-table__td--align-top" colspan="2"><span>Loading profile ...</span></td></tr></tbody><tbody ng-if="!$ctrl.state.loading && !$ctrl.state.profileInfo || $ctrl.state.error" class="ums-table__tbody ums-table__tbody--split ums-table__tbody--transparent-all"><tr class="ums-table__tr"><td class="ums-table__td ums-table__td--align-top" colspan="2"><span class="ums-table__inner-column"><span ng-show="$ctrl.visitorId || $ctrl.visitorIds">No profiles found for any of the specified visitor ID\'s</span> <span ng-show="$ctrl.state.error">{{$ctrl.state.error}}</span></span></td></tr></tbody><tbody ng-if="!$ctrl.state.loading && $ctrl.state.profileInfo" class="ums-table__tbody ums-table__tbody--split ums-table__tbody--transparent-all"><tr class="ums-table__tr" ng-if="$ctrl.state.profileInfo.isIdentified"><td class="ums-table__td ums-table__td--align-top ums-table__td--half"><span class="ums-table__inner-column"><span class="umsLabel">Identified on</span> <strong ng-bind="$ctrl.state.profileInfo.identifiedOn | date: \'dd-MM-yyyy\'"></strong></span></td><td class="ums-table__td ums-table__td--align-top ums-table__td--half"></td></tr><tr class="ums-table__tr"><td class="ums-table__td ums-table__td--align-top ums-table__td--half"><span class="ums-table__inner-column"><span class="umsLabel">First session</span> <strong ng-bind="$ctrl.state.profileInfo.firstSessionDate | date: \'dd-MM-yyyy, HH:mm\'"></strong></span></td><td class="ums-table__td ums-table__td--align-top ums-table__td--half"><span class="ums-table__inner-column"><span class="umsLabel">Last activity</span> <strong ng-bind="$ctrl.state.profileInfo.lastSessionDate | date: \'dd-MM-yyyy, HH:mm\'"></strong> <span class="umsLabel" style="text-transform: lowercase; opacity: 0.5;" ng-bind-template="{{ $ctrl.fn.getLastActiveDate($ctrl.state.profileInfo.lastSessionDate) }} days ago"></span></span></td></tr><tr class="ums-table__tr"><td class="ums-table__td ums-table__td--align-top ums-table__td--half"><span class="ums-table__inner-column"><span class="umsLabel">Total sessions</span> <strong ng-bind="$ctrl.state.profileInfo.sessionCount"></strong></span></td><td class="ums-table__td ums-table__td--align-top ums-table__td--half"><span class="ums-table__inner-column"><span class="umsLabel">Total pageviews</span> <strong ng-bind="$ctrl.state.profileInfo.pageviewCount"></strong></span></td></tr><tr class="ums-table__tr" ng-if="!$ctrl.visitorType"><td class="ums-table__td ums-table__td--half"><span class="ums-table__inner-column"><span class="umsLabel">Total time</span> <span ng-if="!$ctrl.state.profileInfo.sessionDurationInSeconds">-</span> <strong ng-if="$ctrl.state.profileInfo.sessionDurationInSeconds"><span ng-bind="$ctrl.fn.toDateTime($ctrl.state.profileInfo.sessionDurationInSeconds) | date:\'HH:mm:ss\'"></span> <span class="umsLabel" style="text-transform: lowercase; display: inline; margin-left: 5px; opacity: 0.5;">hh:mm:ss</span></strong></span></td><td class="ums-table__td ums-table__td--half"><span class="ums-table__inner-column"><span class="umsLabel">Total engaged time</span> <span ng-if="!$ctrl.state.profileInfo.engagedTimeInSeconds">-</span> <strong ng-if="$ctrl.state.profileInfo.engagedTimeInSeconds"><span ng-bind="$ctrl.fn.toDateTime($ctrl.state.profileInfo.engagedTimeInSeconds) | date:\'HH:mm:ss\'"></span> <span class="umsLabel" style="text-transform: lowercase; display: inline; margin-left: 5px; opacity: 0.5;">hh:mm:ss</span></strong></span></td></tr></tbody><tfoot ng-if="$ctrl.showMembers && $ctrl.state.profileInfo.members.length > 0"><tr class="ums-table__tr" ng-repeat="member in $ctrl.state.profileInfo.members"><td class="ums-table__td" colspan="2"><div class="ums-profile-related__member-grid"><div class="ums-profile-related__ident ums-profile-user__container"><img ng-if="member.avatar" ng-src="{{member.avatar}}" class="ums-profile-user__avatar" alt><div ng-if="!member.avatar" ng-bind="member.abbreviation" class="ums-profile-user__initials"></div></div><strong ng-bind="member.name" class="ums-profile-related__name umsFzLg umsColor-main"></strong> <span class="ums-profile-related__login ums-table__inner-column"><span class="umsLabel">Last login</span> <strong ng-if="member.umbracoMemberLastLogin !== null" ng-bind="member.umbracoMemberLastLogin | date: \'dd-MM-yyyy, HH:mm\'"></strong> <strong ng-if="member.umbracoMemberLastLogin === null">Not logged in yet</strong></span> <a ng-if="member.url" ng-href="{{member.url}}" class="btn ums-button ums-button--light ums-button--icon ums-button--sm-1 ums-profile-related__button"><span>Show</span><ums-icon id="icon-arrow" modifier="xs"></ums-icon></a></div></td></tr></tfoot><tfoot ng-if="$ctrl.showRelatedProfiles"><tr class="ums-table__tr" ng-if="$ctrl.visitorId"><td class="ums-table__td" colspan="2"><ums-member-related-profile visitor-id="$ctrl.visitorId"></ums-member-related-profile></td></tr><tr class="ums-table__tr" ng-if="$ctrl.visitorIds" ng-repeat="relatedProfileId in $ctrl.visitorIds"><td class="ums-table__td" colspan="2"><ums-member-related-profile visitor-id="relatedProfileId"></ums-member-related-profile></td></tr></tfoot></table>',bindings:{visitorId:"<?",visitorIds:"<?",visitorType:"<",showMembers:"<?",showRelatedProfiles:"<?"},controller:["umsProfileInfoService","$q",function umsProfileMemberController(service,$q){var ctrl=this;this.$onInit=function(){ctrl.fn.readVisitorIdAndGetData(),1==ctrl.visitorType&&ctrl.fn.getData.botNames()},ctrl.state={loading:!0,loadingBotNames:!0,error:null,visitorId:null,profileInfo:null,botNamesById:{}},ctrl.fn={readVisitorIdAndGetData:function(){ctrl.state.loading=!0,ctrl.state.error=null,ctrl.state.profileInfo=null;var getDataRequests=[];ctrl.visitorId||ctrl.visitorIds?(ctrl.visitorId&&getDataRequests.push(ctrl.fn.getData.profileInfo(ctrl.visitorId)),ctrl.visitorIds&&ctrl.visitorIds.forEach(function(id){getDataRequests.push(ctrl.fn.getData.profileInfo(id))}),$q.all(getDataRequests).then(function(){ctrl.state.loading=!1})):(ctrl.state.loading=!1,ctrl.state.error="No visitor ID specified")},getData:{profileInfo:function(id){var filter={visitorId:id};return service.getProfiles(filter).then(function(response){var firstProfile=response.results[0];return ctrl.state.profileInfo?response.results.forEach(function(result){ctrl.fn.addResultToExistingProfile(result)}):ctrl.state.profileInfo=firstProfile,response})},botNames:function(filter){return ctrl.state.loadingBotNames=!0,service.getBotNames(filter).then(function(response){ctrl.state.botNamesById=response,ctrl.state.loading.loadingBotNames=!1})}},addResultToExistingProfile:function(result){var profileInfo=ctrl.state.profileInfo;profileInfo.sessionDurationInSeconds+=result.sessionDurationInSeconds,profileInfo.engagedTimeInSeconds+=result.engagedTimeInSeconds,profileInfo.totalGoalCompletions+=result.totalGoalCompletions,profileInfo.totalGoalValue+=result.totalGoalValue,profileInfo.pageviewCount+=result.pageviewCount,profileInfo.sessionCount+=result.sessionCount,profileInfo.isIdentified=!0===result.isIdentified||profileInfo.isIdentified,profileInfo.hasParticipatedInAbTest=!0===result.hasParticipatedInAbTest||profileInfo.hasParticipatedInAbTest,profileInfo.hasViewedPersonalizedPage=!0===result.hasViewedPersonalizedPage||profileInfo.hasViewedPersonalizedPage,profileInfo.members=profileInfo.members.concat(result.members),profileInfo.lastSessionDate=result.lastSessionDate>profileInfo.lastSessionDate?result.lastSessionDate:profileInfo.lastSessionDate,profileInfo.firstSessionDate=result.firstSessionDate<profileInfo.firstSessionDate?result.firstSessionDate:profileInfo.firstSessionDate,!profileInfo.identifiedOn&&result.identifiedOn?profileInfo.identifiedOn=result.identifiedOn:result.identifiedOn&&result.identifiedOn<profileInfo.identifiedOn&&(profileInfo.identifiedOn=result.identifiedOn)},getLastActiveDate:function(lastActiveDate){var today=new Date,daysBetweenDates=ctrl.fn.daysBetweenDates(lastActiveDate,today);return parseInt(daysBetweenDates)},daysBetweenDates:function(dateOne,dateTwo){return dateOne=new Date(dateOne),dateTwo=new Date(dateTwo),dayDiff=(dateTwo-dateOne)/1e3/60/60/24,dayDiff},toDateTime:function(secs){var t=new Date(1970,0,1);return t.setSeconds(secs),t}}}]}),angular.module("engage").component("umsProfilePersonas",{template:'<table class="ums-table__table"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td"><h3 class="umsFzLg">Persona groups</h3></td><td class="ums-table__td"><div class="ums-table__flap-label-holder"><div class="ums-table__flap-label-item"><div class="ums-table__flap-label-text">Last registered values</div></div></div></td></tr></thead><tbody class="ums-table__tbody"><tr><td colspan="2"><div class="ums-flexgrid__container ums-flexgrid__container--lg ums-flexgrid__container--flexstart ums-flexgrid__container--fullwidth" ng-if="$ctrl.state.personas.length > 0"><article class="ums-flexgrid__item ums-flexgrid__item--1-3" ng-repeat="group in $ctrl.state.personas track by group.id" ng-if="group.personas.length > 0"><header style="display: flex; flex-direction: column; margin-bottom: 20px"><strong ng-bind="group.title" class="umsFzLg"></strong> <span class="umsDescription ums-chart-persona__description" style="margin-top: 10px"><span ng-if="!group.expiration">Never expires</span> <span ng-if="group.expiration && group.expirationType === 0">Expires after {{group.expiration}} day{{group.expiration === 1 ? \'\': \'s\'}}</span> <span ng-if="group.expiration && group.expirationType === 1">Expires after {{group.expiration}} session{{group.expiration === 1 ? \'\': \'s\'}}</span></span></header><ums-graph-persona-journey-scoring ng-if="!$ctrl.state.loading" group="group" chart-data="group.personas"></ums-graph-persona-journey-scoring></article></div></td></tr></tbody></table>',bindings:{visitorId:"<?"},controller:["$http","umsProfileInfoService","umsPersonaApi",function($http,service,personaApi){var ctrl=this;this.state={personas:null,personaScoresById:{},loading:!1},this.$onInit=function(){return this.state.loading=!0,personaApi.getAll().then(function(response){return ctrl.state.personas=response,response}).then(function(){return ctrl.personaScore(ctrl.visitorId).then(function(personaScores){personaScores.forEach(function(score){ctrl.state.personaScoresById[score.personaId]={isActive:score.isActive,score:score.score}}),ctrl.state.personas.forEach(function(personaGroup){personaGroup.personas.forEach(function(personaItem){ctrl.state.personaScoresById[personaItem.id]&&(personaItem.score=ctrl.state.personaScoresById[personaItem.id].score,personaItem.isActive=ctrl.state.personaScoresById[personaItem.id].isActive)})})})}).finally(function(){this.state.loading=!1}.bind(this))},this.personaScore=function(visitorId){return service.getPersonaScoreOfVisitor(visitorId).then(function(response){return response})}}]}),angular.module("engage").component("umsProfileSearchTerms",{template:'<table class="ums-table__table ums-table__table--no-minwidth ums-table__table--faketable" style="height: 380px;"><thead class="ums-table__thead"><tr class="ums-table__tr"><td class="ums-table__td" colspan="2"><h3 class="umsFzLg">Search Terms</h3></td></tr></thead><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th"><div class="umsLabel">Searchterm</div></th><th class="ums-table__th"><div class="umsLabel">Date</div></th></tr></thead><tbody class="ums-table__tbody"><tr class="ums-table__tr" ng-if="$ctrl.state.searchterms.length === 0"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow" colspan="2"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-show="$ctrl.state.loading">Loading ...</span> <span ng-show="!$ctrl.state.loading">No search terms found</span></span></td></tr><tr class="ums-table__tr" ng-repeat="searchterm in $ctrl.state.searchterms | orderBy: \'-timestamp\'"><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><strong ng-bind="searchterm.Query"></strong></span></td><td class="ums-table__td ums-table__td--nopadding ums-table__td--hide-overflow"><span class="ums-table__td--column ums-table__td--column-padding"><span ng-bind="searchterm.Timestamp | umsDate"></span></span></td></tr></tbody></table>',bindings:{visitorId:"<?"},controller:["$http",function umsDefaultUmbracoFormsSubmissions($http){this.state={searchterms:[],loading:!1},this.$onInit=function(){this.getSearchTerms().then(function(searchTerms){this.state.searchterms=searchTerms}.bind(this))},this.getSearchTerms=function(){return this.state.loading=!0,$http.get("/umbraco/backoffice/engage/searchterms/getSearchTermsByVisitor?visitorId="+this.visitorId).then(function(response){return response.data||[]}).finally(function(){this.state.loading=!1}.bind(this))}}]}),angular.module("engage").component("umsProfileSessionSpecs",{template:'<div class="ums-table__specs-holder" ng-if="$ctrl.session" ng-class="{\'ums-table__specs-holder--margin\': $ctrl.margin}"><div class="ums-table__specs-item ums-popup__enter" ng-if="$ctrl.session.operatingSystemName" ng-class="{\'s-active\': $ctrl.isActive || $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized, \'ums-table__specs-item--line\': $ctrl.line, \'is-fade-animated\': $ctrl.animate}"><div class="ums-popup__holder ums-popup__holder--break is-animated"><span>Operating system</span></div><div class="ums-icon-wrap"><ums-icon id="icon-device" modifier="md"></ums-icon><strong ng-bind="$ctrl.session.operatingSystemName"></strong></div></div><div class="ums-table__specs-item ums-popup__enter" ng-if="$ctrl.session.browserName || $ctrl.session.browserVersion" ng-class="{\'s-active\': $ctrl.isActive || $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized, \'ums-table__specs-item--line\': $ctrl.line, \'is-fade-animated\': $ctrl.animate}"><div class="ums-popup__holder ums-popup__holder--break ums-popup__holder--small is-animated"><span>Browser</span></div><div class="ums-icon-wrap"><ums-icon id="icon-browser" modifier="md"></ums-icon><strong><span ng-bind="$ctrl.session.browserName"></span> <span ng-bind="$ctrl.session.browserVersion"></span></strong></div></div><div class="ums-table__specs-item ums-popup__enter" ng-if="$ctrl.session.ipAddress" ng-class="{\'s-active\': $ctrl.isActive || $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized, \'ums-table__specs-item--line\': $ctrl.line, \'is-fade-animated\': $ctrl.animate}"><div class="ums-popup__holder ums-popup__holder--break ums-popup__holder--small is-animated"><span>IP Address</span></div><div class="ums-icon-wrap"><ums-icon id="icon-ip" modifier="md"></ums-icon><strong ng-bind="$ctrl.session.ipAddress"></strong></div></div><div class="ums-table__specs-item ums-popup__enter" ng-if="$ctrl.session.location" ng-class="{\'s-active\': $ctrl.isActive || $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized, \'ums-table__specs-item--line\': $ctrl.line, \'is-fade-animated\': $ctrl.animate}"><div class="ums-popup__holder ums-popup__holder--break ums-popup__holder--small is-animated"><span>Location</span></div><div class="ums-icon-wrap"><ums-icon id="icon-location-map" modifier="md"></ums-icon><strong ng-bind="$ctrl.session.location"></strong></div></div></div>',bindings:{session:"<",margin:"<?",isActive:"<?",line:"<?",animate:"<?"}}),angular.module("engage").component("umsSegmentRuleDisplay",{template:'<div class="ums-segmentinfo__parameter__box" ng-class="{\'ums-segmentinfo__parameter__box--current\': $ctrl.isActive, \'has-edit-button\': !$ctrl.isActive && $ctrl.edit}"><div class="ums-popup__enter ums-popup__enter--flex"><div class="ums-segmentinfo__parameter__icon"><ums-icon ng-if="$ctrl.rule.icon" id="{{$ctrl.rule.icon}}" modifier="md"></ums-icon><img ng-if="$ctrl.rule.iconUrl" ng-src="{{$ctrl.rule.iconUrl}}" class="ums-icon ums-icon--md"></div><div class="ums-segmentinfo__parameter__negation" ng-if="$ctrl.negation"><span>not</span></div><div class="ums-segmentinfo__parameter__text" data-segment-rule-display-container></div><div class="ums-popup__holder ums-popup__holder--offset ums-popup__holder--no-pointer ums-popup__holder--auto-whitespace is-animated"><span ng-if="$ctrl.isActive">Editing:</span> <span ng-bind="$ctrl.rule.name"></span></div></div><div class="ums-popup__enter ums-segmentinfo__parameter__popholder" ng-if="!$ctrl.isActive && $ctrl.edit"><button class="ums-segmentinfo__parameter__button" ng-click="$ctrl.edit()"><ums-icon id="icon-edit" modifier="xs"></ums-icon></button><div class="ums-popup__holder ums-popup__holder--small ums-popup__holder--offset ums-popup__holder--no-pointer is-animated">Edit parameter settings</div></div></div>',bindings:{rule:"<",config:"<",negation:"<?",edit:"&?",isActive:"<"},controller:["$element","$compile","$scope",function($element,$compile,$scope){this.$displayContainer=null,this.$onInit=function(){if(this.$displayContainer=$element.find("[data-segment-rule-display-container]"),null==this.$displayContainer)throw new Error("<ums-segment-rule-display>: required container element not found");this.renderRuleDisplay(this.rule)},this.renderRuleDisplay=function(rule){var template="<"+rule.components.display+' rule="$ctrl.rule" config="$ctrl.config"></'+rule.components.display+">",compiled=$compile(template)($scope);compiled.addClass("ums-segmentrule__display"),this.$displayContainer.append(compiled)}}]}),angular.module("engage").component("umsSegmentRuleEditor",{template:'<div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-segmentparameter__label" ng-show="$ctrl.name"><div class="ums-form__label" ng-bind="$ctrl.name"></div></div><form name="$ctrl.form" id="form_{{$ctrl.type}}" ng-submit="$ctrl.form.$valid && $ctrl.save()" class="ums-segmentbuilder__form"><ng-transclude></ng-transclude></form></div></div>',bindings:{name:"<",type:"<",save:"&",form:"=?"},transclude:!0}),angular.module("engage").component("umsSegmentRuleEditors",{template:'<div class="ums-segmentsteps__container"><button class="ums-button ums-button--sm ums-button--square-icon ums-button--light" ng-class="{\'ums-button--disabled\': $ctrl.activeRule == null }" ng-click="$ctrl.activeRule = null" ng-disabled="$ctrl.activeRule == null"><ums-icon class="ums-icon--rotate-180" id="icon-arrow" modifier="xxs"></ums-icon></button><div class="ums-segmentsteps__holder"><button class="ums-segmentsteps__step" ng-class="{\'s-active\': $ctrl.activeRule == null}" ng-click="$ctrl.activeRule = null" ng-disabled="$ctrl.activeRule == null">1. Choose a parameter</button> <button class="ums-segmentsteps__step" ng-class="{\'s-active\': $ctrl.activeRule != null}" ng-disabled="true">2. Setup the parameter</button></div></div><div class="ums-segmentparameter__holder"><div class="ums-segmentparameter__container"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart ums-segmentbuilder__animate" ng-if="$ctrl.activeRule == null"><div class="ums-flexgrid__item ums-segmentparameter__label"><div class="ums-form__label">Select a parameter</div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-4" ng-repeat="rule in $ctrl.rules"><button class="ums-boxed__container ums-segmentparameter__wrap" ng-click="$ctrl.editRule(rule)" ng-class="{\'s-applied\': $ctrl.appliedRules[rule.type] }"><div class="ums-segmentparameter__icon" ng-if="rule.iconUrl"><img ng-src="{{rule.iconUrl}}" class="ums-icon ums-icon--lg"></div><div class="ums-segmentparameter__icon" ng-if="rule.icon"><ums-icon id="{{rule.icon}}" modifier="lg"></ums-icon></div><div class="ums-segmentparameter__title" ng-bind="rule.name"></div><span class="ums-gotoarrow ums-gotoarrow"><ums-icon id="icon-arrow"></ums-icon></span> <span class="ums-segmentparameter__parameter-label" ng-if="rule.label" ng-bind="rule.label"></span></button></div></div><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart ums-segmentbuilder__animate" ng-show="$ctrl.activeRule != null"><div class="ums-flexgrid__item" style="margin: 0;padding: 0;"><ums-segment-invert-parameter is-negation="$ctrl.isNegation"></ums-segment-invert-parameter></div><div data-segment-rule-editors-container style="width: 100%;"></div></div></div></div><div class="ums-segmentparameter__button-holder is-animated" ng-if="$ctrl.activeRule"><button class="btn ums-button ums-button--light ums-button--icon ums-button--link-error" type="button" ng-click="$ctrl.removeRuleFromSegment($ctrl.activeRule)" ng-show="$ctrl.appliedRules[$ctrl.activeRule.type]"><span>Delete parameter</span><ums-icon id="icon-delete" modifier="sm"></ums-icon></button> <button class="btn ums-button ums-button--success ums-button--icon ums-segmentparameter__button" type="submit" form="form_{{$ctrl.activeRule.type}}"><span>Save parameter</span><ums-icon id="icon-save" modifier="sm"></ums-icon></button></div><div class="ums-segmentinfo__container ums-segmentinfo__container--blue" ng-if="!$ctrl.segment.rules && !$ctrl.activeRule"><div class="ums-segmentinfo__text"><strong>Build your segment</strong><div>Let’s build a segment! Use the steps above.<br>Pick, setup and save your parameters in order to build a segment.</div></div><div class="ums-segmentinfo__image"><img src="/App_Plugins/Umbraco.Engage/assets/illustration-laptop.svg" alt></div></div><div class="ums-segmentinfo__container is-animated" ng-if="$ctrl.segment.rules.length > 0 || $ctrl.activeRule"><div class="ums-segmentinfo__text"><strong>Applied parameters</strong><div class="ums-segmentinfo__parameter__container"><div ng-repeat="rule in $ctrl.segment.rules track by rule.type"><ums-segment-rule-display ng-if="$ctrl.activeRule.type !== rule.type" rule="$ctrl.rulesByType[rule.type]" negation="rule.isNegation" config="rule.config" edit="$ctrl.editRule($ctrl.rulesByType[rule.type])" is-active="false"></ums-segment-rule-display></div><ums-segment-rule-display ng-if="$ctrl.activeRule != null" rule="$ctrl.activeRule" negation="$ctrl.isNegation" config="$ctrl.activeConfig" edit="$ctrl.editRule($ctrl.activeRule)" is-active="true"></ums-segment-rule-display></div></div></div>',bindings:{segment:"<",activeRule:"="},controller:["umsSegmentRuleRepository","$element","$compile","$scope","$q",function umsSegmentRuleEditorsCtrl(ruleRepo,$element,$compile,$scope,$q){var $ctrl=this;this.rules=[],this.rulesByType={},this.appliedRules={},this.isNegation=!1,this.$editorsContainer=null,this.$onInit=function(){this.rules=ruleRepo.getRules(),this.rulesByType={},this.rules.forEach(function(rule){this.rulesByType[rule.type]=rule}.bind(this)),this.$editorsContainer=$element.find("[data-segment-rule-editors-container]"),this.renderRuleEditors(),this.updateAppliedRules()},this.getSavedConfig=function(ruleType){if(null==this.segment||!Array.isArray(this.segment.rules))return null;var rule=_.find(this.segment.rules,{type:ruleType});return null==rule?null:(rule&&rule.isNegation&&($ctrl.isNegation=rule.isNegation),rule.config)},this.editRule=function(rule){this.activeRule=rule;var savedConfig=this.getSavedConfig(rule.type);this.activeConfig=null!=savedConfig?angular.copy(savedConfig):angular.copy(rule.defaultConfig)},this.removeRuleFromSegment=function(rule){var idx=_.findIndex($ctrl.segment.rules,{type:rule.type});idx>-1&&$ctrl.segment.rules.splice(idx,1),delete this.appliedRules[rule.type],rule===$ctrl.activeRule&&($ctrl.activeRule=null)},this.saveRule=function(type,config,negation){var savedConfig=angular.copy(config);$ctrl.segment.rules=$ctrl.segment.rules||[];var idx=_.findIndex($ctrl.segment.rules,{type:type});-1===idx?$ctrl.segment.rules.push({id:0,segmentId:0,type:type,isNegation:negation,config:savedConfig,created:new Date}):($ctrl.segment.rules[idx].isNegation=negation,$ctrl.segment.rules[idx].config=savedConfig),this.appliedRules[type]=!0,this.activeRule=null,this.activeConfig=null},this.renderRuleEditors=function(){$q.all(this.rules.map(function(rule){return rule.init()})).then(function(){$ctrl.rules.forEach($ctrl.renderRuleEditor.bind($ctrl))})},this.renderRuleEditor=function(rule){var template="<"+rule.components.editor+" ng-if=\"$ctrl.activeRule.type === '"+rule.type+'\'" rule="$ctrl.activeRule" config="$ctrl.activeConfig" save="$ctrl.saveRule(\''+rule.type+"', $ctrl.activeConfig, $ctrl.isNegation)\"></"+rule.components.editor+">",compiled=$compile(template)($scope);compiled.addClass("ums-segmentbuilder__panel"),this.$editorsContainer.append(compiled)},this.updateAppliedRules=function(){null!=this.segment&&Array.isArray(this.segment.rules)&&this.segment.rules.forEach(function(rule){this.appliedRules[rule.type]=!0}.bind(this))}}]}),angular.module("engage").service("umsSegmentRuleRepository",["$q","umsEventEmitter",function umsSegmentRuleRepository($q,eventEmitter){var rules=[];this.addRule=function(rule){this.prepareRule(rule),rules.push(rule),this.orderRules()},this.prepareRule=function(rule){var initFn=rule.init||function(){},value=null;rule.init=function(){return null==value&&(value=$q.when(initFn.call(rule)),eventEmitter.once("umsPathChange",function(){value=null})),value}},this.orderRules=function(){rules.sort(function(ruleA,ruleB){return ruleA.order>ruleB.order?1:ruleA.order<ruleB.order?-1:ruleA.order===ruleB.order?0:void 0})},this.removeRule=function(rule){var idx=rules.indexOf(rule);-1!==idx&&rules.splice(idx,1)},this.getRules=function(){return rules.slice()}}]),angular.module("engage").component("umsDonutChart",{template:'<div><div class="ums-chart-donut__chart-wrapper"><div class="ums-chart-donut__chart-holder"><div class="ums-chart-donut__chart-item" style="position:relative;"><canvas chart-base chart-type="$ctrl.chart.type" chart-data="$ctrl.state.chartDataSet" chart-labels="$ctrl.state.chartLabels" chart-colors="$ctrl.chart.colors" chart-dataset-override="$ctrl.chart.datasetOverride" chart-options="$ctrl.chart.options"></canvas></div><div class="ums-chart-donut__overlay"><strong ng-bind="$ctrl.state.chartTotal"></strong> <span class="umsLabel umsJustifyCenter">Total</span></div></div><ul class="ums-chart-donut__sidebar"><li ng-repeat="item in $ctrl.chartData" class="ums-chart-donut__sidebar-item"><span class="ums-chart-donut__sidebar-dot" ng-style="{background: $ctrl.state.chartColors[$index]}"></span> <strong class="ums-chart-donut__sidebar-value umsFzLg"><span ng-bind="item.data"></span> <small ng-bind-template="/ {{(item.data / $ctrl.state.chartTotal) * 100 | limitTo: 4}}%"></small></strong></li></ul></div><ul class="ums-chart-donut__legend"><li ng-repeat="item in $ctrl.chartData" class="ums-chart-donut__legend-item"><span class="ums-chart-donut__sidebar-dot" ng-style="{background: $ctrl.state.chartColors[$index]}"></span> <strong class="ums-chart-donut__legend-name" ng-bind="item.label"></strong></li></ul></div>',bindings:{chartData:"<"},controller:[umsDonutChartController]}),angular.module("engage").component("umsGraphPersonaJourneyScoring",{template:'<div style="position:relative"><div class="ums-chart-persona__chart" style="position:relative;" ng-style="{\'height\': \'calc((50px * \' + $ctrl.chartData.length + \') + 30px\'}"><canvas chart-base chart-type="$ctrl.chart.type" chart-data="$ctrl.chart.data" chart-labels="$ctrl.chart.labels" chart-dataset-override="$ctrl.chart.datasetOverride" chart-options="$ctrl.chart.options" ng-attr-id="{{\'personalization-chart_\' + $ctrl.identifier + \'-\' + $ctrl.group.id}}"></canvas></div><div data-belongs-to-chart-id="{{\'personalization-chart_\' + $ctrl.identifier + \'-\' + $ctrl.group.id}}" class="ums-chart-persona__tooltip"><table></table></div><ul class="ums-chart-persona__list"><li class="ums-chart-persona__item" ng-repeat="item in $ctrl.chartData"><span class="ums-chart-persona__icon-holder"><span class="ums-chart-persona__line" ng-style="{\'background-color\': item.color }"></span> <span class="ums-chart-persona__image-holder"><img ng-src="{{item.iconUrl}}" class="ums-chart-persona__icon"></span></span> <span class="ums-chart-persona__name" ng-bind="item.title" ng-class="{\'s-active\': item.isActive}"></span> <span class="ums-chart-persona__empty-bar"></span></li></ul><ul class="ums-chart-persona__legend-list"><li class="ums-chart-persona__legend-item ums-chart-persona__legend-item--difference" ng-show="$ctrl.group.minimumParticipationScoreThreshold">Threshold (set to {{$ctrl.group.minimumParticipationScoreThreshold}})</li><li class="ums-chart-persona__legend-item ums-chart-persona__legend-item--difference" style="border-left-color: #FF7F50;" ng-show="$ctrl.group.minimumDeviation">Minimal deviation (set to {{$ctrl.group.minimumDeviation}}{{$ctrl.group.minimumDeviationType == 1 ? "%" : "" }})</li></ul></div>',bindings:{group:"<",chartData:"<"},controller:[umsGraphPersonaJourneyScoringController]}),angular.module("engage").component("umsGraphProfileDonut",{template:'<div class="ums-chart-profile-donut__chart-wrapper"><div class="ums-chart-profile-donut__chart-holder"><div class="ums-chart-profile-donut__chart-item" style="position:relative;"><canvas chart-base chart-type="$ctrl.chart.type" chart-data="$ctrl.state.chartDataSet" chart-labels="$ctrl.state.chartLabels" chart-colors="$ctrl.chart.colors" chart-dataset-override="$ctrl.chart.datasetOverride" chart-options="$ctrl.chart.options"></canvas></div><div class="ums-chart-profile-donut__overlay"><strong ng-bind="$ctrl.state.chartTotal"></strong> <span class="umsLabel umsJustifyCenter">Total</span></div></div><ul class="ums-chart-profile-donut__legend"><li ng-repeat="item in $ctrl.chartData" class="ums-chart-profile-donut__legend-item"><span class="ums-chart-profile-donut__legend-dot" ng-style="{background: $ctrl.state.chartColors[$index]}"></span> <strong class="ums-chart-profile-donut__legend-name" ng-style="{color: $ctrl.state.chartTextColors[$index]}" ng-bind="item.label"></strong> <strong class="ums-chart-profile-donut__legend-value umsFzLg"><span ng-bind="item.data"></span> <small ng-bind-template="/ {{(item.data / $ctrl.state.chartTotal) * 100 | limitTo: 4}}%"></small></strong></li></ul></div>',bindings:{chartData:"<"},controller:[umsGraphProfileDonutController]}),angular.module("engage").component("umsGraphProfileGrowth",{template:'<div class="ums-chart-profile-growth__chart-wrapper"><div class="ums-chart-profile-growth__chart-holder"><canvas chart-base chart-type="$ctrl.chart.type" chart-data="$ctrl.chart.data" chart-labels="$ctrl.chart.labels" chart-colors="$ctrl.chart.colors" chart-options="$ctrl.chart.options" chart-dataset-override="$ctrl.chart.datasetOverride"></canvas></div><ul class="ums-chart-profile-growth__legend"><li ng-repeat="dataSetOverride in $ctrl.chart.datasetOverride" class="ums-chart-profile-growth__legend-item"><span class="ums-chart-profile-donut__legend-dot" ng-style="{background: $ctrl.state.chartColors[$index]}"></span> <strong class="ums-chart-profile-donut__legend-name" ng-style="{color: $ctrl.state.chartTextColors[$index]}" ng-bind="dataSetOverride.label"></strong></li></ul></div>',bindings:{chartData:"<"},controller:[umsGraphProfileGrowthController]}),angular.module("engage").component("umsGraphProfilePotential",{template:'<div class="ums-chart-profile-potential__chart-wrapper"><div class="ums-chart-profile-potential__chart-holder"><div class="ums-chart-profile-potential__chart-item"><div class="ums-chart-profile-potential__ring-holder"><div class="ums-chart-profile-potential__ring"></div><div class="ums-chart-profile-potential__ring"></div><div class="ums-chart-profile-potential__ring"></div></div><ol class="ums-chart-profile-potential__names"><li class="umsLabel">Engaged</li><li class="umsLabel">Active</li><li class="umsLabel">Not-engaged</li><li class="umsLabel">In-active</li></ol><div class="ums-chart-profile-potential__holds-pin"><div class="ums-chart-profile-potential__pin" ng-class="{\'s-visible\': !$ctrl.state.loading}" ng-style="{\'--color\': $ctrl.state.pinColor, \'bottom\': $ctrl.chartDataset.engaged + \'%\', \'left\': $ctrl.chartDataset.active + \'%\'}"><span></span></div></div></div></div></div>',bindings:{visitorId:"<"},controller:["umsProfileInfoService",umsGraphProfilePotentialController]}),angular.module("engage").component("umsProfileActivityTableEvents",{template:'<table class="ums-table__table ums-table__table--nested"><thead><tr class="ums-table__tr ums-table__tr--inside-box ums-table__tr--inside-box-nested"><th class="ums-table__th ums-profile__table-type-holder ums-profile__line-parent"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span></th><th class="ums-table__th ums-profile__table-type-holder ums-profile__table-type-holder--small ums-profile__line-parent"><span class="ums-profile__line-item ums-profile__line-item--inside ums-profile__line-item--rotated" ng-class="{ \'s-active-before s-active-after\': $ctrl.pageview.abTests.length > 0 || $ctrl.pageview.appliedPersonalizationName, \'s-session-active\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized }"></span></th><th class="ums-table__th ums-table__th--fixed-xs"><div class="umsLabel">Time</div></th><th class="ums-table__th ums-table__th--fixed-xxs"><div class="umsLabel">Icon</div></th><th class="ums-table__th"><div class="umsLabel">Event</div></th><th class="ums-table__th"><div class="umsLabel">Detail</div></th><th class="ums-table__th"></th></tr></thead><tbody ng-if="!$ctrl.eventsByPageviewId[$ctrl.pageview.id]"><tr class="ums-table__tr ums-table__tr--wide ums-table__tr--inside-box ums-table__tr--inside-box-nested ums-table__tr--inside-box-nested-loading"><td class="ums-table__td ums-profile__table-type-holder ums-profile__line-parent"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span></td><td class="ums-table__td ums-profile__table-type-holder ums-profile__table-type-holder--small ums-profile__line-parent"><span class="ums-profile__line-item ums-profile__line-item--inside" ng-class="{\'s-active-before s-active-after\': $ctrl.pageview.abTests.length > 0 || $ctrl.pageview.appliedPersonalizationName}"></span> <span class="ums-profile__type-holder"><span class="ums-profile__type-indicator ums-profile__type-indicator--second s-small" ng-class="{\'s-active\': $ctrl.pageview.abTests.length > 0 || $ctrl.pageview.appliedPersonalizationName}"></span></span></td><td class="ums-table__td" colspan="5"><span>Loading...</span></td></tr></tbody><tbody ng-if="$ctrl.eventsByPageviewId[$ctrl.pageview.id]"><tr ng-repeat="singleEvent in $ctrl.eventsByPageviewId[$ctrl.pageview.id] | orderBy: [\'-timestamp\', \'-type\']" class="ums-table__tr ums-table__tr--wide ums-table__tr--inside-box ums-table__tr--inside-box-nested is-fade-progress" ng-class="{\'s-conversion\': singleEvent.type == 4}"><td class="ums-table__td ums-profile__table-type-holder ums-profile__line-parent"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span></td><td class="ums-table__td ums-profile__table-type-holder ums-profile__table-type-holder--small ums-profile__line-parent"><span class="ums-profile__line-item ums-profile__line-item--inside" ng-class="{\'s-active-before s-active-after\': $ctrl.pageview.abTests.length > 0 || $ctrl.pageview.appliedPersonalizationName}"></span> <span class="ums-profile__type-holder"><span class="ums-profile__type-indicator ums-profile__type-indicator--second s-small" ng-class="{\'s-active\': $ctrl.pageview.abTests.length > 0 || $ctrl.pageview.appliedPersonalizationName}"></span></span></td><td class="ums-table__td"><span ng-bind="singleEvent.timestamp | date: \'HH:mm:ss\'"></span></td><td class="ums-table__td" style="padding: 0;"><div style="position: relative; z-index: 1; top: 3px;"><ums-icon ng-show="$ctrl.state.eventTypes[singleEvent.type].icon" ng-attr-id="{{$ctrl.state.eventTypes[singleEvent.type].icon}}" modifier="md"></ums-icon></div></td><td class="ums-table__td"><span ng-bind="$ctrl.state.eventTypes[singleEvent.type].name"></span></td><td class="ums-table__td"><span ng-bind-html="singleEvent.detail"></span></td><td class="ums-table__td" style="padding-right: 70px;"><span class="ums-profile__indicators-holder"><span ng-show="singleEvent.type == 4" class="ums-profile__conversion-indicator"><span>Conversion</span></span> <span class="ums-popup__enter" ng-show="singleEvent.type == 1 && $ctrl.pageview.abTests.length > 0" ng-repeat="abTestVariant in $ctrl.pageview.abTests"><a ng-href="{{ \'#/engage/ab-testing/test-detail?id=\' + abTestVariant.id}}" target="_blank" title="Go to A/B test \'{{abTestVariant.name}}\'" class="ums-profile__regular-indicator"><span class="ums-icon-wrap"><ums-icon id="icon-ab-testing" modifier="md"></ums-icon><span ng-bind="abTestVariant.variantName"></span></span></a><div class="ums-popup__holder ums-popup__holder--break ums-popup__holder--offset is-animated"><span ng-if="abTestVariant.description">{{abTestVariant.description}}</span> <span style="opacity:0.6;">Click to show details</span></div></span></span></td></tr></tbody></table>',bindings:{session:"<",pageview:"<",eventsByPageviewId:"<"},controller:[umsProfileActivityTableEventsController]}),angular.module("engage").component("umsProfileActivityTablePageviews",{template:'<table class="ums-table__table ums-table__table--no-minwidth ums-table__table--nested"><thead><tr class="ums-table__tr ums-table__tr--inside-box"><th class="ums-table__th ums-profile__table-type-holder ums-profile__line-parent"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span></th><th class="ums-table__th"><div class="umsLabel">Time</div></th><th class="ums-table__th" colspan="3"><div class="umsLabel">Page</div></th><th class="ums-table__th"><div class="umsLabel">Time on page</div></th><th class="ums-table__th"><div class="umsLabel">Engaged time</div></th><th class="ums-table__th" colspan="2"><div class="umsLabel">Scroll depth</div></th><th class="ums-table__th"><div class="umsLabel">Goals</div></th><th class="ums-table__th"><div class="umsLabel">Events</div></th><th class="ums-table__th" colspan="3"><div class="umsLabel">Variant</div></th></tr></thead><tbody ng-if="!$ctrl.pageviewsById[$ctrl.session.id]"><tr class="ums-table__tr ums-table__tr--wide ums-table__tr--inside-box"><td class="ums-table__td ums-profile__table-type-holder ums-profile__table-type-holder--full ums-profile__line-parent umsColor-base"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span> <span class="ums-profile__type-holder"><span class="ums-profile__type-indicator" ng-class="{\'s-active\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span></span></td><td class="ums-table__td" colspan="12">Loading...</td></tr></tbody><tbody ng-repeat="pageview in $ctrl.pageviewsById[$ctrl.session.id]" class="is-fade-animated"><tr class="ums-table__tr ums-table__tr--wide ums-table__tr--inside-box ums-table__tr--inside-box-toggle" ng-click="$ctrl.fn.openEventRow(pageview)" ng-class="{\'s-open\': pageview.eventInfoVisible}"><td class="ums-table__td ums-profile__table-type-holder ums-profile__table-type-holder--full ums-profile__line-parent"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span> <span class="ums-profile__type-holder"><span class="ums-profile__type-indicator" ng-class="{\'s-active\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized, \'s-icon\': pageview.abTests.length > 0 || pageview.appliedPersonalizationName}"><ums-icon id="icon-ab-testing" modifier="btn" ng-if="pageview.abTests.length > 0"></ums-icon><ums-icon id="icon-personalization" modifier="btn" ng-if="pageview.appliedPersonalizationName"></ums-icon></span></span></td><td class="ums-table__td"><span ng-bind="pageview.date | date:\'HH:mm\'"></span></td><td class="ums-table__td" colspan="3"><span class="ums-popup__enter" style="display: flex; align-items: center;"><span>/{{ $ctrl.fn.slicedUrl(pageview.url) | limitTo:35 }}</span> <span ng-show="$ctrl.fn.slicedUrl(pageview.url).length > 35">...</span><div class="ums-popup__holder ums-popup__holder--break ums-popup__holder--offset is-animated"><span>Page URL: {{pageview.url}}</span></div><a ng-href="{{pageview.url}}" target="_blank" title="Go to \'{{pageview.url}}\'" class="ums-button ums-button--table ums-button--transparent"><ums-icon id="icon-fullscreen" modifier="xs"></ums-icon></a></span></td><td class="ums-table__td"><span ng-if="!pageview.timeOnPageInSeconds">-</span> <span ng-if="pageview.timeOnPageInSeconds">{{$ctrl.fn.toDateTime(pageview.timeOnPageInSeconds) | date:"HH:mm:ss"}}</span></td><td class="ums-table__td"><span ng-if="!pageview.engagedTimeInSeconds">-</span> <span ng-if="pageview.engagedTimeInSeconds">{{$ctrl.fn.toDateTime(pageview.engagedTimeInSeconds) | date:"HH:mm:ss"}}</span></td><td class="ums-table__td" colspan="2"><span ng-show="!pageview.scrollDepth">-</span> <span ng-show="pageview.scrollDepth">{{pageview.scrollDepth * 100 | number : 0}}%</span></td><td class="ums-table__td"><span ng-bind="pageview.goalCompletions"></span></td><td class="ums-table__td"><span ng-bind="pageview.events"></span></td><td class="ums-table__td" colspan="2"><span ng-if="pageview.abTests.length === 0 && !pageview.appliedPersonalizationName">-</span><div class="ums-profile__variants-row-holder"><span ng-if="pageview.abTests.length > 0"><span class="ums-icon-wrap" ng-repeat="abTest in pageview.abTests"><ums-icon id="icon-ab-testing" modifier="md"></ums-icon><span ng-if="$index > 0" style="opacity: 0.5">&</span> <span ng-bind="abTest.name"></span></span></span> <span ng-if="pageview.appliedPersonalizationName" class="ums-icon-wrap" ng-class="{\'ums-popup__enter\': pageview.isInControlGroup}" ng-style="{\'text-decoration\': pageview.isInControlGroup ? \'line-through\' : \'inherit\'}"><ums-icon id="icon-personalization" modifier="md"></ums-icon><span ng-bind="pageview.appliedPersonalizationName"></span><div ng-if="pageview.isInControlGroup" class="ums-popup__holder ums-popup__holder--break ums-popup__holder--offset is-animated"><span>Part of control group. Visitor will not be exposed to personalized content.</span></div></span></div></td><td class="ums-table__td ums-table__td--nowrap"><ums-icon ng-show="!pageview.eventInfoVisible" id="icon-toggle" modifier="sm"></ums-icon><ums-icon ng-show="pageview.eventInfoVisible" id="icon-toggle" modifier="sm" css-class="ums-icon--flip-y"></ums-icon></td></tr><tr ng-show="pageview.eventInfoVisible"><td colspan="14" class="ums-table__table--nested__parent"><ums-profile-activity-table-events session="$ctrl.session" pageview="pageview" events-by-pageview-id="$ctrl.state.eventsByPageviewId"></ums-profile-activity-table-events></td></tr></tbody><tfoot><tr class="ums-table__tr ums-table__tr--wide ums-table__tr--specs" ng-if="$ctrl.session.operatingSystemName || $ctrl.session.browserName || $ctrl.session.browserVersion || $ctrl.session.ipAddress || $ctrl.session.location"><td class="ums-table__td ums-profile__line-parent ums-profile__table-type-holder ums-profile__line-parent--corner"><span class="ums-profile__line-item" ng-class="{\'s-active-before s-active-after\': $ctrl.session.wasAbTested || $ctrl.session.wasPersonalized}"></span></td><td class="ums-table__td" colspan="14"><ums-profile-session-specs session="$ctrl.session" line="true" margin="true"></ums-profile-session-specs></td></tr></tfoot></table>',bindings:{session:"=",pageviewsById:"="},controller:["umsProfileInfoService",umsProfileActivityTablePageviewsController]}),angular.module("engage").component("umsMemberRelatedProfile",{template:'<div ng-if="$ctrl.state.loading > 0">Loading...</div><div class="ums-profile-related__profile-grid" ng-if="$ctrl.state.loading < 1"><div class="ums-profile-related__specs"><ums-profile-session-specs session="$ctrl.state.session[$ctrl.state.session.length -1]" animate="true" is-active="true"></ums-profile-session-specs></div><div class="ums-profile-related__sessions ums-table__inner-column"><div class="ums-table__inner-column"><span class="umsLabel">First session</span> <strong ng-bind="$ctrl.state.session[0].startDate | date: \'dd-MM-yyyy, HH:mm\'"></strong></div><div class="ums-table__inner-column"><span class="umsLabel">Last session</span> <strong ng-bind="$ctrl.state.session[$ctrl.state.session.length -1].startDate | date: \'dd-MM-yyyy, HH:mm\'"></strong></div></div><a ng-href="{{\'/umbraco/#/engage/profiles/insights?id=\' + $ctrl.visitorId}}" class="btn ums-button ums-button--light ums-button--icon ums-button--sm-1 ums-profile-related__button"><span>Show</span><ums-icon id="icon-arrow" modifier="xs"></ums-icon></a></div>',bindings:{visitorId:"<?"},controller:["umsProfileInfoService","$q",function umsProfileMemberController(service,$q){var ctrl=this;this.$onInit=function(){ctrl.fn.refresh()},ctrl.state={loading:0,error:null,session:null,pageview:null},ctrl.fn={refresh:function(){var filter={pageIndex:0,visitorId:ctrl.visitorId};ctrl.fn.getData.sessions(filter).then(function(session){return ctrl.state.session=ctrl.fn.sortArray(session,"startDate"),session}).then(function(session){ctrl.fn.getData.pageviewsById(session[0].id).then(function(pageviews){return ctrl.state.session[ctrl.state.session.length-1].ipAddress=pageviews[0].ipAddress,session})})},getData:{sessions:function(filter){return ctrl.state.loading++,service.getSessionsOfVisitor(filter).then(function(response){return ctrl.state.loading--,response.results})},pageviewsById:function(id){return ctrl.state.loading++,service.getPageviewsOfSession(id).then(function(response){return ctrl.state.loading--,response})}},sortArray:function(array,sortOnKey){return array.slice().sort(function(a,b){return a[sortOnKey]<b[sortOnKey]?-1:a[sortOnKey]>b[sortOnKey]?1:0})}}}]}),angular.module("engage").component("umsSegmentInvertParameter",{template:'<div class="ums-flexgrid__container ums-flexgrid__container--sm"><div class="ums-flexgrid__item" style="display: flex; justify-content: flex-end;"><div class="ums-form__switch" style="max-width: none; width: 200px;"><input type="radio" name="ums-segment-builder-type" class="ums-form__switch__input" id="ums-segmentbuilder-switch-invert-include" ng-model="$ctrl.isNegation" ng-value="false" required> <label for="ums-segmentbuilder-switch-invert-include" class="ums-form__switch__label">Include</label> <input type="radio" name="ums-segment-builder-type" class="ums-form__switch__input" id="ums-segmentbuilder-switch-invert-exclude" ng-model="$ctrl.isNegation" ng-value="true" required> <label for="ums-segmentbuilder-switch-invert-exclude" class="ums-form__switch__label">Exclude</label></div></div></div>',bindings:{isNegation:"="},controller:[function(){var $ctrl=this;this.$onInit=function(){void 0!==$ctrl.isNegation&&null!==$ctrl.isNegation||($ctrl.isNegation=!1)}}]}),angular.module("engage").component("umsSegmentRuleBrowserDisplay",{template:'<span ng-repeat="browser in $ctrl.config.Browsers track by $index" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">or</span> <span ng-bind="browser" class="ums-segmentrule__rulecontent"></span></span>',bindings:{config:"<"}}),angular.module("engage").component("umsSegmentRuleBrowserEditor",{template:'<ums-segment-rule-editor type="$ctrl.rule.type" save="$ctrl.save()" form="$ctrl.form"><div class="ums-flexgrid__container ums-flexgrid__container--sm"><input type="hidden" name="browsers" ng-model="$ctrl.config.Browsers" ums-required-array><div class="ums-flexgrid__item" ng-if="$ctrl.rule.data.browsers.length === 0"><div class="ums-form__checkbox__label ums-form__checkbox__label--error">You have no visits at your website. You can only use the browser parameters once you\'ve had visitors.</div></div><div class="ums-flexgrid__item" ng-show="$ctrl.form.$submitted && $ctrl.form.browsers.$invalid"><div class="ums-form__checkbox__label ums-form__checkbox__label--error">At least one browser type should be selected</div></div></div><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart" ng-show="$ctrl.rule.data.browsers.length > 0"><div ng-repeat="browser in $ctrl.rule.data.browsers | orderBy:\'browser.label\'" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox" ng-class="{\'s-selected\': $ctrl.selected[browser.value]}"><input type="checkbox" name="selectedBrowser" class="ums-form__checkbox__input" ng-checked="$ctrl.selected[browser.value]" ng-click="$ctrl.toggleBrowser(browser)"> {{browser.label}}</label></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){this.selected={},this.$onInit=function(){this.rule.data.browsers.forEach(function(browser){var isSelected=this.config.Browsers.indexOf(browser.value)>-1;this.selected[browser.value]=isSelected}.bind(this))},this.toggleBrowser=function(browser){this.selected[browser.value]=!this.selected[browser.value],Array.isArray(this.config.Browsers)||(this.config.Browsers=[]);var idx=this.config.Browsers.indexOf(browser.value);-1===idx?this.config.Browsers.push(browser.value):this.config.Browsers.splice(idx,1)}}]}),angular.module("engage").run(["umsSegmentRuleRepository","umsAnalyticsApi",function(ruleRepo,analyticsApi){var rule={name:"Browser",type:"Browser",icon:"icon-browser",order:2,defaultConfig:{Browsers:[]},data:{browsers:[]},components:{display:"ums-segment-rule-browser-display",editor:"ums-segment-rule-browser-editor"},init:function(){return function getBrowsers(){return analyticsApi.distinct("browser").then(function(browsers){if(Array.isArray(browsers))return browsers.map(function(device){return{label:device,value:device}})})}().then(function(browsers){this.data.browsers=browsers}.bind(this))}};ruleRepo.addRule(rule)}]),angular.module("engage").component("umsSegmentRuleCampaignsDisplay",{template:'<span class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin" ng-show="$ctrl.fn.objectHasKeys($ctrl.config.parameters)"><span ng-repeat="(key, value) in $ctrl.config.parameters track by $index" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">and</span> <span ng-bind="$ctrl.fn.getLabelFromKey(key)" class="ums-segmentrule__rulecontent"></span><span ng-bind="$ctrl.fn.getParameterTypeLabel(value.type) | lowercase"></span> <span ng-repeat="parameterInput in value.input track by $index" ng-if="parameterInput.length > 0" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">or</span> <span ng-bind-template="\'{{parameterInput}}\'" class="ums-segmentrule__rulecontent"></span></span></span><span ng-if="$ctrl.config.settings.range" ng-bind="$ctrl.fn.getDateRange($ctrl.config.settings.range) | lowercase"></span></span>',bindings:{config:"<",rule:"<"},controller:[function(){var $ctrl=this;$ctrl.fn={objectHasKeys:function(obj){return Object.keys(obj).length>0},getLabelFromKey:function(key){var idx=$ctrl.rule.data.utmValues.findIndex(function(item){return item.value==key});return $ctrl.rule.data.utmValues[idx].name},getDateRange:function(range){var idx=$ctrl.rule.data.dateRange.findIndex(function(item){return item.value==range.type}),label=$ctrl.rule.data.dateRange[idx].label;return $ctrl.rule.data.dateRange[idx].hasRange&&(label+=" "+range.maximum+" "+$ctrl.rule.data.dateRange[idx].valueType[1==range.maximum?"single":"multiple"]),label},getParameterTypeLabel:function(type){if(type)return $ctrl.rule.data.sourceTypes.find(function(item){return item.value==type}).label}}}]}),angular.module("engage").component("umsSegmentRuleCampaignsEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.fn.onSave()"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated"><div class="ums-form__row ums-form__row--small" ng-repeat="singleUtm in $ctrl.rule.data.utmValues"><div style="width: 100%;"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox ums-segmentparameter__groupbox--start" ng-class="{\'s-disabled\': $ctrl.config.parameters[singleUtm.value].input.length > 1}"><input ng-model="$ctrl.state.selectedParameters[singleUtm.value]" type="checkbox" class="ums-form__radio__input" ng-change="$ctrl.fn.toggleParameter(singleUtm.value)" ng-required="$ctrl.state.selectedParameters.length == 0" ng-disabled="$ctrl.config.parameters[singleUtm.value].input.length > 1"> <strong class="umsColor-main" style="white-space: nowrap; min-width: 100px;" ng-bind="singleUtm.name"></strong><select class="ums-form__select" ng-if="singleUtm.showDropdown && $ctrl.config.parameters[singleUtm.value]" ng-model="$ctrl.config.parameters[singleUtm.value].type" ng-options="sourceType.value as sourceType.label for sourceType in $ctrl.rule.data.sourceTypes" ng-change="$ctrl.fn.createInputForValue(singleUtm.value)"></select><div style="flex: 1; display: flex; justify-content: flex-end;"><button type="button" class="ums-button ums-button--sm ums-button--icon ums-button--light ums-segmentparameter__clear-button" ng-show="$ctrl.config.parameters[singleUtm.value].input.length > 1" ng-click="$ctrl.fn.resetInput(singleUtm.value)"><span>Clear values</span><ums-icon id="icon-close" modifier="xxs"></ums-icon></button></div></label><div class="ums-accordion__content ums-segmentparameter__accordion-content" ng-if="singleUtm.showDropdown && $ctrl.fn.showParameters($ctrl.config.parameters[singleUtm.value].type)"><div class="ums-segmentparameter__config-parameter-holder" style="margin-top: -6px;"><div ng-repeat="singleInput in $ctrl.config.parameters[singleUtm.value].input track by \'singleItemInput-\' + $index" class="ums-segmentparameter__custom-input-holder" style="margin-top: 6px;"><input ng-model="$ctrl.config.parameters[singleUtm.value].input[$index]" ng-change="$ctrl.fn.handleInputChangeForValue(singleUtm.value, $index)" ng-blur="$ctrl.fn.handleBlur(singleUtm.value, singleInput, $index)" ng-attr-placeholder="{{\'Value \' + ($index + 1)}}" ng-required="$first" type="input" class="ums-form__input ums-segmentparameter__custom-input-item" ng-class="{\'s-large\': $ctrl.state.currentSourceType && !$ctrl.state.currentSourceType.multipleInputs}" style="width: 178px; padding-right: 5px;"> <span ng-if="!$last" class="ums-segmentparameter__custom-input-spacer">Or</span></div></div></div></div></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated"><ums-accordion-item name="Advanced settings" style="width: 100%"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Date range *</div></div><div class="ums-form__row ums-form__row--small" ng-repeat="singleDateRange in $ctrl.rule.data.dateRange"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.settings.range.type" ng-attr-type="{{$ctrl.dateRange.type}}" class="ums-form__radio__input" ng-attr-name="{{$ctrl.dateRange.name}}" ng-value="singleDateRange.value" required> <span style="white-space: nowrap;" ng-bind="singleDateRange.label"></span> <input ng-if="singleDateRange.hasRange" ng-model="$ctrl.config.settings.range.maximum" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-style="{\'color\': $ctrl.config.settings.range.type == singleDateRange.value ? \'inherit\' : \'#fff\'}" ng-required="$ctrl.config.range.type == singleDateRange.value"> <span style="margin-left: 10px;" ng-show="singleDateRange.hasRange && $ctrl.config.settings.range.maximum === 1" ng-bind="singleDateRange.valueType.single"></span> <span style="margin-left: 10px;" ng-show="singleDateRange.hasRange && $ctrl.config.settings.range.maximum !== 1" ng-bind="singleDateRange.valueType.multiple"></span></label></div></ums-accordion-item></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){var $ctrl=this;this.$onInit=function(){$ctrl.fn.checkSelectedCheckboxes(),$ctrl.fn.updateParameterObject(!0)},$ctrl.dateRange={model:"",type:"radio",name:"rangeAny"},$ctrl.state={currentSourceType:null,selectedParameters:{},parameters:{}},$ctrl.fn={toggleParameter:function(parameterValue){1==$ctrl.state.selectedParameters[parameterValue]?$ctrl.config.parameters[parameterValue]={type:"empty"}:delete $ctrl.config.parameters[parameterValue]},createInputForValue:function(value){$ctrl.config.parameters[value].input=[],$ctrl.config.parameters[value].input.push("")},resetInput:function(value){$ctrl.config.parameters[value].input=[""]},handleInputChangeForValue:function(value,idx){idx==$ctrl.config.parameters[value].input.length-1&&$ctrl.state.currentSourceType.multipleInputs&&$ctrl.config.parameters[value].input.push("")},handleBlur:function(value,inputValue,idx){0==inputValue.length&&idx>0&&$ctrl.config.parameters[value].input.length!==idx+1&&$ctrl.config.parameters[value].input.splice(idx,1)},showParameters:function(selectedType){if(selectedType){var sourceType=$ctrl.rule.data.sourceTypes.find(function(type){return type.value==selectedType});return $ctrl.state.currentSourceType=sourceType,sourceType.hasInput}return!1},checkSelectedCheckboxes:function(){Object.keys($ctrl.config.parameters).forEach(function(parameter){$ctrl.state.selectedParameters[parameter]=!0})},updateParameterObject:function(add){for(parameter in $ctrl.config.parameters)add&&$ctrl.config.parameters[parameter].input?$ctrl.config.parameters[parameter].input=$ctrl.fn.addEmptyInput($ctrl.config.parameters[parameter].input):$ctrl.config.parameters[parameter].input&&($ctrl.config.parameters[parameter].input=$ctrl.fn.removeEmptyInput($ctrl.config.parameters[parameter].input))},removeEmptyInput:function(arr){return arr.filter(function(item){return""!==item})},addEmptyInput:function(arr){return arr.push(""),arr},onSave:function(){$ctrl.fn.updateParameterObject(!1),$ctrl.save()}}}]}),angular.module("engage").run(["umsSegmentRuleRepository",function(ruleRepo){ruleRepo.addRule({name:"Campaigns",type:"Campaign",icon:"icon-campaigns",order:9,defaultConfig:{parameters:{},settings:{range:{type:"any",maximum:0}}},data:{utmValues:[{name:"utm_source",value:"source",showDropdown:!0},{name:"utm_medium",value:"medium",showDropdown:!0},{name:"utm_campaign",value:"campaign",showDropdown:!0},{name:"utm_term",value:"term",showDropdown:!0},{name:"utm_content",value:"content",showDropdown:!0},{name:"utm_source_platform",value:"sourcePlatform",showDropdown:!0},{name:"utm_creative_format",value:"creativeFormat",showDropdown:!0},{name:"utm_marketing_tactic",value:"marketingTactic",showDropdown:!0}],dateRange:[{value:"any",label:"Anytime"},{value:"currentPage",label:"On this page"},{value:"now",label:"In this session"},{value:"sessions",label:"In the last",hasRange:!0,valueType:{single:"session",multiple:"sessions"}},{value:"days",label:"In the last",hasRange:!0,valueType:{single:"day",multiple:"days"}}],sourceTypes:[{value:"empty",label:"Is empty"},{value:"notEmpty",label:"Is filled"},{value:"exactMatch",label:"Matches exactly",hasInput:!0,multipleInputs:!0},{value:"contains",label:"Contains",hasInput:!0,multipleInputs:!0},{value:"regexMatch",label:"Regular expression",hasInput:!0,multipleInputs:!1}]},components:{display:"ums-segment-rule-campaigns-display",editor:"ums-segment-rule-campaigns-editor"},init:function(){}})}]),angular.module("engage").component("umsSegmentRuleCustomerJourneyDisplay",{template:'<span ng-repeat="stepId in $ctrl.config.CustomerJourneySteps track by $index" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">or</span> <span ng-bind="$ctrl.stepsById[stepId].title" class="ums-segmentrule__rulecontent"></span></span>',bindings:{rule:"<",config:"<"},controller:[function(){var $ctrl=this;this.stepsById={},this.$onInit=function(){this.rule.data.customerJourneyGroups.forEach(function(group){Array.isArray(group.steps)&&group.steps.forEach(function(step){$ctrl.stepsById[step.id]=step})})}}]}),angular.module("engage").component("umsSegmentRuleCustomerJourneyEditor",{template:'<ums-segment-rule-editor type="$ctrl.rule.type" save="$ctrl.save()" form="$ctrl.form"><div class="ums-flexgrid__container ums-flexgrid__container--sm"><input type="hidden" name="customerjourneys" ng-model="$ctrl.config.CustomerJourneySteps" ums-required-array><div class="ums-flexgrid__item ums-flexgrid__item--1-1 rte" ng-if="!$ctrl.rule.data.customerJourneyGroups || $ctrl.rule.data.customerJourneyGroups.length < 1"><span>There are no journeys configured. Please <a href="/umbraco/#/uMarketengageingSuite/personalization/journeys">configure these first</a>, before scoring your referral url\'s.</span></div><div class="ums-flexgrid__item rte" ng-if="$ctrl.rule.data.customerJourneyGroups.length > 0 && $ctrl.rule.data.customerJourneyGroups[0].steps.length < 1"><div class="ums-form__checkbox__label"><span>You have no customer journey steps configured. You should <a href="/umbraco/#/engage/personalization/journeys">add these journey steps first</a>, before you can score your referral url\'s.</span></div></div><div class="ums-flexgrid__item rte" ng-show="$ctrl.form.$submitted && $ctrl.form.customerjourneys.$invalid"><div class="ums-form__checkbox__label ums-form__checkbox__label--error"><span>At least one customer journey step should be selected.</span></div></div></div><div ng-repeat="journeyGroup in $ctrl.rule.data.customerJourneyGroups track by journeyGroup.id" ng-if="journeyGroup.steps.length > 0" class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-segmentparameter__label"><div class="ums-form__label" ng-bind="journeyGroup.title"></div></div><label ng-repeat="journeyStep in journeyGroup.steps" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><div class="ums-groupbox__container ums-groupbox__container--sm ums-segmentparameter__groupbox ums-segmentparameter__groupbox--padding" ng-attr-for="{{ \'journeystep-\' + journeyStep.id + \'-\' + $index }}" ng-class="{\'s-selected\': journeyStep.selected}"><input type="checkbox" name="selectedJourneyStep" class="ums-form__checkbox__input ums-groupbox__checkbox ums-segmentparameter__groupbox__checkbox" ng-checked="journeyStep.selected" ng-click="$ctrl.toggleStep(journeyStep)"><div class="ums-groupbox__colorbar ums-groupbox__colorbar--sm" style="background: {{journeyStep.color}};"></div><div class="ums-groupbox__image ums-groupbox__image--sm"><img ng-if="journeyStep.iconUrl" ng-src="{{ journeyStep.iconUrl }}" alt></div><div class="ums-groupbox__text"><h3 class="umsHeading" ng-bind="journeyStep.title"></h3><span ng-bind="journeyStep.description"></span></div></div></label></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){var $ctrl=this;this.$onInit=function(){this.rule.data.customerJourneyGroups.forEach(function(group){Array.isArray(group.steps)&&group.steps.forEach(function(step){step.selected=null!=$ctrl.config.CustomerJourneySteps&&$ctrl.config.CustomerJourneySteps.indexOf(step.id)>-1})})},this.toggleStep=function(step){step.selected=!step.selected,Array.isArray(this.config.CustomerJourneySteps)||(this.config.CustomerJourneySteps=[]);var idx=this.config.CustomerJourneySteps.indexOf(step.id);-1===idx?this.config.CustomerJourneySteps.push(step.id):this.config.CustomerJourneySteps.splice(idx,1)}}]}),angular.module("engage").run(["umsSegmentRuleRepository","umsCustomerJourneyApi",function(ruleRepo,customerJourneyApi){var rule={name:"Journey",type:"CustomerJourney",icon:"icon-journey",label:"Implicit",order:1,defaultConfig:{CustomerJourneySteps:[]},data:{customerJourneyGroups:[]},components:{display:"ums-segment-rule-customer-journey-display",editor:"ums-segment-rule-customer-journey-editor"},init:function(){return customerJourneyApi.getAll().then(function(groups){this.data.customerJourneyGroups=groups}.bind(this))}};ruleRepo.addRule(rule)}]),angular.module("engage").component("umsSegmentRuleDeviceDisplay",{template:'<span ng-repeat="device in $ctrl.config.Devices track by $index" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">or</span> <span ng-bind="device" class="ums-segmentrule__rulecontent"></span></span>',bindings:{config:"<"}}),angular.module("engage").component("umsSegmentRuleDeviceEditor",{template:'<ums-segment-rule-editor type="$ctrl.rule.type" save="$ctrl.save()" form="$ctrl.form"><div class="ums-flexgrid__container ums-flexgrid__container--sm"><input type="hidden" name="devices" ng-model="$ctrl.config.Devices" ums-required-array><div class="ums-flexgrid__item" ng-if="$ctrl.rule.data.devices.length === 0"><div class="ums-form__checkbox__label ums-form__checkbox__label--error">You have no visits at your website. You can only use the Device type parameters once you\'ve had visitors.</div></div><div class="ums-flexgrid__item" ng-show="$ctrl.form.$submitted && $ctrl.form.devices.$invalid"><div class="ums-form__checkbox__label ums-form__checkbox__label--error">At least one device type should be selected</div></div></div><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart" ng-show="$ctrl.rule.data.devices.length > 0"><div ng-repeat="device in $ctrl.rule.data.devices | orderBy:\'device.label\'" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox" ng-class="{\'s-selected\': device.selected}"><input type="checkbox" name="selectedBrowser" class="ums-form__checkbox__input" ng-checked="device.selected" ng-click="$ctrl.toggleDevice(device)"> {{device.label}}</label></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){var $ctrl=this;this.$onInit=function(){Array.isArray(this.rule.data.devices)&&this.rule.data.devices.forEach(function(device){device.selected=null!=$ctrl.config.Devices&&$ctrl.config.Devices.indexOf(device.value)>-1})},this.toggleDevice=function(device){device.selected=!device.selected,Array.isArray(this.config.Devices)||(this.config.Devices=[]);var idx=this.config.Devices.indexOf(device.value);-1===idx?this.config.Devices.push(device.value):this.config.Devices.splice(idx,1)}}]}),angular.module("engage").run(["umsSegmentRuleRepository","umsAnalyticsApi",function(ruleRepo,analyticsApi){var rule={name:"Device type",type:"Device",icon:"icon-device",order:3,defaultConfig:{Devices:[]},data:{devices:[]},components:{display:"ums-segment-rule-device-display",editor:"ums-segment-rule-device-editor"},init:function(){return function getAllDevices(){return analyticsApi.distinct("deviceCategory").then(function(devices){if(Array.isArray(devices))return devices.map(function(device){return{label:device,value:device}})})}().then(function(devices){this.data.devices=devices}.bind(this))}};ruleRepo.addRule(rule)}]),angular.module("engage").component("umsSegmentRuleLocationDisplay",{template:'<span class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin"><span class="ums-segmentrule__rulecontent"><span class="ums-segmentrule__rulecontent" ng-bind="$ctrl.config.country"></span> <span class="ums-segmentrule__rulecontent" ng-show="$ctrl.config.province" ng-bind="\', \' + $ctrl.config.province"></span> <span class="ums-segmentrule__rulecontent" ng-show="$ctrl.config.county" ng-bind="\', \' + $ctrl.config.county"></span> <span class="ums-segmentrule__rulecontent" ng-show="$ctrl.config.city" ng-bind="\', \' + $ctrl.config.city"></span></span></span>',bindings:{config:"<"}}),angular.module("engage").component("umsSegmentRuleLocationEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()"><div class="ums-flexgrid__item ums-flexgrid__item--1-1 rte" ng-if="$ctrl.rule.data.countries.length === 0"><div class="ums-form__checkbox__label"><span>Could not load localization data. Please refer to <a target="_blank" href="https://docs.umbraco.com/umbraco-engage/developers/analytics/location">the documentation</a> for more information.</span></div></div><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart is-animated" ng-show="$ctrl.rule.data.countries.length > 0"><div class="ums-flexgrid__item ums-flexgrid__item--1-2"><div class="ums-form__label">Country</div><select class="ums-form__select" ng-change="$ctrl.rule.selectUpdated($ctrl.config)" ng-model="$ctrl.config.country" ng-options="country as country for country in $ctrl.rule.data.countries" required></select></div></div><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart is-animated" ng-show="$ctrl.rule.data.provinces[$ctrl.config.country].length > 0"><div class="ums-flexgrid__item ums-flexgrid__item--1-2"><div class="ums-form__label">Province</div><select class="ums-form__select" ng-change="$ctrl.rule.selectUpdated($ctrl.config)" ng-model="$ctrl.config.province" ng-options="province as province for province in $ctrl.rule.data.provinces[$ctrl.config.country]"><option value>All</option></select></div></div><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart is-animated" ng-show="$ctrl.rule.data.counties[$ctrl.config.country + \'_\' + $ctrl.config.province].length > 0"><div class="ums-flexgrid__item ums-flexgrid__item--1-2"><div class="ums-form__label">County</div><select class="ums-form__select" ng-change="$ctrl.rule.selectUpdated($ctrl.config)" ng-model="$ctrl.config.county" ng-options="county as county for county in $ctrl.rule.data.counties[$ctrl.config.country + \'_\' + $ctrl.config.province]"><option value>All</option></select></div></div><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart is-animated" ng-show="$ctrl.rule.data.cities[$ctrl.config.country + \'_\' + $ctrl.config.province + \'_\' + $ctrl.config.county].length > 0"><div class="ums-flexgrid__item ums-flexgrid__item--1-2"><div class="ums-form__label">City</div><select class="ums-form__select" ng-change="$ctrl.rule.selectUpdated($ctrl.config)" ng-model="$ctrl.config.city" ng-options="city as city for city in $ctrl.rule.data.cities[$ctrl.config.country + \'_\' + $ctrl.config.province + \'_\' + $ctrl.config.county]"><option value>All</option></select></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"}}),angular.module("engage").run(["umsSegmentRuleRepository","$http",function(ruleRepo,$http){var rule={name:"Location",type:"Location",icon:"icon-location-map-black",order:5,defaultConfig:{country:"",province:"",county:"",city:""},data:{countries:[],provinces:{},counties:{},cities:{}},components:{display:"ums-segment-rule-location-display",editor:"ums-segment-rule-location-editor"},selectUpdated:function(config){null===config.country&&(config.country=""),null===config.province&&(config.province=""),null===config.county&&(config.county=""),null===config.city&&(config.city="")},init:function(){return $http.get("/umbraco/backoffice/engage/locationsegmentrule/getdata").then(response=>{this.data=response.data})}};ruleRepo.addRule(rule)}]),angular.module("engage").component("umsSegmentRuleMemberLoggedInDisplay",{template:'<span class="ums-segmentrule__wrapper"><span ng-show="$ctrl.config.isLoggedIn === true" class="ums-segmentrule__rulecontent">Member logged in</span> <span ng-show="$ctrl.config.isLoggedIn === false" class="ums-segmentrule__rulecontent">Member not logged in</span></span>',bindings:{config:"<"}}),angular.module("engage").component("umsSegmentRuleMemberLoggedInEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div ng-repeat="option in $ctrl.options" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.isLoggedIn" type="radio" class="ums-form__radio__input" name="isLoggedIn" ng-value="option.value" required> {{option.label}}</label></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){this.options=[{label:"Logged in",value:!0},{label:"Not logged in",value:!1}]}]}),angular.module("engage").run(["umsSegmentRuleRepository","umsAnalyticsApi",function(ruleRepo){ruleRepo.addRule({name:"Logged in members",type:"MemberLoggedIn",icon:"icon-logged-members",order:6,defaultConfig:{isLoggedIn:null},data:null,components:{display:"ums-segment-rule-member-logged-in-display",editor:"ums-segment-rule-member-logged-in-editor"}})}]),angular.module("engage").component("umsSegmentRuleMemberRegisteredDisplay",{template:'<span class="ums-segmentrule__wrapper"><span ng-show="$ctrl.config.isRegisteredMember === true" class="ums-segmentrule__rulecontent">Is a member</span> <span ng-show="$ctrl.config.isRegisteredMember === false" class="ums-segmentrule__rulecontent">Is not a member</span></span>',bindings:{config:"<"}}),angular.module("engage").component("umsSegmentRuleMemberRegisteredEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div ng-repeat="option in $ctrl.options" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.isRegisteredMember" type="radio" class="ums-form__radio__input" name="isRegisteredMember" ng-value="option.value" required> {{option.label}}</label></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){this.options=[{label:"Is a member",value:!0},{label:"Is not a member",value:!1}]}]}),angular.module("engage").run(["umsSegmentRuleRepository","umsAnalyticsApi",function(ruleRepo){ruleRepo.addRule({name:"Registered members",type:"MemberRegistered",icon:"icon-registered-members",order:6,defaultConfig:{isRegisteredMember:null},data:null,components:{display:"ums-segment-rule-member-registered-display",editor:"ums-segment-rule-member-registered-editor"}})}]),angular.module("engage").component("umsSegmentRuleNumberOfSessionsDisplay",{template:'<span class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin"><span ng-switch="$ctrl.config.operator" class="ums-segmentrule__rulecontent"><span ng-switch-when="eq" ng-bind="\'Exactly\'"></span> <span ng-switch-when="gt" ng-bind="\'More than\'"></span> <span ng-switch-when="lt" ng-bind="\'Less than\'"></span></span> <span class="ums-segmentrule__rulecontent ums-segmentrule__wrapper--thin"><span class="ums-segmentrule__rulecontent" ng-bind="$ctrl.config.sessions"></span> <span class="ums-segmentrule__rulecontent" ng-show="$ctrl.config.sessions === 1">session</span> <span class="ums-segmentrule__rulecontent" ng-show="$ctrl.config.sessions !== 1">sessions</span></span></span>',bindings:{config:"<"}}),angular.module("engage").component("umsSegmentRuleNumberOfSessionsEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart is-animated"><div class="ums-flexgrid__item ums-flexgrid__item--1-2"><select class="ums-form__select" ng-model="$ctrl.config.operator" ng-options="operator.value as operator.label for operator in $ctrl.operators" required></select></div><div class="ums-flexgrid__item ums-flexgrid__item--1-2"><label style="display: flex; align-items: center;"><input type="number" class="ums-form__input" ng-model="$ctrl.config.sessions" placeholder="0" style="margin-right: 20px;" required> <strong ng-show="$ctrl.config.sessions === 1" class="ums-form__label" style="margin: 0 20px 0 0; width: auto;">Session</strong> <strong ng-show="$ctrl.config.sessions !== 1" class="ums-form__label" style="margin: 0 20px 0 0; width: auto;">Sessions</strong></label></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){this.operators=[{value:"eq",label:"Exactly"},{value:"gt",label:"More than"},{value:"lt",label:"Less than"}]}]}),angular.module("engage").run(["umsSegmentRuleRepository",function(ruleRepo){ruleRepo.addRule({name:"Number of sessions",type:"NumberOfSessions",icon:"icon-number-sessions",order:5,defaultConfig:{operator:"eq",sessions:null},data:null,components:{display:"ums-segment-rule-number-of-sessions-display",editor:"ums-segment-rule-number-of-sessions-editor"}})}]),angular.module("engage").component("umsSegmentRuleOrderCompletedDisplay",{template:'<span class="ums-segmentrule__wrapper"><span ng-show="$ctrl.config.HasCompletedOrder === true" class="ums-segmentrule__rulecontent">Is a customer {{$ctrl.parsedSettingDate}}</span> <span ng-show="$ctrl.config.HasCompletedOrder === false" class="ums-segmentrule__rulecontent">Is not a customer {{$ctrl.parsedSettingDate}}</span></span>',bindings:{config:"<"},controller:[function(){var $ctrl=this;this.$onInit=function(){$ctrl.config&&$ctrl.config.settings&&$ctrl.config.settings.range&&("any"===$ctrl.config.settings.range.type||"days"===$ctrl.config.settings.range.type&&(void 0===$ctrl.config.settings.range.maximum&&($ctrl.config.settings.range.maximum=0),1===$ctrl.config.settings.range.maximum?$ctrl.parsedSettingDate="that placed an order in the last day":$ctrl.parsedSettingDate="that placed an order in the last "+$ctrl.config.settings.range.maximum+" days"))}}]}),angular.module("engage").component("umsSegmentRuleOrderCompletedEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div ng-repeat="option in $ctrl.options" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.HasCompletedOrder" type="radio" class="ums-form__radio__input" name="HasCompletedOrder" ng-value="option.value" required> {{option.label}}</label></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated"><ums-accordion-item name="Advanced settings" style="width: 100%"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Customer placed an order</div></div><div class="ums-form__row ums-form__row--small" ng-repeat="singleDateRange in $ctrl.rule.data.dateRange"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.settings.range.type" ng-attr-type="{{$ctrl.dateRange.type}}" class="ums-form__radio__input" ng-attr-name="{{$ctrl.dateRange.name}}" ng-value="singleDateRange.value" required> <span style="white-space: nowrap;" ng-bind="singleDateRange.label"></span> <input ng-if="singleDateRange.hasRange" ng-model="$ctrl.config.settings.range.maximum" type="number" placeholder="0" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-style="{\'color\': $ctrl.config.settings.range.type == singleDateRange.value ? \'inherit\' : \'#fff\'}" ng-required="$ctrl.config.range.type == singleDateRange.value"> <span style="margin-left: 10px;" ng-show="singleDateRange.hasRange && $ctrl.config.settings.range.maximum === 1" ng-bind="singleDateRange.valueType.single"></span> <span style="margin-left: 10px;" ng-show="singleDateRange.hasRange && $ctrl.config.settings.range.maximum !== 1" ng-bind="singleDateRange.valueType.multiple"></span></label></div></ums-accordion-item></div></div></ums-segment-rule-editor><p style="padding-left: 10px;"><i>A Visitor is considered a Customer once an order is placed.</i></p>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){this.options=[{label:"Is a customer",value:!0},{label:"Is not a customer",value:!1}],this.dateRange={model:"",type:"radio",name:"rangeAny"}}]}),angular.module("engage").run(["umsSegmentRuleRepository","$http","umsUtilService",function(ruleRepo,$http,umsUtilService){var rule={name:"Commerce - Existing customer",type:"OrderCompleted",icon:"icon-completed-order",order:21,defaultConfig:{HasCompletedOrder:null,settings:{range:{type:"any",maximum:0}}},data:{dateRange:[{value:"any",label:"Anytime"},{value:"days",label:"In the last",hasRange:!0,valueType:{single:"day",multiple:"days"}}]},components:{display:"ums-segment-rule-order-completed-display",editor:"ums-segment-rule-order-completed-editor"}};function GetEnabledAddons(){umsUtilService.getEnabledAddons().then(addons=>{clearInterval(checkUserInterval),!0===addons.UmbracoCommerce&&ruleRepo.addRule(rule)}).catch(function(error){})}GetEnabledAddons();var checkUserInterval=setInterval(GetEnabledAddons,5e3)}]),angular.module("engage").component("umsSegmentRulePageEventDisplay",{template:'<span class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin" ng-show="$ctrl.config.events.length > 0 && ($ctrl.config.events[0].Category || $ctrl.config.events[0].Action || $ctrl.config.events[0].Label)"><span ng-if="$ctrl.config.frequency.type == 0">Not triggered event</span> <span ng-if="$ctrl.config.frequency.type > 0">Triggered event</span> <span ng-repeat="pageEvent in $ctrl.config.events track by $index" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">or</span> <span ng-if="$index > 0">event</span> <span ng-if="pageEvent.Category" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">with category</span> <span ng-if="pageEvent.Category">"{{pageEvent.Category}}"</span> <span ng-if="pageEvent.Action" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">with action</span> <span ng-if="pageEvent.Action">"{{pageEvent.Action}}"</span> <span ng-if="pageEvent.Label" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">with label</span> <span ng-if="pageEvent.Label">"{{pageEvent.Label}}"</span></span> <span ng-if="$ctrl.config.frequency.type == 2" ng-bind-template="{{$ctrl.operators[$ctrl.config.frequency.operator].label | lowercase}} {{$ctrl.config.frequency.completions}} times"></span> <span ng-if="$ctrl.config.range.type == 0">in this session</span> <span ng-if="$ctrl.config.range.type == 1 || $ctrl.config.range.type == 2" ng-bind-template="in the last {{$ctrl.config.range.maximum}} {{$ctrl.config.range.type == 1 ? \'sessions\' : \'days\'}}"></span> <span ng-if="$ctrl.config.range.type == 3">anytime</span></span>',bindings:{config:"<",rule:"<"},controller:[function(){this.operators=[{value:0,label:"Exactly"},{value:1,label:"More than"},{value:2,label:"Less than"}]}]}),angular.module("engage").component("umsSegmentRulePageEventEditor",{template:'<ums-segment-rule-editor type="$ctrl.rule.type" save="$ctrl.save()" form="$ctrl.form"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--2-3 is-animated"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Frequency *</div></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="1" required> Has triggered this event</label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="2" required> <span style="white-space: nowrap;">Has triggered this event</span><select class="ums-form__select" ng-model="$ctrl.config.frequency.operator" ng-options="operator.value as operator.label for operator in $ctrl.operators" ng-required="$ctrl.config.frequency.type == 2"></select><input ng-model="$ctrl.config.frequency.completions" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-required="$ctrl.config.frequency.type == 2"> <span style="margin-left: 10px;">times</span></label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="0" required> Has not triggered this event</label></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated"><ums-goal-type-editor-page-event ng-repeat="pageEvent in $ctrl.config.events" all-required="false" config="pageEvent"></ums-goal-type-editor-page-event><br><hr></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated"><ums-accordion-item name="Advanced settings" style="width: 100%"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Date range *</div></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="3" required> Anytime</label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="0" required> In this session</label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="1" required> <span style="white-space: nowrap;">In the last</span> <input ng-model="$ctrl.config.range.maximum" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-style="{\'color\': $ctrl.config.range.type == 1 ? \'inherit\' : \'#fff\'}" ng-required="$ctrl.config.range.type == 1"> <span style="margin-left: 10px;">sessions</span></label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="2" required> <span style="white-space: nowrap;">In the last</span> <input ng-model="$ctrl.config.range.maximum" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-style="{\'color\': $ctrl.config.range.type == 2 ? \'inherit\' : \'#fff\'}" ng-required="$ctrl.config.range.type == 2"> <span style="margin-left: 10px;">days</span></label></div></ums-accordion-item></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){var $ctrl=this;this.$onInit=function(){0===$ctrl.config.events.length&&$ctrl.config.events.push(eventSettingsTemplate)};var eventSettingsTemplate={Category:null,Action:null,Label:null};$ctrl.operators=[{value:0,label:"Exactly"},{value:1,label:"More than"},{value:2,label:"Less than"}]}]}),angular.module("engage").run(["umsSegmentRuleRepository",function(ruleRepo){ruleRepo.addRule({name:"Event triggered",type:"PageEvent",icon:"icon-event-click",order:7,defaultConfig:{frequency:{type:1,operator:0,completions:0},events:[],range:{type:3,maximum:0}},data:null,components:{display:"ums-segment-rule-page-event-display",editor:"ums-segment-rule-page-event-editor"}})}]),angular.module("engage").component("umsSegmentRulePersonaDisplay",{template:'<span ng-repeat="personaId in $ctrl.config.Personas track by $index" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light">or</span> <span ng-bind="$ctrl.personasById[personaId].title" class="ums-segmentrule__rulecontent"></span></span>',bindings:{config:"<",rule:"<"},controller:[function(){var $ctrl=this;this.personasById={},this.$onInit=function(){this.rule.data.personaGroups.forEach(function(group){Array.isArray(group.personas)&&group.personas.forEach(function(persona){$ctrl.personasById[persona.id]=persona})})}}]}),angular.module("engage").component("umsSegmentRulePersonaEditor",{template:'<ums-segment-rule-editor type="$ctrl.rule.type" save="$ctrl.save()" form="$ctrl.form"><div class="ums-flexgrid__container ums-flexgrid__container--sm"><input type="hidden" name="personas" ng-model="$ctrl.config.Personas" ums-required-array><div class="ums-flexgrid__item ums-flexgrid__item--1-1 rte" ng-if="!$ctrl.rule.data.personaGroups || $ctrl.rule.data.personaGroups.length < 1"><div class="ums-form__checkbox__label"><span>There are no personas configured. Please <a href="/umbraco/#/engage/personalization/personas">configure these first</a>, before scoring this page.</span></div></div><div class="ums-flexgrid__item rte" ng-if="$ctrl.rule.data.personaGroups.length > 0 && $ctrl.rule.data.personaGroups[0].personas.length < 1"><div class="ums-form__checkbox__label"><span>You have no personas configured. You should <a href="/umbraco/#/engage/personalization/personas">add these personas first</a>, before you can score this page.</span></div></div><div class="ums-flexgrid__item rte" ng-show="$ctrl.form.$submitted && $ctrl.form.personas.$invalid"><div class="ums-form__checkbox__label ums-form__checkbox__label--error"><span>At least one persona should be selected.</span></div></div></div><div ng-repeat="personaGroup in $ctrl.rule.data.personaGroups track by personaGroup.id" ng-if="personaGroup.personas.length > 0" class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-segmentparameter__label"><div class="ums-form__label" ng-bind="personaGroup.title"></div></div><label ng-repeat="personaItem in personaGroup.personas | orderBy:\'title\'" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><div class="ums-groupbox__container ums-groupbox__container--sm ums-segmentparameter__groupbox ums-segmentparameter__groupbox--padding" ng-attr-for="{{ \'personagroup-\' + personaGroup.id + \'-\' + $index }}" ng-class="{\'s-selected\': personaItem.selected}"><input type="checkbox" name="selectedPersonaItem" class="ums-form__checkbox__input ums-groupbox__checkbox ums-segmentparameter__groupbox__checkbox" ng-checked="personaItem.selected" ng-click="$ctrl.togglePersona(personaItem)"><div class="ums-groupbox__colorbar ums-groupbox__colorbar--sm" ng-style="{ background: personaItem.color }"></div><div class="ums-groupbox__image ums-groupbox__image--sm"><img ng-if="personaItem.iconUrl" ng-src="{{ personaItem.iconUrl }}" alt></div><div class="ums-groupbox__text"><h3 class="umsHeading" ng-bind="personaItem.title"></h3><span ng-bind="personaItem.description"></span></div></div></label></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){var $ctrl=this;this.$onInit=function(){this.rule.data.personaGroups.forEach(function(group){Array.isArray(group.personas)&&group.personas.forEach(function(persona){persona.selected=null!=$ctrl.config.Personas&&$ctrl.config.Personas.indexOf(persona.id)>-1})})},this.togglePersona=function(persona){persona.selected=!persona.selected,Array.isArray(this.config.Personas)||(this.config.Personas=[]);var idx=this.config.Personas.indexOf(persona.id);-1===idx?this.config.Personas.push(persona.id):this.config.Personas.splice(idx,1)}}]}),angular.module("engage").run(["umsSegmentRuleRepository","umsPersonaApi",function(ruleRepo,personaApi){var rule={name:"Persona",type:"Persona",icon:"icon-persona",label:"Implicit",order:0,defaultConfig:{Personas:[]},data:{personaGroups:[]},components:{display:"ums-segment-rule-persona-display",editor:"ums-segment-rule-persona-editor"},init:function(){return personaApi.getAll().then(function(personaGroups){this.data.personaGroups=personaGroups}.bind(this))}};ruleRepo.addRule(rule)}]),angular.module("engage").component("umsSegmentRuleProductsInCartDisplay",{template:'<span class="ums-segmentrule__wrapper"><span ng-show="$ctrl.config.HasProductsInCart === true" class="ums-segmentrule__rulecontent">Has products in cart</span> <span ng-show="$ctrl.config.HasProductsInCart === false" class="ums-segmentrule__rulecontent">Has no products in cart</span></span>',bindings:{config:"<"}}),angular.module("engage").component("umsSegmentRuleProductsInCartEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div ng-repeat="option in $ctrl.options" class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><label class="ums-form__checkbox__label ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.HasProductsInCart" type="radio" class="ums-form__radio__input" name="HasProductsInCart" ng-value="option.value" required> {{option.label}}</label></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){this.options=[{label:"Has product(s) in cart",value:!0},{label:"Has no product(s) in cart",value:!1}]}]}),angular.module("engage").run(["umsSegmentRuleRepository","$http","umsUtilService",function(ruleRepo,$http,umsUtilService){var rule={name:"Commerce - Has Product(s) in Cart",type:"ProductsInCart",icon:"icon-shopping-cart",order:20,defaultConfig:{HasProductsInCart:null},data:null,components:{display:"ums-segment-rule-products-in-cart-display",editor:"ums-segment-rule-products-in-cart-editor"}};function GetEnabledAddons(){umsUtilService.getEnabledAddons().then(addons=>{clearInterval(checkUserInterval),!0===addons.UmbracoCommerce&&ruleRepo.addRule(rule)}).catch(function(error){})}GetEnabledAddons();var checkUserInterval=setInterval(GetEnabledAddons,5e3)}]),angular.module("engage").component("umsSegmentRuleReachedGoalsDisplay",{template:'<span class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin" ng-show="$ctrl.config.goals.length > 0"><span ng-if="$ctrl.config.frequency.type == 0">Not reached</span> <span ng-if="$ctrl.config.frequency.type > 0">Reached</span> <span ng-repeat="goal in $ctrl.config.goals track by $index" class="ums-segmentrule__wrapper"><span ng-if="$index > 0" class="ums-segmentrule__divider ums-segmentinfo__parameter__text--light"><span ng-if="$ctrl.config.frequency.type == 0 || $ctrl.config.frequency.type == 1 || $ctrl.config.frequency.type == 2">or</span> <span ng-if="$ctrl.config.frequency.type != 0 && $ctrl.config.frequency.type != 1 && $ctrl.config.frequency.type != 2">and</span></span> <span ng-bind="$ctrl.goalsById[goal].name" class="ums-segmentrule__rulecontent"></span></span> <span ng-if="$ctrl.config.frequency.type == 2 || $ctrl.config.frequency.type == 4" style="margin-right: 0;" ng-bind-template=", {{$ctrl.operators[$ctrl.config.frequency.operator].label | lowercase}} {{$ctrl.config.frequency.completions}} times"></span> <span ng-if="$ctrl.config.range.type == 0">, in this session</span> <span ng-if="$ctrl.config.range.type == 1 || $ctrl.config.range.type == 2" ng-bind-template=", in the last {{$ctrl.config.range.maximum}} {{$ctrl.config.range.type == 1 ? \'sessions\' : \'days\'}}"></span> <span ng-if="$ctrl.config.range.type == 3">, anytime</span></span>',bindings:{config:"<",rule:"<"},controller:[function(){var $ctrl=this;$ctrl.goalsById={},$ctrl.operators=[{value:0,label:"Exactly"},{value:1,label:"More than"},{value:2,label:"Less than"}],this.$onInit=function(){$ctrl.rule.data.goals.forEach(function(goal){$ctrl.goalsById[goal.id]=goal})}}]}),angular.module("engage").component("umsSegmentRuleReachedGoalsEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()"><div class="ums-flexgrid__container ums-flexgrid__container--sm ums-flexgrid__container--flexstart"><div class="ums-flexgrid__item ums-flexgrid__item--2-3 is-animated" style="max-width: unset;"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Frequency *</div></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="1" required> Has reached any of these goals</label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="2" required> <span style="white-space: nowrap;">Has reached any of these goals</span><select class="ums-form__select" ng-model="$ctrl.config.frequency.operator" ng-options="operator.value as operator.label for operator in $ctrl.operators" ng-required="$ctrl.config.frequency.type == 2"></select><input ng-model="$ctrl.config.frequency.completions" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-required="$ctrl.config.frequency.type == 2"> <span style="margin-left: 10px;">times</span></label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="3" required> Has reached all of these goals</label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="4" required> <span style="white-space: nowrap;">Has reached all of these goals</span><select class="ums-form__select" ng-model="$ctrl.config.frequency.operator" ng-options="operator.value as operator.label for operator in $ctrl.operators" ng-required="$ctrl.config.frequency.type == 4"></select><input ng-model="$ctrl.config.frequency.completions" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-required="$ctrl.config.frequency.type == 4"> <span style="margin-left: 10px;">times</span></label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.frequency.type" type="radio" class="ums-form__radio__input" name="frequencyAny" ng-value="0" required> Has reached none of these goals</label></div></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Goals *</div></div><table class="ums-table__table ums-table__table--no-minwidth"><thead class="ums-table__thead"><tr class="ums-table__tr ums-table__tr--labels"><th class="ums-table__th ums-table__th--fixed-xxxs"></th><th class="ums-table__th"><div class="umsLabel">Goal</div></th><th class="ums-table__th"><div class="umsLabel">Trigger</div></th><th class="ums-table__th"><div class="umsLabel">Type</div></th></tr></thead><tbody><tr class="ums-table__tr" ng-if="$ctrl.loading && $ctrl.rule.data.goals.length <= 0"><td class="ums-table__td" colspan="4"><img src="/umbraco/lib/tinymce/skins/lightgray/img/loader.gif" alt="Loading"> <span style="margin-left: 10px;">Loading goals ...</span></td></tr><tr class="ums-table__tr ums-table__tr--toggle" ng-if="$ctrl.rule.data.goals.length > 0" ng-repeat="goal in $ctrl.rule.data.goals | filter: {isActive: true} track by goal.id" ng-click="$ctrl.checkCheckbox(goal, $event)"><td class="ums-table__td ums-table__td--sm ums-table__td--check-padding"><input class="ums-form__checkbox__input" type="checkbox" style="margin-top:0;" ng-model="$ctrl.selected[goal.id]" ng-change="$ctrl.updateConfig(goal)"></td><td class="ums-table__td ums-table__td--sm"><span ng-bind="goal.name"></span></td><td class="ums-table__td ums-table__td--sm"><span ng-bind="goal.typeText"></span></td><td class="ums-table__td ums-table__td--sm"><span ng-bind-template="{{goal.isMain ? \'Macro\' : \'Micro\'}}"></span></td></tr></tbody></table></div><div class="ums-flexgrid__item ums-flexgrid__item--1-1 is-animated"><ums-accordion-item name="Advanced settings" style="width: 100%"><div class="ums-form__row ums-form__row--small"><div class="ums-form__label">Date range *</div></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="3" required> Anytime</label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="0" required> In this session</label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="1" required> <span style="white-space: nowrap;">In the last</span> <input ng-model="$ctrl.config.range.maximum" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-style="{\'color\': $ctrl.config.range.type == 1 ? \'inherit\' : \'#fff\'}" ng-required="$ctrl.config.range.type == 1"> <span style="margin-left: 10px;">sessions</span></label></div><div class="ums-form__row ums-form__row--small"><label class="ums-form__checkbox__label ums-form__checkbox__label--hover ums-segmentparameter__groupbox"><input ng-model="$ctrl.config.range.type" type="radio" class="ums-form__radio__input" name="rangeAny" ng-value="2" required> <span style="white-space: nowrap;">In the last</span> <input ng-model="$ctrl.config.range.maximum" type="number" min="0" class="ums-form__input" style="width: 55px; padding-right: 5px;" ng-style="{\'color\': $ctrl.config.range.type == 2 ? \'inherit\' : \'#fff\'}" ng-required="$ctrl.config.range.type == 2"> <span style="margin-left: 10px;">days</span></label></div></ums-accordion-item></div></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){var $ctrl=this;this.selected={},this.$onInit=function(){this.rule.data.goals.forEach(function(goal){this.selected[goal.id]=this.config.goals.indexOf(goal.id)>-1}.bind(this))},$ctrl.operators=[{value:0,label:"Exactly"},{value:1,label:"More than"},{value:2,label:"Less than"}],$ctrl.checkCheckbox=function(goal,$event){$event.target.classList.contains("ums-form__checkbox__input")||(this.selected[goal.id]=!this.selected[goal.id],this.updateConfig(goal))},$ctrl.updateConfig=function(goal){var idx=$ctrl.config.goals.indexOf(goal.id);-1===idx?$ctrl.config.goals.push(goal.id):$ctrl.config.goals.splice(idx,1)}}]}),angular.module("engage").run(["umsSegmentRuleRepository","umsGoalApi",function(ruleRepo,goalApi){var rule={name:"Reached goals",type:"Goal",icon:"icon-goals",order:8,defaultConfig:{frequency:{type:1,operator:0,completions:0},goals:[],range:{type:3,maximum:0}},data:{goals:null},components:{display:"ums-segment-rule-reached-goals-display",editor:"ums-segment-rule-reached-goals-editor"},init:function(){return goalApi.getAll({page:1,pageSize:99999,includeInvalid:!1}).then(function(response){this.data.goals=response.data.rows}.bind(this))}};ruleRepo.addRule(rule)}]),angular.module("engage").component("umsSegmentRuleTimeOfDayDisplay",{template:'<div ng-repeat="range in $ctrl.config.TimeRanges" class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin"><span ng-if="range.from != null" class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin"><span class="ums-segmentrule__rulecontent">From</span> <span class="ums-segmentrule__rulecontent" ng-bind="$ctrl.minutesToHm(range.from)"></span></span> <span ng-if="range.to != null" class="ums-segmentrule__wrapper ums-segmentrule__wrapper--thin"><span class="ums-segmentrule__rulecontent">until</span> <span class="ums-segmentrule__rulecontent" ng-bind="$ctrl.minutesToHm(range.to)"></span></span></div>',bindings:{config:"<"},controller:[function(){this.minutesToHm=function(minutes){if(null===minutes||isNaN(minutes)||minutes<0)return null;var hrs=Math.floor(minutes/60),min=minutes%60;return(hrs<10?"0"+hrs:hrs)+":"+(min<10?"0"+min:min)}}]}),angular.module("engage").component("umsSegmentRuleTimeOfDayEditor",{template:'<ums-segment-rule-editor name="$ctrl.rule.name" type="$ctrl.rule.type" save="$ctrl.save()" form="$ctrl.form"><div class="ums-flexgrid__container ums-flexgrid__container--sm"><input type="hidden" name="timeofday" ng-model="$ctrl.timeofday" required ng-if="$ctrl.config.TimeRanges[0].from == null && $ctrl.config.TimeRanges[0].to == null"><div class="ums-flexgrid__item" ng-show="$ctrl.form.$submitted && $ctrl.form.timeofday.$invalid"><div class="ums-form__checkbox__label ums-form__checkbox__label--error">Please specify at least "From" or "Until"</div></div></div><div class="ums-flexgrid__container" ng-repeat="timebox in $ctrl.config.TimeRanges"><label class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><div class="ums-form__label">From</div><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker" style="max-height: 40px;"><umb-flatpickr options="$ctrl.timepicker.options" on-setup="$ctrl.onSetupPicker(fpItem, $ctrl.minutesToDate(timebox.from), \'from\')" on-change="$ctrl.onTimePickerChange($ctrl.timepicker.from, \'from\')" on-open="$ctrl.onTimePickerChange($ctrl.timepicker.from, \'from\')" class="ums-segmentparameter__datepicker-input"></umb-flatpickr><span class="ums-form__input-icon"><ums-icon id="icon-status-running" modifier="sm"></ums-icon></span> <button class="ums-segmentparameter__datepicker-btn" ng-if="timebox.from != null" ng-click="$ctrl.timepicker.from.clear()" type="button"><i class="icon-delete"></i></button></div></label> <label class="ums-flexgrid__item ums-flexgrid__item--1-2 is-animated"><div class="ums-form__label">Until</div><div class="ums-form__input-iconwrap ums-segmentparameter__datepicker" style="max-height: 40px;"><umb-flatpickr options="$ctrl.timepicker.options" on-setup="$ctrl.onSetupPicker(fpItem, $ctrl.minutesToDate(timebox.to), \'to\')" on-change="$ctrl.onTimePickerChange($ctrl.timepicker.to, \'to\')" on-open="$ctrl.onTimePickerChange($ctrl.timepicker.to, \'to\')" class="ums-segmentparameter__datepicker-input"></umb-flatpickr><span class="ums-form__input-icon"><ums-icon id="icon-status-running" modifier="sm"></ums-icon></span> <button class="ums-segmentparameter__datepicker-btn" ng-if="timebox.to != null" ng-click="$ctrl.timepicker.to.clear()" type="button"><i class="icon-delete"></i></button></div></label></div></ums-segment-rule-editor>',bindings:{rule:"<",config:"<",save:"&"},controller:[function(){var $ctrl=this;this.timepicker={options:{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0},from:null,to:null},this.onSetupPicker=function(picker,time,fromOrTo){picker.element.placeholder="Select time...",$ctrl.timepicker[fromOrTo]=picker,$ctrl.timepicker[fromOrTo].setDate(time,!1)},this.onTimePickerChange=function(picker,fromOrTo){var newDateToInsert=null;picker.selectedDates.length>0&&(newDateToInsert=picker.selectedDates[0]),$ctrl.config.TimeRanges[0][fromOrTo]=$ctrl.dateToMinutes(newDateToInsert)},this.dateToMinutes=function(date){return null===date?null:60*date.getHours()+date.getMinutes()},this.minutesToDate=function(minutes){return null===minutes||isNaN(minutes)||minutes<0||minutes>1440?null:new Date(60*minutes*1e3).toISOString().substr(11,5)}}]}),angular.module("engage").run(["umsSegmentRuleRepository",function(ruleRepo){ruleRepo.addRule({name:"Time of day",type:"TimeOfDay",icon:"icon-status-running",order:4,defaultConfig:{TimeRanges:[{from:null,to:null}]},data:null,components:{display:"ums-segment-rule-time-of-day-display",editor:"ums-segment-rule-time-of-day-editor"}})}])}();